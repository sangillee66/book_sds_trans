{
  "hash": "bf31546ebf045e679b13668a3e4b6b88",
  "result": {
    "engine": "knitr",
    "markdown": "---\ndate-modified: last-modified\nnumber-sections: true\nformat: \n  html: \n    toc: true\ncode-link: true\ncode-copy: true\nexecute: \n  warning: false\n  error: false\n  freeze: auto\neditor: visual\n---\n\n\n# 공간계량경제학적 모델 {#sec-econometrics}\n\n공간 가중치 행렬을 활용하고 최대우도추정법을 적용하는 전형적인 형태의 공간적 자기회귀 모델은 이미 오래전에 정식화된 바 있다(Cliff and Ord 1973, 1981). 이러한 초기 연구를 확장하여 공간 계량경제학적 관점에서 일단의 모델이 발전해 왔으며, 많은 경우 동시적 자기회귀 프레임워크와 행 표준화 공간 가중치 행렬이 사용되었다(Anselin 1988). 동시적 자기회귀 프레임워크와 조건부 자기회귀 프레임워크가 두 개의 축을 이루고 있으며, 두 프레임워크 모두 보완적 차원에서 관측치의 상대적 중요성을 반영하기 위한 사례 가중치를 활용할 수 있다(Waller and Gotway 2004).\n\n공간 회귀 모델을 적합시키는 과정에서 제기되는 이슈들을 논의하기에 앞서, 몇 가지 사항을 언급하고자 한다. 공간적 회귀분석을 공간계량경제학적 맥락에서의 접근하는 방식에 대한 최근 리뷰는 Kelejian과 Piras(2017)에 의해 제공되었다. 이 연구에서는 공간 지체 반응 변수의 계수를 $\\lambda$, 공간 지체 잔차의 계수를 $\\rho$로 명명하고 있는데, 이는 다른 연구들(Anselin 1988; LeSage and Pace 2009)과는 거꾸로 이다. 여기서는 공간 지체 모델의 공간 계수는 $\\rho_\\text {Lag}$로, 공간 오차 모델의 공간 계수는 $\\rho_\\text{Err}$로 표현하고자 한다. 흥미로운 발견 중 하나는 상대적으로 밀도가 높은 공간 가중치 행렬이 모델 추정치를 과소평가할 가능성이 있다는 점인데, 이는 희소 가중치 행렬이 더 적합하다는 점을 시사하는 것이다(Smith 2009). 또 다른 유용한 발견은 잔차에 공간적 자기상관이 존재하더라도, 공변량 자체가 공간적 자기상관을 나타내지 않는 한 편향된 회귀 계수 분산의 추정치가 산출되지는 않는다는 점이다(Smith and Lee 2012). 그러나 일반적으로 반응 변수와 공변량의 공간 과정이 일치하지 않을 가능성이 있으며, 공변량과 잔차가 공간적 자기상관을 보이는 경우 공간 과정을 모델링하려는 시도가 이루어지지 않는 한 회귀 계수 분산의 추정치가 과소평가될 가능성이 높다.\n\n## 정의\n\n공간 과정을 모델링하려는 시도 중 가장 초기의 공간계량경제학적 정식 중 하나는 잔차의 공간 자기상관을 모델링하는 것이다(공간 오차 모델, SEM):\n\n$$\n\\textbf{y}=\\textbf{X}\\beta+\\textbf{u},\\qquad \\textbf{u}=\\rho_\\text {Err} \\textbf{Wu}+\\epsilon,\n$$\n\n여기서 $\\textbf{y}$는 $N$ 위치에서 측정된 반응 변수로 $(N\\times1)$ 관측치 벡터, $\\textbf{X}$는 $(N \\times k)$ 공변량 행렬, $\\beta$는 $(k \\times 1)$ 계수 벡터, $\\textbf{u}$는 $(N \\times 1)$ 공간적 자기상관을 가진 교란 벡터, $\\epsilon$은 독립항등분포를 가진 $(N \\times 1)$ 교란 벡터, $\\rho_\\text{Err}$은 스칼라 공간 파라미터이다.\n\n이 모델과 유사한 다른 공간계량경제학 모델들은 혼합 모델 프레임워크에 부합하지 않는다. 여기서 모델링된 공간 과정은 반응 변수, 공변량, 그리고 계수와 직접적으로 상호작용한다. 이러한 종류의 모델링 프레임워크는 시계열 프레임워크를 단순히 2차원으로 확장한 오래된 전통에서 기원한 것으로 보인다.\n\n$$\n\\textbf{u}=(\\textbf{I}-\\rho_\\text{Err}\\textbf{W})^{-1}\\epsilon,\\quad \\textbf{y}=\\textbf{X}\\beta+(\\textbf{I}-\\rho_\\text{Err}\\textbf{W})^{-1}\\epsilon,\\quad (\\textbf{I}-\\rho_\\text{Err}\\textbf{W})\\textbf{y}=(\\textbf{I}-\\rho_\\text{Err}\\textbf{W})\\textbf{X}\\beta+\\epsilon.\n$$\n\n공변량과 반응 변수에서의 과정이 일치한다면, 최소제곱법 계수와 SEM 계수 간의 차이는 거의 없을 것이다. 그러나 실제로는 두 개의 과정이 일치하지 않으며, 이를 고려하기 위해서는 Hausman 검정과 같은 부가적인 조치가 필요하다(Pace and LeSage 2008). 이는 공간 과정이 일치하는 경우 시계열 분석에서의 단위근과 공적분 개념을 공간적으로 확장하는 이전 논의와 관련이 있을 수 있다(Fingleton 1999).\n\n반응 변수에만 공간 과정을 포함하는 모델은 공간 지체 모델(SLM, 종종 SAR - 공간적 자기회귀 모델)이라고 한다(LeSage and Pace 2009). Durbin 모델은 공변량에 공간 지체 공변량을 추가한 모델이다. 공간 Durbin 모델에 대한 리뷰는 Mur와 Angulo(2006)를 살펴보면 된다. 만약 반응 변수에 공간 과정 외에도 잔차에 공간 과정을 포함시키기로 선택한다면, 다시 두 가지 모델이 형성된다. 하나는 모든 모델을 포함하는 일반적인 중첩 모델(GNM, general nested model)이고, 다른 하나는 공간 지체 공변량을 포함하지 않는 모델(SAC, 또한 SARAR(Spatial AutoRegressive-AutoRegressive) 모델)이다. 만약 잔차나 반응 변수에 공간 과정을 모델링하지 않는다면, 공간 지체 공변량을 선형 모델에 추가할 수 있다. 이를 공간 지체 X 모델(SLX)이라고 한다(Elhorst 2010; Bivand 2012; LeSage 2014; Halleck Vega and Elhorst 2015). GNM은 다음과 같이 표현할 수 있다:\n\n$$\n\\textbf{y}=\\rho_\\text{Lag}\\textbf{Wy}+\\textbf{X}\\beta+\\textbf{WX}\\gamma+\\textbf{u},\\qquad \\textbf{u}=\\rho_\\text{Err}\\textbf{Wu}+\\epsilon\n$$\n\n여기서 $\\gamma$는 $(k' \\times 1)$ 파라미터 벡터이다. $k'$는 절편과 공변량의 일부를 정의하는데, 행표준화 공간 가중치를 사용하고 공간 지체 절편을 누락하는 경우 $k'=k-1$이다.\n\n이 기본 모델에 제약을 가하면 다양한 변용 모델이 생성되는데, $\\gamma = 0$으로 설정하면 이중 공간 계수 모델인 SAC/SARAR 모델이 되고, $\\rho_\\text{Lag}=0$으로 설정하면 오차 Durbin 모델(SDEM)이 된다. 더 많은 조건을 부여할 수 있는데, $\\gamma = 0$와 $\\rho_\\text{Err}=0$로 설정하면 공간 지체 모델(SLM), $\\gamma=0$와 $\\rho_\\text{Lag}=0$로 설정하며 공간 오차 모델(SEM), $\\rho_\\text{Lag}=0$과 $\\rho_\\text{Err}=0$로 설정하면 공간 지체 X 모델(SLX)을 얻을 수 있다.\n\n공변량이 관측된 새로운 위치에 대해 예측을 행하는 것과 관련된 이슈들은 오래전에 인식되었지만, 가능성에 대한 검토에서 진전을 이루는 데는 많은 시간이 걸렸다(Bivand 2002; Goulard, Laurent, and Thomas-Agnan 2017; Laurent and Margaretic 2021). 최대우도추정법으로 적합된 SLM, SDM, SEM, SDEM, SAC, GNM 모델을 예측에 적용하는 방법은 Google Summer of Coding 프로젝트를 수행한 Martin Gubri의 공로가 크다. 이 프로젝트와 결측 데이터를 다루는 유사한 모델에 대한 연구(Suesse 2018)를 원용하면 보스턴 데이터셋에서 검열된 중앙값 주택 가격을 탐색하는 연구에 시사점을 얻을 수 있다. 예측 이슈를 다루다 보면 해당 모델의 축약 형태가 매우 중요하다는 점을 인식하게 되는데, SLM, SDM, SAC, GNM 모델에서처럼 반응 변수의 공간 과정이 회귀 계수와 상호작용하는 경우 보다 단순화된 형태가 도움이 될 수 있다.\n\n반응 변수와 회귀 계수 간의 이러한 상호작용의 결과는, 공변량의 단위 변화가 회귀 계수의 값으로 반응 변수에 영향을 미치려면 공간 지체 반응 변수의 계수가 0이어야 한다는 것이다. 만약 공간 계수가 0이 아니라면, 글로벌 파급효과가 작용하게 되며, 이러한 파급효과의 크기는 회귀 계수 만큼이나 중요한 정보이다(LeSage and Pace 2009; Elhorst 2010; Bivand 2012; LeSage 2014; Halleck Vega and Elhorst 2015). SDEM 및 SLX 모델의 경우, 각 공변량의 총 파급효과(공변량 및 공간 지체 공변량 계수의 합)의 표준 오차를 계산하기 위해 선형 결합을 사용하여 로컬 파급효과를 나타낸다.\n\n이것은 GNM 데이터 생성 과정에서 확인할 수 있다:\n\n$$\n(\\textbf{I}-\\rho_{\\text Err}\\textbf{W})(\\textbf{I}-\\rho_{\\text Lag}\\textbf{W})\\textbf{y}=(\\textbf{I}-\\rho_{\\text Err}\\textbf{W})(\\textbf{X}\\beta+\\textbf{WX}\\gamma)+\\epsilon\n$$\n\n다음과 같이 다르게 나타낼 수 있다.\n\n$$\n\\textbf{y}=(\\textbf{I}-\\rho_\\text{Lag}\\textbf{W})^{-1}(\\textbf{X}\\beta+\\textbf{WX}\\gamma)+(\\textbf{I}-\\rho_\\text{Lag}\\textbf{W})^{-1}(\\textbf{I}-\\rho_\\text{Err}\\textbf{W})^{-1}\\epsilon.\n$$\n\n$\\rho_\\text{Lag}$와 $\\beta$ 간의 상호작용($\\gamma$가 존재할 경우, 셋 간의 상호작용)이 존재한다. 이것은 다음의 편도함수로부터 확인할 수 있다. $\\partial y_i/\\partial x_{jr}=((\\textbf{I}-\\rho_\\text{Lag}\\textbf{W})^{-1}(\\textbf{I}\\beta_r+\\textbf{W}\\gamma_r))_{ij}$. 여기서 밀집 행렬 $S_r(\\textbf{W})=((\\textbf{I}-\\rho_\\text{Lag}\\textbf{W})^{-1}(\\textbf{I}\\beta_r+\\textbf{W}\\gamma_r))$의 주대각 요소는 직접적인 영향(효과)을 나타내고, 비대각 요소는 간접적인 영향을 나타낸다.\n\nPiras와 Prucha (2014)는 Raymond J. G. M. Florax, Folmer, Rey (2003)를 재검토하고 수정하였다(또한 Hendry (2006)와 Raymond J. G. M. Florax, Folmer, Rey (2006)의 논평 참조). 이들은 모델 선택을 위해 통상적으로 사용되는 사전 검정(pre-test) 전략보다는 해당 모델링에 적합한 가장 일반적인 모델을 추정하는 전략이 더 낳다고 결론지었다. 이 발견에 비추어, 여기서는 사전 검정 모델 선택을 사용하지 않는다.\n\n현재 **spatialreg** 패키지가 주의를 기울이고 있는 것은 공간 지체 공변량을 처리하는 방법을 개선하는 것인데, `Durbin` 아규먼트를 사용하여 공간 지체 형식으로 추가할 공변량의 하위 집합을 제공하는 논리 값이나 수식을 받는다. 일부 공변량, 예를 들어 더미 변수와 같은 것들은 공간 지체 형식으로 추가되지 않아야 한다는 주장이 있다. 일단 공간 지체 공변량이 선택되면 다음의 이슈는 영향력을 계산할 때 이를 어떻게 적절하게 다룰지와 관련된 다. 이렇게 개선된 기능은 MCMC 또는 최대우도추정법으로 적합된 횡단면 모델에 적용되며, 공간 패널 모델에 적용될 예정이다.\n\n거의 다루어지지 않은 이슈인 기능적 형태 가정(functional form assumption)을 언급하는 것은 충분한 가치가 있다. 이 이슈는 예를 들어 **McSpatial** 패키지에서 제시된 공간 분위수 회귀(McMillen 2013)와 같은 유연한 구조가 유용한 상황과 관련되어 있다. 또한 **McSpatial** 패키지의 일부 함수, 새로운 패키지 **spldv**(Sarrias and Piras 2022), 그리고 **spatialprobit** 패키지 및 **ProbitSpatial** 패키지(Wilhelm and Matos 2013; Martinetti and Geniaux 2017)에서 다루는 이산 반응 변수와 관련된 이슈들도 있다. **McSpatial** 패키지의 MCMC 실행은 LeSage와 Pace(2009)를 기반으로 한다. 마지막으로, Wagner와 Zeileis(2019)는 SLM 모델이 재귀적 분할 설정에서 어떻게 사용될 수 있는지 보여주며, 이를 **spatialreg** 패키지의 `lagsarlm()` 함수를 사용한 **lagsarlmtree** 패키지에서 구현하는 방법을 제시한다.\n\n**spatialreg** 패키지(Bivand and Piras 2022)를 통해 횡단(cross-sectional) 최대우도추정과 일반화된 모멘트법(GMM) 추정을 행하는 것과 **sphet** 패키지를 통해 공간계량경제학 스타일의 공간 회귀 모델을 행하는 것에 대한 리뷰(Bivand and Piras 2015)는 여전히 대부분 유효하다. 이 리뷰에서는 R 패키지에서의 추정량을 다른 프로그래밍 언어에서 제공되는 대체 구현과 비교하였다. 그러나 베이지안 공간계량경제학 스타일의 공간 회귀는 다루지 않았다. Millo와 Piras (2012)에서 설명한 공간 패널 추정량에 대해서는 더 많은 변화가 있었지만, 여기서는 다루지 않는다.\n\nBivand, Millo, and Piras (2021)는 공간계량경제학적 분석을 위한 R 패키지의 많은 기능을 다루고 있으며, Bivand와 Piras (2015)를 업데이트하고 일반화된 모멘트법(GMM) 및 공간 패널 모델링의 최근 발전을 포함하고 있기 때문에, 이 장에서는 Boston 주택 가격 데이터셋을 사용한 Bivand (2017)의 예제 몇 가지만 제한적으로 다룰 것이다.\n\n## 최대우도추정: spatialreg 패키지의 활용\n\n단일 공간 계수를 가진 모델(SEM 및 SDEM은 `errorsarlm()` 함수 사용, SLM 및 SDM은 `lagsarlm()` 함수 사용)에는 Ord (1975)가 처음 설명한 방법이 사용된다. 다음 표는 최대우도추정법을 사용하여 위에서 설명한 모델을 추정할 수 있는 함수들을 보여준다.\n\n| 모델 | 모델명           | 최대우도추정 함수               |\n|------|------------------|---------------------------------|\n| SEM  | 공간에러         | `errorsarlm(..., Durbin=FALSE)` |\n| SEM  | 공간에러         | `spautolm(..., family=\"SAR\")`   |\n| SDEM | 공간더빈에러     | `errorsarlm(..., Durbin=TRUE)`  |\n| SLM  | 공간지체         | `lagsarlm(..., Durbin=FALSE)`   |\n| SDM  | 공간더빈         | `lagsarlm(..., Durbin=TRUE)`    |\n| SAC  | 공간자기회귀결합 | `sacsarlm(..., Durbin=FALSE)`   |\n| GNM  | 일반 포함        | `sacsarlm(..., Durbin=TRUE)`    |\n\n추정 함수인 `errorsarlm()`과 `lagsarlm()`은 비슷한 인자를 받는데, 첫 번째와 두 번째 인가(`formula`와 `data`)는 대부분의 모델 추정 함수에서 공통적으로 사용된다. 세 번째 인자는 `listw` 공간 가중치 객체이고, `na.action`은 결측값을 가진 관측개체의 공간 가중치를 처리하는 방법을 정의하는데 다른 모델 추정 함수와 동일하게 동작한다. `weights` 아규먼트는 분산 항목에서 관측값별 변동성을 나타내는 가중치를 제공하는 데 사용된다. 단, `lagsarlm()` 함수에서는 이 옵션이 제공되지 않는다.\n\n`Durbin` 아규먼트는 이전의 `type`과 `etype` 인자를 대체하며, 주어지지 않으면 기본값은 `FALSE`로 설정된다. 만약 제공된다면, `FALSE`나 `TRUE`일 수 있으며, 이 경우 모든 공간 지체 설명 변수가 포함된다. 또는, 일면 공식(one-sided formula)를 통해 어떤 공간 지체 설명 변수가 포함될지를 지정할 수 있다. `method` 아규먼트는 로그 우도 함수에서 로그 행렬식 항을 계산하는 방법을 지정하며, 기본값은 `\"eigen\"`으로, 이는 중간 크기의 데이터셋에 적합하다. `interval` 아규먼트는 **stats** 패키지의 `optimize()` 함수를 통해 공간 계수를 찾는 선형 탐색의 도메인 범위를 제공한다. `tol.solve()` 아규먼트는 **base** 패키지의 `solve()` 함수에 전달되며, 이는 회귀 계수 간에 수치적 스케일 차이가 있는 데이터셋에서 분산-공분산 행렬의 역행렬을 계산하는 데 필요하다. 디폴트 값은 `base::solve()`에서 훨씬 더 큰 값이다. `control` 아규먼트는 추정 함수 실행을 더 세밀하게 조정할 수 있게 해주는 제어 값의 리스트를 받는다.\n\n`sacsarlm()` 함수는 SAC 및 GNM 형식에서 두 개의 공간적 프로세스를 모델링할 때 서로 다른 두 개의 공간 가중치를 사용하는 경우, 두 번째 공간 가중치 및 `interval` 아규먼트를 받을 수 있다. 디폴트는 동일한 공간 가중치를 사용하는 것이다. 기본적으로는 **stats** 패키지의 `nlminb()` 함수가 수치 최적화에 사용되며, 시작 값을 선택하는 데 휴리스틱이 사용된다. `lagsarlm()`함수와 마찬가지로, 이 함수는 `weights` 아규먼트를 받지 않는다.\n\n대용량 데이터셋이 사용되는 경우, 계수의 분산-공분산 행렬을 계산하기 위해 분석적 점근적(analytic asymptotic) 접근 방식 대신 수치적 헤시안(Hessian) 접근 방식이 사용된다.\n\n### 보스턴 주택 가격 데이터셋 예시\n\n예제는 Bivand (2017)를 기반으로 16장에서 생성된 객체들을 사용한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(spatialreg)\neigs_489 <- eigenw(lw_q_489)\nSDEM_489 <- errorsarlm(form, data = boston_489, \n      listw = lw_q_489, Durbin = TRUE, zero.policy = TRUE,\n      control = list(pre_eig = eigs_489))\nSEM_489 <- errorsarlm(form, data = boston_489, \n      listw = lw_q_489, zero.policy = TRUE,\n      control = list(pre_eig = eigs_489))\n```\n:::\n\n\n디폴트인 `\"eigen\"` 방법을 사용하기 위해 미리 계산된 고유값을 `control` 리스트 아규먼트를 사용하여 전달한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbind(data.frame(model=c(\"SEM\", \"SDEM\")), \n      rbind(broom::tidy(Hausman.test(SEM_489)), \n            broom::tidy(Hausman.test(SDEM_489))))[,1:4]\n#   model statistic  p.value parameter\n# 1   SEM      52.0 2.83e-06        14\n# 2  SDEM      48.7 6.48e-03        27\n```\n:::\n\n\n489개의 트랙트 데이터셋에 대한 두 가지 Hausman 검정 결과는 회귀 계수가 비공간적 회귀분석의 회귀계수와는 유의미하게 다르다는 것을 시사하며, 이는 공간 프로세스의 발자국이 일치하지 않음을 함축한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\neigs_94 <- eigenw(lw_q_94)\nSDEM_94 <- errorsarlm(form, data=boston_94, listw=lw_q_94,\n                      Durbin = TRUE,\n                      control = list(pre_eig=eigs_94))\n# Warning in RET$pfunction(\"adjusted\", ...): Completion with error >\n# abseps\n\n# Warning in RET$pfunction(\"adjusted\", ...): Completion with error >\n# abseps\n\n# Warning in RET$pfunction(\"adjusted\", ...): Completion with error >\n# abseps\n\n# Warning in RET$pfunction(\"adjusted\", ...): Completion with error >\n# abseps\nSEM_94 <- errorsarlm(form, data = boston_94, listw = lw_q_94,\n                     control = list(pre_eig = eigs_94))\n```\n:::\n\n\n94개의 대기 오염 모델 출력 구역에 대한 Hausman 검정은 계수 간 큰 차이를 발견하지 못했다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbind(data.frame(model=c(\"SEM\", \"SDEM\")), \n      rbind(broom::tidy(Hausman.test(SEM_94)), \n            broom::tidy(Hausman.test(SDEM_94))))[, 1:4]\n#   model statistic p.value parameter\n# 1   SEM     15.66   0.335        14\n# 2  SDEM      9.21   0.999        27\n```\n:::\n\n\n이러한 결과는 SEM과 SDEM 모델이 대기 오염 모델 출력 구역 수준에서 최소 제곱법이나 SLX에 거의 추가적인 차이를 만들지 않았다는 점을 보여준다. 우도비 검정을 통해 이러한 사실을 확인할 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbind(data.frame(model=c(\"SEM\", \"SDEM\")),\n      rbind(broom::tidy(LR1.Sarlm(SEM_94)),\n            broom::tidy(LR1.Sarlm(SDEM_94))))[,c(1, 4:6)]\n#   model statistic p.value parameter\n# 1   SEM     2.593   0.107         1\n# 2  SDEM     0.216   0.642         1\n```\n:::\n\n\n**spatialreg** 패키지의 `LR.Sarlm()` 함수를 사용하면 중첩(nested) 모델 간에 우도비 검정을 실행할 수 있지만, 여기서는 **lmtest** 패키지의 `lrtest()` 함수를 사용하는데 결과는 동일하다. 트랙트와 모델 출력 구역 모두에서 공간 지체 공변량을 포함하는 모델이 보다 선호된다는 결과가 산출된다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\no <- lmtest::lrtest(SEM_489, SDEM_489)\nattr(o, \"heading\")[2] <- \"Model 1: SEM_489\\nModel 2: SDEM_489\"\no\n# Likelihood ratio test\n# \n# Model 1: SEM_489\n# Model 2: SDEM_489\n#   #Df LogLik Df Chisq Pr(>Chisq)    \n# 1  16    274                        \n# 2  29    311 13  74.4    1.2e-10 ***\n# ---\n# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\no <- lmtest::lrtest(SEM_94, SDEM_94)\nattr(o, \"heading\")[2] <- \"Model 1: SEM_94\\nModel 2: SDEM_94\"\no\n# Likelihood ratio test\n# \n# Model 1: SEM_94\n# Model 2: SDEM_94\n#   #Df LogLik Df Chisq Pr(>Chisq)    \n# 1  16   59.7                        \n# 2  29   81.3 13  43.2    4.2e-05 ***\n# ---\n# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n\nSLX 모델은 최소제곱법을 사용하여 적합되며, 로그 우도 값을 반환하여 잔차에 공간적 과정 요소가 포함될 필요가 있는지를 테스트할 수 있게 해준다. 트랙트 데이터셋에서는 분명히 그렇다는 결과가 도출되었다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSLX_489 <- lmSLX(form, data = boston_489, listw = lw_q_489,\n                 zero.policy = TRUE)\no <- lmtest::lrtest(SLX_489, SDEM_489)\nattr(o, \"heading\")[2] <- \"Model 1: SLX_489\\nModel 2: SDEM_489\"\no\n# Likelihood ratio test\n# \n# Model 1: SLX_489\n# Model 2: SDEM_489\n#   #Df LogLik Df Chisq Pr(>Chisq)    \n# 1  28    231                        \n# 2  29    311  1   159     <2e-16 ***\n# ---\n# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n\n그러나 산출 존 데이터에 대해서는 반대의 결과가 도출되었다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSLX_94 <- lmSLX(form, data = boston_94, listw = lw_q_94)\no <- lmtest::lrtest(SLX_94, SDEM_94)\nattr(o, \"heading\")[2] <- \"Model 1: SLX_94\\nModel 2: SDEM_94\"\no\n# Likelihood ratio test\n# \n# Model 1: SLX_94\n# Model 2: SDEM_94\n#   #Df LogLik Df Chisq Pr(>Chisq)\n# 1  28   81.2                    \n# 2  29   81.3  1  0.22       0.64\n```\n:::\n\n\n이러한 결과는 주택 단위 수를 트랙트와 출력 구역별로 집계하여 사례 가중치를 사용할 때도 유지된다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSLX_489w <- lmSLX(form, data = boston_489, listw = lw_q_489,\n                  weights = units, zero.policy = TRUE)\nSDEM_489w <- errorsarlm(form, data = boston_489,\n                        listw = lw_q_489, Durbin = TRUE,\n                        weights = units, zero.policy = TRUE,\n                        control = list(pre_eig = eigs_489))\no <- lmtest::lrtest(SLX_489w, SDEM_489w)\nattr(o, \"heading\")[2] <- \"Model 1: SLX_489w\\nModel 2: SDEM_489w\"\no\n# Likelihood ratio test\n# \n# Model 1: SLX_489w\n# Model 2: SDEM_489w\n#   #Df LogLik Df Chisq Pr(>Chisq)    \n# 1  28    311                        \n# 2  29    379  1   136     <2e-16 ***\n# ---\n# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nSLX_94w <- lmSLX(form, data = boston_94, listw = lw_q_94,\n                 weights = units)\nSDEM_94w <- errorsarlm(form, data = boston_94, listw = lw_q_94,\n                       Durbin = TRUE, weights = units,\n                       control = list(pre_eig = eigs_94))\no <- lmtest::lrtest(SLX_94w, SDEM_94w)\nattr(o, \"heading\")[2] <- \"Model 1: SLX_94w\\nModel 2: SDEM_94w\"\no\n# Likelihood ratio test\n# \n# Model 1: SLX_94w\n# Model 2: SDEM_94w\n#   #Df LogLik Df Chisq Pr(>Chisq)\n# 1  28   97.5                    \n# 2  29   98.0  1  0.92       0.34\n```\n:::\n\n\n이 경우와 Bivand (2017)에서 제시된 논거를 바탕으로 가중치 사용은 정당화된다. 주택 단위 수가 트랙트의 경우는 5개에서 3,031개로 다양하고, 대기 오렴 모델 출력 구역의 경우는 25개에서 12,411개로 다양하기 때문이다. 이러한 이유로, 그리고 가중치 일반화 중첩 모델(GNM)이 개발되지 않았다는 이유로, GNM을 일반적인 모델에서 더 단순한 모델로 테스트하는 출발점으로 삼을 수 없다. 대신, SDEM 모델을 출발점으로 삼고 Hausman 테스트를 사용하여 관측 단위 선택의 지침을 구한다.\n\n## 영향\n\n글로벌 영향은 공간 지체 반응 변수를 포함하는 모델(SLM, SDM, SAC, GNM)의 적합 결과를 보고하는 데 있어 핵심적인 사항으로 이해되고 있다(LeSage와 Pace 2009). 글로벌 영향을 공간 지체 공변량(SLX, SDEM)을 포함하는 다른 모델로 확장하는 시도도 이루어졌다(Elhorst 2010; Bivand 2012; Halleck Vega와 Elhorst 2015). SLM, SDM, SAC, GNM 모델은 최대 우도 또는 GMM을 사용하여 적합시킬 때 계수의 분산-공분산 행렬을 사용할 수 있으며, 계수 값을 평균으로 삼고 추정된 분산-공분산 행렬로부터 분산을 가져와 다변량 정규 분포를 설정하고 그것으로부터 랜덤 샘플을 추출할 수 있다. 베이지안 방법을 사용하여 적합하는 경우라면, 샘플은 사전에 주어진다. SDEM의 경우, 비지체 공변량의 회귀 계수에 대한 샘플은 직접적인 영향을 나타내고, 공간 지체 공변량의 계수에 대한 샘플은 간접적인 영향을 나타내며, 이들의 합은 총 영향을 나타낸다.\n\nSLX와 SDEM 모델에서는 추론을 위해 샘플링이 필요하지 않으므로 최대 우도를 사용하여 적합한 모델에 대해 선형 결합을 사용한다. 여기서는 공기 오염 변수에 대해서만 결과를 보여준다. 모델 출력 보고 방법에 대한 문제를 완전히 해결한 연구는 아직 발간되지 않았다. 개별 공변량에 대해 세 가지 영향력 값을 보고해야 하기 때문이다. 공간 지체 공변량이 포함될 경우, 두 개의 계수는 세 가지 영향으로 대체된다. 여기서는 공기 오염 변수에 대해 그 예를 보여준다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_imp_94_SDEM <- summary(impacts(SDEM_94))\nrbind(Impacts = sum_imp_94_SDEM$mat[5,], \n      SE = sum_imp_94_SDEM$semat[5,])\n#           Direct Indirect   Total\n# Impacts -0.01276 -0.01845 -0.0312\n# SE       0.00235  0.00472  0.0053\n```\n:::\n\n\nSLX와 SDEM 모델에서 직접적인 영향은 같은 관측 단위에서 공기 오염 변화가 응답에 미치는 결과이고, 간접적인(지역적인) 영향은 인접한 관측 단위에서 공기 오염 변화가 응답에 미치는 결과이다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_imp_94_SLX <- summary(impacts(SLX_94))\nrbind(Impacts = sum_imp_94_SLX$mat[5,], \n      SE = sum_imp_94_SLX$semat[5,])\n#          Direct Indirect    Total\n# Impacts -0.0128 -0.01874 -0.03151\n# SE       0.0028  0.00556  0.00611\n```\n:::\n\n\n같은 방법을 가중 공간 회귀 분석에 적용하면, 공기 오염이 주택 가치에 미치는 총 영향은 감소하지만 여전히 유의미하다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_imp_94_SDEMw <- summary(impacts(SDEM_94w))\nrbind(Impacts = sum_imp_94_SDEMw$mat[5,], \n      SE = sum_imp_94_SDEMw$semat[5,])\n#           Direct Indirect    Total\n# Impacts -0.00592 -0.01076 -0.01668\n# SE       0.00269  0.00531  0.00559\n```\n:::\n\n\n전체적으로, 공기 오염 모델 출력 구역 수준으로 집계된 공간 지체 공변량만 포함하는 가중 공간 회귀 모델이 대부분의 모델 오지정 오류를 해결하는 것처럼 보이며, Bivand (2017)에서 더 자세히 논의되어 있는 바와 같이, 이는 오지정된 대체 모델들보다 훨씬 더 큰 오염 제거에 대한 지불 의향이 있다는 점을 보여준다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_imp_94_SLXw <- summary(impacts(SLX_94w))\nrbind(Impacts = sum_imp_94_SLXw$mat[5,], \n      SE = sum_imp_94_SLXw$semat[5,])\n#           Direct Indirect    Total\n# Impacts -0.00620 -0.01221 -0.01842\n# SE       0.00326  0.00628  0.00629\n```\n:::\n\n\n## 예측\n\n보스턴 구역 데이터셋에서 응답 변수인 중위 주택 가격 17개의 관측치가 제한되어 있다. 우리는 `\"Sarlm\"` 객체에 대한 `predict()` 메서드를 사용하여 이 값을 채울 것이다. 이 메서드는 Goulard, Laurent, and Thomas-Agnan (2017)을 기반으로 Martin Gubri에 의해 다시 작성되었으며, Laurent와 Margaretic (2021)도 참조할 수 있다. `pred.type` 아규먼트는 해당 논문에서 제시된 예측 전략을 지정한다.\n\n이 예시를 SDEM 모델의 다양한 변종을 `pred.type`의 설정을 통해 시도하고 샘플 외 예측을 수행해 보면 차이가 있음을 알 수 있으며, 이는 연구할 만한 중요한 영역임을 시사한다. 누락 변수 처리에 대한 몇 가지 대안이 제시된바 있다(Gómez-Rubio, Bivand, and Rue 2015; Suesse 2018). 예측에 대한 관심이 증가하는 또 다른 이유는 예측이 기계 학습 접근 방식의 기본 요소라는 점이다. 기계 학습에서는 검증 및 테스트 데이터셋을 위한 예측이 모델 사양 선택을 이끈다. 의존성을 가진 공간 데이터로부터 훈련 및 기타 데이터셋을 선택하는 것은 여전히 해결되지 않은 문제로, 독립적인 데이터와는 분명히 다른 복잡성을 지니고 있다.\n\n여기에서는 검열(censored) 트랙트 관측값에 대해 세 가지 서로 다른 예측 유형을 사용하여 예측값을 산출하고, USD 단위의 주택 중위값으로 복원하기 위해 지수 연산을 적용한다. `newdata` 객체의 `row.names()`가 공간 가중치 행렬의 `\"region.id\"` 속성과 일치하여 샘플 외 예측이 가능해진다는 점에 유의해야 한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnd <- boston_506[is.na(boston_506$median),]\nt0 <- exp(predict(SDEM_489, newdata = nd, listw = lw_q,\n                  pred.type = \"TS\", zero.policy  =TRUE))\nsuppressWarnings(t1 <- exp(predict(SDEM_489, newdata = nd,\n                                    listw = lw_q,\n                                    pred.type = \"KP2\",\n                                    zero.policy = TRUE)))\nsuppressWarnings(t2 <- exp(predict(SDEM_489, newdata = nd,\n                                    listw = lw_q,\n                                    pred.type = \"KP5\",\n                                    zero.policy = TRUE)))\n```\n:::\n\n\n우리는 INLA의 `\"slm\"` 모델을 사용하여 모델 적합 함수 호출 과정에서 누락된 반응 변수 값을 예측할 수도 있다. `\"slm\"` 모델이 아직 실험적인 상태이므로 약간의 설정 코드가 필요하다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(INLA)\n# Loading required package: foreach\n# Loading required package: parallel\n# Loading required package: sp\n# This is INLA_23.04.24 built 2023-04-24 19:15:35 UTC.\n#  - See www.r-inla.org/contact-us for how to get help.\n#  - To enable PARDISO sparse library; see inla.pardiso()\n# \n# Attaching package: 'INLA'\n# The following object is masked _by_ '.GlobalEnv':\n# \n#     f\nW <- as(lw_q, \"CsparseMatrix\")\nn <- nrow(W)\ne <- eigenw(lw_q)\nre.idx <- which(abs(Im(e)) < 1e-6)\nrho.max <- 1 / max(Re(e[re.idx]))\nrho.min <- 1 / min(Re(e[re.idx]))\nrho <- mean(c(rho.min, rho.max))\nboston_506$idx <- 1:n\nzero.variance = list(prec = list(initial = 25, fixed = TRUE))\nargs.slm <- list(rho.min = rho.min, rho.max = rho.max, W = W,\n                 X = matrix(0, n, 0), Q.beta = matrix(1,0,0))\nhyper.slm <- list(prec = list(prior = \"loggamma\", \n                              param = c(0.01, 0.01)),\n                  rho = list(initial = 0, prior = \"logitbeta\",\n                             param = c(1,1)))\nWX <- create_WX(model.matrix(update(form, CMEDV ~ .), \n                             data = boston_506), lw_q)\nSDEM_506_slm <- inla(update(form, \n                            . ~ . + WX + f(idx, model = \"slm\",\n                                         args.slm = args.slm,\n                                         hyper = hyper.slm)),\n                 data = boston_506, family = \"gaussian\",\n                 control.family = list(hyper = zero.variance),\n                 control.compute = list(dic = TRUE, cpo = TRUE))\nmv_mean <- exp(SDEM_506_slm$summary.fitted.values$mean[\n               which(is.na(boston_506$median))])\n```\n:::\n\n\nINLA는 또한 예측값에 대한 주변 분포(marginal distribution)의 격자형 추정치를 제공하며, 이를 통해 예측값과 관련된 불확실성을 평가할 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(fit_TS = t0[,1], fit_KP2 = c(t1), fit_KP5 = c(t2),\n    INLA_slm = mv_mean, censored = \n      boston_506$censored[as.integer(attr(t0, \"region.id\"))])\n#     fit_TS fit_KP2 fit_KP5 INLA_slm censored\n# 13   23912   29477   28147    31112    right\n# 14   28126   27001   28516    31314    right\n# 15   30553   36184   32476    41298    right\n# 17   18518   19621   18878    21160    right\n# 43    9564    6817    7561     6830     left\n# 50    8371    7196    7383     6885     left\n# 312  51477   53301   54173    56274    right\n# 313  45921   45823   47095    46447    right\n# 314  44196   44586   45361    42805    right\n# 317  43427   45707   45442    48025    right\n# 337  39879   42072   41127    41462    right\n# 346  44708   46694   46108    45847    right\n# 355  48188   49068   48911    49138    right\n# 376  42881   45883   44966    47747    right\n# 408  44294   44615   45670    46164    right\n# 418  38211   43375   41914    43913    right\n# 434  41647   41690   42398    41551    right\n```\n:::\n\n\n공간 회귀를 위한 툴박스는 여전히 완전하지 않았으며, 빈틈을 채우는 데는 시간이 걸릴 것이다. 여러 공간 회귀 전통들이 서로의 이해와 발전을 거의 공유하지 않는 점은 여전히 아쉬운 부분이다.\n\n## 연습문제\n\n1.  Piras와 Prucha(2014), 그리고 Raymond J. G. M. Florax, Folmer, Rey(2003)를 참조할 때, 사전 테스트 전략을 선택하면, 속성만 포함된 데이터셋과 지자체 구역 변수가 추가된 속성 데이터셋의 선형 모델에서 잔차의 공간적 의존성이 나타나는지 답하시오. 사전 테스트가 어떤 모델을 지목하는지에 대해 답하시오.\n\n2.  지자체 부서 더미 변수의 포함하거나 지자체 부서 체제 모델을 실행하면 잔차의 공간적 의존성을 줄이는 데 도움이 될 수 있을지에 대해 답하시오.\n\n3.  속성만 포함한 모델과 지자체 부서 변수를 추가한 모델에 대해 최대우도법을 사용하여 SEM 모델을 실행하고(GMM 코드 예시는 Bivand, Millo, and Piras (2021)를 참조), 이를 SDEM 모델로 확장하시오. SLX 모델을 실행하고, 해당 모델의 잔차에 대한 공간적 자기상관 테스트 결과를 해석하시오. SEM과 SDEM 모델에 대한 Hausman 테스트가 보여주는 매우 높은 유의성을 해석하시오.\n\n4.  속성만 포함한 모델과 지자체 부서 변수를 추가한 모델에 대해 GNM 모델을 실행하시오. 이러한 모델을 SDM 또는 SDEM 형식으로 단순화할 수 있을지에 대해 답하시오.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}