{
  "hash": "cb49cb8da117f199e40d2dea97db4131",
  "result": {
    "engine": "knitr",
    "markdown": "---\ndate-modified: last-modified\nnumber-sections: true\nformat: \n  html: \n    toc: true\ncode-link: true\ncode-copy: true\nexecute: \n  warning: false\n  error: false\n  freeze: auto\neditor: visual\n---\n\n\n# 지오메트리 {#sec-geometry}\n\n2장에서 좌표계에 대해 배웠으므로 이제 이 장에서는 좌표계를 이용하여 지오메트리를 어떻게 정의할 수 있는지에 대해 배울 것이다. 다음의 사항이 다루어진다.\n\n-   심플 피처(simple feature): 포인트, 라인, 폴리곤 지오메트리를 다루는 표준\n\n-   지오메트리에 적용되는 다양한 오퍼레이션\n\n-   커버리지(coveratge): 공간 혹은 시공간의 함수\n\n-   테셀레이션(tessellation): 하나의 지역을 여러개의 하위지역으로 세분한 것\n\n-   네트워크\n\n구면 지오메트리는 4장에서 논의되며, 래스터와 공간 혹은 시공간을 직사각형 형태로 분할한 또 다른 세분 체계는 6장에서 다룬다.\n\n## 심플 피쳐 지오메트리\n\n심플 피처 지오메트리는 피처의 지오메트리를 설명하는 방법이다. 여기서 피처란 지오메트리를 가진 사물을 의미하는데, 암묵적으로 시간 속성을 가질 수 있고, 사물 자체를 묘사하기 위한 라벨이나 사물을 정량적으로 측정한 값과 관련된 속성을 가질 수 있다. 단순 피처 지오메트리의 주된 용도는 2차원 공간의 기하학적 형태를 포인트, 라인, 또는 폴리곤에 의거해 설명하는 것이다. \"심플\"이라는 형용사가 붙은 이유는 라인이나 폴리곤 지오메트리 역시 포인트 지오메트리와 그것을 연결한 직선으로 표현될 수 있기 때문이다.\n\n심플 피처 억세스(access)는 심플 피처 지오메트리를 설명하는 표준으로(Herring 2011, 2010; ISO 2004), 다음의 사항을 포함한다.\n\n-   클래스 위계\n\n-   오퍼레이션의 집합\n\n-   이항 엔코딩과 텍스트 엔코딩\n\n먼저 가장 일반적으로 사용되는 7가지 심플 피처 지오메트리 유형에 대해 논의할 것이다.\n\n### 7개의 대표 지오메트리\n\n단일(single) 피처를 나타내기 위해 사용되는 가장 일반적인 심플 피처 지오메트리 유형은 다음과 같다.\n\n| 유형 | 설명 |\n|------------------------------------|------------------------------------|\n| `POINT` | 단일 포인트 지오메트리 |\n| `MULTIPOINT` | 포인트의 집합 |\n| `LINESTRING` | 단일 라인스트링(두개 이상의 포인트가 직선으로 연결되어 있음) |\n| `MULTILINESTRING` | 라인스트링의 집합 |\n| `POLYGON` | 내부 링(구멍을 의미)을 가질 수 있는 외부 링 |\n| `MULTIPOLYGON` | 폴리곤의 집합 |\n| `GEOMETRYCOLLECTION` | 위에서 언급된 모든 지오메트리의 집합 |\n\n\n::: {.cell}\n\n:::\n\n\n![심플 피처 지오메트리의 주요 유형](https://r-spatial.org/book/03-Geometries_files/figure-html/fig-sfgeometries-1.png){#fig-3-1}\n\n그림 3.1은 이러한 기본 지오메트리 유형의 예를 보여준다. 지오메트리를 표현한 사람이 읽을 수 있는 WKT 표기법은 다음과 같다.\n\n``` r\nPOINT (0 1)\nMULTIPOINT ((1 1), (2 2), (4 1), (2 3), (1 4))\nLINESTRING (1 1, 5 5, 5 6, 4 6, 3 4, 2 3)\nMULTILINESTRING ((1 1, 5 5, 5 6, 4 6, 3 4, 2 3), (3 0, 4 1, 2 1))\nPOLYGON ((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),\n    (2 2, 3 3, 4 3, 4 2, 2 2))\nMULTIPOLYGON (((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),\n    (2 2, 3 3, 4 3, 4 2, 2 2)), ((3 7, 4 7, 5 8, 3 9, 2 8, 3 7)))\nGEOMETRYCOLLECTION (\n    POLYGON ((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),\n      (2 2 , 3 3, 4 3, 4 2, 2 2)),\n    LINESTRING (1 6, 5 10, 5 11, 4 11, 3 9, 2 8),\n    POINT (2 5),\n    POINT (5 4)\n)\n```\n\n좌표는 공백으로 구분되고, 포인트는 쉼표로 구분된다. 집합은 괄호로 묶여 있으며, 쉼표로 구분된다. 폴리곤은 외부 링과 (만일 있다면) 내부 링(구멍을 나타냄)으로 구성된다.\n\n지오메트리의 개별 포인트는 최소한 두 개의 좌표를 포함하며, 이 좌표는 $x$와 $y$ 순서로 나열된다. 이 좌표가 타원체 좌표를 나타내는 경우, $x$는 일반적으로 경도를, $y$는 위도를 의미하지만, 경우에 따라 위도-경도의 순서로 나열될 수도 있다(2.4절 및 섹션 7.7.6 참조).\n\n### 심플 지오메트리, 타당한 지오메트리, 링 디렉션\n\n라인리스팅은 자기 교차하지 않을 때 심플이라고 부를 수 있다.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n``` r\n# LINESTRING (0 0, 1 1, 2 2, 0 2, 1 1, 2 0)\n```\n\n``` r\n# is_simple \n#     FALSE\n```\n\n타당한 폴리곤과 멀티폴리곤은 다음의 모든 프로퍼티를 보유한다.\n\n-   폴리곤 링은 닫혀있다(첫번째 포인트와 마지막 포인트는 동일하다)\n\n-   폴리곤 구멍(내부 링)은 외부 링의 안쪽에 있다.\n\n-   폴리곤 내부 링은 외부 링과 한 지점에서 만날 수는 있지만 라인을 공유할 수는 없다.\n\n-   폴리곤 링은 자신의 경로를 반복하지 않는다.\n\n-   멀티폴리곤에서 외부 링은 다른 외부 링과 한 지점에서 만날 수는 있지만 라인을 공유할 수는 없다.\n\n이것들 어느 하나라도 만족시키지 못한다면 해당 지오메트리는 타당하지 않다. 타당하지 않는 지오메트리는 일반적으로 오퍼레이션 과정에서 오류를 발생시키지만, 보통 사전에 타당한 지오메트리로 수정된다.\n\n또 다른 규칙은 폴리곤의 외부 링은 반시계 방향으로 감겨야 하며, 구멍은 시계 방향으로 감겨야 한다는 것이다. 그러나 이러한 규칙을 따르지 않는 폴리곤도 여전히 타당한 것으로 간주된다. 이러한 '시계 방향' 개념은 구체에서는 그리 유용하지 않다. 예를 들어, 적도를 폴리곤으로 간주할 경우, 북반구와 남반구 중 어느 쪽이 '내부'라고 할 수 있는가? 여기서 채택된 규칙은 폴리곤의 변을 시계 방향으로 탐색할 때 왼쪽에 있는 영역을 폴리곤의 내부로 간주하는 것이다(7.3절 참조).\n\n### Z 좌표와 M 좌표\n\n심플 피처 지오메트리의 단일 포인트(버텍스)는 $x$ 좌표와 $y$ 좌표 외에 다음을 가질 수 있다.\n\n-   Z 좌표: 고도\n\n-   M 좌표: 측정치\n\nM 속성이 버텍스의 프로퍼티라는 점을 염두에 두면 M 좌표는 유용하게 사용될 수 있을 것으로 보인다. 예를 들어, LINESTRING을 통해 일종의 경로 데이터를 엔코딩한다고 하면, 개별 버텍스에 시간 속성을 할당할 수 있다. 그러나 경로가 자기-교차하게 되면 비타당 혹은 비심플(non-simple)이 된다. 자기-교차성을 검토하기 위해 $x$ 좌표와 $y$ 좌표만을 고려할 때는 드러나지 않는다.\n\nZ와 M은 자주 사용되지 않으며, 이를 유용하게 활용할 수 있는 소프트웨어 지원도 (아직) 드물다. 그래도 Z와 M의 WKT 표현은 비교적 쉽게 이해할 수 있다.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n``` r\n# POINT Z (1 3 2)\n```\n\n``` r\n# POINT M (1 3 2)\n```\n\n``` r\n# LINESTRING ZM (3 1 2 4, 4 4 2 2)\n```\n\n### 엠프티 지오메트리\n\n피쳐 지오메트리 프레임워크에서 매우 중요한 개념이 엠프티(empty) 지오메트리이다. 엠프티 지오메트리는 기하학적 오퍼레이션(3.2절)을 실행할 때 자연스럽게 생성된다. 예를 들어 `POINT (0 0)`과 `POINT (1 1)`의 인터섹션 여부를 검토한다고 하자.\n\n\n::: {.cell}\n\n:::\n\n\n``` r\n# GEOMETRYCOLLECTION EMPTY\n```\n\n두 포인트는 교차하지 않으므로 엠프티 집합이 도출된다. 엠프티 포인트를 비어있지 않은 지오메트리와 결합하면(합집합을 구하면) 엠프티 포인트는 소실된다.\n\n모든 지오메트리 유형은 엠프티 지오메트리를 나타내는 특정한 값을 가지고 있다.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n``` r\n# POINT EMPTY\n```\n\n``` r\n# LINESTRING M EMPTY\n```\n\n엠프티 집합이 생성된다는 점에서는 동일하고 단지 디멘션만 다를 뿐이다(3.2절 참조).\n\n### 10개의 부수적인 지오메트리\n\n다음의 10가지 지오메트리는 매우 드물게 사용되지만, 사용 빈도가 증가하는 경향이 있다.\n\n| 유형 | 설명 |\n|------------------------------------|------------------------------------|\n| `CIRCULARSTRING` | 기본적인 곡선 유형으로 직선 유형의 LINESTRING과 유사하다. 단일 세그먼트는 세 점이 필요하며, 시작점과 끝점(첫 번째와 세 번째 점) 및 호 상의 다른 점이 필요하다. 예외는 닫힌 원의 경우로, 이 경우 시작점과 끝점이 동일하다. 이 경우 두 번째 점은 반드시 호의 중심, 즉 원의 반대편이어야 한다. 호를 연결하려면 이전 호의 마지막 점이 다음 호의 첫 번째 점이 되며, 이는 LINESTRING에서도 동일하다. 따라서 타당한 문자열은 1보다 큰 홀수 개의 점을 가져야 한다. |\n| `COMPOUNDCURVE` | 곡선 세그먼트와 선형 세그먼트를 모두 포함하는 단일 연속 곡선이다. 구성 요소를 잘 갖추고 있어야 하며, 모든 구성 요소의 끝점(마지막을 제외하고)은 다음 구성 요소의 시작점과 일치해야 한다. |\n| `CURVEPOLYGON` | 컴파운트커브가 내재된 예: `CURVEPOLYGON( COMPOUNDCURVE(CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),(4 3, 4 5, 1 4, 0 0)), CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1))` |\n| `MULTICURVE` | 곡선으로 구성된 1차원 지오메트리 컬렉션이다. 이 컬렉션은 라인 문자열, 서큘러 문자열 또는 컴파운드 문자열을 포함할 수 있다. |\n| `MULTISURFACE` | 동일한 CRS를 사용하는 `SURFACE`로 구성된 2차원 지오메트리 컬렉션이다. |\n| `CURVE` | 일반적으로 몇 개의 점의 연결로 정의되는 1차원 지오메트리 객체이며, 점들 간의 인터폴레이션 형태에 따라 커브의 하위 유형이 정의된다. |\n| `SURFACE` | 2차원 지오메트리 객체이다. |\n| `POLYHEDRALSURFACE` | 공통 경계 세그먼트를 공유하는 연속적인 폴리곤의 컬렉션이다. |\n| `TIN` | 오직 삼각형으로만 구성된 `POLYHEDRALSURFACE`이다. |\n| `TRIANGLE` | 세 개의 비공선적(non-collinear) 버텍스로 구성된(역자주: 세 점이 일직선 상에 놓이지 않음을 의미한다), 내부 경계가 없는 폴리곤이다. |\n\n`CIRCULARSTRING`, `COMPOUNDCURVE`, `CURVEPOLYGON`은 SFA 표준에 언급되지 않지만 SQL-MM 파트3 표준에는 포함되어 있다. 위 표의 설명 부분은 PostGIS 매뉴얼에서 그대로 가져온 것이다.\n\n### 텍스트 엔코딩과 바이너리 엔코딩\n\n심플 피처 표준에는 두 가지 엔코딩 방식이 포함되어 있다. 하나는 텍스트 인코딩이고 다른 하나는 바이너리 인코딩이다. 위에서 사용된 KWT는 인간-해독가능(human-readable)이고, KWB(well-known binary) 인코딩은 기계-해독가능(machine-readable)이다. WKB 인코딩은 정보 손실이 없으며 일반적인 텍스트 인코딩(및 디코딩)보다 작업 속도가 빠르다. 이는 R 패키지 **sf**와 GDAL, GEOS, liblwgeom, s2geometry 라이브러리 간의 모든 통신에서 사용된다(그림 1.7).\n\n## 지오메트리에 적용되는 오퍼레이션\n\n심플 피처 지오메트리의 프로퍼티를 추출하는 것이 가능하며, 심플 피처 지오메트리의 결합을 통해 새로운 지오메트리가 생성된 경우, 그것의 프로퍼티를 추출하는 것 역시 가능하다. 이 섹션에서는 기하학적 프로퍼티에 전적으로 초점을 맞춘 오퍼레이션에 대해서만 간략하게 다룬다. 5장에서는 비기하학적 피처 속성 분석에 초점을 맞춘다. 이 섹션의 일부 내용은 Pebesma (2018)로부터 가져온 것이다.\n\n기하학적 프로퍼티에 대한 오퍼레이션을 투입과 산출에 의거해 분류하는 것이 가능하다. 우선 산출의 관점에서, 다음과 같이 구분할 수 있다.\n\n-   프레디케이트(predicate): 특정 프로퍼티가 TRUE임을 주장하는 논리값\n\n-   측정치(measure): 양(수치, 측정 단위가 있을 수 있음)\n\n-   변형(transformation): 새롭게 생성된 지오메트리\n\n오퍼레이션이 어떤 지오메트리에 적용되느냐에 따라 다음과 같이 분류하는 것이 가능하다.\n\n-   유너리(unary): 단일 지오메트리에 적용\n\n-   바이너리(binary): 지오메트리의 쌍에 적용\n\n-   에너리(n-ary): 지오메트리의 집합에 적용\n\n### 유너리 프리디케이트: 단항 조건식(unary predicate)\n\n유너리 프리디케이트는 하나의 지오메트리의 하나의 프로퍼티를 설명한다. `is_simple`, `is_valid`, `is_empty`와 같는 프리디케이트는 각각 지오메트리가 심플한지, 밸리드한지, 엠프티한지의 여부에 대한 논리값을 반환한다. `is_longlat` 프리디케이트는 주어진 CRS가 경위도 좌표계에 기반하고 있는지 평면 좌표계에 기반하고 있는지의 여부를 반환한다. `is(geometry, class)`는 지오메트리가 특정한 클래스에 속하는지의 여부를 확인한다.\n\n### 바이너리 프리디케이트와 DE-9IM: 이항 조건식(binary predicate)과 DE-9IM\n\nDE-9IM(Dimensionally Extended Nine-Intersection Model)(Clementini, Di Felice, and Oosterom 1993; Egenhofer and Franzosa 1991)은 2차원 공간($R^2$)에서 두 지오메트리간의 정성적 관계를 설명하는 모델이다. 모든 지오메트리는 디멘션 값을 가진다.\n\n-   포인트는 0\n\n-   라인 지오메트리는 1\n\n-   폴리곤 지오메트리는 2\n\n-   엠프티 지오메트리는 F(거짓)\n\n모든 지오메트리는 내부(I), 경계(B), 외부(E)를 가지며, 이것들이 어떤 역할은 하는지는 폴리곤의 경우에 보다 명확히 드러난다.\n\n-   라인의 경계는 종점에 의해 형성되고, 선상의 모든 비종점이 내부를 구성한다.\n\n-   포인트는 0차원의 내부를 가지지만, 경계는 없다.\n\n\n::: {.cell}\n\n:::\n\n\n![DE-9IM: 폴리곤의 내부, 경계, 외부(행)와 라인스트링의 내부, 경계, 외부(열) 간의 인터섹션](https://r-spatial.org/book/03-Geometries_files/figure-html/fig-de9im-1.png){#fig-3-2}\n\n그림 3.2는 폴리곤과 라인스트링의 I, B 및 E 간의 인터섹션을 빨간색으로 표시한 것이다. 개별 그래프의 제목에 인터섹션의 결과 도출되는 디멘션(0, 1, 2, 또는 F)이 표시되어 있다. 폴리곤 지오메트리와 라인 지오메트리의 관계는 바로 이러한 디멘션의 연속(concatenation)이다.\n\n\n::: {.cell}\n\n:::\n\n\n``` r\n#      [,1]       \n# [1,] \"1020F1102\"\n```\n\n첫 세 문자는 *첫 번째* 지오메트리(폴리곤)의 내부와 관련이 있다. 그림 3.2에는 첫 번째 지오메트리가 행에 배열되어 있다. 더 나아가 지오메트리의 쌍에 대해 *마스크*(mask) *문자열*로 표현된 특정한 조건의 만족 여부도 질의할 수 있다. 예를 들어, 문자열 `\"0******\"`는 두 번째 지오메트리가 첫 번째 지오메트리의 내부와 하나 이상의 경계 점을 공유할 때 `TRUE`로 평가된다. 여기서 기호 `*`는 디멘션(0, 1, 2 또는 F)을 의미하는 것으로 네 개 중 어는 것도 올 수 있다. 마스크 문자열 `\"T********\"`은 내부가 서로 교차하는 지오메트리 쌍을 찾아내느데, 여기서 기호 T는 차원 디멘션이 0, 1, 2이면서 비엠프티 인터섹션인 경우를 의미한다.\n\n더 나아가 바이너리 프리디케이트는 DE-9IM에서 규정된 정의를 활용함으로써 일반 언어 동사로 표현될 수 있다. 예를 들어, 프리디케이트 `equals`는 관계 `\"T*F**FFF*\"`와 동일하다. 어떤 두 지오메트리가 이러한 관계를 만족한다면, 그 둘은 (위상적으로는) 동일하지만, 노드의 순서가 다를 수 있다.\n\n바이너리 프리디케이트를 나열하면 다음과 같다.\n\n| 프리디케이트 | 의미 | 역프리디케이트 |\n|------------------------|------------------------|------------------------|\n| `contains` | A 포인트 어느 것도 B의 외부에 있지 않다. | `within` |\n| `contains_properly` | A는 B를 포함하며, B의 어떤 포인트도 A의 경계 상에 있지 않다. |  |\n| `covers` | B의 어떤 포인트도 A의 외부에 있지 않다. | `covered_by` |\n| `covered_by` | `covers`의 반대 |  |\n| `crosses` | A와 B는 일부 내부 포인트를 공유하지만 모든 포인트를 공유하는 것은 아니다. |  |\n| `disjoint` | A와 B는 어떤 포인트도 서로 공유하지 않는다. | `intersects` |\n| `equals` | A와 B는 위상적으로 동일하다. 노드 순서나 노드 수가 다를 수 있으며, A가 B를 포함하고 A가 B의 내부에 있는 것과 동일하다. |  |\n| `equals_exact` | A와 B는 기하학적으로 동일하며, 노드 순서도 동일하다. |  |\n| `intersects` | A와 B가 완전 분리의 관계를 가지지 않는다. | `disjoint` |\n| `is_within_distance` | A가 주어진 거리보다 B에 더 가깝게 위치해 있다. |  |\n| `within` | B의 어떤 포인트도 A의 외부에 있지 않다. | `contains` |\n| `touches` | A와 B는 최소한 한 개의 경계 포인트를 공유한다. 내부 포인트를 공유하는 것은 아니다. |  |\n| `overlaps` | A와 B가 다수의 포인트를 공유한다. 디멘션은 A와 B의 디멘션과 동일하다. |  |\n| `related` | A와 B가 주어진 마스크 패턴을 준수하는지의 여부를 반환한다. |  |\n\n위키피디어의 DE-9IM 페이지를 가면, 개별 동사에 해당하는 `relate` 마스크 패턴을 확인할 수 있다. 왜냐하면 *covers*와 *contains*와 같은 동사(그 역도 마찬가지)는 그 의미를 직관적으로 파악하기 어려울 때가 있다.\n\n-   만일 A가 B를 *contains* 한다면, B는 A의 외부나 경계와 어떠한 공유 포인트도 없다.\n\n-   만일 A가 B를 *covers* 한다면, B는 A의 외부와 어떠한 공유 포인트도 없다.\n\n### 유너리 측도\n\n유너리 측도는 지오메트리의 퍼로퍼티를 설명하는 측정값이나 양을 반환한다.\n\n| 측도 | 반환값 |\n|------------------------------------|------------------------------------|\n| `dimension` | 포인트는 0, 라인은 1, 폴리곤은 2, 엠프티 지오메트리에 대해서는 NA |\n| `area` | 지오메트리의 면적 |\n| `length` | 라인 지오메트리의 길이 |\n\n### 바이너리 측도\n\n`distance`는 지오메트리 간의 거리를 반환한다. 질적 측도로서의 (마스크가 없는) `relate`는 관계 패턴을 제공한다. 두 지오메트리간의 기하학적 관련성에 대한 설명은 섹션 3.2.2에 나타나 있다.\n\n### 유너리 변환자\n\n유너리 변환자는 지오메트리별로 작동하며, 각 지오메트리에 대해 새로운 지오메트리를 반환한다.\n\n| 변환자 | 반환 지오메트리 |\n|------------------------------------|------------------------------------|\n| `centroid` | 투입 지오메트리의 센트로이드로 구성된 `POINT` 유형의 지오메트리 |\n| `buffer` | 투입 지오메트리보다 더 큰(혹은 더 작은) 지오메트리: 버퍼 사이즈에 따라 산출 지오메트리의 크기가 달라짐 |\n| `jitter` | 이변량 균등 분포를 이용하여 조금 전위된 지오메트리 |\n| `wrap_dateline` | 날짜 변경선을 더 이상 덮거나 교차하지 않는 조각으로 분할된 지오메트리 |\n| `boundary` | 투입 지오메트리의 경계를 가진 지오메트리 |\n| `convex_hull` | 투입 지오메트리의 컨벡스헐을 가진 지오메트리(그림 3.3) |\n| `line_merge` | `MULTILINESTRING` 내의 `LINESTRING` 요소들을 결합하여 더 긴 `LINESTRING`을 형성한 지오메트리 |\n| `make_valid` | 밸리드하게 교정된 지오메트리 |\n| `node` | 노드가 없는 교차점에 노드를 추가한 라인 지오메트리. 개별적인 라인 지오메트리에만 적용됨 |\n| `point_on_surface` | 서피스에 임의의 포인트를 가진 지오메트리 |\n| `polygonize` | 폐쇄 링을 형성하는 라인으로부터 생성된 폴리곤 지오메트리 |\n| `segmentize` | 주어진 밀도 또는 최소 거리를 만족하는 노드로 구성된 라인 지오메트리 |\n| `simplify` | 버텍스/노드를 제거함으로써 단순화된 라인 혹은 폴리곤 지오메트리 |\n| `split` | 라인스트링에 의해 분할된 지오메트리 |\n| `transform` | 새로운 CRS로 변환 혹은 전환된 지오메트리(2장) |\n| `triangulate` | 들로네(Delauney) 삼각망으로 구성된 지오메트리(그림 3.3) |\n| `voronoi` | 투입 지오메트리로부터 형성된 보로노이(Voronoi) 테셀레이션(그림 3.3) |\n| `zm` | Z 좌표 및 M 좌표가 수정된(일부 좌표의 삭제 혹은 새로운 좌표의 첨가) 지오메트리 |\n| `collection_extract` | 특정 유형의 `GEOMETRYCOLLECTION`으로부터 일부를 추출한 지오메트리 |\n| `cast` | 유형이 전환된 지오메트리 |\n| `+` | 주어진 벡터만큼 전위된 지오메트리 |\n| `*` | 스칼라 또는 매트릭스가 곱해진 지오메트리 |\n\n\n::: {.cell}\n\n:::\n\n\n![포인트의 집합, 왼편은 컨벡스 헐(빨간색), 가운데는 보로노이 폴리곤, 오른편은 들로네 삼각망](https://r-spatial.org/book/03-Geometries_files/figure-html/fig-vor-1.png){#fig-3-3}\n\n### 바이너리 변환자\n\n바이러니 변환자는 지오메트리 쌍에 적용되어 새로운 지오메트리를 생성하는 함수이다. 다음과 같은 것이 있다.\n\n| 함수 | 반환 지오메트리 | 인픽스 오퍼레이터 |\n|------------------------|------------------------|------------------------|\n| `intersection` | 두 지오메트리의 겹치는 부분에 대한 지오메트리 | `&` |\n| `union` | 두 지오메트리를 결합한 지오메트리로, 내부 경계를 제거하고, 중복되는 포인트, 노드, 또는 라인을 삭제 | `|` |\n| `difference` | 두 번째 지오메트리와 중복되는 부분을 제거한 첫 번째 지오메트리 | `/` |\n| `sym_difference` | 중복되는 부분을 제거한 이후에 두 지오메트리를 결합한 지오메트리로 `intersection`의 반대 | `%/%` |\n\n### 에너리 변환자\n\n에너리 변환자는 지오메트리의 집합에 작용한다. `union`을 적용하면 모든 지오메트리의 결합 결과를 얻을 수 있다. 이런 방식이 아니라면, 동일한 차원을 가진 지오메트리 집합은 `MULTI`-유형 지오메트리로 결합하거나 `GEOMETRYCOLLECTION`으로 결합할 수 있다. 이 경우, `union`을 적용하지 않았기 때문에 두 폴리곤 링이 공유 경계선을 가질 때와 같이 타당하지 않은 지오메트리가 생성될 수 있다.\n\n에너리 `intersection`과 `difference`의 경우 형식적으로는 단일 아규먼트를 취하지만 모든 쌍, 세 쌍, 네 쌍 등에 대해 순차적으로 작동한다. 그림 3.4를 살펴보자. 세 개의 상자가 모두 겹치는 영역을 어떻게 식별할 수 있을까? 바이너리 `intersection`을 사용하면 모든 쌍(1-1, 1-2, 1-3, 2-1, 2-2, 2-3, 3-1, 3-2, 3-3)에 대한 인터섹션을 얻을 수 있다. 하지만 두 개 이상의 지오메트리가 교차하는 영역을 식별할 수는 없다. 그림 3.4의 오른쪽 그림은 에너리 `intersection`을 보여주는데, 한 개, 두 개, 또는 *더 많은* 지오메트리의 교차를 통해 생성된 7개의 겹치지 않는 고유한 지오메트리를 확인할 수 있다.\n\n\n::: {.cell}\n\n:::\n\n\n![왼쪽: 세 개의 겹치는 정사각형이 있는데, 모든 사각형이 겹치는 부분을 어떻게 확인할 수 있을까 오른쪽: 서로 겹치지 않는 고유한 에너리 교차](https://r-spatial.org/book/03-Geometries_files/figure-html/fig-boxes-1.png){#fig-3-4}\n\n유사하게, 집합 $\\{s_1,s_2,s_3,...\\}$에 에너리 `difference`를 적용하여 $\\{s_1,s_2-s_1,s_3-s_2-s_1,...\\}$를 생성할 수 있다. 결과가 그림 3.5에 나타나 있는데, 왼편에는 원래 집합을 보여주고 있고, 오른편에는 투입 지오메트리의 순서를 바꾼 후의 집합을 보여주고 있다. 이는 결과가 입력 지오메트리의 순서에 의존한다는 사실을 명확히 하기 위함이다. 결과로 얻어진 지오메트리는 서로 겹치지 않는다.\n\n\n::: {.cell}\n\n:::\n\n\n![박스를 서로다른 순서에 따라 differece를 적용한 결과: 왼쪽은 원리 순서이고 오른쪽은 반대 순서](https://r-spatial.org/book/03-Geometries_files/figure-html/fig-diff-1.png){#fig-3-5}\n\n## 정밀도\n\n기하학적 오퍼레이션, 예를 들어 특정 점이 선 위에 있는지 여부를 찾는 오퍼레이션은 R에서 사용되는 8바이트 더블과 같은 배정밀도 부동소수점 수로 좌표가 표현될 때 실패할 수 있다. 자주 선택되는 해결책은 연산 전에 좌표의 정밀도를 제한하는 것이다. 이를 위해 정밀도 모델이 채택된다. 가장 일반적인 방법은 하나의 계수 $p$를 선택하고, 원래 좌표 $c$에에서 반올림된 좌표 $c'$를 계산하는 것이다.\n\n$$\nc'=\\text {round} (p\\cdot c)/p\n$$\n\n이러한 종류의 반올림은 좌표를 간격이 $1/p$ 인 규칙적인 그리드 상의 점으로 변환하며, 이는 기하학적 연산에 유익하다. 물론, 이러한 반올림은 면적이나 거리와 같은 모든 계산에도 영향을 미치며, 밸리드 지오메트리를 무효하게 만들 수 있다. 어떤 정밀도 값이 특정 애플리케이션에 가장 적합한지는 일반적으로 상식과 시행착오를 결합해 결정된다.\n\n## 커버리지: 테셀레이션과 래스터\n\nOGC(Open Geospatial Consortium, 오픈지리공간컨소시움)는 *커버리지*(coverage)를 “시공간적 도메인 내의 임의의 직접 위치에 대해 그 범위에서 값을 반환하는 함수로 작용하는 피처”라고 정의한다 (Baumann, Hirschorn, and Masó 2017). *함수*가 존재한다는 것은 시공간적 도메인 내의 모든 \"포인트\", 즉 특정한 지점과 특정한 시점의 모든 조합마다 범위에 대해 *단일* 값을 우리가 얻을 수 있다는 것을 의미한다. 이는 시공간적 현상에서 매우 일반적인 상황이며, 몇 가지 예를 들 수 있다.\n\n-   경계 분쟁을 제외하고 얘기한다면, 특정 시점의 특정 지역 내 모든 지점(도메인)은 단일 행정 단위(범위)에 속한다.\n-   특정 시점의 특정 지역 내 모든 지점(도메인)은 특정한 토지피복 유형(범위)을 갖는다.\n-   특정 지역(도메인)의 모든 지점은 단일한 고도값(범위)을 가지며, 이는 주어진 평균 해수면을 기준으로 측정될 수 있다.\n-   3차원 기체의 모든 시공간적 지점(도메인)은 온도(범위)에 대해 단일 값을 갖는다.\n\n여기서 주의해야 할 점은 관찰이나 측정은 항상 시간과 공간을 소요하기 때문에, 측정된 값은 항상 시공간적 부피(volume)에 대한 평균값일 수 밖에 없다는 점이다. 따라서 범위 변수를 무부피의 “포인트”에 대해 측정하는 경우는 극히 드물다. 그러나 많은 실제 사례에서 측정된 부피는 “포인트”로 간주될 만큼 충분히 작기는 하다. *토지 피복* 유형과 같은 변수의 경우, 구별되는 유형이 측정된 면적 단위와 관련하여 의미가 있도록 부피를 선택해야 한다.\n\n주어진 예의 처음 두 가지에서 범위 변수는 *범주형*이며, 마지막 두 가지에서 범위 변수는 *연속형*이다. 범주형 범위 변수의 경우, 넓은 지역이 동일한 범위 값을 가지면, 이러한 데이터를 효율적으로 표현하는 방법은 동일한 값을 가진 지역의 경계를 저장하는 것이다. 예를 들어, 국가 경계와 같은 경계가 이에 해당한다. 이는 단순 피처 지오메트리(폴리곤 또는 멀티폴리곤)을 사용하여 수행할 수 있지만, 이로 인해 몇 가지 도전 과제가 발생할 수 있다.\n\n-   단순 피처 폴리곤들이 서로 겹치지 않고 틈새도 없어야 하지만, 이러한 점이 반드시 보장된다고 말하기 어렵다.\n\n-   단순 피처는 인접한 두 폴리곤의 경계 상에 놓인 포인트를 하나의 폴리곤에만 할당하지 못하는데, 이는 커버리지로서의 해석과 충돌한다.\n\n### 토폴로지 모델\n\n폴리곤 커버리지의 겹침과 틈새가 없도록 보장된 데이터 모델을 *토폴로지* 모델(topological model)이라고 하는데, GRASS GIS나 ArcGIS와 같은 지리정보시스템(GIS)에서 그 예를 찾을 수 있다. 토폴로지 모델은 폴리곤 경계를 한 번만 저장하고, 경계의 양쪽에 어떤 폴리곤이 있는지를 등록한다.\n\n토폴로지 모델에서 동일한 범위 값을 가진 지역들에 대해 (멀티)폴리곤 집합을 도출하는 것은 간단하다. 폴리곤의 세트로부터 토폴로지를 재정의하는 역의 과정을 수행하기 위해서는 오류에 대한 임계값을 설정해야하고 겹침과 틈새를 처리하는 특정한 방법을 고려해야 한다.\n\n### 래스터 테셀레이션\n\n테셀레이션은 공간(2차원 또는 3차원)을 폴리곤을 이용해 더 작은 요소로 세분화한 것을 말한다. 정규 테셀레이션은 정규 폴리곤(삼각형, 사각형 또는 육각형)으로 구성되는 테셀레이션을 의미한다. 정사각형을 사용하는 테셀레이션이 공간데이터에 일반적으로 사용되는 이를 래스터 데이터라고 부른다. 래스터 데이터는 공간적 디멘션 $d$를 정규 셀로 세분하는데, 각 셀 $d_i$는 좌측 닫힘 및 우측 개방 범위(구간)로 형성된다(역자주: 어떤 범위가 좌측 닫힘 및 우측 개방의 형식으로 규정되었다는 것은 범위의 왼쪽 끝점은 포함되지만, 범위의 오른쪽 끝점은 포함되지 않는다는 것을 의미한다.)\n\n$$\nd_i=d_0+[i\\times \\delta,(i+1)\\times \\delta)\n$$\n\n여기서 $d_0$는 오프셋값, $\\delta$는 구간(셀 또는 픽셀) 크기, 셀 인덱스인 $i$는 임의의 값을 취할 수 있지만 연속적인 정수값이어야한다. $\\delta$는 $y$-축(북거)에 대해서는 보통 음의 값을 취하는데 래스터의 행은 남쪽으로 갈수록 증가하는 반면 $y$-좌표값은 감소하는 것과 보조를 맞추기 위함이다.\n\n일반적인 폴리곤 테셀레이션에서는 두 개의 폴리곤이 공유하는 경계에 위치한 점의 할당이 모호하지만, 정규 테셀레이션에서는 좌측 닫힘 “\\[” 및 우측 개방 “)” 구간을 사용하기 때문에 이러한 모호성이 해소된다. 이는 $y$-좌표에 음의 $\\delta$값이 $x$-좌표에 양의 $\\delta$값이 적용된 적용된 래스터의 경우, 각 셀의 모서리 점들 중 좌측 상단의 것만이 해당 셀의 부분으로 간주된다는 것을 의미한다. 이로 인해 발생할 수 있는 예기치 못한 결과 중 한 예가 그림 3.6에 나타나 있다.\n\n\n::: {.cell}\n\n:::\n\n\n![래스터화의 예기치 못한 결과: 각 셀의 좌측 상단 지점만 셀의 내부로 간주되기 때문에 대각선 아래에서 붉은 선에 접촉한 셀들도 래스터로 전환되었다.](https://r-spatial.org/book/03-Geometries_files/figure-html/fig-rasterizeline-1.png){#fig-3-6}\n\n시간 차원을 좌측 닫힘 및 우측 개방 구간으로 세분하는 것은 매우 일반적이며, 이는 R의 **xts** 패키지와 같은 시계열 소프트웨어의 암묵적인 기본 가정이다. 즉, 시간 스탬프(시점)는 시간 간격의 시작을 나타낸다. 다른 모델이 결합될 수도 있다. 예를 들어, 심플 피처 폴리곤을 사용하여 공간을 세분하고 이를 정규 시간 테셀레이션과 결합하여 시공간 벡터 데이터 큐브 개념을 구현할 수 있다. 래스터 및 벡터 데이터 큐브에 대한 논의는 6장에서 다룬다.\n\n위에서 언급한 것처럼, $R^2$에 대한 정규 테셀레이션을 생성하는데 활용될 수 있는 폴리곤으로 정사각형 외에 삼각형과 육각형도 있다. 3차원 구체로 확장하면 더 많아지는데, 큐브, 정팔면체, 정이십면체, 정십이면체 등을 포함한다. 큐브를 기반으로 하는 공간 인덱스는 s2geometry이며, H3 라이브러리는 정이십면체를 사용하는데, 밀집화를 위해 (주로) 육각형을 사용한다. 지구 전체를 포괄하는 모자이크 역시 이산 글로벌 그리드라고 불린다.\n\n## 네트워크\n\n공간적 네트워크느 일반적으로 라인(LINESTRING) 요소로 구성되지만, 네트워크로서의 완결성을 위한 추가적인 위상적 특성을 가진다.\n\n-   라인스트링의 시작점과 끝점은 다른 라인스트링의 시작점이나 끝점에 연결될 수 있으며, 이를 통해 노드와 엣지의 집합이 형성된다.\n\n-   엣지는 방향성을 가질 수 있으며, 이 경우 연결(흐름, 수송)은 한 방향으로만 가능하다.\n\n**osmar**(Schlesinger and Eugster 2013), **stplanr**(Lovelace, Ellison, and Morgan 2022), **sfnetworks**(van der Meer et al. 2022)와 같은 R 패키지는 네트워크 객체를 구성하고 이를 다루는 기능을 제공하며, 네트워크를 통한 최단 또는 최속 경로를 계산할 수 있게 해준다. **spatstat** 패키지(Baddeley, Turner, and Rubak 2022; Baddeley, Rubak, and Turner 2015)는 포인트 패턴 분석을 선형 네트워크 상에서도 할 수 있는 기능을 제공한다(11장). Lovelace, Nowosad, and Muenchow (2019)의 12장은 네트워크 데이터를 사용한 교통 애플리케이션에 대해 다루고 있다.\n\n## 연습문제\n\n다음의 연습문제를 풀되, 적절한 곳에서 R을 활용하라.\n\n1.  2차원(평면) 공간에서 심플 피처 지오메트리로 표현될 수 없는 지오메트리의 두 가지 예를 제시하고, 그림으로 표현하라.\n\n2.  좌표 10.542, 0.01, 45321.6789를 정밀도 값 1, 1e3, 1e6, 및 1e-2를 사용하여 재계산하라.\n\n3.  에너리 인터섹션이 요구되는 현실 문제를 제시하라.\n\n4.  지점별로 하나의 폐쇄 폴리곤을 가지는 보로노이 다이어그램(그림 3.3)을 어떻게 만들 수 있는지 설명하라.\n\n5.  다음의 지오메트리에 대해 유너리 측도 `dimension`을 계산하라. `POINT Z (0 1 1)`, `LINESTRING Z (0 0 1,1 1 2)`, `POLYGON Z ((0 0 0,1 0 0,1 1 0,0 00))`\n\n6.  `LINESTRING(0 0,1 0)`과 `LINESTRING(0.5 0,0.5 1)`의 DE-9IM 관계를 설명하라. 개별 문자의 의미도 함께 설명하라.\n\n7.  심플 피처 폴리곤의 집합을 가지고 커버리지 하나를 만들 수 있을지의 여부에 대해 답하라. 만약 답이 그렇다이면 어떤 제약조건 하에서 그것이 가능한지 설명하라.\n\n8.  **sf** 패키지에 들어 있는 `nc` 카운티 데이터를 가지고, 네 개의 카운티가 동시에 접촉하고 있는 포인트들을 추출하라.\n\n9.  $y$-축을 위한 $\\delta$값이 양수라면, 그림 3.6은 어떻게 달라질지 설명하라.\n",
    "supporting": [
      "03_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}