---
date-modified: last-modified
number-sections: true
format: 
  html: 
    toc: true
code-link: true
code-copy: true
execute: 
  warning: false
  error: false
  freeze: auto
editor: visual
---

# 시작하기 {#sec-start}

이 장에서는 공간데이터와 시공간데이터를 다루기 위한 관련 개념들에 대해 소개한다. 이 개념들은 이후의 장들에서 좀 더 상세하게 다루어질 것이다. 이 외에도 모든 공간데이터사이언스 언어 실행의 토대가 되는 몇 가지 오픈소스 테크놀로지에 대해 소개한다.

## 첫 번째 지도

공간데이터를 표현하는 전형적인 방법은 지도를 그리는 것이다. @fig-first-map 에는 단순한 지도가 나타나 있다.

```{r}
#| echo: false
#| label: fig-first-map
#| fig-cap: "첫 번째 지도: 미국 노스캐롤라이나의 카운티별 출생아수, 1974~78년"
library(tidyverse)
library(sf)
system.file("gpkg/nc.gpkg", package="sf") |>
    read_sf() -> nc
nc.32119 <- st_transform(nc, 'EPSG:32119')
nc.32119 |>
    select(BIR74) |>
    plot(graticule = TRUE, axes = TRUE)
```

이 지도에는 몇 가지 그래픽 요소들이 나타나 있다.

-   검은색 외곽선을 가진 폴리곤이 나타나 있고, 폴리곤의 내부는 BIR74라는 변수(제목)의 값에 따라 상이한 컬러로 채워져 있다.

-   범례는 서로 다른 컬러가 무엇을 의미하는지를 설명하고 있는데, 특정한 *컬러 팔레트*가 적용되어 있고, 컬러가 변하는 지점에 *컬러 단절값*이 나타나 있다.

-   경위선망(그래티큘)이 지도의 배경에 나타나 있다.

-   축의 눈금은 특정한 경도값과 위도값이다.

*폴리곤*은 특정한 형태의 *지오메트리*이다. 공간적 지오메트리(포인트, 라인, 폴리곤, 픽셀)에 대해서는 @sec-geometry 에서 자세히 다룬다. 폴리곤은 여러 개의 포인트들로 구성되어 있고, 포인트들은 선분으로 서로 이어져 있다. 공간데이터의 포인트 위치가 어떻게 표현되고 측정되는지에 대해서는 @sec-coord 에서 다룬다. @fig-first-map 에서 볼 수 있는 것처럼, 모든 경위선이 직선으로 표현되는 것이 아니다. 이것은 지도에 특정한 형태의 투영법이 적용되어 있음을 의미한다. 지도투영에 대해서는 @sec-coord 와 @sec-every 에서 다룬다.

@fig-first-map 에서 컬러로 표현되어 있는 것은 `BIR74`라는 변수의 값이다. 값 하나는 지오메트리 혹은 피쳐(feature) 하나와 연결되어 있다. @sec-attribute 은 이러한 피처 속성 및 그것들이 피처 지오메트리와 어떻게 관련되어 있는지에 대해서 다룰 것이다. `BIR74` 변수는 출생아수를 나타내며, 이는 *지역별* 빈도값이다. 지역별 빈도값이라는 말은 이 값이 지역 내의 모든 지점과 관련되어 있는 것이 아니라는 것을 의미하는데, 지도의 컬러가 연속적인 값을 취하고 있기 때문에 이렇게 오해할 수 있지만, 사실 빈도값은 폴리곤에 전체와 연결되어 있는 일종의 적분값을 의미한다.

@fig-first-map 을 그리기 위해서는 당연히 데이터가 필요한데, @sec-sf 에서 사용된 파일을 읽어 들였다. 세 개의 속성 변수에 대한 첫 세 개 레코드의 데이터 요약을 출력하면 다음과 같다:

```{r}
#| echo: false
nc |> select(AREA, BIR74, SID74) |> print(n = 3)
```

이 데이터 요약은 다음의 사항을 알려준다:

-   데이터셋은 100개의 피처(레코드)와 3개의 필드(속성)으로 구성되어 있다.

-   지오메트리 유형은 `MULTIPOLYGON` (@sec-geometry )이다.

-   디멘션(dimension)은 `XY`이다. 즉, 개별 포인트는 두 개의 좌표값으로 구성되어 있다.

-   좌표참조계(CRS, coordinate reference system)는 측지(geodetic) 좌표계이며, NAD27 데이텀(datum)에 의거한 경위도값을 가지고 있다(@sec-coord ).

-   세 개의 속성 변수 바로 다음에 `MULTIPOLYGON` 유형의 `geom` 변수가 있는데, 이것은 폴리곤 정보를 도(degree) 형식으로 담고있다.

패싯(facet) 플롯을 활용하면 @fig-1-2 에서 보는 것과 같은 보다 복잡한 형태의 지도를 그릴 수 있다.

```{r}
#| echo: false
#| label: fig-1-2
#| fig-cap: "미국 노스캐롤라이나 카운티별 영아돌연사증후군에 의한 사망아수의 패싯 지도, 1974~78년과 1979~84년" 
year_labels <- c("SID74" = "1974 - 1978", "SID79" = "1979 - 1984")
nc.32119 |> select(SID74, SID79) |>
    pivot_longer(starts_with("SID")) -> nc_longer
ggplot() + geom_sf(data = nc_longer, aes(fill = value), linewidth = 0.4) + 
  facet_wrap(~ name, ncol = 1, labeller = labeller(name = year_labels)) +
  scale_y_continuous(breaks = 34:36) +
  scale_fill_gradientn(colors = sf.colors(20)) +
  theme(panel.grid.major = element_line(color = "white"))
```

리플릿(leaflet)을 활용하면 @fig-1-3 에서 보는 것과 같은 상호작용형 지도를 만들 수 있다.

```{r}
#| echo: false
#| label: fig-1-3
#| fig-cap: "**mapview**로 그린 상호작용형 지도: 팬과 줌을 이용해 지도 스케일에 변화를 줄 수 있고 카운티를 클릭하면 해당 카운티의 속성을 보여주는 팝업 윈도우가 뜬다."
library(mapview) |> suppressPackageStartupMessages()
mapviewOptions(fgb = FALSE)
nc.32119 |> mapview(zcol = "BIR74", legend = TRUE, col.regions = sf.colors)
```

## CRS
