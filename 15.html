<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>공간데이터사이언스 개론 - 15&nbsp; 공간적 자기상관 측도</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./16.html" rel="next">
<link href="./14.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-autocorrelation" class="quarto-section-identifier"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">공간적 자기상관 측도</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">공간데이터사이언스 개론</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/sangillee66/book_sds_trans" title="소스 코드" class="quarto-navigation-tool px-1" aria-label="소스 코드"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">서장</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">시작하기</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">좌표계</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">구면 지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">속성과 서포트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">데이터 큐브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터사이언스와 R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">sf와 stars 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">공간데이터의 플로팅</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">대규모 데이터와 클라우드 네이티브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간통계분석과 공간모델링</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">공간데이터의 통계적 모형화</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">포인트 패턴 분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">공간적 내삽</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">다변량 및 시공간 지구통계학</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">근접성과 에어리어 데이터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">공간적 자기상관 측도</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">공간적 회귀분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">공간계량경제학적 모형</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">부록</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">예전 R 공간 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R 기초</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">목차</h2>
   
  <ul>
<li><a href="#%EC%B8%A1%EB%8F%84%EC%99%80-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%98%A4%EC%A7%80%EC%A0%95" id="toc-측도와-프로세스-오지정" class="nav-link active" data-scroll-target="#%EC%B8%A1%EB%8F%84%EC%99%80-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%98%A4%EC%A7%80%EC%A0%95"><span class="header-section-number">15.1</span> 측도와 프로세스 오지정</a></li>
  <li>
<a href="#%EC%A0%84%EC%97%AD%EC%A0%81-%EC%B8%A1%EB%8F%84" id="toc-전역적-측도" class="nav-link" data-scroll-target="#%EC%A0%84%EC%97%AD%EC%A0%81-%EC%B8%A1%EB%8F%84"><span class="header-section-number">15.2</span> 전역적 측도</a>
  <ul class="collapse">
<li><a href="#%EB%B2%94%EC%A3%BC-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9C%84%ED%95%9C-%EC%A1%B0%EC%9D%B8-%EC%B9%B4%EC%9A%B4%ED%8A%B8-%ED%86%B5%EA%B3%84%EB%9F%89" id="toc-범주-데이터를-위한-조인-카운트-통계량" class="nav-link" data-scroll-target="#%EB%B2%94%EC%A3%BC-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9C%84%ED%95%9C-%EC%A1%B0%EC%9D%B8-%EC%B9%B4%EC%9A%B4%ED%8A%B8-%ED%86%B5%EA%B3%84%EB%9F%89"><span class="header-section-number">15.2.1</span> 범주 데이터를 위한 조인 카운트 통계량</a></li>
  <li><a href="#%EB%AA%A8%EB%9F%B0-%ED%86%B5%EA%B3%84%EB%9F%89" id="toc-모런-통계량" class="nav-link" data-scroll-target="#%EB%AA%A8%EB%9F%B0-%ED%86%B5%EA%B3%84%EB%9F%89"><span class="header-section-number">15.2.2</span> 모런 통계량</a></li>
  </ul>
</li>
  <li>
<a href="#%EA%B5%AD%EC%A7%80%EC%A0%81-%EC%B8%A1%EB%8F%84" id="toc-국지적-측도" class="nav-link" data-scroll-target="#%EA%B5%AD%EC%A7%80%EC%A0%81-%EC%B8%A1%EB%8F%84"><span class="header-section-number">15.3</span> 국지적 측도</a>
  <ul class="collapse">
<li><a href="#%EA%B5%AD%EC%A7%80%EC%A0%81-%EB%AA%A8%EB%9F%B0-%ED%86%B5%EA%B3%84%EB%9F%89" id="toc-국지적-모런-통계량" class="nav-link" data-scroll-target="#%EA%B5%AD%EC%A7%80%EC%A0%81-%EB%AA%A8%EB%9F%B0-%ED%86%B5%EA%B3%84%EB%9F%89"><span class="header-section-number">15.3.1</span> 국지적 모런 통계량</a></li>
  <li><a href="#%EA%B5%AD%EC%A7%80%EC%A0%81-%EA%B2%8C%ED%8B%B0%EC%8A%A4-%EC%98%A4%EB%93%9C-%ED%86%B5%EA%B3%84%EB%9F%89" id="toc-국지적-게티스-오드-통계량" class="nav-link" data-scroll-target="#%EA%B5%AD%EC%A7%80%EC%A0%81-%EA%B2%8C%ED%8B%B0%EC%8A%A4-%EC%98%A4%EB%93%9C-%ED%86%B5%EA%B3%84%EB%9F%89"><span class="header-section-number">15.3.2</span> 국지적 게티스-오드 통계량</a></li>
  <li><a href="#%EA%B5%AD%EC%A7%80%EC%A0%81-%EA%B8%B0%EC%96%B4%EB%A6%AC-%ED%86%B5%EA%B3%84%EB%9F%89" id="toc-국지적-기어리-통계량" class="nav-link" data-scroll-target="#%EA%B5%AD%EC%A7%80%EC%A0%81-%EA%B8%B0%EC%96%B4%EB%A6%AC-%ED%86%B5%EA%B3%84%EB%9F%89"><span class="header-section-number">15.3.3</span> 국지적 기어리 통계량</a></li>
  <li><a href="#rgeoda-%ED%8C%A8%ED%82%A4%EC%A7%80" id="toc-rgeoda-패키지" class="nav-link" data-scroll-target="#rgeoda-%ED%8C%A8%ED%82%A4%EC%A7%80"><span class="header-section-number">15.3.4</span> rgeoda 패키지</a></li>
  </ul>
</li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C" id="toc-연습문제" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C"><span class="header-section-number">15.4</span> 연습문제</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-autocorrelation" class="quarto-section-identifier"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">공간적 자기상관 측도</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">2025년 8월 16일</p>
    </div>
  </div>
    
  </div>
  


</header><p>에어리어 데이터 분석에서 공간적 자기상관이 존재하는 경우, 관측치의 독립성을 전제로 하는 전통적 추론 방식과는 다른 분석 절차가 요구된다는 점이 오래전부터 잘 알려져 왔다. 공간적 자기상관이 존재하면, 관측 개체 <span class="math inline">\(i\)</span>의 값을 인접 이웃들의 집합 <span class="math inline">\(N_i\)</span>에 속하는 다른 관측 개체 <span class="math inline">\(j\)</span>의 값으로 예측할 수 있다. Moran(1948)과 Geary(1954)의 선구적인 연구 성과는 점진적인 수용 과정을 거쳐(사회과학 분야의 예: Duncan, Cuzzort, and Duncan 1961), 이후 정리와 확장을 통해 정량적 분석의 기본 도구로 자리 잡았다(Cliff and Ord 1973, 1981).</p>
<p>Cliff와 Ord(1973)는 조인 카운트 통계량, 모런 통계량(Moran’s <span class="math inline">\(I\)</span>), 기어리 통계량(Geary’s <span class="math inline">\(C\)</span>) 등 다양한 공간통계량에 공통적으로 적용 가능한 분포 이론을 확립하고자 하였으며, 이 과정에서 공간가중치행렬(spatial weights matrix)의 개념을 일반화하고 확장하는데 주력하였다. 이들 통계량은 전체 연구 지역에 대해 하나의 공간적 자기상관 값을 산출한다는 점에서 전역적 측도(global measure)라고 불리며, 이후 개별 구역 단위의 공간적 자기상관 값을 산출하는 국지적 측도(local measure)(Getis and Ord 1992; Anselin 1995)의 발전으로 이어졌다.</p>
<p><strong>spdep</strong> 패키지는 다양한 측도를 계산할 수 있도록 할 뿐 아니라 측도간 비교 분석을 촉진하도록 설계되었다. 이러한 이유로 측도 함수는 컴파일된 코드가 아닌 R로 작성되어, 최근 소개된 <strong>rgeoda</strong> 패키지(Li and Anselin 2021; Anselin, Li, and Koschinsky 2021)보다 속도는 다소 느리지만 훨씬 더 유연하다.</p>
<section id="측도와-프로세스-오지정" class="level2" data-number="15.1"><h2 data-number="15.1" class="anchored" data-anchor-id="측도와-프로세스-오지정">
<span class="header-section-number">15.1</span> 측도와 프로세스 오지정</h2>
<p>Tobler(1970)가 제시한 지리학의 제1법칙, 즉 “모든 것은 다른 모든 것과 연관되어 있다. 그러나 가까이 있는 것은 멀리 떨어져 있는 것보다 더 많이 연관되어 있다”는 만고의 진리처럼 받아들여져서는 안된다. 이 법칙은 지나치게 단순화된 개념으로, 다른 잠재적 문제들을 가려 버릴 수 있다. 예를 들어 개체화(entitation)의 문제, 스포트 문제, 그리고 오지정(misspecification)의 문제가 이에 해당한다. 관측 단위의 크기가 기저 공간 프로세스의 스케일에 부합하는가? 주어진 관측 단위에서 나타나는 관심 변수의 공간적 패턴이 다른 변수의 공간적 패턴으로 설명될 수 있는가?(역자주: 여기에서 ’개체화’의 문제는 사용된 공간 단위가 해당 공간 현상을 분석하기에 적합한지와 관련된 문제로 소위 ’공간단위 임의성의 문제(MAUP, modifiable areal unit problem)’와 관련된 것이다. ’오지정’의 문제는 통계 모형에서 해당 현상을 설명하기에 적절하지 않은 방식으로 변수 설정이 이루어진 경우를 통칭하는 용어인데, 주로 주요 변수의 누락에서 비롯되는 문제를 지적한다.)</p>
<p>토블러(Tobler, 1970)의 논문은 올슨(Olsson, 1970)의 논문과 함께 경제지리학(<em>Economic Geography)</em> 저널의 특별호에 실렸다. 그러나 올슨은 공간적 자기상관이 공간 현상에 필연적으로 내재된 속성이 아니라, 부적절한 개체화, 누락된 변수, 그리고/또는 부적절하게 설정된 함수 관계로 인해 발생하는 경우가 더 많다는 점을 간파했다. Olsson의 핵심 인용문은 228쪽에 있다.</p>
<p>“이러한 자기상관의 존재는 Tobler(1970)가 말한 “모든 것은 다른 모든 것과 연관되어 있다. 그러나 가까이 있는 것은 멀리 떨어져 있는 것보다 더 많이 연관되어 있다”는 주장에 동의하고 싶어지게 만든다. 그러나 한편으로, 이러한 자기상관이 체계적인 오지정 오류를 가리고 있는 것처럼 보인다는 사실은 이 주장을 ’지리학의 제1법칙’으로 격상하는 것이 다소 성급하다는 점을 시사한다. 최악의 경우, 이 주장은 사후 오류(post hoc fallacy, 단순한 우연을 인과 관계로 잘못 해석하는 오류)의 공간적 변형에 불과할 수도 있다.”</p>
<p>’제1법칙’으로서의 ’확고한 지위’는 존 스노(John Snow)가 지도를 통해 콜레라의 원인이 수인성임을 밝혀냈다는 ’믿음’과 매우 유사하다. 존 스노의 이야기는 GIS를 홍보하는 데 도움이 될 수 있지만, 실제 역사적 사실과는 거리가 있다. 존 스노는 소호(Soho) 지역을 탐문하기 전에 이미 강력한 작업 가설을 갖고 있었으며, 해당 지도는 브로드 스트리트(Broad Street) 펌프가 차단된 이후 그의 가설이 옳았음을 문서화하기 위해 작성된 것이었다(Brody et al.&nbsp;2000).</p>
<p>불행히도 공간적 자기상관 측도는 실제 공간 구조뿐 아니라, 모형화 과정에서의 잘못된 지정으로 인한 오류까지 반영할 수 있다(Schabenberger and Gotway 2005; McMillen 2003). 이를 이해하기 위해, 대표적인 공간적 자기상관 측도인 모런 통계량을 정의한 뒤(Cliff and Ord 1981, 17), 단순한 예시를 살펴보자.</p>
<p><span class="math display">\[
I=\frac {n\sum_{(2)}w_{ij} z_i z_j}{S_0\sum^n_{i=1}z^2_i}
\]</span></p>
<p>여기서 <span class="math inline">\(z_i=x_i-\bar{x}\)</span>, <span class="math inline">\(x_i\)</span>는 해당 변수의 <span class="math inline">\(n\)</span>개의 관측값 중 하나, <span class="math inline">\(\bar{x}=\sum^n_{i=1}x_i/n\)</span>, <span class="math inline">\(\sum_{(2)}=\sum^n_{i=1}\sum^n_{j=1}(i\neq j)\)</span>, <span class="math inline">\(w_{ij}\)</span>는 공간가중치, <span class="math inline">\(S_0=\sum_{(2)}w_{ij}\)</span>이다. 먼저, 무작위 확률 변수에 대해 공간적 자기상관을 검토하기 위해 정규성 가정 하에서(인수를 <code>randomisation = FALSE</code>로 지정) 모런 검정을 수행한다. 검정 통계량은 <span class="math inline">\(Z(I)=\frac{I-E(I)}{\sqrt{Var(I)}}\)</span>로 정의되며, 계산된 <span class="math inline">\(z\)</span> 값을 <span class="math inline">\(E(I)\)</span>와 <span class="math inline">\(Var(I)\)</span>를 갖는 정규분포와 비교한다. 아래는 무작위 확률 변수에 공간적 자기상관이 존재하지 않는다는 귀무가설을 검정한 결과이다.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="va">glance_htest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ht</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ht</span><span class="op">$</span><span class="va">estimate</span>, </span>
<span>    <span class="st">"Std deviate"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">ht</span><span class="op">$</span><span class="va">statistic</span><span class="op">)</span>, </span>
<span>    <span class="st">"p.value"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">ht</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">pol_pres15</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">lw_q_B</span>, randomisation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">glance_htest</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Moran I statistic       Expectation          Variance </span></span>
<span><span class="co">#         -0.004772         -0.000401          0.000140 </span></span>
<span><span class="co">#       Std deviate           p.value </span></span>
<span><span class="co">#         -0.369320          0.711889</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이제, 약간의 공간적 경향성을 가진 가상의 변수를 생성하고, 이를 별도의 변수로 취급하지 않고 원래의 무작위 변수에 합산했다고 가정하자. 이 상태에서 동일한 검정을 적용하면 이번에는 강한 공간적 자기상관이 나타난다. 이는 공간적 경향성을 가진 변수를 모형에 포함하지 않아 발생한 변수 누락 오류로, 그 영향이 분석 결과에서 강한 공간적 자기상관으로 잘못 나타난 사례다.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.0015</span></span>
<span><span class="va">coords</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">t</span></span>
<span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">t</span> <span class="op">-&gt;</span> <span class="va">x_t</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">lw_q_B</span>, randomisation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">glance_htest</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Moran I statistic       Expectation          Variance </span></span>
<span><span class="co">#          0.043403         -0.000401          0.000140 </span></span>
<span><span class="co">#       Std deviate           p.value </span></span>
<span><span class="co">#          3.701491          0.000214</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>공간적 경향성을 가진 변수를 선형모형의 독립변수로 포함하면, 잔차에서 공간적 자기상관이 사라지는 것을 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">x_t</span> <span class="op">~</span> <span class="va">t</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lm.morantest.html">lm.morantest</a></span><span class="op">(</span><span class="va">lw_q_B</span>, alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">glance_htest</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Observed Moran I      Expectation         Variance      Std deviate </span></span>
<span><span class="co">#        -0.004777        -0.000789         0.000140        -0.337306 </span></span>
<span><span class="co">#          p.value </span></span>
<span><span class="co">#         0.735886</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다양한 공간적 자기상관 측도는 여러 R 패키지에서 이용할 수 있다. 그 가운데 <strong>spdep</strong> 패키지(Bivand 2022b)가 핵심적인 역할을 담당하며, 패키지 간 차이는 주로 실행 설계와 관련된다(Bivand and Wong 2018). <strong>spdep</strong> 패키지를 사용하면 회귀 잔차에 대한 전역적 및 국지적 모런 검정을 수행할 수 있으며, 다른 패키지와 달리 정확(exact) 검정과 안장점 근사법(saddlepoint approximation)(Tiefelsdorf 2002; Bivand, Müller, and Reder 2009)을 모두 제공한다.</p>
</section><section id="전역적-측도" class="level2" data-number="15.2"><h2 data-number="15.2" class="anchored" data-anchor-id="전역적-측도">
<span class="header-section-number">15.2</span> 전역적 측도</h2>
<section id="범주-데이터를-위한-조인-카운트-통계량" class="level3" data-number="15.2.1"><h3 data-number="15.2.1" class="anchored" data-anchor-id="범주-데이터를-위한-조인-카운트-통계량">
<span class="header-section-number">15.2.1</span> 범주 데이터를 위한 조인 카운트 통계량</h3>
<p>먼저 조인 카운트(join-count) 통계량을 살펴보자. 여기서 <code><a href="https://r-spatial.github.io/spdep/reference/joincount.test.html">joincount.test()</a></code> 함수는 <code>"factor"</code> 값 벡터 <code>fx</code>와 <code>listw</code> 객체를 입력받아, <strong>stats</strong> 패키지에서 정의된 <code>htest</code>(가설 검정) 객체들의 리스트를 반환한다. 반환되는 각 <code>htest</code> 객체는 <code>fx</code> 인수의 각 수준에 대해 하나씩 생성된다. 관찰된 카운트는 동일한 범주 수준을 가진 이웃 쌍의 수를 의미하며, 이를 동일 컬러 조인(same-colour joins)이라고 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html">args</a></span><span class="op">(</span><span class="va">joincount.test</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>#  function (fx, listw, zero.policy = NULL, alternative = "greater",
#    sampling = "nonfree", spChk = NULL, adjust.n = TRUE)</code></pre>
<p>이 함수는 가설 검정을 위한 <code>alternative</code> 인수와, 통계량의 분산을 구성하는 기준을 지정하는 <code>sampling</code> 인수를 입력받는다. 기본값 <code>"nonfree"</code>는 개념적으로 분석적 순열(analytical permutation)과 동일한 것이다.(역자주: ’분석적 순열’은 난수를 사용해 무작위 순열을 생성하지 않고, 가능한 모든 순열의 조합과 그에 따른 검정 통계량 분포를 수학 공식이나 조합론(combinatorics)을 통해 직접 계산하는 방식이다. 즉, 가설 검정을 위한 적률(예: 기대값, 분산 등)을 산출하는 공식이 명시적으로 제시되는 방식이다.) <code>spChk</code> 인수는 이전 버전과의 호환성을 위해 유지된다. 참고로, 앞에서 살펴본 지방자치단체 데이터에 대한 범주 유형별 카운트는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">pol_pres15</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="va">types</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">Types</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#          Rural          Urban    Urban/rural Warsaw Borough </span></span>
<span><span class="co">#           1563            303            611             18</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>네 개의 범주 유형, 즉 네 개의 수준이 있으므로, <code>htest</code> 객체 리스트를 재배열하여 추정 결과를 나타내는 행렬을 생성한다. 관찰된 동일 컬러 조인 카운트는 입력된 범주 수준의 카운트를 기반으로 계산한 기대값과 함께 표로 정리된다. 예를 들어, 바르샤바 구역 간에는 결합이 거의 없을 것으로 예상되는데, 이는 구역 수가 매우 적기 때문이다. 분산 계산은 선택된 <code>listw</code> 객체의 기본 상수와 입력 범주 수준의 카운트를 사용하여 수행된다. <span class="math inline">\(z\)</span> 값은 관찰된 조인 카운트와 기대값의 차이를 분산의 제곱근으로 나누어 산출한다.</p>
<p>조인 카운트 검정은 다중 컬러조인 카운트 상황으로 확장되도록 수정되었다(Upton and Fingleton 1985). <strong>spdep</strong> 패키지에서는 <code><a href="https://r-spatial.github.io/spdep/reference/joincount.multi.html">joincount.multi()</a></code> 함수로 구현되어 있으며, 비자유 샘플링(non-free sampling)을 기반으로 표를 반환하되 <span class="math inline">\(p\)</span> 값은 보고하지 않는다.(역자주: ’자유 샘플링(free sampling)’은 각 공간 단위에 레이블(예: 흑과 백)을 독립적으로 무작위 부여하는 방식으로, 샘플링(즉, 재배치)마다 흑백 비율이 달라질 수 있어 복원 샘플링과 유사하다. 반면 ’비자유 샘플링(nonfree sampling)’은 전체에서 흑과 백의 개수를 고정한 채로 무작위 재배치하는 방식으로, 원래 데이터의 비율을 유지하며 비복원 샘플링과 유사하다. 예를 들어 조인 카운트 통계량 검정에서 비자유 샘플링은 원래의 흑백 개수를 그대로 보존한 채 공간 단위의 위치만 바꾸는 방식이다.)</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Types</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/joincount.multi.html">joincount.multi</a></span><span class="op">(</span>listw <span class="op">=</span> <span class="va">lw_q_B</span><span class="op">)</span></span>
<span><span class="co">#                               Joincount Expected Variance z-value</span></span>
<span><span class="co"># Rural:Rural                    3087.000 2793.920 1126.534    8.73</span></span>
<span><span class="co"># Urban:Urban                     110.000  104.719   93.299    0.55</span></span>
<span><span class="co"># Urban/rural:Urban/rural         656.000  426.526  331.759   12.60</span></span>
<span><span class="co"># Warsaw Borough:Warsaw Borough    41.000    0.350    0.347   68.96</span></span>
<span><span class="co"># Urban:Rural                     668.000 1083.941  708.209  -15.63</span></span>
<span><span class="co"># Urban/rural:Rural              2359.000 2185.769 1267.131    4.87</span></span>
<span><span class="co"># Urban/rural:Urban               171.000  423.729  352.190  -13.47</span></span>
<span><span class="co"># Warsaw Borough:Rural             12.000   64.393   46.460   -7.69</span></span>
<span><span class="co"># Warsaw Borough:Urban              9.000   12.483   11.758   -1.02</span></span>
<span><span class="co"># Warsaw Borough:Urban/rural        8.000   25.172   22.354   -3.63</span></span>
<span><span class="co"># Jtot                           3227.000 3795.486 1496.398  -14.70</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>바이너리 가중치를 적용하는 상항에서는 조인 카운트의 합에 해당 조인에 대한 가중치를 곱한 값도 여전히 정수로 나타난다. 그러나 행표준화가중치를 적용하면, 가중치가 대부분 1보다 작은 분수가 되므로 카운트, 기대값, 분산이 달라진다. 그럼에도 최종적인 <span class="math inline">\(z\)</span> 값에는 큰 변화가 없다.</p>
<p>그러나 역거리 기반의 <code>listw</code> 객체를 사용하면 <span class="math inline">\(z\)</span> 값이 크게 변한다. 이는 가까운 센트로이드에 상대적으로 더 큰 가중치가 부여되기 때문이다.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Types</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/joincount.multi.html">joincount.multi</a></span><span class="op">(</span>listw <span class="op">=</span> <span class="va">lw_d183_idw_B</span><span class="op">)</span></span>
<span><span class="co">#                               Joincount Expected Variance z-value</span></span>
<span><span class="co"># Rural:Rural                    3.46e+02 3.61e+02 4.93e+01   -2.10</span></span>
<span><span class="co"># Urban:Urban                    2.90e+01 1.35e+01 2.23e+00   10.39</span></span>
<span><span class="co"># Urban/rural:Urban/rural        4.65e+01 5.51e+01 9.61e+00   -2.79</span></span>
<span><span class="co"># Warsaw Borough:Warsaw Borough  1.68e+01 4.53e-02 6.61e-03  206.38</span></span>
<span><span class="co"># Urban:Rural                    2.02e+02 1.40e+02 2.36e+01   12.73</span></span>
<span><span class="co"># Urban/rural:Rural              2.25e+02 2.83e+02 3.59e+01   -9.59</span></span>
<span><span class="co"># Urban/rural:Urban              3.65e+01 5.48e+01 8.86e+00   -6.14</span></span>
<span><span class="co"># Warsaw Borough:Rural           5.65e+00 8.33e+00 1.73e+00   -2.04</span></span>
<span><span class="co"># Warsaw Borough:Urban           9.18e+00 1.61e+00 2.54e-01   15.01</span></span>
<span><span class="co"># Warsaw Borough:Urban/rural     3.27e+00 3.25e+00 5.52e-01    0.02</span></span>
<span><span class="co"># Jtot                           4.82e+02 4.91e+02 4.16e+01   -1.38</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="모런-통계량" class="level3" data-number="15.2.2"><h3 data-number="15.2.2" class="anchored" data-anchor-id="모런-통계량">
<span class="header-section-number">15.2.2</span> 모런 통계량</h3>
<p><strong>spdep</strong> 패키지에서 모런 통계량은 <code><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test()</a></code> 함수로 구현되어 있다. 이 함수는 <code><a href="https://r-spatial.github.io/spdep/reference/joincount.test.html">joincount.test()</a></code> 함수와 유사한 인수를 가지지만, 샘플링 대신 랜덤화(randomisation) 가정을 토대로 측도의 분산을 계산한다. 또한 수치 값 대신 순위를 사용할 수도 있다(Cliff and Ord 1981, 46). 일부 오래된 소프트웨어에서는 분산 항목의 마지막 구성 요소가 생략된 채 표시되는데, <code>drop.EI2</code> 인수는 이를 재현해준다.(역자주: 모런 통계량과 기어리 통계량의 가설 검정에는 전통적으로 두 가지 접근법이 있다. ’랜덤화 가정’은 관측값을 공간단위에 무작위로 재배치하여 경험적 분포를 구성하는 방식으로, 전체 레이블 비율을 유지하는 비자유 샘플링과 유사하다. 반면 ’정규성(normality) 가정’은 관측값이 정규분포를 따른다고 가정하여 이론적 분포를 이용하는 방식으로, 자유 샘플링과 유사하다. 두 접근법은 기대값은 동일하지만 분산이 서로 다르며, 모두 적률(moment)에 대한 공식을 제시하는 분석적 순열 방식이다.)</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html">args</a></span><span class="op">(</span><span class="va">moran.test</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>#  function (x, listw, randomisation = TRUE, zero.policy = NULL,
#    alternative = "greater", rank = FALSE, na.action = na.fail,
#    spChk = NULL, adjust.n = TRUE, drop.EI2 = FALSE)</code></pre>
<p><code>randomisation</code> 인수의 기본값은 <code>TRUE</code>이며, <code>FALSE</code>로 지정하면 정규성 가정 하에서 검정을 수행한다. 아래 사례를 통해, 단일 변수에 정규성 가정을 적용한 검정 결과와 절편만 포함된 회귀모형의 잔차에 대해 랜덤화 가정 하에서 수행한 검정 결과가 동일하게 나타남을 확인할 수 있다. 해당 변수는 2015년 폴란드 대통령 선거의 투표율이다. <code>randomisation</code>의 철자는 Cliff와 Ord(1973)의 표기를 따른 것이다.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pol_pres15</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="va">I_turnout</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">I_turnout</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">I_turnout</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span>listw <span class="op">=</span> <span class="va">lw_q_B</span>, randomisation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">glance_htest</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Moran I statistic       Expectation          Variance </span></span>
<span><span class="co">#          0.691434         -0.000401          0.000140 </span></span>
<span><span class="co">#       Std deviate           p.value </span></span>
<span><span class="co">#         58.461349          0.000000</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://r-spatial.github.io/spdep/reference/lm.morantest.html">lm.morantest()</a></code> 함수는 <code>resfun</code> 인수를 가지고 있는데, 이를 통해 검정에 사용할 잔차를 추출하는 함수를 지정할 수 있다. 이를 활용하면 종속 변수의 다른 중요한 특성을 모형화할 수 있다(Cliff and Ord 1981, 203). 단일 변수에 대한 표준 검정과 비교하기 위해, 여기서는 절편만 포함된 회귀모형을 사용하였으며 그 결과가 동일함을 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">I_turnout</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">pol_pres15</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lm.morantest.html">lm.morantest</a></span><span class="op">(</span>listw <span class="op">=</span> <span class="va">lw_q_B</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">glance_htest</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Observed Moran I      Expectation         Variance      Std deviate </span></span>
<span><span class="co">#         0.691434        -0.000401         0.000140        58.461349 </span></span>
<span><span class="co">#          p.value </span></span>
<span><span class="co">#         0.000000</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>정규성 가정과 랜덤화 가정 하에서의 검정 차이는, 변수의 첨도가 정상 범위를 벗어나는 경우 추가 항목이 더해진다는 점이다. 이때 사용되는 척도는 고전적인 첨도 측정법이다. 기본값인 랜덤화 가정 하에서는 결과가 크게 달라지지 않는다.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">I_turnout</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span>listw <span class="op">=</span> <span class="va">lw_q_B</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">mtr</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">glance_htest</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Moran I statistic       Expectation          Variance </span></span>
<span><span class="co">#          0.691434         -0.000401          0.000140 </span></span>
<span><span class="co">#       Std deviate           p.value </span></span>
<span><span class="co">#         58.459835          0.000000</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>1970년대 초반부터 몬테카를로(Monte Carlo) 검정, 즉 호프(Hope) 유형의 검정 또는 순열 부트스트랩(permutation bootstrap)으로 알려진 검정 절차에 대한 관심이 제기되었다. 기본적으로 <code><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc()</a></code> 함수는 <code>"htest"</code> 객체를 반환하지만, 내부적으로는 <code><a href="https://rdrr.io/pkg/boot/man/boot.html">boot::boot()</a></code> 함수를 사용하므로 <code>return_boot = TRUE</code>로 설정하면 <code>"boot"</code> 객체를 반환할 수도 있다. 또한 시뮬레이션 횟수는 <code>nsim</code>으로 지정하며, 이는 관측값을 무작위로 섞는 횟수를 의미한다.(역자주: 몬테카를로 검정 또는 순열 부트스트랩 검정은 가능한 모든 순열을 실제로 계산하지 않고, 그중 일부를 난수로 무작위 추출하여 검정 통계량의 분포를 근사하는 방식이다. 추출 횟수가 충분히 많을수록 근사 정확도가 높아지지만, 결과는 난수 생성에 따라 변동할 수 있다. 이에 비해 위에서 살펴본 분석적 순열은 적률(기대값, 분산 등)을 수학적 공식으로 직접 계산하여 검정 통계량의 분포를 구하는 방식으로, 난수 추출이 필요 없으며 동일한 데이터와 가정하에서는 언제나 같은 결과를 얻는다.)</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">I_turnout</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span>listw <span class="op">=</span> <span class="va">lw_q_B</span>, nsim <span class="op">=</span> <span class="fl">999</span>, </span>
<span>             return_boot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">mmc</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>순열 부트스트랩은 각 무작위 순열의 결과를 보존하며, 통계량의 관측값(여기서는 모런 통계값)과 랜덤화 시뮬레이션의 평균값(<span class="math inline">\(E(I)\)</span>와 동일한 역할)의 차이, 그리고 램덤화 시뮬레이션의 표준편차를 보고한다.</p>
<p>몬테카를로 시뮬레이션의 분산과 랜덤화 가정 하에서의 분석적 분산을 비교하면, 보통 큰 차이가 없다. 이는 몬테카를로 검정이 불필요하다는 주장의 근거가 된다.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Permutation bootstrap"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">mmc</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>, </span>
<span>  <span class="st">"Analytical randomisation"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">mtr</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#    Permutation bootstrap Analytical randomisation </span></span>
<span><span class="co">#                 0.000144                 0.000140</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>전역적 기어리 통계량(Geary’s <span class="math inline">\(C\)</span>)은 <code><a href="https://r-spatial.github.io/spdep/reference/geary.test.html">geary.test()</a></code> 함수로 구현되어 있으며, <code><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test()</a></code> 함수와 거의 동일한 인수 구조를 따른다. 게티스-오드(Getis-Ord <span class="math inline">\(G\)</span>) 검정은 추가적인 인수를 가지는데, 이는 Bivand와 Wong(2018)이 지적한 바와 같이 초기 통계량의 변종이 이후에 나타났고, 특히 거리 기반 이웃 규정에서는 생성되는 무이웃 관측 개체를 처리하는 방식의 차이를 반영해야 하기 때문이다. Getis와 Ord(1992)의 194쪽에 따르면, <span class="math inline">\(G^*\)</span>의 경우, <span class="math inline">\(G\)</span>와는 달리 <span class="math inline">\(i \neq j\)</span> 합산 제약이 완화되어 <span class="math inline">\(i\)</span>가 자기 자신을 이웃에 포함할 수 있다. 이렇게 하면 모든 관측 개체가 적어도 하나의 이웃을 가지게 되므로 무이웃 문제도 해결된다.</p>
<p>마지막으로, 경험적 베이즈 모런 통계량은 비율 데이터에서 공간적 자기상관을 평가할 때 분모를 고려할 수 있게 해준다(Assunção and Reis 1999). 지금까지는 공간단위별로 유효 투표수와 투표권을 가진 인구수의 비율을 고려했으나, <code><a href="https://r-spatial.github.io/spdep/reference/EBImoran.mc.html">EBImoran.mc()</a></code> 함수를 이용하면 투표권을 가진 인구수가 적은 공간단위에서 나타나는 극단적인 비율값이 가지는 통계적 불확실성을 반영할 수 있다. 그러나 결과에는 큰 변화가 없다.</p>
<p>지금까지 다룬 전역적 공간적 자기상관 통계량은 이웃 그래프에 기반한 공간가중치를 활용한 측도들이다. 이러한 측도들을 매우 정교한 통계적 도구라고 부르기는 어렵다. 그 이유는 결과의 해석이 해당 변수의 평균 모형을 어떻게 설정하느냐에 크게 의존하기 때문이다. 만약 평균 모형이 절편만 포함한다면, 전역적 통계량은 공간적 자기상관 뿐만 아니라 다른 모든 종류의 오지정 문제에도 동시에 반응하게 된다. 공간단위의 선정과 관련된 개체화 문제가 일반적으로는 오지정 문제의 핵심적인 원인이 된다.(역자주: 공간적 자기상관 통계량이 측정하고 검정하는 대상에는 현상의 본질적인 공간적 자기상관성뿐 아니라, 측정 과정에서 비롯되는 기타 요인이나 오지정 문제가 함께 반영될 수 있다. 따라서 이러한 통계량을 현상의 공간적 자기상관성을 정밀하게 측정하는 척도로 단정하기는 어렵다는 의미이다.)</p>
</section></section><section id="국지적-측도" class="level2" data-number="15.3"><h2 data-number="15.3" class="anchored" data-anchor-id="국지적-측도">
<span class="header-section-number">15.3</span> 국지적 측도</h2>
<p>전역적 측도의 한계를 극복하기 위한 노력의 일환으로, 1990년대 초반부터 ’국지적 공간연관성 지표(LISA, local indicators of spatial association)’들이 등장하기 시작했다(Anselin 1995; Getis and Ord 1992, 1996).</p>
<p>또한, 모런 플롯(혹은 모런 산포도)을 통해 관심 변수와 그 공간래그값(14장 참조) 간의 관련성을 시각화할 수 있게 되었다. 일반적으로 행표준화가중치를 사용하면 두 축을 보다 더 직접적으로 비교할 수 있다(Anselin 1996). <code><a href="https://r-spatial.github.io/spdep/reference/moran.plot.html">moran.plot()</a></code> 함수는 영향력 측정 객체(influence measures object)를 반환하며, 이를 통해 전역적 모런 통계량을 나타내는 직선의 기울기에 상대적으로 큰 영향을 미치는 관측 개체를 표시할 수 있다.(역자주: ’영향력 측정 객체’는 회귀분석 등에서 각 관측 개체가 분석 결과에 미치는 영향을 정량화한 지표들의 집합을 담는 결과 객체를 말한다. 여기에는 레버리지(leverage), Cook’s 거리, DFBETA, DFFITS, 공분산 비율 등과 같이 특정 관측 개체를 제거하거나 변경했을 때 추정치나 적합값이 얼마나 변하는지를 나타내는 통계량이 포함된다. <code><a href="https://r-spatial.github.io/spdep/reference/moran.plot.html">moran.plot()</a></code> 함수는 Moran 산점도를 작성하면서 이러한 영향력 측정 절차를 표준화된 관측값과 공간래그값 간의 관계에 적용하여, 각 공간단위가 국지적 모런 통계량에 미치는 상대적 영향을 파악할 수 있는 형태로 반환한다.) 그림 15.1에서는 영향력이 큰 관측 개체가 상당히 많다는 점을 확인할 수 있다. 이러한 관측값과 공간래그 관측값의 쌍은 집합적으로 전역적 측도를 구성하지만, 개별적으로도 탐색이 가능하다. 모런 플롯에서 오른쪽 상단 사분면에는 높은 값-높은 값(High-High) 쌍이, 왼쪽 하단 사분면에는 낮은 값-낮은 값(Low-Low) 쌍이 나타난다. 왼쪽 상단과 오른쪽 하단 사분면에는 각각 낮은 값-높은 값(Low-High)과 높은 값-낮은 값(High-Low) 쌍이 위치하며, 앞의 두 사분면에 비해 상대적으로 적게 나타난다. <code><a href="https://r-spatial.github.io/spdep/reference/moran.plot.html">moran.plot()</a></code> 함수에서 사분면은 변수값와 공간래그값의 평균을 기준으로 나뉘지만, 해당 값을 표준화한 경우에는 0을 기준으로 나뉜다.</p>
<div id="fig-15-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-moranplot-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-1" data-gallery="quarto-lightbox-gallery-1"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-moranplot-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.1: 투표율에 대한 모런 플롯(행표준화 공간가중치행렬 적용)
</figcaption></figure>
</div>
<p>반환된 객체에서 회귀 영향 측도값(구체적으로는 hat influence measure, 햇 영향력 지표 혹은 레버리지 값)을 추출하여 지도를 작성하면(그림 15.2), 경계부에 위치한 공간단위들이 높은 값을 나타내는 것을 확인할 수 있다. 이는 아마도 행표준화 공간가중치행렬을 적용했기 때문일 수 있다.(역자주: 경계부의 공간단위는 상대적으로 적은 수의 이웃을 가지며, 행 표준화가 적용되었을 때 상대적으로 높은 가중치를 부여받게 된다.) 대도시나 그 주변 지역에서도 높은 값을 관찰할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span><span class="op">)</span></span>
<span><span class="co"># Breaking News: tmap 3.x is retiring. Please test v4, e.g. with</span></span>
<span><span class="co"># remotes::install_github('r-tmap/tmap')</span></span>
<span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hat_value</span> <span class="op">&lt;-</span> <span class="va">infl_W</span><span class="op">$</span><span class="va">hat</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">"hat_value"</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-15-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-moranhat-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-2" data-gallery="quarto-lightbox-gallery-2"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-moranhat-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.2: 모런 회귀 영향 측도값의 분포(행표준화 공간가중치행렬 적용)
</figcaption></figure>
</div>
<section id="국지적-모런-통계량" class="level3" data-number="15.3.1"><h3 data-number="15.3.1" class="anchored" data-anchor-id="국지적-모런-통계량">
<span class="header-section-number">15.3.1</span> 국지적 모런 통계량</h3>
<p>Bivand와 Wong(2018)은 국지적 모런 통계량(Moran’s <span class="math inline">\(I_i\)</span>)​과 국지적 게티스-오드 통계량(Getis-Ord <span class="math inline">\(G_i\)</span>)​과 같은 국지적 지표 사용에 영향을 미치는 문제들을 다루었다. 일부 문제는 국지적 지표 계산에 영향을 미치고, 다른 문제는 해당 값에 대한 통계적 추론에 영향을 준다. <span class="math inline">\(n\)</span>개의 관측 단위에 대해 <span class="math inline">\(n\)</span>개의 통계값이 산출되므로, 다중비교(multiple comparison) 문제를 해결할 필요가 있다.(역자주: ’다중비교 문제’란 여러 가설 검정을 동시에 수행할 때 우연에 의해 ’유의’로 판정되는 결과가 증가하는 현상이다. 예를 들어, 유의수준 0.05에서 독립된 검정을 5번 수행하면, 모두 유의하지 않을 확률은 <span class="math inline">\(0.95^5\approx 0.77\)</span>이고, 따라서 최소 한 번이라도 유의할 확률은 약 22.6%에 달한다. 국지적 통계량처럼 관측 개체마다 개별 검정을 수행하는 경우, 이러한 오류를 통제하기 위해 Bonferroni 보정이나 뒤에서 다룰 FDR과 같은 조정 방법이 필요하다.) Caldas de Castro와 Singer(2006)는 전형적인 데이터셋과 시뮬레이션 실험을 바탕으로, 확률값에 대한 FDR(false discovery rate, 오발견율) 조정이 무조정의 결과보다 흥미로운 클러스터를 더 잘 드러낸다고 결론지었다. 이를 바탕으로, Anselin(2019)은 FDR 조정을 재정의된 ’유의성‘ 기준치(Benjamin et al., 2018)와 결합하는 방식을 제안하였다. 예를 들어, 기존의 0.1, 0.05, 0.01 대신 0.01, 0.005, 0.001을 사용하는 방식이다. 또한 <em>유의적</em>(significant) 대신 <em>흥미로운</em>(interesting)이라는 용어 사용을 권고하였다. 이러한 논의는 Bivand(2022a)에서 더 자세히 다루어진다. 전역적 통계량과 마찬가지로, 오지정 문제는 여전히 혼란의 원인이며, 전역적 공간적 자기상관이 존재하는 상황에서 국지적 공간적 자기상관을 해석하는 일은 여전히 도전 과제이다(Ord and Getis 2001; Tiefelsdorf 2002; Bivand, Müller, and Reder 2009).</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html">args</a></span><span class="op">(</span><span class="va">localmoran</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>#  function (x, listw, zero.policy = NULL, na.action = na.fail,
#    conditional = TRUE, alternative = "two.sided", mlvar = TRUE,
#    spChk = NULL, adjust.x = FALSE)</code></pre>
<p>Bivand와 Wong(2018)는 국지적 모런 통계량의 표준편차를 분석적 공식에 기반한 방식과 조건부(conditional) 순열에 기반한 방식으로 비교하였다. 이에 대해 Sauer 등(2021)은 이러한 비교가 오해에 기반하고 있음을 명확히 보여주었다. Sokal, Oden과 Thomson(1998)은 총괄(total) 순열과 조건부 순열에 기반한 국지적 모런 통계량의 표준편차 공식을 제시한 바 있는데, Bivand와 Wong(2018)에서 사용된 분석 공식은 이전 관행에 따라 총괄 순열만 사용하였으며, 따라서 시뮬레이션 조건부 순열과 일치하지 않는다.(역자주: 국지적 공간적 자기상관 측도의 맥락에서 ’총괄 혹은 총체적 순열’은 데이터의 모든 값을 대상으로 무작위 재배치를 수행하는 방식이다. 반면 ’조건부 혹은 조건적 순열’은 특정 관측 단위의 값을 고정한 채 나머지 값만 무작위로 재배치한다. 두 방식 모두 랜덤화 가정에 기반하며, 적률(기대값, 분산 등)을 공식을 구하는 분석적 순열로도, 난수 시뮬레이션에 의한 순열 부트스트랩으로도 구현할 수 있다.) 적시에 제안된 풀 리퀘스트 덕분에, 이제 <code><a href="https://r-spatial.github.io/spdep/reference/localmoran.html">localmoran()</a></code> 함수는 Sokal, Oden과 Thomson(1998)의 부록에 수록된 대안적 공식을 사용한 <code>conditional</code> 논리 인수(기본값은 <code>TRUE</code>)를 포함한다. <code><a href="https://r-spatial.github.io/spdep/reference/localmoran.html">localmoran()</a></code> 함수의 <code>mlvar</code>와 <code>adjust.x</code> 인수가 필요한 이유는 Bivand와 Wong(2018)에 설명되어 있으며, 이를 통한 다른 패키지의 결과와 비교할 수 있다. 기본값인 <code>two.sided</code>를 설정하면 다음과 같은 결과를 얻을 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">I_turnout</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.html">localmoran</a></span><span class="op">(</span>listw <span class="op">=</span> <span class="va">lw_q_W</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locm</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>국지적 모런 통계량을 합산한 뒤 공간가중치의 합으로 나누면 전역적 모런 통계량과 동일해지며, 이를 통해 국지적 수준에서 양 또는 음의 공간적 자기상관의 존재를 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">locm</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">lw_q_W</span><span class="op">)</span>, </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">I_turnout</span>, <span class="va">lw_q_W</span><span class="op">)</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/r/stats/p.adjust.html">stats::p.adjust()</a></code> 함수를 사용해 다중비교를 조정한 결과, 조정을 적용하지 않을 경우 2,495개의 국지적 지표 중 15% 이상이 <span class="math inline">\(p\text{-value}&lt;0.005\)</span>를 가지는 것으로 나타났다. 그러나 FWER(family-wise error rate, 전체 오류율)을 제어하기 위해 Bonferroni 조정을 사용할 경우 이 비율은 1.5%로 감소한다. 다른 두 가지 조정 옵션도사용 할 수 있는데, <code>"fdr"</code>은 Benjamini와 Hochberg(1995)의 FDR 조정 방법으로 약 6%를, <code>"BY"</code>는 Benjamini와 Yekutieli(2001)의 또 다른 FDR 조정 방법으로 약 2.5%를 보였다.(역자주: Bonferroni 조정은 전역적 유의확률을 <span class="math inline">\(\alpha\)</span>라고 할 때, 국지적 측도에 대응하는 유의확률을 <span class="math inline">\(\alpha/n\)</span> 으로 계산하는 방법이다. 이에 비해 Benjamini와 Hochberg(1995)가 제안한 FDR 조정 방법은 여러 가설 검정에서 기각된 가설 중 실제로는 참인 비율을 제어하는 것을 목표로 하며, Bonferroni 조정보다 덜 보수적이어서 검정력이 높다. 이후 Benjamini와 Yekutieli(2001)는 BH 방법을 상관 구조가 존재하는 검정 상황에도 적용할 수 있도록 확장하였다.)</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pva</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pv</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"none"</span> <span class="op">=</span> <span class="va">pv</span>, </span>
<span>    <span class="st">"FDR"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">pv</span>, <span class="st">"fdr"</span><span class="op">)</span>, <span class="st">"BY"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">pv</span>, <span class="st">"BY"</span><span class="op">)</span>,</span>
<span>    <span class="st">"Bonferroni"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">pv</span>, <span class="st">"bonferroni"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">locm</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="st">"Pr(z != E(Ii))"</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">pva</span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pvsp</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0.005</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pvsp</span>, <span class="fl">2</span>, <span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#       none        FDR         BY Bonferroni </span></span>
<span><span class="co">#        385        149         64         38</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>전역적 측도에서는 분석적 방법에 대한 대안적 추론 방식으로 순열 부트스트랩이 사용된다. 그런데 분석적 분산 도출 방식과 순열 방식 모두 모든 관측값을 뒤섞는 것에 기반한다. 국지적 측도에서는 전체 순열보다 조건부 순열이 훨씬 더 적합하다. 이는 관측 개체 <span class="math inline">\(i\)</span>의 값을 고정한채 나머지 <span class="math inline">\(n-1\)</span>개의 값을 무작위로 샘플링하여 해당 이웃의 값을 결정하는 방식이다. 조건부 순열은 <code><a href="https://r-spatial.github.io/spdep/reference/localmoran.html">localmoran_perm()</a></code> 함수로 제공되며, 여러 컴퓨팅 노드가 있는 경우 병렬 샘플링이 가능하고, 각 컴퓨팅 노드에서 난수 생성기의 시드를 설정할 수 있다. <code>nsim</code> 인수로 시뮬레이션 수를 지정하면, 시뮬레이션된 값 중 관측된 모런 통계값의 순위에 기반하여 확률값 추정치의 정밀도가 결정된다.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/set.mcOption.html">set.coresOption</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1L</span>, <span class="fl">1L</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">I_turnout</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.html">localmoran_perm</a></span><span class="op">(</span>listw <span class="op">=</span> <span class="va">lw_q_W</span>, nsim <span class="op">=</span> <span class="fl">9999</span>, </span>
<span>                    iseed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locm_p</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그 결과, 다중비교 조정을 적용하지 않는 경우 전체 관측값의 15% 이상이 양측 <span class="math inline">\(p\text{-value}&lt;0.005\)</span> 로 나타났다. Bonferroni 조정을 적용하면 이 비율은 약 1.5%로 감소하였다. 여기서 <span class="math inline">\(p\)</span> 값은 순열 샘플의 표준편차와 정규분포를 사용하여 계산되었다.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locm_p</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="st">"Pr(z != E(Ii))"</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">pva</span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pvsp</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pvsp</span>, <span class="fl">2</span>, <span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#       none        FDR         BY Bonferroni </span></span>
<span><span class="co">#        380        148         64         39</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>해당 변수가 반드시 정규분포를 따른다고 가정할 수 없으므로, 모든 시뮬레이션 값에서 관측값의 순위를 산정하고, 그 순위에 기반하여 균등분포에서의 확률값을 계산하는 방식으로 <span class="math inline">\(p\)</span> 값을 구할 수도 있다.(역자주: 시뮬레이션을 통해 얻은 통계값들 중에서 관측 통계값과 같거나 그보다 더 극단적인 값을 보이는 경우의 개수를 이용해 일종의 근사 유의확률을 계산한다. 예를 들어 유의수준 0.005까지 확인하려면 999회의 시뮬레이션이 필요한데, 이는 유의확률의 최소 단위가 <span class="math inline">\(1/(999+1)=0.001\)</span> 이기 때문이다.)</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locm_p</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="st">"Pr(z != E(Ii)) Sim"</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">pva</span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pvsp</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pvsp</span>, <span class="fl">2</span>, <span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#       none        FDR         BY Bonferroni </span></span>
<span><span class="co">#        391        127          0          0</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>위의 결과는 <code>"BY"</code> 방식과 Bonferroni 방식을 적용한 경우, 9,999개의 샘플에서는 <em>흥미로운</em> 위치가 전혀 나타나지 않음을 보여준다. 그러나 샘플 수를 999,999로 늘리면 <em>흥미로운</em> 위치가 발견될 수 있다. 한편, FDR 조정과 판정 기준값(cut-off) 0.005를 적용하면, 약 5%의 위치가 흥미로운 위치로 나타난다.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_pv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">locm</span><span class="op">[</span>, <span class="st">"Pr(z != E(Ii))"</span><span class="op">]</span>, <span class="st">"fdr"</span><span class="op">)</span></span>
<span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_std_pv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">locm_p</span><span class="op">[</span>, <span class="st">"Pr(z != E(Ii))"</span><span class="op">]</span>, </span>
<span>                                   <span class="st">"fdr"</span><span class="op">)</span></span>
<span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_p_pv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">locm_p</span><span class="op">[</span>, <span class="st">"Pr(z != E(Ii)) Sim"</span><span class="op">]</span>,</span>
<span>                                 <span class="st">"fdr"</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-15-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localmoranPr-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-3" data-gallery="quarto-lightbox-gallery-3"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localmoranPr-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.3: 국지적 모런 통계량의 FDR 유의확률 값. 왼쪽 상단 패널은 분석적 조건부 유의확률, 오른쪽 상단 패널은 순열 표준편차를 이용한 조건부 유의확률, 왼쪽 하단 패널은 순열 순위에 기반한 조건부 유의확률을 각각 나타낸다(행표준화 공간가중치행렬 적용)
</figcaption></figure>
</div>
<p>FDR 조정과 판정 기준값 0.005를 적용한 결과, 그림 15.3에서 볼 수 있듯이 분석적 조건부 접근법, 순열 샘플링에서 추출된 값들의 적률을 활용한 접근법, 순열 샘플링에서 관측값의 순위를 활용한 접근법 모두 유사한 지도 패턴을 나타냈다. 이는 입력 변수의 분포가 정규분포에 매우 근접하기 때문에 나타난 현상이다.</p>
<p>국지적 모런통계치를 제시할 때는 종종 ‘핫스팟’ 지도가 사용된다. 그러나 국지적 모런통계값은 입력 변수의 값이 낮든 높든 강한 양의 자기상관만 있으면 높은 값을 가지므로, 유사한 값을 지닌 이웃들의 ‘클러스터’가 어디에서 발생하는지를 낮은 값 클러스터와 높은 값 클러스터로 명확히 구분해 보이기는 어렵다. 이를 보완하기 위해 모런 플롯을 활용할 수 있다. 모런 플롯에서는 변수값과 공간래그값의 평균을 기준으로 범주형 사분면 변수를 생성한다. 이후, 기준 유의확률과 조정 절차에 따라 모런 통계값이 ’흥미로운’ 값으로 간주되지 않는 관측 개체는 사분면 범주 속성에서 <code>NA</code>값을 갖게 된다. 아래 사례에서는 FDR 조정된 조건부 유의확률 값을 사용했는데(그림 15.3, 왼쪽 상단 패널), 53개의 관측 개체가 <code>"Low-Low"</code> 클러스터에, 96개는 <code>"High-High"</code> 클러스터에 속했다. 이는 표준편차 기반의 순열 <span class="math inline">\(p\)</span> 값(그림 15.3, 오른쪽 상단 패널)에서도 유사하게 나타난다. 순위 기반 순열 <span class="math inline">\(p\)</span> 값(그림 15.3, 왼쪽 하단 패널)에서는 <code>"High-High"</code> 클러스터의 수가 줄고 <code>"Low-Low"</code> 클러스터 수가 증가한다.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">quadr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">locm</span>, <span class="st">"quadr"</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">quadr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">locm</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname<span class="op">=</span><span class="st">"Pr(z != E(Ii))"</span>, cutoff <span class="op">=</span> <span class="fl">0.005</span>, </span>
<span>                droplevels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_an_q</span></span>
<span><span class="va">locm_p</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname<span class="op">=</span><span class="st">"Pr(z != E(Ii))"</span>, cutoff <span class="op">=</span> <span class="fl">0.005</span>, </span>
<span>                  droplevels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_ac_q</span> </span>
<span><span class="va">locm_p</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname<span class="op">=</span><span class="st">"Pr(z != E(Ii)) Sim"</span>, cutoff <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>                  droplevels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_cp_q</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_an_q</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_ac_q</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_cp_q</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="st">"Moran plot quadrants"</span> <span class="op">=</span> <span class="va">a</span>, <span class="st">"Analytical cond."</span> <span class="op">=</span> <span class="va">b</span>, </span>
<span>  <span class="st">"Permutation std. cond."</span> <span class="op">=</span> <span class="va">c</span>, <span class="st">"Permutation rank cond."</span> <span class="op">=</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#           Moran plot quadrants Analytical cond.</span></span>
<span><span class="co"># Low-Low                   1040               53</span></span>
<span><span class="co"># High-Low                   264                0</span></span>
<span><span class="co"># Low-High                   213                0</span></span>
<span><span class="co"># High-High                  978               96</span></span>
<span><span class="co"># &lt;NA&gt;                         0             2346</span></span>
<span><span class="co">#           Permutation std. cond. Permutation rank cond.</span></span>
<span><span class="co"># Low-Low                       53                     56</span></span>
<span><span class="co"># High-Low                       0                      0</span></span>
<span><span class="co"># Low-High                       0                      0</span></span>
<span><span class="co"># High-High                     95                     71</span></span>
<span><span class="co"># &lt;NA&gt;                        2347                   2368</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_an_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_an_q</span><span class="op">)</span></span>
<span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_ac_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_ac_q</span><span class="op">)</span></span>
<span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_cp_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_cp_q</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-15-4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-Iihotspots-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-4" data-gallery="quarto-lightbox-gallery-4"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-Iihotspots-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.4: 국지적 모런 통계량의 FDR 조정 핫스팟 지도(유의수준은 0.005). 왼쪽 상단 패널에는 분석적 조건부 유의확률, 오른쪽 상단 패널은 순열 표준편차 기반 조건부 유의확률, 왼쪽 하단 패널은 순열 순위 기반 조건부 유의확률이 적용된 경우를 보여준다.(행표준화 공간가중치행렬 적용)
</figcaption></figure>
</div>
<p>Figure 15.4는 분석적 조건부 표준편차, 순열 기반 표준편차, 순위 기반 확률 값의 세 가지 접근법에 대해 <span class="math inline">\(\alpha=0.005\)</span> 확률 값 컷오프를 적용했을 때 FDR 조정된 <em>흥미로운</em> 클러스터들 간의 차이가 거의 없음을 보여준다. <code>"High-High"</code> 클러스터의 핵심부는 대도시 지역에 위치한다.</p>
<p>Tiefelsdorf (2002)는 국지적 모런 통계량의 표준편차를 계산하는 표준 접근 방식에 수치적 추정치를 추가해야 한다고 주장하며, 이를 안장점 근사를 통해 구현하는 것이 계산적으로 효율적인 방법임을 보여주었다. <code><a href="https://r-spatial.github.io/spdep/reference/localmoran.sad.html">localmoran.sad()</a></code> 함수는 첫 번째 인수로 적합된 선형모형을 입력받으므로, 우선 절편만 포함된 기본 모형을 적합시켜야 한다. 그러나 구역별 유권자 수가 크게 다르므로, 이러한 효과를 통제하기 위해 최종적으로 가중 선형모형을 적합시킨다.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">I_turnout</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">lm_null</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>안장점 근사 방식은 조건부 순열만큼 계산 비용이 많이 든다. 이는 많은 샘플에 대해 단일 측정값을 계산하는 것이 아니라, 각 국지적 근사마다 상당한 수치 계산이 필요하기 때문이다.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_null</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.sad.html">localmoran.sad</a></span><span class="op">(</span>nb <span class="op">=</span> <span class="va">nb_q</span>, style <span class="op">=</span> <span class="st">"W"</span>,</span>
<span>                                  alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locm_sad_null</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>안장점 근사법의 주요 장점은 단순히 수치 변수를 사용하는 대신, 적합된 선형모형을 기반으로 잔차를 분석한다는 점이다. 절편만 포함된 모형을 사용하면 결과는 국지적 모런 통계량과 유사하지만, 관찰값에 가중치를 부여할 수 있다. 여기서는 투표권이 있는 인구수를 기준으로 가중치를 부여하며, 이를 통해 작은 단위의 관찰값은 낮은 가중치를 받는다.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">I_turnout</span> <span class="op">~</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">I_entitled_to_vote</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>        <span class="va">lm_null_weights</span></span>
<span><span class="va">lm_null_weights</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.sad.html">localmoran.sad</a></span><span class="op">(</span>nb <span class="op">=</span> <span class="va">nb_q</span>, style <span class="op">=</span> <span class="st">"W"</span>,</span>
<span>                           alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locm_sad_null_weights</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다음으로, 농촌, 도시, 기타 유형의 관측 개체를 구분하는 범주형 변수를 추가한다.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">I_turnout</span> <span class="op">~</span> <span class="va">Types</span>, weights<span class="op">=</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">I_entitled_to_vote</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>        <span class="va">lm_types</span></span>
<span><span class="va">lm_types</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.sad.html">localmoran.sad</a></span><span class="op">(</span>nb <span class="op">=</span> <span class="va">nb_q</span>, style <span class="op">=</span> <span class="st">"W"</span>,</span>
<span>                                  alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locm_sad_types</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locm_sad_null</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname<span class="op">=</span><span class="st">"Pr. (Sad)"</span>,</span>
<span>                     cutoff<span class="op">=</span><span class="fl">0.005</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_sad0</span></span>
<span><span class="va">locm_sad_null_weights</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname<span class="op">=</span><span class="st">"Pr. (Sad)"</span>,</span>
<span>                     cutoff <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_sad1</span></span>
<span><span class="va">locm_sad_types</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname<span class="op">=</span><span class="st">"Pr. (Sad)"</span>,</span>
<span>                     cutoff <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_sad2</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-15-5" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localmoranHsad-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-5" data-gallery="quarto-lightbox-gallery-5"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localmoranHsad-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.5: 국지적 모런 통계량의 FDR 조정 핫스팟 지도(양측검정, 흥미로움의 판정 기준값 0.005 적용). 왼쪽 상단 패널에는 순열 표준편차를 활용한 조건부 유의확률, 오른쪽 상단 패널은 기본(절편만 있는) 모형의 안장점 근사에 기반한 유의확률, 왼쪽 하단 패널은 가중 기본(절편만 있는) 모형의 안장점 근사에 근거한 유의확률, 오른쪽 하단 패널은 가중 유형 모형의 안장점 근사에 기반한 유의확률을 나타낸다.(행표준화 공간가중치행렬의 적용)
</figcaption></figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_sad0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low-High"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      weighted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_sad1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low-High"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      type_weighted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_sad2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low-High"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#               Low-Low Low-High High-High &lt;NA&gt;</span></span>
<span><span class="co"># null               19        0        55 2421</span></span>
<span><span class="co"># weighted            9        0        52 2434</span></span>
<span><span class="co"># type_weighted      13        0        81 2401</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그림 15.5의 왼쪽 상단 패널에는 비교를 위해 순열 순위 기반 클러스터가 제시되어 있다. 안장점 근사법은 더 풍부한 평균모형을 적용할 수 있으며, 관측 개체 <span class="math inline">\(i\)</span>에서의 회귀 잔차 값을 그 이웃들의 값과 연결하는 본질적으로 국지적인 접근법이기 때문에, 안정접 근사법에 기반한 나머지 세 개의 패널은 상당히 다른 패턴을 보여준다. 절편만 포함한 기본 모형은 표준적인 결과와 매우 유사하지만, 유권자수에 따른 가중치 부여로 인해 대부분의 <code>"Low-Low"</code> 클러스터가 제거된다. 범주 유형 변수를 추가하면 도시 지역의 <code>"High-High"</code> 클러스터가 강화되지만, 바르샤바 구역들은 <em>흥미로운</em> 군집의 핵에서 제외된다. 바르샤바의 중앙 구역들은 높은 투표율을 보이며, 마찬가지로 높은 투표율을 보이는 다른 구역들에 의해 둘러싸여 있으나, 이는 공간적 자기상관에 의한 것이 아니라 모두 대도시 구역에 속하기 때문이다. 또한, 전역적 공간 프로세스를 통합한 경우 안장점 근사법을 활용할 수 있는데, 이를 통해 표준 접근법에서 나타나는 전역 및 지역 공간적 자기상관의 결합 효과를 제거할 수 있다.</p>
<p>같은 결과를 정확 접근법으로도 얻을 수 있지만, 수치적분이 실패하는 경우가 있어 표준편차의 정확한 추정값 대신 <code>NaN</code>가 반환될 수 있다. 따라서 추가적인 조정이 필요할 수 있다(Bivand, Müller, and Reder 2009).(역자주: ’정확 접근법’은 검정 통계량의 분포를 평균과 분산만으로 추정하는 정규 근사나, 이를 개선한 안장점 근사와 달리, 필요한 모든 적률(moment)을 활용해 분포를 근사가 아닌 정확한 형태로 계산하는 방법이다. 이러한 접근은 정규성 가정과 관련되며, 계산 과정에서 상당한 전산 자원이 소요된다.)</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_types</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.exact.html">localmoran.exact</a></span><span class="op">(</span>nb <span class="op">=</span> <span class="va">nb_q</span>, style <span class="op">=</span> <span class="st">"W"</span>, </span>
<span>    alternative <span class="op">=</span> <span class="st">"two.sided"</span>, useTP<span class="op">=</span><span class="cn">TRUE</span>, truncErr<span class="op">=</span><span class="fl">1e-8</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locm_ex_types</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locm_ex_types</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname <span class="op">=</span> <span class="st">"Pr. (exact)"</span>,</span>
<span>                         cutoff <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_ex</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-15-6" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localmoranHsadex-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-6" data-gallery="quarto-lightbox-gallery-6"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localmoranHsadex-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.6: 국지적 모런 통계량의 FDR 조정 핫스팟 지도(양측검정, 흥미로움의 판정 기준값 0.005 적용). 왼쪽 패널에는 가중 유형 모형의 안장점 근사에 기반한 유의확률이, 오른쪽 패널은 가중 유형 모형의 정확 접근법에 기반한 유의확률이 제시되어 있다.(행표준화 공간가중치행렬의 적용)
</figcaption></figure>
</div>
<p>그림 15.6에서 볼 수 있듯이, 정확 접근법과 안장점 근사법은 동일한 회귀 잔차, 다중비교 조정 방식, 그리고 기준값 수준을 적용했을 때 거의 동일한 클러스터 분류 결과를 산출한다. 두 방법 간의 차이는, 아래에 나타난 것처럼, 정확 접근법이 4개의 추가적인 관측 개체를 <em>흥미로운</em> 사례로 탐지한다는 점이다.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Saddlepoint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_sad2</span><span class="op">)</span>,</span>
<span>      exact <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">locm_ex</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#            exact</span></span>
<span><span class="co"># Saddlepoint Low-Low High-High &lt;NA&gt;</span></span>
<span><span class="co">#   Low-Low        13         0    0</span></span>
<span><span class="co">#   High-High       0        81    0</span></span>
<span><span class="co">#   &lt;NA&gt;            2         2 2397</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="국지적-게티스-오드-통계량" class="level3" data-number="15.3.2"><h3 data-number="15.3.2" class="anchored" data-anchor-id="국지적-게티스-오드-통계량">
<span class="header-section-number">15.3.2</span> 국지적 게티스-오드 통계량</h3>
<p>국지적 게티스-오드 측도(Getis-Ord <span class="math inline">\(G_i\)</span>)(Getis and Ord 1992, 1996)는 표준화된 값으로 산출된다. <code>include.self</code> 인수를 사용하여 이웃 객체에 자신을 포함하도록 설정하면 <span class="math inline">\(G^*_i\)</span> 측도값을 계산할 수 있다. <code>return_internals = TRUE</code>로 지정하면 관측값, 기대값, 그리고 이에 대한 분석적 분산값이 함께 반환된다.</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">I_turnout</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localG.html">localG</a></span><span class="op">(</span><span class="va">lw_q_W</span>, return_internals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locG</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>순열에 기반한 가설 검정도 수행할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">I_turnout</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localG.html">localG_perm</a></span><span class="op">(</span><span class="va">lw_q_W</span>, nsim <span class="op">=</span> <span class="fl">9999</span>, iseed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locG_p</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>분석적 표준편차에 기반한 유의확률, 순열 기반 표준편차에 기반한 유의확률(첫 번째 두 열과 행), 순열 순위 기반 유의확률 간의 상관관계는 매우 강하다.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>localG<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">locG</span>, <span class="st">"internals"</span><span class="op">)</span><span class="op">[</span>, <span class="st">"Pr(z != E(Gi))"</span><span class="op">]</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">locG_p</span>, <span class="st">"internals"</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pr(z != E(Gi))"</span>, </span>
<span>                                  <span class="st">"Pr(z != E(Gi)) Sim"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#                    localG Pr(z != E(Gi)) Pr(z != E(Gi)) Sim</span></span>
<span><span class="co"># localG                  1              1                  1</span></span>
<span><span class="co"># Pr(z != E(Gi))          1              1                  1</span></span>
<span><span class="co"># Pr(z != E(Gi)) Sim      1              1                  1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="국지적-기어리-통계량" class="level3" data-number="15.3.3"><h3 data-number="15.3.3" class="anchored" data-anchor-id="국지적-기어리-통계량">
<span class="header-section-number">15.3.3</span> 국지적 기어리 통계량</h3>
<p>Anselin(2019)의 연구는 Anselin(1995)의 내용을 확장한 것으로, 조사이아 패리(Josiah Parry)의 기여(풀 리퀘스트: <a href="https://github.com/r-spatial/spdep/pull/66" class="uri">https://github.com/r-spatial/spdep/pull/66</a>) 덕분에 최근 <strong>spdep</strong> 패키지에 추가되었다. 이로써 <span class="math inline">\(I_i\)</span>와 <span class="math inline">\(G_i\)</span>에 사용되던 조건부 순열 프레임워크를 국지적 기어리 통계량(<span class="math inline">\(C_i\)</span>)에도 적용할 수 있게 되었다.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">I_turnout</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localC.html">localC_perm</a></span><span class="op">(</span><span class="va">lw_q_W</span>, nsim<span class="op">=</span><span class="fl">9999</span>, iseed<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locC_p</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>순열 표준편차 기반 유의확률과 순위 기반 유의확률 값은 <span class="math inline">\(G_i\)</span>와 비교했을 때 상관관계가 그리 높지 않다. 이는 부분적으로 <span class="math inline">\(C_i\)</span>가 값들의 유사성을 값들의 곱이 아니라 값들 간의 차이 함수로 표현하기 때문이며, 이러한 공간적 자기상관 개념화 차이가 반영된 결과로 해석된다.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">locC_p</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pr(z != E(Ci))"</span>,</span>
<span>                                 <span class="st">"Pr(z != E(Ci)) Sim"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#                    Pr(z != E(Ci)) Pr(z != E(Ci)) Sim</span></span>
<span><span class="co"># Pr(z != E(Ci))              1.000              0.966</span></span>
<span><span class="co"># Pr(z != E(Ci)) Sim          0.966              1.000</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locC_p</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname <span class="op">=</span> <span class="st">"Pr(z != E(Ci)) Sim"</span>,</span>
<span>                  cutoff <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_C</span></span>
<span><span class="va">locG_p</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname <span class="op">=</span> <span class="st">"Pr(z != E(Gi)) Sim"</span>,</span>
<span>                  cutoff <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_G</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-15-7" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localIGC-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-7" data-gallery="quarto-lightbox-gallery-7"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localIGC-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.7: FDR 조정 핫스팟 지도(양측검정, 흥미로움의 판정 기준값 0.005 적용). 왼쪽 패널은 국지적 모런 통계량에 따른 공간 클러스터를, 가운데 패널은 국지적 게티스-오드 통계량에 따른 공간 클러스터를, 오른편 패널은 국지적 기어리 통계량에 따른 공간 클러스터를 보여준다.(행표준화 공간가중치행렬의 적용)
</figcaption></figure>
</div>
<p>그림 15.7은 동일한 변수(투표율)와 동일한 공간가중치를 사용했을 때 <span class="math inline">\(I_i\)</span>, <span class="math inline">\(G_i\)</span>, <span class="math inline">\(C_i\)</span>가 식별한 흥미로운 클러스터 핵심부가 매우 유사함을 보여준다. 통계적 추론에는 순위 기반 순열 FDR 조정 확률값이 사용되었고, 기준값은 <span class="math inline">\(\alpha=0.005\)</span>로 설정되었다. 대부분의 경우, <code>"High-High"</code> 클러스터의 핵심은 도시 지역이며, <code>"Low-Low"</code> 클러스터의 핵심은 북부의 인구 밀도가 낮은 농촌 지역과 남부 국경 근처의 독일 소수 민족 지역이다. 세 가지 측도는 클러스터 핵심을 명명하는 방식에서 약간 차이를 보인다. <span class="math inline">\(I_i\)</span>는 모런 산점도 플롯의 사분면을 사용하고, <span class="math inline">\(G_i\)</span>는 입력 변수의 평균을 기준으로 <code>"Low"</code>와 <code>"High"</code>를 구분하며(이는 <span class="math inline">\(I_i\)</span> 튜플의 첫 번째 요소와 동일), <span class="math inline">\(C_i\)</span>는 입력 변수의 평균값 기준으로 하지만 공간래그값에 대해서는 0을 기준으로 나눈다. 이전과 마찬가지로 해당 사례가 없는 클러스터 범주는 제외된다.</p>
<p>비교를 위해, 다변량 <span class="math inline">\(C_i\)</span>를 살펴보기 전에 두 번째(최종) 라운드 투표율에 대한 단변량 <span class="math inline">\(C_i\)</span>를 먼저 살펴보자. 1차 투표에서 상위 두 후보 간의 결선 투표는, 1차 투표에서 명확한 선호를 보이지 않았던 일부 유권자의 참여를 유도할 수 있지만, 1차 투표에서 탈락한 후보에게 강한 충성심을 가졌던 일부 유권자의 참여를 저해할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pol_pres15</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="va">II_turnout</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localC.html">localC_perm</a></span><span class="op">(</span><span class="va">lw_q_W</span>, nsim<span class="op">=</span><span class="fl">9999</span>, iseed<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locC_p_II</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locC_p_II</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname <span class="op">=</span> <span class="st">"Pr(z != E(Ci)) Sim"</span>,</span>
<span>                     cutoff <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_C_II</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다변량 <span class="math inline">\(C_i\)</span>(Anselin 2019)는 단변량 <span class="math inline">\(C_i\)</span>가값들의 합을 변수 개수로 나누어 계산하며, 이때 순열은 고정되어 변수 간 상관관계가 변하지 않도록 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pol_pres15</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">I_turnout</span>, <span class="va">II_turnout</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localC.html">localC_perm</a></span><span class="op">(</span><span class="va">lw_q_W</span>, nsim<span class="op">=</span><span class="fl">9999</span>, iseed<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">locMvC_p</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다변량 <span class="math inline">\(C_i\)</span>는 단변량 <span class="math inline">\(C_i\)</span>의 평균값임을 다음과 같이 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="va">locMvC_p</span>, <span class="op">(</span><span class="va">locC_p</span><span class="op">+</span><span class="va">locC_p_II</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>          check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locMvC_p</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname <span class="op">=</span> <span class="st">"Pr(z != E(Ci)) Sim"</span>,</span>
<span>                    cutoff <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_MvC</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-15-8" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localCmulti-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-8" data-gallery="quarto-lightbox-gallery-8"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localCmulti-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.8: FDR 조정 핫스팟 지도(양측검정, 흥미로움의 판정 기준값 0.005 적용). 왼쪽 패널에는 1차 투표율에 대한 공간 클러스터, 가운데 패널에는 2차 투표율에 대한 공간 클러스터, 오른쪽 패널에는 두 차례 투표율 모두에 대한 공간 클러스터가 나타나 있다.(행표준화 공간가중치행렬의 적용)
</figcaption></figure>
</div>
<p>그림 15.8은 다변량 측도가 개별 단변량 측도에서 흥미로운 케이스로 식별된 관측 개체들을 기본적으로 결합하고 있음을 보여준다. 이를 구체적으로 살펴보기 위해, 1차 및 2차 투표의 단변량 측도값을 결합한 뒤 이를 다변량 측도값과 대조하여 표로 정리할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_C</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_C_II</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">":"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_MvC</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#                      </span></span>
<span><span class="co">#                       Positive &lt;NA&gt;</span></span>
<span><span class="co">#   High-High:High-High       81    0</span></span>
<span><span class="co">#   NA:High-High              41   27</span></span>
<span><span class="co">#   Low-Low:Low-Low           25    0</span></span>
<span><span class="co">#   NA:Low-Low                43   11</span></span>
<span><span class="co">#   NA:Other Positive          1    0</span></span>
<span><span class="co">#   NA:Negative                0    1</span></span>
<span><span class="co">#   High-High:NA              15    0</span></span>
<span><span class="co">#   Low-Low:NA                11    3</span></span>
<span><span class="co">#   NA:NA                     36 2200</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다변량 <span class="math inline">\(C_i\)</span>에서는 흥미로운 케이스로 식별된 관측 개체 중 47개는 단변량 <span class="math inline">\(C_i\)</span> 어느 경우에서도 <em>흥미로운</em> 케이스로 나타나지 않았다(FDR, 판정 기준값 0.005). 1차와 2차 라운드 모두에서 <em>흥미로운</em> 것으로 나타난 관측값은 거의 모두 다변량에서도 흥미로운 것으로 분류되었지만, 두 라운드 중 한 라운드에서만 흥미로운 것으로 나타난 관측값은 보다 혼합된 결과를 보였다.</p>
</section><section id="rgeoda-패키지" class="level3" data-number="15.3.4"><h3 data-number="15.3.4" class="anchored" data-anchor-id="rgeoda-패키지">
<span class="header-section-number">15.3.4</span> rgeoda 패키지</h3>
<p><strong>rgeoda</strong> 패키지(Li and Anselin 2022)는 GeoDa의 R 래퍼 패키지로, <strong>spdep</strong> 패키지와 유사한 기능을 제공하여 에어리어 데이터 공간적 자기상관을 탐색할 수 있게 한다. 활성 객체는 컴파일된 작업 공간의 메모리 주소를 참조하는 포인터로 관리되며, 모든 연산이 GeoDa와 동일하게 컴파일된 코드로 실행되므로 <strong>rgeoda</strong> 패키지는 매우 빠른 성능을 제공한다. 다만, 수정이나 기능 확장이 필요할 경우 유연성은 상대적으로 떨어진다.</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geodacenter/rgeoda/">rgeoda</a></span><span class="op">)</span></span>
<span><span class="va">Geoda_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/queen_weights.html">queen_weights</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Geoda_w</span><span class="op">)</span></span>
<span><span class="co">#                      name               value</span></span>
<span><span class="co"># 1 number of observations:                2495</span></span>
<span><span class="co"># 2          is symmetric:                 TRUE</span></span>
<span><span class="co"># 3               sparsity: 0.00228786229774178</span></span>
<span><span class="co"># 4        # min neighbors:                   1</span></span>
<span><span class="co"># 5        # max neighbors:                  13</span></span>
<span><span class="co"># 6       # mean neighbors:    5.70821643286573</span></span>
<span><span class="co"># 7     # median neighbors:                   6</span></span>
<span><span class="co"># 8           has isolates:               FALSE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>비교를 위해, 2015년 폴란드 대통령 선거 투표율에 대한 다변량 <span class="math inline">\(C_i\)</span> 지표를 살펴보자.</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lisa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_multigeary.html">local_multigeary</a></span><span class="op">(</span><span class="va">Geoda_w</span>, </span>
<span>    <span class="va">pol_pres15</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"I_turnout"</span>, <span class="st">"II_turnout"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>    cpu_threads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    permutations <span class="op">=</span> <span class="fl">99999</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>연접 이웃을 비교하면, 이는 위에서 <code><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb()</a></code> 함수를 통해 정의된 것과 동일하다.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/card.html">card</a></span><span class="op">(</span><span class="va">nb_q</span><span class="op">)</span>, <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_num_nbrs.html">lisa_num_nbrs</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span>, </span>
<span>          check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다변량 <span class="math inline">\(C_i\)</span> 값도 위와 동일하다.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_values.html">lisa_values</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">locMvC_p</span><span class="op">)</span>,</span>
<span>          check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>한 가지 차이점은 <strong>rgeoda</strong> 패키지에서 사용하는 접힌(folded) 양측 순위 기반 순열 유의확률 값의 범위가 <span class="math inline">\([0,0.5]\)</span>로 제한된다는 점이다. 이는 <strong>spdep</strong> 패키지에서도 계산되지만, 처리 방식은 다를 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">locMvC_p</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pr(z != E(Ci)) Sim"</span>, </span>
<span>                                <span class="st">"Pr(folded) Sim"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">range</span><span class="op">)</span></span>
<span><span class="co">#      Pr(z != E(Ci)) Sim Pr(folded) Sim</span></span>
<span><span class="co"># [1,]             0.0002         0.0001</span></span>
<span><span class="co"># [2,]             0.9990         0.4995</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이것은 <span class="math inline">\([0,1]\)</span> 범위에서의 컷오프 값 <span class="math inline">\(0.005\)</span>가, <span class="math inline">\([0,0.5]\)</span> 범위에서는 <span class="math inline">\(0.0025\)</span>에 해당함을 의미한다.</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locMvC_p</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/hotspotmap.html">hotspot</a></span><span class="op">(</span>Prname <span class="op">=</span> <span class="st">"Pr(folded) Sim"</span>,</span>
<span>                    cutoff <span class="op">=</span> <span class="fl">0.0025</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_MvCa</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>따라서 <code><a href="https://geodacenter.github.io/rgeoda/reference/local_multigeary.html">local_multigeary()</a></code> 함수는 클러스터 핵심 클래스를 설정할 때 기본 판정 기준값인 <span class="math inline">\(0.05\)</span>를 사용하지만, 우리는 이를 더 엄격하게 조정하고, <code>lisa</code> 객체의 출력 구성 요소에 FDR 조정을 적용함으로써 결과의 신뢰성을 높일 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mvc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>              labels <span class="op">=</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html">lisa_labels</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span>, <span class="st">"fdr"</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0.0025</span></span>
<span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">geoda_mvc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>regoda</strong> 패키지의 순열 방식을 적용한 결과 약 80개의 추가 관측값이 <em>흥미로운</em> 케이스로 확인되었으며, 구현 세부 사항에 대한 추가 분석이 여전히 진행 중이다.</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/addmargins.html">addmargins</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>spdep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">hs_MvCa</span><span class="op">)</span>,</span>
<span>                 rgeoda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">addNA</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">geoda_mvc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#           rgeoda</span></span>
<span><span class="co"># spdep      Positive &lt;NA&gt;  Sum</span></span>
<span><span class="co">#   Positive      249    4  253</span></span>
<span><span class="co">#   &lt;NA&gt;           75 2167 2242</span></span>
<span><span class="co">#   Sum           324 2171 2495</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-15-9" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-15-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localCmultix-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-9" data-gallery="quarto-lightbox-gallery-9"><img src="https://r-spatial.org/book/15-Measures_files/figure-html/fig-localCmultix-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-15-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;15.9: FDR 조정 다변량 <span class="math inline">\(C_i\)</span> 핫스팟 지도(양측검정, 흥미로움의 판정 기준값은 <span class="math inline">\([0,0.5]\)</span> 범위에서 0.0025 적용). 왼쪽 패널은 합산 투표율을 <strong>spdep</strong> 패키지에 적용한 결과이고, 오른쪽 패널은 합산 투표율을 <strong>rgeoda</strong> 패키지에 적용한 결과이다.(행표준화 공간가중치행렬의 적용)
</figcaption></figure>
</div>
<p>그림 15.9는 <strong>spdep</strong> 패키지에서 <em>흥미로운</em> 것으로 판정된 242개 관측값의 거의 모두가 <strong>rgeoda</strong> 패키지에서도 역시 <em>흥미로운</em> 것으로 판정되었지만, 후자는 추가로 86개를 더 <em>흥미로운</em> 것으로 판정했음을 보여준다. 물론 순열 결과의 변동성은 불가피하지만, 어느 한쪽 또는 양쪽 구현에 수정이 필요한지 여부는 여전히 규명되어야 한다.</p>
</section></section><section id="연습문제" class="level2" data-number="15.4"><h2 data-number="15.4" class="anchored" data-anchor-id="연습문제">
<span class="header-section-number">15.4</span> 연습문제</h2>
<ol type="1">
<li><p>체스판의 조인 카운트 통계값이 <code>rook</code> 이웃과 <code>queen</code> 이웃 간에 크게 다른 이유를 설명하시오.</p></li>
<li><p>15.1절에서 제시한 시뮬레이션을 체스판 다각형과 행 표준화된 <code>queen</code> 연접 이웃을 사용하여 반복하시오. 공간적 자기상관이 일반적으로 (피할 수 없는) 데이터의 모형 오지정 문제를 나타낼 수 있다는 점을 이해하는 것이 왜 중요한지 설명하시오.</p></li>
<li><p>국지적 공간적 자기상관 통계량에 FDR 조정이 권장되는 이유를 설명하시오.</p></li>
<li><p>문항 2의 시뮬레이션 데이터에 대해 분석적 조건 접근법과 안장점 근사법을 사용하여 국지적 모런 통계량(<span class="math inline">\(I_i\)</span>)의 표준편차 값(검정 통계값)을 비교하시오. 또한 안장점 근사법의 장단점을 설명하시오.</p></li>
</ol>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">그림&nbsp;15.1: 투표율에 대한 모런 플롯(행표준화 공간가중치행렬 적용)</span>
<span class="glightbox-desc lightbox-desc-2">그림&nbsp;15.2: 모런 회귀 영향 측도값의 분포(행표준화 공간가중치행렬 적용)</span>
<span class="glightbox-desc lightbox-desc-3">그림&nbsp;15.3: 국지적 모런 통계량의 FDR 유의확률 값. 왼쪽 상단 패널은 분석적 조건부 유의확률, 오른쪽 상단 패널은 순열 표준편차를 이용한 조건부 유의확률, 왼쪽 하단 패널은 순열 순위에 기반한 조건부 유의확률을 각각 나타낸다(행표준화 공간가중치행렬 적용)</span>
<span class="glightbox-desc lightbox-desc-4">그림&nbsp;15.4: 국지적 모런 통계량의 FDR 조정 핫스팟 지도(유의수준은 0.005). 왼쪽 상단 패널에는 분석적 조건부 유의확률, 오른쪽 상단 패널은 순열 표준편차 기반 조건부 유의확률, 왼쪽 하단 패널은 순열 순위 기반 조건부 유의확률이 적용된 경우를 보여준다.(행표준화 공간가중치행렬 적용)</span>
<span class="glightbox-desc lightbox-desc-5">그림&nbsp;15.5: 국지적 모런 통계량의 FDR 조정 핫스팟 지도(양측검정, 흥미로움의 판정 기준값 0.005 적용). 왼쪽 상단 패널에는 순열 표준편차를 활용한 조건부 유의확률, 오른쪽 상단 패널은 기본(절편만 있는) 모형의 안장점 근사에 기반한 유의확률, 왼쪽 하단 패널은 가중 기본(절편만 있는) 모형의 안장점 근사에 근거한 유의확률, 오른쪽 하단 패널은 가중 유형 모형의 안장점 근사에 기반한 유의확률을 나타낸다.(행표준화 공간가중치행렬의 적용)</span>
<span class="glightbox-desc lightbox-desc-6">그림&nbsp;15.6: 국지적 모런 통계량의 FDR 조정 핫스팟 지도(양측검정, 흥미로움의 판정 기준값 0.005 적용). 왼쪽 패널에는 가중 유형 모형의 안장점 근사에 기반한 유의확률이, 오른쪽 패널은 가중 유형 모형의 정확 접근법에 기반한 유의확률이 제시되어 있다.(행표준화 공간가중치행렬의 적용)</span>
<span class="glightbox-desc lightbox-desc-7">그림&nbsp;15.7: FDR 조정 핫스팟 지도(양측검정, 흥미로움의 판정 기준값 0.005 적용). 왼쪽 패널은 국지적 모런 통계량에 따른 공간 클러스터를, 가운데 패널은 국지적 게티스-오드 통계량에 따른 공간 클러스터를, 오른편 패널은 국지적 기어리 통계량에 따른 공간 클러스터를 보여준다.(행표준화 공간가중치행렬의 적용)</span>
<span class="glightbox-desc lightbox-desc-8">그림&nbsp;15.8: FDR 조정 핫스팟 지도(양측검정, 흥미로움의 판정 기준값 0.005 적용). 왼쪽 패널에는 1차 투표율에 대한 공간 클러스터, 가운데 패널에는 2차 투표율에 대한 공간 클러스터, 오른쪽 패널에는 두 차례 투표율 모두에 대한 공간 클러스터가 나타나 있다.(행표준화 공간가중치행렬의 적용)</span>
<span class="glightbox-desc lightbox-desc-9">그림&nbsp;15.9: FDR 조정 다변량 <span class="math inline">\(C_i\)</span> 핫스팟 지도(양측검정, 흥미로움의 판정 기준값은 <span class="math inline">\([0,0.5]\)</span> 범위에서 0.0025 적용). 왼쪽 패널은 합산 투표율을 <strong>spdep</strong> 패키지에 적용한 결과이고, 오른쪽 패널은 합산 투표율을 <strong>rgeoda</strong> 패키지에 적용한 결과이다.(행표준화 공간가중치행렬의 적용)</span>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "복사완료!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "복사완료!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./14.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">근접성과 에어리어 데이터</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./16.html" class="pagination-link" aria-label="<span class='chapter-number'>16</span>&nbsp; <span class='chapter-title'>공간적 회귀분석</span>">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">공간적 회귀분석</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"selector":".lightbox","closeEffect":"zoom","openEffect":"zoom","descPosition":"bottom","loop":false});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>