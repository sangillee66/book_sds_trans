<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>공간데이터사이언스 개론 - 17&nbsp; 공간계량경제학적 모형</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./A.html" rel="next">
<link href="./16.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-econometrics" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">공간계량경제학적 모형</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">공간데이터사이언스 개론</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/sangillee66/book_sds_trans" title="소스 코드" class="quarto-navigation-tool px-1" aria-label="소스 코드"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">서장</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">시작하기</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">좌표계</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">구체 지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">속성과 서포트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">데이터 큐브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터사이언스와 R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">sf와 stars 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">공간데이터의 플로팅</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">대규모 데이터와 클라우드 네이티브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간통계분석과 공간모델링</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">공간데이터의 통계적 모형화</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">포인트 패턴 분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">공간적 인터폴레이션</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">다변량 및 시공간 지구통계학</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">근접성과 에어리어 데이터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">공간적 자기상관 측도</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">공간적 회귀분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">공간계량경제학적 모형</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">부록</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">오래된 공간 R 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R 기초</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">목차</h2>
   
  <ul>
<li><a href="#%EC%A0%95%EC%9D%98" id="toc-정의" class="nav-link active" data-scroll-target="#%EC%A0%95%EC%9D%98"><span class="header-section-number">17.1</span> 정의</a></li>
  <li>
<a href="#%EC%B5%9C%EB%8C%80%EC%9A%B0%EB%8F%84%EC%B6%94%EC%A0%95-spatialreg-%ED%8C%A8%ED%82%A4%EC%A7%80%EC%9D%98-%ED%99%9C%EC%9A%A9" id="toc-최대우도추정-spatialreg-패키지의-활용" class="nav-link" data-scroll-target="#%EC%B5%9C%EB%8C%80%EC%9A%B0%EB%8F%84%EC%B6%94%EC%A0%95-spatialreg-%ED%8C%A8%ED%82%A4%EC%A7%80%EC%9D%98-%ED%99%9C%EC%9A%A9"><span class="header-section-number">17.2</span> 최대우도추정: spatialreg 패키지의 활용</a>
  <ul class="collapse">
<li><a href="#%EB%B3%B4%EC%8A%A4%ED%84%B4-%EC%A3%BC%ED%83%9D-%EA%B0%80%EA%B2%A9-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B-%EC%98%88%EC%8B%9C" id="toc-보스턴-주택-가격-데이터셋-예시" class="nav-link" data-scroll-target="#%EB%B3%B4%EC%8A%A4%ED%84%B4-%EC%A3%BC%ED%83%9D-%EA%B0%80%EA%B2%A9-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B-%EC%98%88%EC%8B%9C"><span class="header-section-number">17.2.1</span> 보스턴 주택 가격 데이터셋 예시</a></li>
  </ul>
</li>
  <li><a href="#%EC%98%81%ED%96%A5" id="toc-영향" class="nav-link" data-scroll-target="#%EC%98%81%ED%96%A5"><span class="header-section-number">17.3</span> 영향</a></li>
  <li><a href="#%EC%98%88%EC%B8%A1" id="toc-예측" class="nav-link" data-scroll-target="#%EC%98%88%EC%B8%A1"><span class="header-section-number">17.4</span> 예측</a></li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C" id="toc-연습문제" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C"><span class="header-section-number">17.5</span> 연습문제</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-econometrics" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">공간계량경제학적 모형</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">2025년 8월 11일</p>
    </div>
  </div>
    
  </div>
  


</header><p>공간가중치행렬을 활용하고 최대우도추정법을 적용하는 전형적인 형태의 공간적 자기회귀 모형은 이미 오래전에 정식화된 바 있다(Cliff and Ord 1973, 1981). 이러한 초기 연구를 확장하여 공간 계량경제학적 관점에서 일단의 모형이 발전해 왔으며, 많은 경우 동시적 자기회귀 프레임워크와 행 표준화 공간 가중치 행렬이 사용되었다(Anselin 1988). 동시적 자기회귀 프레임워크와 조건부 자기회귀 프레임워크가 두 개의 축을 이루고 있으며, 두 프레임워크 모두 보완적 차원에서 관측치의 상대적 중요성을 반영하기 위한 사례 가중치를 활용할 수 있다(Waller and Gotway 2004).</p>
<p>공간 회귀 모형을 적합시키는 과정에서 제기되는 이슈들을 논의하기에 앞서, 몇 가지 사항을 언급하고자 한다. 공간적 회귀분석을 공간계량경제학적 맥락에서의 접근하는 방식에 대한 최근 리뷰는 Kelejian과 Piras(2017)에 의해 제공되었다. 이 연구에서는 공간 지체 반응 변수의 계수를 <span class="math inline">\(\lambda\)</span>, 공간 지체 잔차의 계수를 <span class="math inline">\(\rho\)</span>로 명명하고 있는데, 이는 다른 연구들(Anselin 1988; LeSage and Pace 2009)과는 거꾸로 이다. 여기서는 공간 지체 모형의 공간 계수는 <span class="math inline">\(\rho_\text {Lag}\)</span>로, 공간 오차 모형의 공간 계수는 <span class="math inline">\(\rho_\text{Err}\)</span>로 표현하고자 한다. 흥미로운 발견 중 하나는 상대적으로 밀도가 높은 공간 가중치 행렬이 모형 추정치를 과소평가할 가능성이 있다는 점인데, 이는 희소 가중치 행렬이 더 적합하다는 점을 시사하는 것이다(Smith 2009). 또 다른 유용한 발견은 잔차에 공간적 자기상관이 존재하더라도, 공변량 자체가 공간적 자기상관을 나타내지 않는 한 편향된 회귀 계수 분산의 추정치가 산출되지는 않는다는 점이다(Smith and Lee 2012). 그러나 일반적으로 반응 변수와 공변량의 공간 과정이 일치하지 않을 가능성이 있으며, 공변량과 잔차가 공간적 자기상관을 보이는 경우 공간 과정을 모형화하려는 시도가 이루어지지 않는 한 회귀 계수 분산의 추정치가 과소평가될 가능성이 높다.</p>
<section id="정의" class="level2" data-number="17.1"><h2 data-number="17.1" class="anchored" data-anchor-id="정의">
<span class="header-section-number">17.1</span> 정의</h2>
<p>공간 과정을 모형화하려는 시도 중 가장 초기의 공간계량경제학적 정식 중 하나는 잔차의 공간 자기상관을 모형화하는 것이다(공간 오차 모형, SEM):</p>
<p><span class="math display">\[
\textbf{y}=\textbf{X}\beta+\textbf{u},\qquad \textbf{u}=\rho_\text {Err} \textbf{Wu}+\epsilon,
\]</span></p>
<p>여기서 <span class="math inline">\(\textbf{y}\)</span>는 <span class="math inline">\(N\)</span> 위치에서 측정된 반응 변수로 <span class="math inline">\((N\times1)\)</span> 관측치 벡터, <span class="math inline">\(\textbf{X}\)</span>는 <span class="math inline">\((N \times k)\)</span> 공변량 행렬, <span class="math inline">\(\beta\)</span>는 <span class="math inline">\((k \times 1)\)</span> 계수 벡터, <span class="math inline">\(\textbf{u}\)</span>는 <span class="math inline">\((N \times 1)\)</span> 공간적 자기상관을 가진 교란 벡터, <span class="math inline">\(\epsilon\)</span>은 독립항등분포를 가진 <span class="math inline">\((N \times 1)\)</span> 교란 벡터, <span class="math inline">\(\rho_\text{Err}\)</span>은 스칼라 공간 파라미터이다.</p>
<p>이 모형과 유사한 다른 공간계량경제학 모형들은 혼합 모형 프레임워크에 부합하지 않는다. 여기서 모형화된 공간 과정은 반응 변수, 공변량, 그리고 계수와 직접적으로 상호작용한다. 이러한 종류의 모형화 프레임워크는 시계열 프레임워크를 단순히 2차원으로 확장한 오래된 전통에서 기원한 것으로 보인다.</p>
<p><span class="math display">\[
\textbf{u}=(\textbf{I}-\rho_\text{Err}\textbf{W})^{-1}\epsilon,\quad \textbf{y}=\textbf{X}\beta+(\textbf{I}-\rho_\text{Err}\textbf{W})^{-1}\epsilon,\quad (\textbf{I}-\rho_\text{Err}\textbf{W})\textbf{y}=(\textbf{I}-\rho_\text{Err}\textbf{W})\textbf{X}\beta+\epsilon.
\]</span></p>
<p>공변량과 반응 변수에서의 과정이 일치한다면, 최소제곱법 계수와 SEM 계수 간의 차이는 거의 없을 것이다. 그러나 실제로는 두 개의 과정이 일치하지 않으며, 이를 고려하기 위해서는 Hausman 검정과 같은 부가적인 조치가 필요하다(Pace and LeSage 2008). 이는 공간 과정이 일치하는 경우 시계열 분석에서의 단위근과 공적분 개념을 공간적으로 확장하는 이전 논의와 관련이 있을 수 있다(Fingleton 1999).</p>
<p>반응 변수에만 공간 과정을 포함하는 모형은 공간 지체 모형(SLM, 종종 SAR - 공간적 자기회귀 모형)이라고 한다(LeSage and Pace 2009). Durbin 모형은 공변량에 공간 지체 공변량을 추가한 모형이다. 공간 Durbin 모형에 대한 리뷰는 Mur와 Angulo(2006)를 살펴보면 된다. 만약 반응 변수에 공간 과정 외에도 잔차에 공간 과정을 포함시키기로 선택한다면, 다시 두 가지 모형이 형성된다. 하나는 모든 모형을 포함하는 일반적인 중첩 모형(GNM, general nested model)이고, 다른 하나는 공간 지체 공변량을 포함하지 않는 모형(SAC, 또한 SARAR(Spatial AutoRegressive-AutoRegressive) 모형)이다. 만약 잔차나 반응 변수에 공간 과정을 모형화하지 않는다면, 공간 지체 공변량을 선형 모형에 추가할 수 있다. 이를 공간 지체 X 모형(SLX)이라고 한다(Elhorst 2010; Bivand 2012; LeSage 2014; Halleck Vega and Elhorst 2015). GNM은 다음과 같이 표현할 수 있다:</p>
<p><span class="math display">\[
\textbf{y}=\rho_\text{Lag}\textbf{Wy}+\textbf{X}\beta+\textbf{WX}\gamma+\textbf{u},\qquad \textbf{u}=\rho_\text{Err}\textbf{Wu}+\epsilon
\]</span></p>
<p>여기서 <span class="math inline">\(\gamma\)</span>는 <span class="math inline">\((k' \times 1)\)</span> 파라미터 벡터이다. <span class="math inline">\(k'\)</span>는 절편과 공변량의 일부를 정의하는데, 행표준화 공간 가중치를 사용하고 공간 지체 절편을 누락하는 경우 <span class="math inline">\(k'=k-1\)</span>이다.</p>
<p>이 기본 모형에 제약을 가하면 다양한 변용 모형이 생성되는데, <span class="math inline">\(\gamma = 0\)</span>으로 설정하면 이중 공간 계수 모형인 SAC/SARAR 모형이 되고, <span class="math inline">\(\rho_\text{Lag}=0\)</span>으로 설정하면 오차 Durbin 모형(SDEM)이 된다. 더 많은 조건을 부여할 수 있는데, <span class="math inline">\(\gamma = 0\)</span>와 <span class="math inline">\(\rho_\text{Err}=0\)</span>로 설정하면 공간 지체 모형(SLM), <span class="math inline">\(\gamma=0\)</span>와 <span class="math inline">\(\rho_\text{Lag}=0\)</span>로 설정하며 공간 오차 모형(SEM), <span class="math inline">\(\rho_\text{Lag}=0\)</span>과 <span class="math inline">\(\rho_\text{Err}=0\)</span>로 설정하면 공간 지체 X 모형(SLX)을 얻을 수 있다.</p>
<p>공변량이 관측된 새로운 위치에 대해 예측을 행하는 것과 관련된 이슈들은 오래전에 인식되었지만, 가능성에 대한 검토에서 진전을 이루는 데는 많은 시간이 걸렸다(Bivand 2002; Goulard, Laurent, and Thomas-Agnan 2017; Laurent and Margaretic 2021). 최대우도추정법으로 적합된 SLM, SDM, SEM, SDEM, SAC, GNM 모형을 예측에 적용하는 방법은 Google Summer of Coding 프로젝트를 수행한 Martin Gubri의 공로가 크다. 이 프로젝트와 결측 데이터를 다루는 유사한 모형에 대한 연구(Suesse 2018)를 원용하면 보스턴 데이터셋에서 검열된 중앙값 주택 가격을 탐색하는 연구에 시사점을 얻을 수 있다. 예측 이슈를 다루다 보면 해당 모형의 축약 형태가 매우 중요하다는 점을 인식하게 되는데, SLM, SDM, SAC, GNM 모형에서처럼 반응 변수의 공간 과정이 회귀 계수와 상호작용하는 경우 보다 단순화된 형태가 도움이 될 수 있다.</p>
<p>반응 변수와 회귀 계수 간의 이러한 상호작용의 결과는, 공변량의 단위 변화가 회귀 계수의 값으로 반응 변수에 영향을 미치려면 공간 지체 반응 변수의 계수가 0이어야 한다는 것이다. 만약 공간 계수가 0이 아니라면, 글로벌 파급효과가 작용하게 되며, 이러한 파급효과의 크기는 회귀 계수 만큼이나 중요한 정보이다(LeSage and Pace 2009; Elhorst 2010; Bivand 2012; LeSage 2014; Halleck Vega and Elhorst 2015). SDEM 및 SLX 모형의 경우, 각 공변량의 총 파급효과(공변량 및 공간 지체 공변량 계수의 합)의 표준 오차를 계산하기 위해 선형 결합을 사용하여 로컬 파급효과를 나타낸다.</p>
<p>이것은 GNM 데이터 생성 과정에서 확인할 수 있다:</p>
<p><span class="math display">\[
(\textbf{I}-\rho_{\text Err}\textbf{W})(\textbf{I}-\rho_{\text Lag}\textbf{W})\textbf{y}=(\textbf{I}-\rho_{\text Err}\textbf{W})(\textbf{X}\beta+\textbf{WX}\gamma)+\epsilon
\]</span></p>
<p>다음과 같이 다르게 나타낼 수 있다.</p>
<p><span class="math display">\[
\textbf{y}=(\textbf{I}-\rho_\text{Lag}\textbf{W})^{-1}(\textbf{X}\beta+\textbf{WX}\gamma)+(\textbf{I}-\rho_\text{Lag}\textbf{W})^{-1}(\textbf{I}-\rho_\text{Err}\textbf{W})^{-1}\epsilon.
\]</span></p>
<p><span class="math inline">\(\rho_\text{Lag}\)</span>와 <span class="math inline">\(\beta\)</span> 간의 상호작용(<span class="math inline">\(\gamma\)</span>가 존재할 경우, 셋 간의 상호작용)이 존재한다. 이것은 다음의 편도함수로부터 확인할 수 있다. <span class="math inline">\(\partial y_i/\partial x_{jr}=((\textbf{I}-\rho_\text{Lag}\textbf{W})^{-1}(\textbf{I}\beta_r+\textbf{W}\gamma_r))_{ij}\)</span>. 여기서 밀집 행렬 <span class="math inline">\(S_r(\textbf{W})=((\textbf{I}-\rho_\text{Lag}\textbf{W})^{-1}(\textbf{I}\beta_r+\textbf{W}\gamma_r))\)</span>의 주대각 요소는 직접적인 영향(효과)을 나타내고, 비대각 요소는 간접적인 영향을 나타낸다.</p>
<p>Piras와 Prucha (2014)는 Raymond J. G. M. Florax, Folmer, Rey (2003)를 재검토하고 수정하였다(또한 Hendry (2006)와 Raymond J. G. M. Florax, Folmer, Rey (2006)의 논평 참조). 이들은 모형 선택을 위해 통상적으로 사용되는 사전 검정(pre-test) 전략보다는 해당 모형화에 적합한 가장 일반적인 모형을 추정하는 전략이 더 낳다고 결론지었다. 이 발견에 비추어, 여기서는 사전 검정 모형 선택을 사용하지 않는다.</p>
<p>현재 <strong>spatialreg</strong> 패키지가 주의를 기울이고 있는 것은 공간 지체 공변량을 처리하는 방법을 개선하는 것인데, <code>Durbin</code> 아규먼트를 사용하여 공간 지체 형식으로 추가할 공변량의 하위 집합을 제공하는 논리 값이나 수식을 받는다. 일부 공변량, 예를 들어 더미 변수와 같은 것들은 공간 지체 형식으로 추가되지 않아야 한다는 주장이 있다. 일단 공간 지체 공변량이 선택되면 다음의 이슈는 영향력을 계산할 때 이를 어떻게 적절하게 다룰지와 관련된 다. 이렇게 개선된 기능은 MCMC 또는 최대우도추정법으로 적합된 횡단면 모형에 적용되며, 공간 패널 모형에 적용될 예정이다.</p>
<p>거의 다루어지지 않은 이슈인 기능적 형태 가정(functional form assumption)을 언급하는 것은 충분한 가치가 있다. 이 이슈는 예를 들어 <strong>McSpatial</strong> 패키지에서 제시된 공간 분위수 회귀(McMillen 2013)와 같은 유연한 구조가 유용한 상황과 관련되어 있다. 또한 <strong>McSpatial</strong> 패키지의 일부 함수, 새로운 패키지 <strong>spldv</strong>(Sarrias and Piras 2022), 그리고 <strong>spatialprobit</strong> 패키지 및 <strong>ProbitSpatial</strong> 패키지(Wilhelm and Matos 2013; Martinetti and Geniaux 2017)에서 다루는 이산 반응 변수와 관련된 이슈들도 있다. <strong>McSpatial</strong> 패키지의 MCMC 실행은 LeSage와 Pace(2009)를 기반으로 한다. 마지막으로, Wagner와 Zeileis(2019)는 SLM 모형이 재귀적 분할 설정에서 어떻게 사용될 수 있는지 보여주며, 이를 <strong>spatialreg</strong> 패키지의 <code><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">lagsarlm()</a></code> 함수를 사용한 <strong>lagsarlmtree</strong> 패키지에서 구현하는 방법을 제시한다.</p>
<p><strong>spatialreg</strong> 패키지(Bivand and Piras 2022)를 통해 횡단(cross-sectional) 최대우도추정과 일반화된 모멘트법(GMM) 추정을 행하는 것과 <strong>sphet</strong> 패키지를 통해 공간계량경제학 스타일의 공간 회귀 모형을 행하는 것에 대한 리뷰(Bivand and Piras 2015)는 여전히 대부분 유효하다. 이 리뷰에서는 R 패키지에서의 추정량을 다른 프로그래밍 언어에서 제공되는 대체 구현과 비교하였다. 그러나 베이지안 공간계량경제학 스타일의 공간 회귀는 다루지 않았다. Millo와 Piras (2012)에서 설명한 공간 패널 추정량에 대해서는 더 많은 변화가 있었지만, 여기서는 다루지 않는다.</p>
<p>Bivand, Millo, and Piras (2021)는 공간계량경제학적 분석을 위한 R 패키지의 많은 기능을 다루고 있으며, Bivand와 Piras (2015)를 업데이트하고 일반화된 모멘트법(GMM) 및 공간 패널 모형화의 최근 발전을 포함하고 있기 때문에, 이 장에서는 Boston 주택 가격 데이터셋을 사용한 Bivand (2017)의 예제 몇 가지만 제한적으로 다룰 것이다.</p>
</section><section id="최대우도추정-spatialreg-패키지의-활용" class="level2" data-number="17.2"><h2 data-number="17.2" class="anchored" data-anchor-id="최대우도추정-spatialreg-패키지의-활용">
<span class="header-section-number">17.2</span> 최대우도추정: spatialreg 패키지의 활용</h2>
<p>단일 공간 계수를 가진 모형(SEM 및 SDEM은 <code><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm()</a></code> 함수 사용, SLM 및 SDM은 <code><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">lagsarlm()</a></code> 함수 사용)에는 Ord (1975)가 처음 설명한 방법이 사용된다. 다음 표는 최대우도추정법을 사용하여 위에서 설명한 모형을 추정할 수 있는 함수들을 보여준다.</p>
<table class="table">
<thead><tr class="header">
<th>모형</th>
<th>모형명</th>
<th>최대우도추정 함수</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>SEM</td>
<td>공간에러</td>
<td><code>errorsarlm(..., Durbin=FALSE)</code></td>
</tr>
<tr class="even">
<td>SEM</td>
<td>공간에러</td>
<td><code>spautolm(..., family="SAR")</code></td>
</tr>
<tr class="odd">
<td>SDEM</td>
<td>공간더빈에러</td>
<td><code>errorsarlm(..., Durbin=TRUE)</code></td>
</tr>
<tr class="even">
<td>SLM</td>
<td>공간지체</td>
<td><code>lagsarlm(..., Durbin=FALSE)</code></td>
</tr>
<tr class="odd">
<td>SDM</td>
<td>공간더빈</td>
<td><code>lagsarlm(..., Durbin=TRUE)</code></td>
</tr>
<tr class="even">
<td>SAC</td>
<td>공간자기회귀결합</td>
<td><code>sacsarlm(..., Durbin=FALSE)</code></td>
</tr>
<tr class="odd">
<td>GNM</td>
<td>일반 포함</td>
<td><code>sacsarlm(..., Durbin=TRUE)</code></td>
</tr>
</tbody>
</table>
<p>추정 함수인 <code><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm()</a></code>과 <code><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">lagsarlm()</a></code>은 비슷한 인자를 받는데, 첫 번째와 두 번째 인가(<code>formula</code>와 <code>data</code>)는 대부분의 모형 추정 함수에서 공통적으로 사용된다. 세 번째 인자는 <code>listw</code> 공간 가중치 객체이고, <code>na.action</code>은 결측값을 가진 관측개체의 공간 가중치를 처리하는 방법을 정의하는데 다른 모형 추정 함수와 동일하게 동작한다. <code>weights</code> 아규먼트는 분산 항목에서 관측값별 변동성을 나타내는 가중치를 제공하는 데 사용된다. 단, <code><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">lagsarlm()</a></code> 함수에서는 이 옵션이 제공되지 않는다.</p>
<p><code>Durbin</code> 아규먼트는 이전의 <code>type</code>과 <code>etype</code> 인자를 대체하며, 주어지지 않으면 기본값은 <code>FALSE</code>로 설정된다. 만약 제공된다면, <code>FALSE</code>나 <code>TRUE</code>일 수 있으며, 이 경우 모든 공간 지체 설명 변수가 포함된다. 또는, 일면 공식(one-sided formula)를 통해 어떤 공간 지체 설명 변수가 포함될지를 지정할 수 있다. <code>method</code> 아규먼트는 로그 우도 함수에서 로그 행렬식 항을 계산하는 방법을 지정하며, 기본값은 <code>"eigen"</code>으로, 이는 중간 크기의 데이터셋에 적합하다. <code>interval</code> 아규먼트는 <strong>stats</strong> 패키지의 <code><a href="https://rdrr.io/r/stats/optimize.html">optimize()</a></code> 함수를 통해 공간 계수를 찾는 선형 탐색의 도메인 범위를 제공한다. <code>tol.solve()</code> 아규먼트는 <strong>base</strong> 패키지의 <code><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve()</a></code> 함수에 전달되며, 이는 회귀 계수 간에 수치적 스케일 차이가 있는 데이터셋에서 분산-공분산 행렬의 역행렬을 계산하는 데 필요하다. 디폴트 값은 <code><a href="https://rdrr.io/r/base/solve.html">base::solve()</a></code>에서 훨씬 더 큰 값이다. <code>control</code> 아규먼트는 추정 함수 실행을 더 세밀하게 조정할 수 있게 해주는 제어 값의 리스트를 받는다.</p>
<p><code><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">sacsarlm()</a></code> 함수는 SAC 및 GNM 형식에서 두 개의 공간적 프로세스를 모형화할 때 서로 다른 두 개의 공간 가중치를 사용하는 경우, 두 번째 공간 가중치 및 <code>interval</code> 아규먼트를 받을 수 있다. 디폴트는 동일한 공간 가중치를 사용하는 것이다. 기본적으로는 <strong>stats</strong> 패키지의 <code><a href="https://rdrr.io/r/stats/nlminb.html">nlminb()</a></code> 함수가 수치 최적화에 사용되며, 시작 값을 선택하는 데 휴리스틱이 사용된다. <code><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">lagsarlm()</a></code>함수와 마찬가지로, 이 함수는 <code>weights</code> 아규먼트를 받지 않는다.</p>
<p>대용량 데이터셋이 사용되는 경우, 계수의 분산-공분산 행렬을 계산하기 위해 분석적 점근적(analytic asymptotic) 접근 방식 대신 수치적 헤시안(Hessian) 접근 방식이 사용된다.</p>
<section id="보스턴-주택-가격-데이터셋-예시" class="level3" data-number="17.2.1"><h3 data-number="17.2.1" class="anchored" data-anchor-id="보스턴-주택-가격-데이터셋-예시">
<span class="header-section-number">17.2.1</span> 보스턴 주택 가격 데이터셋 예시</h3>
<p>예제는 Bivand (2017)를 기반으로 16장에서 생성된 객체들을 사용한다.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spatialreg/">spatialreg</a></span><span class="op">)</span></span>
<span><span class="va">eigs_489</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/eigenw.html">eigenw</a></span><span class="op">(</span><span class="va">lw_q_489</span><span class="op">)</span></span>
<span><span class="va">SDEM_489</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_489</span>, </span>
<span>      listw <span class="op">=</span> <span class="va">lw_q_489</span>, Durbin <span class="op">=</span> <span class="cn">TRUE</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pre_eig <span class="op">=</span> <span class="va">eigs_489</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SEM_489</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_489</span>, </span>
<span>      listw <span class="op">=</span> <span class="va">lw_q_489</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pre_eig <span class="op">=</span> <span class="va">eigs_489</span><span class="op">)</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>디폴트인 <code>"eigen"</code> 방법을 사용하기 위해 미리 계산된 고유값을 <code>control</code> 리스트 아규먼트를 사용하여 전달한다.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SEM"</span>, <span class="st">"SDEM"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">Hausman.test</a></span><span class="op">(</span><span class="va">SEM_489</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">Hausman.test</a></span><span class="op">(</span><span class="va">SDEM_489</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#   model statistic  p.value parameter</span></span>
<span><span class="co"># 1   SEM      52.0 2.83e-06        14</span></span>
<span><span class="co"># 2  SDEM      48.7 6.48e-03        27</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>489개의 트랙트 데이터셋에 대한 두 가지 Hausman 검정 결과는 회귀 계수가 비공간적 회귀분석의 회귀계수와는 유의미하게 다르다는 것을 시사하며, 이는 공간 프로세스의 발자국이 일치하지 않음을 함축한다.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">eigs_94</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/eigenw.html">eigenw</a></span><span class="op">(</span><span class="va">lw_q_94</span><span class="op">)</span></span>
<span><span class="va">SDEM_94</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">form</span>, data<span class="op">=</span><span class="va">boston_94</span>, listw<span class="op">=</span><span class="va">lw_q_94</span>,</span>
<span>                      Durbin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pre_eig<span class="op">=</span><span class="va">eigs_94</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Warning in RET$pfunction("adjusted", ...): Completion with error &gt;</span></span>
<span><span class="co"># abseps</span></span>
<span></span>
<span><span class="co"># Warning in RET$pfunction("adjusted", ...): Completion with error &gt;</span></span>
<span><span class="co"># abseps</span></span>
<span></span>
<span><span class="co"># Warning in RET$pfunction("adjusted", ...): Completion with error &gt;</span></span>
<span><span class="co"># abseps</span></span>
<span></span>
<span><span class="co"># Warning in RET$pfunction("adjusted", ...): Completion with error &gt;</span></span>
<span><span class="co"># abseps</span></span>
<span><span class="va">SEM_94</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_94</span>, listw <span class="op">=</span> <span class="va">lw_q_94</span>,</span>
<span>                     control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pre_eig <span class="op">=</span> <span class="va">eigs_94</span><span class="op">)</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>94개의 대기 오염 모형 출력 구역에 대한 Hausman 검정은 계수 간 큰 차이를 발견하지 못했다.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SEM"</span>, <span class="st">"SDEM"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">Hausman.test</a></span><span class="op">(</span><span class="va">SEM_94</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">Hausman.test</a></span><span class="op">(</span><span class="va">SDEM_94</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#   model statistic p.value parameter</span></span>
<span><span class="co"># 1   SEM     15.66   0.335        14</span></span>
<span><span class="co"># 2  SDEM      9.21   0.999        27</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이러한 결과는 SEM과 SDEM 모형이 대기 오염 모형 출력 구역 수준에서 최소 제곱법이나 SLX에 거의 추가적인 차이를 만들지 않았다는 점을 보여준다. 우도비 검정을 통해 이러한 사실을 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SEM"</span>, <span class="st">"SDEM"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">LR1.Sarlm</a></span><span class="op">(</span><span class="va">SEM_94</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">LR1.Sarlm</a></span><span class="op">(</span><span class="va">SDEM_94</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#   model statistic p.value parameter</span></span>
<span><span class="co"># 1   SEM     2.593   0.107         1</span></span>
<span><span class="co"># 2  SDEM     0.216   0.642         1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>spatialreg</strong> 패키지의 <code><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">LR.Sarlm()</a></code> 함수를 사용하면 중첩(nested) 모형 간에 우도비 검정을 실행할 수 있지만, 여기서는 <strong>lmtest</strong> 패키지의 <code>lrtest()</code> 함수를 사용하는데 결과는 동일하다. 트랙트와 모형 출력 구역 모두에서 공간 지체 공변량을 포함하는 모형이 보다 선호된다는 결과가 산출된다.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">SEM_489</span>, <span class="va">SDEM_489</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"heading"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Model 1: SEM_489\nModel 2: SDEM_489"</span></span>
<span><span class="va">o</span></span>
<span><span class="co"># Likelihood ratio test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: SEM_489</span></span>
<span><span class="co"># Model 2: SDEM_489</span></span>
<span><span class="co">#   #Df LogLik Df Chisq Pr(&gt;Chisq)    </span></span>
<span><span class="co"># 1  16    274                        </span></span>
<span><span class="co"># 2  29    311 13  74.4    1.2e-10 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">SEM_94</span>, <span class="va">SDEM_94</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"heading"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Model 1: SEM_94\nModel 2: SDEM_94"</span></span>
<span><span class="va">o</span></span>
<span><span class="co"># Likelihood ratio test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: SEM_94</span></span>
<span><span class="co"># Model 2: SDEM_94</span></span>
<span><span class="co">#   #Df LogLik Df Chisq Pr(&gt;Chisq)    </span></span>
<span><span class="co"># 1  16   59.7                        </span></span>
<span><span class="co"># 2  29   81.3 13  43.2    4.2e-05 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>SLX 모형은 최소제곱법을 사용하여 적합되며, 로그 우도 값을 반환하여 잔차에 공간적 과정 요소가 포함될 필요가 있는지를 테스트할 수 있게 해준다. 트랙트 데이터셋에서는 분명히 그렇다는 결과가 도출되었다.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">SLX_489</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/SLX.html">lmSLX</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_489</span>, listw <span class="op">=</span> <span class="va">lw_q_489</span>,</span>
<span>                 zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">SLX_489</span>, <span class="va">SDEM_489</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"heading"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Model 1: SLX_489\nModel 2: SDEM_489"</span></span>
<span><span class="va">o</span></span>
<span><span class="co"># Likelihood ratio test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: SLX_489</span></span>
<span><span class="co"># Model 2: SDEM_489</span></span>
<span><span class="co">#   #Df LogLik Df Chisq Pr(&gt;Chisq)    </span></span>
<span><span class="co"># 1  28    231                        </span></span>
<span><span class="co"># 2  29    311  1   159     &lt;2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그러나 산출 존 데이터에 대해서는 반대의 결과가 도출되었다.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">SLX_94</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/SLX.html">lmSLX</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_94</span>, listw <span class="op">=</span> <span class="va">lw_q_94</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">SLX_94</span>, <span class="va">SDEM_94</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"heading"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Model 1: SLX_94\nModel 2: SDEM_94"</span></span>
<span><span class="va">o</span></span>
<span><span class="co"># Likelihood ratio test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: SLX_94</span></span>
<span><span class="co"># Model 2: SDEM_94</span></span>
<span><span class="co">#   #Df LogLik Df Chisq Pr(&gt;Chisq)</span></span>
<span><span class="co"># 1  28   81.2                    </span></span>
<span><span class="co"># 2  29   81.3  1  0.22       0.64</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이러한 결과는 주택 단위 수를 트랙트와 출력 구역별로 집계하여 사례 가중치를 사용할 때도 유지된다.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">SLX_489w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/SLX.html">lmSLX</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_489</span>, listw <span class="op">=</span> <span class="va">lw_q_489</span>,</span>
<span>                  weights <span class="op">=</span> <span class="va">units</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SDEM_489w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_489</span>,</span>
<span>                        listw <span class="op">=</span> <span class="va">lw_q_489</span>, Durbin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        weights <span class="op">=</span> <span class="va">units</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pre_eig <span class="op">=</span> <span class="va">eigs_489</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">SLX_489w</span>, <span class="va">SDEM_489w</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"heading"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Model 1: SLX_489w\nModel 2: SDEM_489w"</span></span>
<span><span class="va">o</span></span>
<span><span class="co"># Likelihood ratio test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: SLX_489w</span></span>
<span><span class="co"># Model 2: SDEM_489w</span></span>
<span><span class="co">#   #Df LogLik Df Chisq Pr(&gt;Chisq)    </span></span>
<span><span class="co"># 1  28    311                        </span></span>
<span><span class="co"># 2  29    379  1   136     &lt;2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">SLX_94w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/SLX.html">lmSLX</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_94</span>, listw <span class="op">=</span> <span class="va">lw_q_94</span>,</span>
<span>                 weights <span class="op">=</span> <span class="va">units</span><span class="op">)</span></span>
<span><span class="va">SDEM_94w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">boston_94</span>, listw <span class="op">=</span> <span class="va">lw_q_94</span>,</span>
<span>                       Durbin <span class="op">=</span> <span class="cn">TRUE</span>, weights <span class="op">=</span> <span class="va">units</span>,</span>
<span>                       control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pre_eig <span class="op">=</span> <span class="va">eigs_94</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">SLX_94w</span>, <span class="va">SDEM_94w</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"heading"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Model 1: SLX_94w\nModel 2: SDEM_94w"</span></span>
<span><span class="va">o</span></span>
<span><span class="co"># Likelihood ratio test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: SLX_94w</span></span>
<span><span class="co"># Model 2: SDEM_94w</span></span>
<span><span class="co">#   #Df LogLik Df Chisq Pr(&gt;Chisq)</span></span>
<span><span class="co"># 1  28   97.5                    </span></span>
<span><span class="co"># 2  29   98.0  1  0.92       0.34</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 경우와 Bivand (2017)에서 제시된 논거를 바탕으로 가중치 사용은 정당화된다. 주택 단위 수가 트랙트의 경우는 5개에서 3,031개로 다양하고, 대기 오렴 모형 출력 구역의 경우는 25개에서 12,411개로 다양하기 때문이다. 이러한 이유로, 그리고 가중치 일반화 중첩 모형(GNM)이 개발되지 않았다는 이유로, GNM을 일반적인 모형에서 더 단순한 모형로 테스트하는 출발점으로 삼을 수 없다. 대신, SDEM 모형을 출발점으로 삼고 Hausman 테스트를 사용하여 관측 단위 선택의 지침을 구한다.</p>
</section></section><section id="영향" class="level2" data-number="17.3"><h2 data-number="17.3" class="anchored" data-anchor-id="영향">
<span class="header-section-number">17.3</span> 영향</h2>
<p>글로벌 영향은 공간 지체 반응 변수를 포함하는 모형(SLM, SDM, SAC, GNM)의 적합 결과를 보고하는 데 있어 핵심적인 사항으로 이해되고 있다(LeSage와 Pace 2009). 글로벌 영향을 공간 지체 공변량(SLX, SDEM)을 포함하는 다른 모형로 확장하는 시도도 이루어졌다(Elhorst 2010; Bivand 2012; Halleck Vega와 Elhorst 2015). SLM, SDM, SAC, GNM 모형은 최대 우도 또는 GMM을 사용하여 적합시킬 때 계수의 분산-공분산 행렬을 사용할 수 있으며, 계수 값을 평균으로 삼고 추정된 분산-공분산 행렬로부터 분산을 가져와 다변량 정규 분포를 설정하고 그것으로부터 랜덤 샘플을 추출할 수 있다. 베이지안 방법을 사용하여 적합하는 경우라면, 샘플은 사전에 주어진다. SDEM의 경우, 비지체 공변량의 회귀 계수에 대한 샘플은 직접적인 영향을 나타내고, 공간 지체 공변량의 계수에 대한 샘플은 간접적인 영향을 나타내며, 이들의 합은 총 영향을 나타낸다.</p>
<p>SLX와 SDEM 모형에서는 추론을 위해 샘플링이 필요하지 않으므로 최대 우도를 사용하여 적합한 모형에 대해 선형 결합을 사용한다. 여기서는 공기 오염 변수에 대해서만 결과를 보여준다. 모형 출력 보고 방법에 대한 문제를 완전히 해결한 연구는 아직 발간되지 않았다. 개별 공변량에 대해 세 가지 영향력 값을 보고해야 하기 때문이다. 공간 지체 공변량이 포함될 경우, 두 개의 계수는 세 가지 영향으로 대체된다. 여기서는 공기 오염 변수에 대해 그 예를 보여준다.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sum_imp_94_SDEM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">SDEM_94</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>Impacts <span class="op">=</span> <span class="va">sum_imp_94_SDEM</span><span class="op">$</span><span class="va">mat</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span>, </span>
<span>      SE <span class="op">=</span> <span class="va">sum_imp_94_SDEM</span><span class="op">$</span><span class="va">semat</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#           Direct Indirect   Total</span></span>
<span><span class="co"># Impacts -0.01276 -0.01845 -0.0312</span></span>
<span><span class="co"># SE       0.00235  0.00472  0.0053</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>SLX와 SDEM 모형에서 직접적인 영향은 같은 관측 단위에서 공기 오염 변화가 응답에 미치는 결과이고, 간접적인(지역적인) 영향은 인접한 관측 단위에서 공기 오염 변화가 응답에 미치는 결과이다.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sum_imp_94_SLX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">SLX_94</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>Impacts <span class="op">=</span> <span class="va">sum_imp_94_SLX</span><span class="op">$</span><span class="va">mat</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span>, </span>
<span>      SE <span class="op">=</span> <span class="va">sum_imp_94_SLX</span><span class="op">$</span><span class="va">semat</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#          Direct Indirect    Total</span></span>
<span><span class="co"># Impacts -0.0128 -0.01874 -0.03151</span></span>
<span><span class="co"># SE       0.0028  0.00556  0.00611</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>같은 방법을 가중 공간 회귀 분석에 적용하면, 공기 오염이 주택 가치에 미치는 총 영향은 감소하지만 여전히 유의미하다.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sum_imp_94_SDEMw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">SDEM_94w</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>Impacts <span class="op">=</span> <span class="va">sum_imp_94_SDEMw</span><span class="op">$</span><span class="va">mat</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span>, </span>
<span>      SE <span class="op">=</span> <span class="va">sum_imp_94_SDEMw</span><span class="op">$</span><span class="va">semat</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#           Direct Indirect    Total</span></span>
<span><span class="co"># Impacts -0.00592 -0.01076 -0.01668</span></span>
<span><span class="co"># SE       0.00269  0.00531  0.00559</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>전체적으로, 공기 오염 모형 출력 구역 수준으로 집계된 공간 지체 공변량만 포함하는 가중 공간 회귀 모형이 대부분의 모형 오지정 오류를 해결하는 것처럼 보이며, Bivand (2017)에서 더 자세히 논의되어 있는 바와 같이, 이는 오지정된 대체 모형들보다 훨씬 더 큰 오염 제거에 대한 지불 의향이 있다는 점을 보여준다.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sum_imp_94_SLXw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">SLX_94w</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>Impacts <span class="op">=</span> <span class="va">sum_imp_94_SLXw</span><span class="op">$</span><span class="va">mat</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span>, </span>
<span>      SE <span class="op">=</span> <span class="va">sum_imp_94_SLXw</span><span class="op">$</span><span class="va">semat</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#           Direct Indirect    Total</span></span>
<span><span class="co"># Impacts -0.00620 -0.01221 -0.01842</span></span>
<span><span class="co"># SE       0.00326  0.00628  0.00629</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="예측" class="level2" data-number="17.4"><h2 data-number="17.4" class="anchored" data-anchor-id="예측">
<span class="header-section-number">17.4</span> 예측</h2>
<p>보스턴 구역 데이터셋에서 응답 변수인 중위 주택 가격 17개의 관측치가 제한되어 있다. 우리는 <code>"Sarlm"</code> 객체에 대한 <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> 메서드를 사용하여 이 값을 채울 것이다. 이 메서드는 Goulard, Laurent, and Thomas-Agnan (2017)을 기반으로 Martin Gubri에 의해 다시 작성되었으며, Laurent와 Margaretic (2021)도 참조할 수 있다. <code>pred.type</code> 아규먼트는 해당 논문에서 제시된 예측 전략을 지정한다.</p>
<p>이 예시를 SDEM 모형의 다양한 변종을 <code>pred.type</code>의 설정을 통해 시도하고 샘플 외 예측을 수행해 보면 차이가 있음을 알 수 있으며, 이는 연구할 만한 중요한 영역임을 시사한다. 누락 변수 처리에 대한 몇 가지 대안이 제시된바 있다(Gómez-Rubio, Bivand, and Rue 2015; Suesse 2018). 예측에 대한 관심이 증가하는 또 다른 이유는 예측이 기계 학습 접근 방식의 기본 요소라는 점이다. 기계 학습에서는 검증 및 테스트 데이터셋을 위한 예측이 모형 사양 선택을 이끈다. 의존성을 가진 공간 데이터로부터 훈련 및 기타 데이터셋을 선택하는 것은 여전히 해결되지 않은 문제로, 독립적인 데이터와는 분명히 다른 복잡성을 지니고 있다.</p>
<p>여기에서는 검열(censored) 트랙트 관측값에 대해 세 가지 서로 다른 예측 유형을 사용하여 예측값을 산출하고, USD 단위의 주택 중위값으로 복원하기 위해 지수 연산을 적용한다. <code>newdata</code> 객체의 <code><a href="https://rdrr.io/r/base/row.names.html">row.names()</a></code>가 공간 가중치 행렬의 <code>"region.id"</code> 속성과 일치하여 샘플 외 예측이 가능해진다는 점에 유의해야 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="va">boston_506</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">boston_506</span><span class="op">$</span><span class="va">median</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">t0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">SDEM_489</span>, newdata <span class="op">=</span> <span class="va">nd</span>, listw <span class="op">=</span> <span class="va">lw_q</span>,</span>
<span>                  pred.type <span class="op">=</span> <span class="st">"TS"</span>, zero.policy  <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">SDEM_489</span>, newdata <span class="op">=</span> <span class="va">nd</span>,</span>
<span>                                    listw <span class="op">=</span> <span class="va">lw_q</span>,</span>
<span>                                    pred.type <span class="op">=</span> <span class="st">"KP2"</span>,</span>
<span>                                    zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">SDEM_489</span>, newdata <span class="op">=</span> <span class="va">nd</span>,</span>
<span>                                    listw <span class="op">=</span> <span class="va">lw_q</span>,</span>
<span>                                    pred.type <span class="op">=</span> <span class="st">"KP5"</span>,</span>
<span>                                    zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>우리는 INLA의 <code>"slm"</code> 모형을 사용하여 모형 적합 함수 호출 과정에서 누락된 반응 변수 값을 예측할 수도 있다. <code>"slm"</code> 모형이 아직 실험적인 상태이므로 약간의 설정 코드가 필요하다.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="co"># Loading required package: foreach</span></span>
<span><span class="co"># Loading required package: parallel</span></span>
<span><span class="co"># Loading required package: sp</span></span>
<span><span class="co"># This is INLA_23.04.24 built 2023-04-24 19:15:35 UTC.</span></span>
<span><span class="co">#  - See www.r-inla.org/contact-us for how to get help.</span></span>
<span><span class="co">#  - To enable PARDISO sparse library; see inla.pardiso()</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Attaching package: 'INLA'</span></span>
<span><span class="co"># The following object is masked _by_ '.GlobalEnv':</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#     f</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">lw_q</span>, <span class="st">"CsparseMatrix"</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/eigenw.html">eigenw</a></span><span class="op">(</span><span class="va">lw_q</span><span class="op">)</span></span>
<span><span class="va">re.idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Im</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-6</span><span class="op">)</span></span>
<span><span class="va">rho.max</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Re</a></span><span class="op">(</span><span class="va">e</span><span class="op">[</span><span class="va">re.idx</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rho.min</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Re</a></span><span class="op">(</span><span class="va">e</span><span class="op">[</span><span class="va">re.idx</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rho.min</span>, <span class="va">rho.max</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">boston_506</span><span class="op">$</span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span></span>
<span><span class="va">zero.variance</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">25</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">args.slm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>rho.min <span class="op">=</span> <span class="va">rho.min</span>, rho.max <span class="op">=</span> <span class="va">rho.max</span>, W <span class="op">=</span> <span class="va">W</span>,</span>
<span>                 X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span>, <span class="fl">0</span><span class="op">)</span>, Q.beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hyper.slm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"loggamma"</span>, </span>
<span>                              param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  rho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">0</span>, prior <span class="op">=</span> <span class="st">"logitbeta"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">WX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/SLX.html">create_WX</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">form</span>, <span class="va">CMEDV</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span>, </span>
<span>                             data <span class="op">=</span> <span class="va">boston_506</span><span class="op">)</span>, <span class="va">lw_q</span><span class="op">)</span></span>
<span><span class="va">SDEM_506_slm</span> <span class="op">&lt;-</span> <span class="fu">inla</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">form</span>, </span>
<span>                            <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">WX</span> <span class="op">+</span> <span class="fu">f</span><span class="op">(</span><span class="va">idx</span>, model <span class="op">=</span> <span class="st">"slm"</span>,</span>
<span>                                         args.slm <span class="op">=</span> <span class="va">args.slm</span>,</span>
<span>                                         hyper <span class="op">=</span> <span class="va">hyper.slm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">boston_506</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                 control.family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>hyper <span class="op">=</span> <span class="va">zero.variance</span><span class="op">)</span>,</span>
<span>                 control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dic <span class="op">=</span> <span class="cn">TRUE</span>, cpo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mv_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">SDEM_506_slm</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">boston_506</span><span class="op">$</span><span class="va">median</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>INLA는 또한 예측값에 대한 주변 분포(marginal distribution)의 격자형 추정치를 제공하며, 이를 통해 예측값과 관련된 불확실성을 평가할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>fit_TS <span class="op">=</span> <span class="va">t0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, fit_KP2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span>, fit_KP5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span>,</span>
<span>    INLA_slm <span class="op">=</span> <span class="va">mv_mean</span>, censored <span class="op">=</span> </span>
<span>      <span class="va">boston_506</span><span class="op">$</span><span class="va">censored</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">t0</span>, <span class="st">"region.id"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#     fit_TS fit_KP2 fit_KP5 INLA_slm censored</span></span>
<span><span class="co"># 13   23912   29477   28147    31112    right</span></span>
<span><span class="co"># 14   28126   27001   28516    31314    right</span></span>
<span><span class="co"># 15   30553   36184   32476    41298    right</span></span>
<span><span class="co"># 17   18518   19621   18878    21160    right</span></span>
<span><span class="co"># 43    9564    6817    7561     6830     left</span></span>
<span><span class="co"># 50    8371    7196    7383     6885     left</span></span>
<span><span class="co"># 312  51477   53301   54173    56274    right</span></span>
<span><span class="co"># 313  45921   45823   47095    46447    right</span></span>
<span><span class="co"># 314  44196   44586   45361    42805    right</span></span>
<span><span class="co"># 317  43427   45707   45442    48025    right</span></span>
<span><span class="co"># 337  39879   42072   41127    41462    right</span></span>
<span><span class="co"># 346  44708   46694   46108    45847    right</span></span>
<span><span class="co"># 355  48188   49068   48911    49138    right</span></span>
<span><span class="co"># 376  42881   45883   44966    47747    right</span></span>
<span><span class="co"># 408  44294   44615   45670    46164    right</span></span>
<span><span class="co"># 418  38211   43375   41914    43913    right</span></span>
<span><span class="co"># 434  41647   41690   42398    41551    right</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>공간 회귀를 위한 툴박스는 여전히 완전하지 않았으며, 빈틈을 채우는 데는 시간이 걸릴 것이다. 여러 공간 회귀 전통들이 서로의 이해와 발전을 거의 공유하지 않는 점은 여전히 아쉬운 부분이다.</p>
</section><section id="연습문제" class="level2" data-number="17.5"><h2 data-number="17.5" class="anchored" data-anchor-id="연습문제">
<span class="header-section-number">17.5</span> 연습문제</h2>
<ol type="1">
<li><p>Piras와 Prucha(2014), 그리고 Raymond J. G. M. Florax, Folmer, Rey(2003)를 참조할 때, 사전 테스트 전략을 선택하면, 속성만 포함된 데이터셋과 지자체 구역 변수가 추가된 속성 데이터셋의 선형 모형에서 잔차의 공간적 의존성이 나타나는지 답하시오. 사전 테스트가 어떤 모형을 지목하는지에 대해 답하시오.</p></li>
<li><p>지자체 부서 더미 변수의 포함하거나 지자체 부서 체제 모형을 실행하면 잔차의 공간적 의존성을 줄이는 데 도움이 될 수 있을지에 대해 답하시오.</p></li>
<li><p>속성만 포함한 모형과 지자체 부서 변수를 추가한 모형에 대해 최대우도법을 사용하여 SEM 모형을 실행하고(GMM 코드 예시는 Bivand, Millo, and Piras (2021)를 참조), 이를 SDEM 모형로 확장하시오. SLX 모형을 실행하고, 해당 모형의 잔차에 대한 공간적 자기상관 테스트 결과를 해석하시오. SEM과 SDEM 모형에 대한 Hausman 테스트가 보여주는 매우 높은 유의성을 해석하시오.</p></li>
<li><p>속성만 포함한 모형과 지자체 부서 변수를 추가한 모형에 대해 GNM 모형을 실행하시오. 이러한 모형을 SDM 또는 SDEM 형식으로 단순화할 수 있을지에 대해 답하시오.</p></li>
</ol>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "복사완료!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "복사완료!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./16.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">공간적 회귀분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./A.html" class="pagination-link" aria-label="<span class='chapter-number'>A</span>&nbsp; <span class='chapter-title'>오래된 공간 R 패키지</span>">
        <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">오래된 공간 R 패키지</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></div></div></footer></body></html>