<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>공간데이터사이언스 개론 - 7&nbsp; sf와 stars 패키지</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08.html" rel="next">
<link href="./part_2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-sf-stars" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">sf와 stars 패키지</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">공간데이터사이언스 개론</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/sangillee66/book_sds_trans" title="소스 코드" class="quarto-navigation-tool px-1" aria-label="소스 코드"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">서장</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">시작하기</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">좌표계</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">구면 지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">속성과 서포트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">데이터 큐브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터사이언스와 R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">sf와 stars 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">공간데이터의 플로팅</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">대규모 데이터와 클라우드 네이티브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간통계분석과 공간모델링</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">공간데이터의 통계적 모형화</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">포인트 패턴 분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">공간적 내삽</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">다변량 및 시공간 지구통계학</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">근접성과 에어리어 데이터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">공간적 자기상관 측도</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">공간적 회귀분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">공간계량경제학적 모형</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">부록</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">예전 R 공간 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R 기초</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">목차</h2>
   
  <ul>
<li>
<a href="#sec-sf" id="toc-sec-sf" class="nav-link active" data-scroll-target="#sec-sf"><span class="header-section-number">7.1</span> sf 패키지</a>
  <ul class="collapse">
<li><a href="#%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1" id="toc-객체-생성" class="nav-link" data-scroll-target="#%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1"><span class="header-section-number">7.1.1</span> 객체 생성</a></li>
  <li><a href="#%EC%9D%BD%EA%B8%B0%EC%99%80-%EC%93%B0%EA%B8%B0" id="toc-읽기와-쓰기" class="nav-link" data-scroll-target="#%EC%9D%BD%EA%B8%B0%EC%99%80-%EC%93%B0%EA%B8%B0"><span class="header-section-number">7.1.2</span> 읽기와 쓰기</a></li>
  <li><a href="#%EC%84%9C%EB%B8%8C%EC%84%B8%ED%8C%85" id="toc-서브세팅" class="nav-link" data-scroll-target="#%EC%84%9C%EB%B8%8C%EC%84%B8%ED%8C%85"><span class="header-section-number">7.1.3</span> 서브세팅</a></li>
  <li><a href="#%EC%9D%B4%ED%95%AD-%ED%94%84%EB%A0%88%EB%94%94%EC%BC%80%EC%9D%B4%ED%8A%B8" id="toc-이항-프레디케이트" class="nav-link" data-scroll-target="#%EC%9D%B4%ED%95%AD-%ED%94%84%EB%A0%88%EB%94%94%EC%BC%80%EC%9D%B4%ED%8A%B8"><span class="header-section-number">7.1.4</span> 이항 프레디케이트</a></li>
  <li><a href="#%ED%83%80%EC%9D%B4%EB%94%94%EB%B2%84%EC%8A%A4-%ED%8C%A8%ED%82%A4%EC%A7%80" id="toc-타이디버스-패키지" class="nav-link" data-scroll-target="#%ED%83%80%EC%9D%B4%EB%94%94%EB%B2%84%EC%8A%A4-%ED%8C%A8%ED%82%A4%EC%A7%80"><span class="header-section-number">7.1.5</span> 타이디버스 패키지</a></li>
  </ul>
</li>
  <li>
<a href="#%EA%B3%B5%EA%B0%84%EC%A0%81-%EC%A1%B0%EC%9D%B8" id="toc-공간적-조인" class="nav-link" data-scroll-target="#%EA%B3%B5%EA%B0%84%EC%A0%81-%EC%A1%B0%EC%9D%B8"><span class="header-section-number">7.2</span> 공간적 조인</a>
  <ul class="collapse">
<li><a href="#%ED%91%9C%EB%B3%B8%EC%B6%94%EC%B6%9C-%EA%B7%B8%EB%A6%AC%EB%93%9C-%EC%83%9D%EC%84%B1-%EB%82%B4%EC%82%BD" id="toc-표본추출-그리드-생성-내삽" class="nav-link" data-scroll-target="#%ED%91%9C%EB%B3%B8%EC%B6%94%EC%B6%9C-%EA%B7%B8%EB%A6%AC%EB%93%9C-%EC%83%9D%EC%84%B1-%EB%82%B4%EC%82%BD"><span class="header-section-number">7.2.1</span> 표본추출, 그리드 생성, 내삽</a></li>
  </ul>
</li>
  <li><a href="#%ED%83%80%EC%9B%90%EC%B2%B4-%EC%A2%8C%ED%91%9C" id="toc-타원체-좌표" class="nav-link" data-scroll-target="#%ED%83%80%EC%9B%90%EC%B2%B4-%EC%A2%8C%ED%91%9C"><span class="header-section-number">7.3</span> 타원체 좌표</a></li>
  <li>
<a href="#stars-%ED%8C%A8%ED%82%A4%EC%A7%80" id="toc-stars-패키지" class="nav-link" data-scroll-target="#stars-%ED%8C%A8%ED%82%A4%EC%A7%80"><span class="header-section-number">7.4</span> stars 패키지</a>
  <ul class="collapse">
<li><a href="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%9D%98-%EC%9D%BD%EA%B8%B0%EC%99%80-%EC%93%B0%EA%B8%B0" id="toc-래스터-데이터의-읽기와-쓰기" class="nav-link" data-scroll-target="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%9D%98-%EC%9D%BD%EA%B8%B0%EC%99%80-%EC%93%B0%EA%B8%B0"><span class="header-section-number">7.4.1</span> 래스터 데이터의 읽기와 쓰기</a></li>
  <li><a href="#stars-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%90%EB%B8%8C%EC%9D%98-%EC%84%9C%EB%B8%8C%EC%84%B8%ED%8C%85" id="toc-stars-데이터-큐브의-서브세팅" class="nav-link" data-scroll-target="#stars-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%90%EB%B8%8C%EC%9D%98-%EC%84%9C%EB%B8%8C%EC%84%B8%ED%8C%85"><span class="header-section-number">7.4.2</span> <code>stars</code> 데이터 큐브의 서브세팅</a></li>
  <li><a href="#%ED%81%AC%EB%A1%9C%ED%95%91" id="toc-크로핑" class="nav-link" data-scroll-target="#%ED%81%AC%EB%A1%9C%ED%95%91"><span class="header-section-number">7.4.3</span> 크로핑</a></li>
  <li><a href="#stars-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EB%94%94%EB%A9%98%EC%85%98-%EC%9E%AC%EC%84%A4%EC%A0%95-%EB%B0%8F-%EA%B2%B0%ED%95%A9" id="toc-stars-객체의-디멘션-재설정-및-결합" class="nav-link" data-scroll-target="#stars-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EB%94%94%EB%A9%98%EC%85%98-%EC%9E%AC%EC%84%A4%EC%A0%95-%EB%B0%8F-%EA%B2%B0%ED%95%A9"><span class="header-section-number">7.4.4</span> <code>stars</code> 객체의 디멘션 재설정 및 결합</a></li>
  <li><a href="#%ED%8F%AC%EC%9D%B8%ED%8A%B8-%EC%83%98%ED%94%8C%EC%B6%94%EC%B6%9C%EA%B3%BC-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B2%8C%EC%9D%B4%EC%85%98" id="toc-포인트-샘플추출과-애그리게이션" class="nav-link" data-scroll-target="#%ED%8F%AC%EC%9D%B8%ED%8A%B8-%EC%83%98%ED%94%8C%EC%B6%94%EC%B6%9C%EA%B3%BC-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B2%8C%EC%9D%B4%EC%85%98"><span class="header-section-number">7.4.5</span> 포인트 샘플추출과 애그리게이션</a></li>
  <li><a href="#%EC%98%88%EC%B8%A1%EB%AA%A8%ED%98%95" id="toc-예측모형" class="nav-link" data-scroll-target="#%EC%98%88%EC%B8%A1%EB%AA%A8%ED%98%95"><span class="header-section-number">7.4.6</span> 예측모형</a></li>
  <li><a href="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%94%8C%EB%A1%9C%ED%8C%85" id="toc-래스터-데이터-플로팅" class="nav-link" data-scroll-target="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%94%8C%EB%A1%9C%ED%8C%85"><span class="header-section-number">7.4.7</span> 래스터 데이터 플로팅</a></li>
  <li><a href="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D" id="toc-래스터-데이터-분석" class="nav-link" data-scroll-target="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D"><span class="header-section-number">7.4.8</span> 래스터 데이터 분석</a></li>
  <li><a href="#%EA%B3%A1%EC%84%A0%ED%98%95-%EB%9E%98%EC%8A%A4%ED%84%B0" id="toc-곡선형-래스터" class="nav-link" data-scroll-target="#%EA%B3%A1%EC%84%A0%ED%98%95-%EB%9E%98%EC%8A%A4%ED%84%B0"><span class="header-section-number">7.4.9</span> 곡선형 래스터</a></li>
  <li><a href="#gdal-%EC%9C%A0%ED%8B%B8%EB%A6%AC%ED%8B%B0" id="toc-gdal-유틸리티" class="nav-link" data-scroll-target="#gdal-%EC%9C%A0%ED%8B%B8%EB%A6%AC%ED%8B%B0"><span class="header-section-number">7.4.10</span> GDAL 유틸리티</a></li>
  </ul>
</li>
  <li>
<a href="#%EB%B2%A1%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%90%EB%B8%8C-%EC%98%88%EC%A0%9C" id="toc-벡터-데이터-큐브-예제" class="nav-link" data-scroll-target="#%EB%B2%A1%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%90%EB%B8%8C-%EC%98%88%EC%A0%9C"><span class="header-section-number">7.5</span> 벡터 데이터 큐브 예제</a>
  <ul class="collapse">
<li><a href="#%EC%98%88%EC%A0%9C-%EB%8C%80%EA%B8%B0%EC%A7%88-%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B2%8C%EC%9D%B4%EC%85%98-%EC%8B%A4%ED%96%89" id="toc-예제-대기질-시계열-데이터-애그리게이션-실행" class="nav-link" data-scroll-target="#%EC%98%88%EC%A0%9C-%EB%8C%80%EA%B8%B0%EC%A7%88-%EC%8B%9C%EA%B3%84%EC%97%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B2%8C%EC%9D%B4%EC%85%98-%EC%8B%A4%ED%96%89"><span class="header-section-number">7.5.1</span> 예제: 대기질 시계열 데이터 애그리게이션 실행</a></li>
  <li><a href="#%EC%98%88%EC%A0%9C-%EB%B8%8C%EB%A6%AC%EC%8A%A4%ED%86%A8-%EC%B6%9C%EB%B0%9C%EC%A7%80-%EB%8F%84%EC%B0%A9%EC%A7%80-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%90%EB%B8%8C" id="toc-예제-브리스톨-출발지-도착지-데이터-큐브" class="nav-link" data-scroll-target="#%EC%98%88%EC%A0%9C-%EB%B8%8C%EB%A6%AC%EC%8A%A4%ED%86%A8-%EC%B6%9C%EB%B0%9C%EC%A7%80-%EB%8F%84%EC%B0%A9%EC%A7%80-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%90%EB%B8%8C"><span class="header-section-number">7.5.2</span> 예제: 브리스톨 출발지-도착지 데이터 큐브</a></li>
  <li><a href="#%ED%83%80%EC%9D%B4%EB%94%94-%EC%96%B4%EB%A0%88%EC%9D%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0" id="toc-타이디-어레이-데이터" class="nav-link" data-scroll-target="#%ED%83%80%EC%9D%B4%EB%94%94-%EC%96%B4%EB%A0%88%EC%9D%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0"><span class="header-section-number">7.5.3</span> 타이디 어레이 데이터</a></li>
  <li><a href="#%EB%B2%A1%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%90%EB%B8%8C%EB%A5%BC-%EC%9C%84%ED%95%9C-%ED%8C%8C%EC%9D%BC-%ED%8F%AC%EB%A7%B7" id="toc-벡터-데이터-큐브를-위한-파일-포맷" class="nav-link" data-scroll-target="#%EB%B2%A1%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%90%EB%B8%8C%EB%A5%BC-%EC%9C%84%ED%95%9C-%ED%8C%8C%EC%9D%BC-%ED%8F%AC%EB%A7%B7"><span class="header-section-number">7.5.4</span> 벡터 데이터 큐브를 위한 파일 포맷</a></li>
  </ul>
</li>
  <li>
<a href="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%B2%A1%ED%84%B0-%EC%A0%84%ED%99%98%EA%B3%BC-%EB%B2%A1%ED%84%B0-%EB%9E%98%EC%8A%A4%ED%84%B0-%EC%A0%84%ED%99%98" id="toc-래스터-벡터-전환과-벡터-래스터-전환" class="nav-link" data-scroll-target="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%B2%A1%ED%84%B0-%EC%A0%84%ED%99%98%EA%B3%BC-%EB%B2%A1%ED%84%B0-%EB%9E%98%EC%8A%A4%ED%84%B0-%EC%A0%84%ED%99%98"><span class="header-section-number">7.6</span> 래스터-벡터 전환과 벡터-래스터 전환</a>
  <ul class="collapse">
<li><a href="#%EB%B2%A1%ED%84%B0-%EB%9E%98%EC%8A%A4%ED%84%B0-%EC%A0%84%ED%99%98" id="toc-벡터-래스터-전환" class="nav-link" data-scroll-target="#%EB%B2%A1%ED%84%B0-%EB%9E%98%EC%8A%A4%ED%84%B0-%EC%A0%84%ED%99%98"><span class="header-section-number">7.6.1</span> 벡터-래스터 전환</a></li>
  </ul>
</li>
  <li>
<a href="#%EC%A2%8C%ED%91%9C%EB%B3%80%ED%99%98-%EB%B0%8F-%EC%A2%8C%ED%91%9C%EC%A0%84%ED%99%98" id="toc-좌표변환-및-좌표전환" class="nav-link" data-scroll-target="#%EC%A2%8C%ED%91%9C%EB%B3%80%ED%99%98-%EB%B0%8F-%EC%A2%8C%ED%91%9C%EC%A0%84%ED%99%98"><span class="header-section-number">7.7</span> 좌표변환 및 좌표전환</a>
  <ul class="collapse">
<li><a href="#st_crs-%ED%95%A8%EC%88%98" id="toc-st_crs-함수" class="nav-link" data-scroll-target="#st_crs-%ED%95%A8%EC%88%98"><span class="header-section-number">7.7.1</span> <code>st_crs()</code> 함수</a></li>
  <li><a href="#st_transform%ED%95%A8%EC%88%98%EC%99%80-st_project-%ED%95%A8%EC%88%98" id="toc-st_transform함수와-st_project-함수" class="nav-link" data-scroll-target="#st_transform%ED%95%A8%EC%88%98%EC%99%80-st_project-%ED%95%A8%EC%88%98"><span class="header-section-number">7.7.2</span> <code>st_transform()</code>함수와 <code>st_project()</code> 함수</a></li>
  <li><a href="#sf_proj_info-%ED%95%A8%EC%88%98" id="toc-sf_proj_info-함수" class="nav-link" data-scroll-target="#sf_proj_info-%ED%95%A8%EC%88%98"><span class="header-section-number">7.7.3</span> <code>sf_proj_info()</code> 함수</a></li>
  <li><a href="#%EB%8D%B0%EC%9D%B4%ED%85%80-%EA%B7%B8%EB%A6%AC%EB%93%9C-proj.db-cdn.proj.org.-%EB%A1%9C%EC%BB%AC-%EC%BA%90%EC%89%AC" id="toc-데이텀-그리드-proj.db-cdn.proj.org.-로컬-캐쉬" class="nav-link" data-scroll-target="#%EB%8D%B0%EC%9D%B4%ED%85%80-%EA%B7%B8%EB%A6%AC%EB%93%9C-proj.db-cdn.proj.org.-%EB%A1%9C%EC%BB%AC-%EC%BA%90%EC%89%AC"><span class="header-section-number">7.7.4</span> 데이텀 그리드, proj.db, cdn.proj.org. 로컬 캐쉬</a></li>
  <li><a href="#%EB%B3%80%ED%99%98-%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8" id="toc-변환-파이프라인" class="nav-link" data-scroll-target="#%EB%B3%80%ED%99%98-%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8"><span class="header-section-number">7.7.5</span> 변환 파이프라인</a></li>
  <li><a href="#%EC%B6%95-%EC%88%9C%EC%84%9C%EC%99%80-%EB%B0%A9%ED%96%A5" id="toc-축-순서와-방향" class="nav-link" data-scroll-target="#%EC%B6%95-%EC%88%9C%EC%84%9C%EC%99%80-%EB%B0%A9%ED%96%A5"><span class="header-section-number">7.7.6</span> 축 순서와 방향</a></li>
  </ul>
</li>
  <li><a href="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%B3%80%ED%99%98-%EB%B0%8F-%EC%9B%8C%ED%94%84" id="toc-래스터-변환-및-워프" class="nav-link" data-scroll-target="#%EB%9E%98%EC%8A%A4%ED%84%B0-%EB%B3%80%ED%99%98-%EB%B0%8F-%EC%9B%8C%ED%94%84"><span class="header-section-number">7.8</span> 래스터 변환 및 워프</a></li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C" id="toc-연습문제" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C"><span class="header-section-number">7.9</span> 연습문제</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-sf-stars" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">sf와 stars 패키지</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">2025년 8월 17일</p>
    </div>
  </div>
    
  </div>
  


</header><p>이 장에서는 R의 <strong>sf</strong>와 <strong>stars</strong> 패키지를 소개한다. <strong>sf</strong>는 피처의 지오메트리 정보를 리스트-컬럼 형태로 저장하는 심플 피처 테이블 포맷을 제공한다. <strong>stars</strong> 패키지는 래스터와 벡터 데이터 큐브(6장에서 다룸)를 지원하기 위해 개발되었으며, 래스터 레이어, 래스터 스택, 피처 시계열도 처리할 수 있다. <strong>sf</strong> 패키지는 2016년에 CRAN에 처음 공개되었고, <strong>stars</strong> 패키지는 2018년에 등장했다. 두 패키지는 R 컨소시엄의 지원과 활발한 커뮤니티 참여 속에서 개발되었으며, 상호 연동이 가능하도록 설계되었다. <strong>sf</strong>나 <strong>stars</strong> 객체를 대상으로 하는 함수 또는 메서드는 <code>st_</code>로 시작하는데, 이는 관련 함수를 쉽게 식별할 수 있게 해주며, 명령어 자동 완성 기능을 활용할 때 검색을 용이하게 한다.</p>
<section id="sec-sf" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-sf">
<span class="header-section-number">7.1</span> sf 패키지</h2>
<p>R의 <strong>sf</strong> 패키지(Pebesma 2018)는 기존의 R 패키지인 <strong>sp</strong>, <strong>rgeos</strong>, <strong>rgdal</strong>의 벡터 처리 기능을 대체하고 이를 성공적으로 계승하기 위해 개발되었다. 또한 산업계 및 오픈소스 프로젝트에서 널리 사용되는 표준 기반 접근법에 보다 근접하고, 최신 버전의 오픈소스 지리공간 소프트웨어 스택(그림 1.7)에 기반하며, 필요 시 R 공간 소프트웨어와 타이디버스(Wickham et al.&nbsp;2019)의 통합을 가능하게 한다.</p>
<p>이를 위해 <strong>sf</strong> 패키지는 R에서 심플 피처 접근(Herring et al.&nbsp;2011)을 네이티브(native)로 제공한다.(역자주: 여기서 ’네이티브’는 추가적인 변환 과정이나 별도의 중간 계층 없이, 해당 환경에서 직접 실행되거나 지원되는 방식을 의미한다.) 이 패키지는 여러 <strong>tidyverse</strong> 패키지, 특히 <strong>ggplot2</strong>, <strong>dplyr</strong>, <strong>tidyr</strong>와의 인터페이스를 제공하며, GDAL을 통해 데이터를 읽고 쓰고, GEOS(투영 좌표의 경우) 또는 s2geometry(타원체 좌표의 경우)를 이용해 기하학 연산을 수행하고, PROJ를 사용하여 좌표변환 및 전환 작업을 처리한다. 외부 C++ 라이브러리와 연동은 <strong>Rcpp</strong> 패키지(Eddelbuettel 2013)를 통해 이루어진다.</p>
<p><strong>sf</strong> 패키지는 <code>sf</code> 객체로 심플 피처를 표현하며, 이는 <code>data.frame</code> 또는 티블(tibble)의 하위 클래스이다.(역자주: 티블은 <strong>tidyverse</strong> 패키지에서 제안한, 개선된 형태의 데이터 프레임 포맷이다.) <code>sf</code> 객체는 최소한 하나 이상의 <code>sfc</code> 클래스 지오메트리 <em>리스트 열</em>(list-column)을 포함하며, 이 리스트 열의 각 요소는 <code>sfg</code> 클래스의 R 객체로서 지오메트리 정보를 담고 있다. 지오메트리 리스트 열은 <code>data.frame</code>이나 티블 내에서 변수처럼 작동하지만, 숫자형이나 문자형 변수와 같은 기본 벡터보다 복잡한 구조를 갖는다(부록 B.3 참조).</p>
<p><code>sf</code> 객체는 다음과 같은 메타데이터를 가진다.</p>
<ul>
<li><p>(활성화된) 지오메트리 열의 이름: <code>sf_column</code> 속성에 저장됨.</p></li>
<li><p>각 비기하 변수의 속성-지오메트리 관계(5.1절 참조): <code>agr</code> 속성에 저장됨.</p></li>
</ul>
<p><code>sfc</code> 지오메트리 리스트 열은 <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry()</a></code> 함수를 통해 <code>sf</code> 객체에서 추출할 수 있으며, 다음과 같은 메타데이터를 가진다</p>
<ul>
<li><p>좌표참조계(CRS): <code>crs</code> 속성에 저장됨.</p></li>
<li><p>바운딩 박스(bounding box): <code>bbox</code> 속성에 저장됨.</p></li>
<li><p>정밀도: <code>precision</code> 속성에 저장됨.</p></li>
<li><p>지오메트리 수: <code>n_empty</code> 속성에 저장됨.</p></li>
</ul>
<p>이러한 속성들의 값을 확인하거나 수정하기 위해 <code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_set_crs()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_agr.html">st_agr()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_agr.html">st_set_agr()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_precision.html">st_precision()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_precision.html">st_set_precision()</a></code> 등의 함수를 사용할 수 있다.</p>
<section id="객체-생성" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="객체-생성">
<span class="header-section-number">7.1.1</span> 객체 생성</h3>
<p>다음과 같은 방법으로 <code>sf</code> 객체를 생성할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co"># Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.35</span>, <span class="fl">52.42</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.22</span>, <span class="fl">52.18</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.44</span>, <span class="fl">52.19</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">'OGC:CRS84'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span>elev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">33.2</span>, <span class="fl">52.1</span>, <span class="fl">81.2</span><span class="op">)</span>, </span>
<span>      marker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Id01"</span>, <span class="st">"Id02"</span>, <span class="st">"Id03"</span><span class="op">)</span>, geom <span class="op">=</span> <span class="va">sfc</span><span class="op">)</span></span>
<span><span class="co"># Simple feature collection with 3 features and 2 fields</span></span>
<span><span class="co"># Geometry type: POINT</span></span>
<span><span class="co"># Dimension:     XY</span></span>
<span><span class="co"># Bounding box:  xmin: 7.22 ymin: 52.2 xmax: 7.44 ymax: 52.4</span></span>
<span><span class="co"># Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#   elev marker              geom</span></span>
<span><span class="co"># 1 33.2   Id01 POINT (7.35 52.4)</span></span>
<span><span class="co"># 2 52.1   Id02 POINT (7.22 52.2)</span></span>
<span><span class="co"># 3 81.2   Id03 POINT (7.44 52.2)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/images/sf_obj.png" class="lightbox" data-glightbox="description: .lightbox-desc-1" data-gallery="quarto-lightbox-gallery-1"><img src="https://r-spatial.org/book/images/sf_obj.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.1: <code>sf</code> 객체의 구조
</figcaption></figure>
</div>
<p>그림 7.1은 출력된 구성 요소에 대한 설명을 보여준다. 객체를 처음부터 생성하는 경우도 있지만, R에서의 공간데이터는 대체로 외부 소스에서 읽어온다. 이러한 외부 소스에는 다음과 같은 것들이 있다.</p>
<ul>
<li><p>외부 파일</p></li>
<li><p>데이터베이스 내의 테이블(또는 테이블 집합)</p></li>
<li><p>웹서비스 호출을 통해 획득한 데이터셋</p></li>
<li><p>R 패키지에 포함된 데이터셋</p></li>
</ul></section><section id="읽기와-쓰기" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="읽기와-쓰기">
<span class="header-section-number">7.1.2</span> 읽기와 쓰기</h3>
<p>외부 ‘데이터 소스’(파일, 웹서비스, 문자열 등)에서 데이터셋을 읽어올 때는 <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read()</a></code> 함수를 사용한다.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"gpkg/nc.gpkg"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] "/home/edzer/R/x86_64-pc-linux-gnu-library/4.3/sf/gpkg/nc.gpkg"</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span><span class="co"># Reading layer `nc.gpkg' from data source </span></span>
<span><span class="co">#   `/home/edzer/R/x86_64-pc-linux-gnu-library/4.3/sf/gpkg/nc.gpkg' </span></span>
<span><span class="co">#   using driver `GPKG'</span></span>
<span><span class="co"># Simple feature collection with 100 features and 14 fields</span></span>
<span><span class="co"># Geometry type: MULTIPOLYGON</span></span>
<span><span class="co"># Dimension:     XY</span></span>
<span><span class="co"># Bounding box:  xmin: -84.3 ymin: 33.9 xmax: -75.5 ymax: 36.6</span></span>
<span><span class="co"># Geodetic CRS:  NAD27</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>여기서 사용된 파일 이름과 경로는 <strong>sf</strong> 패키지에 포함된 데이터를 가리키며, 이는 <strong>sf</strong> 패키지를 설치하는 과정에서 설정되므로 어떤 컴퓨터에서든 예외 없이 읽을 수 있다.</p>
<p><code><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read()</a></code> 함수는 두 개의 인수, 즉 <em>데이터 소스 이름</em>(<code>dsn</code>)과 <em>레이어</em>(layer)를 가진다. 위의 예에서 사용된 <em>지오패키지</em>(GPKG) 파일은 단일 레이어만 포함하고 있으며, 해당 레이어가 불러와진 것이다. 만약 여러 레이어가 포함되어 있었다면, 첫 번째 레이어가 읽히고 경고 메시지가 출력되었을 것이다. 데이터셋에서 사용 가능한 레이어 목록은 다음과 같이 조회할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html">st_layers</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span><span class="co"># Driver: GPKG </span></span>
<span><span class="co"># Available layers:</span></span>
<span><span class="co">#   layer_name geometry_type features fields crs_name</span></span>
<span><span class="co"># 1    nc.gpkg Multi Polygon      100     14    NAD27</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>심플 피처 객체는 <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write()</a></code> 함수를 사용하여 저장할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">file</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".gpkg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] "/tmp/Rtmpm9lGRF/file361e653fae4a9.gpkg"</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write</a></span><span class="op">(</span><span class="va">nc</span>, <span class="va">file</span>, layer <span class="op">=</span> <span class="st">"layer_nc"</span><span class="op">)</span></span>
<span><span class="co"># Writing layer `layer_nc' to data source </span></span>
<span><span class="co">#   `/tmp/Rtmpm9lGRF/file361e653fae4a9.gpkg' using driver `GPKG'</span></span>
<span><span class="co"># Writing 100 features with 14 fields and geometry type Multi Polygon.</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>여기서 파일 형식(GPKG)은 파일 이름 확장자에서 결정된다. <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write()</a></code> 함수의 <code>append</code> 인수를 설정하면 기존 레이어에 레코드를 추가하거나, 기존 레이어를 교체할 수 있다. <code>append</code> 인수가 설정되지 않은 상태에서 동일한 레이어가 이미 존재하면 오류가 발생한다. 타이디버스 스타일의 <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf()</a></code> 함수는 <code>append</code>가 설정되지 않은 경우에도 오류 없이 레이어를 교체한다. 또한, <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_delete()</a></code> 함수를 사용하면 레이어를 삭제할 수 있으며, 이는 특히 데이터베이스의 테이블과 연결된 레이어를 다룰 때 유용하다.</p>
<p>WKT-2 좌표참조계를 지원하는 파일 형식의 경우, <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read()</a></code>와 <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write()</a></code>를 통해 이를 읽고 쓸 수 있다. 그러나 <code>csv</code>와 같은 간단한 포맷에서는 이 기능이 지원되지 않는다. 셰이프파일(shapefile) 형식은 CRS 인코딩에 매우 제한적인 지원만 제공한다.(역자주: 셰이프파일은 ESRI가 개발한 벡터 데이터 포맷으로, 현재 가장 널리 사용되는 형식 중 하나이다.)</p>
</section><section id="서브세팅" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="서브세팅">
<span class="header-section-number">7.1.3</span> 서브세팅</h3>
<p>매우 일반적인 작업 중 하나는 객체의 일부를 추출하는 것인데 이를 서브세팅(subsetting)이라고 한다. 베이스 R에서는 이를 위해 대괄호 기호(<code>[]</code>)를 사용한다. <code>data.frame</code> 객체에 적용되는 규칙을 <code>sf</code> 객체에도 동일하게 적용할 수 있다. 예를 들어, 다음 같은 코드를 사용하면 레코드 2~5와 열 3~7을 선택할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>여기에 몇몇 옵션을 부가적으로 적용할 수 있다.</p>
<ul>
<li><p><code>drop</code> 인수는 기본값이 <code>FALSE</code>로 설정되어 있어, 지오메트리 열이 <em>항상</em> 선택되며 <code>sf</code> 객체가 반환된다. <code>TRUE</code>로 설정하면, 지오메트리 열이 선택되지 <em>않은</em> 경우 해당 열이 제거된 <code>data.frame</code>이 반환된다.</p></li>
<li><p>공간(<code>sf</code>, <code>sfc</code>, <code>sfg</code>) 객체를 첫 번째 인수로 사용하여 선택하면, 해당 객체와 공간적으로 <em>교차</em>하는 피처가 선택된다(다음 절 참조). 다른 프레디케이트를 사용하려면 <code>op</code> 인수를 설정하여 <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_covers()</a></code>와 같은 함수나 3.2.2절에 나열된 다른 이항 프레디케이트 함수를 지정할 수 있다.</p></li>
</ul></section><section id="이항-프레디케이트" class="level3" data-number="7.1.4"><h3 data-number="7.1.4" class="anchored" data-anchor-id="이항-프레디케이트">
<span class="header-section-number">7.1.4</span> 이항 프레디케이트</h3>
<p><code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_covers()</a></code>와 같은 이항 프레디케이트 함수(3.2.2절 참조)는 두 개의 피처 집합 또는 피처 지오메트리를 입력받아, 모든 쌍에 대해 조건이 <code>TRUE</code>인지 <code>FALSE</code>인지를 반환한다. 대규모 집합의 경우, 이러한 연산은 일반적으로 대부분이 <code>FALSE</code> 값으로 채워진 거대한 행렬을 생성하게 되며, 이 때문에 기본적으로 희소 표현(sparse representation)이 반환된다.(역자주: 희소 표현은 메모리 사용을 최적화하고 데이터 처리를 더욱 효율적으로 하는 방식으로, 일반적으로 <code>TRUE</code> 값만을 저장하고 <code>FALSE</code> 값은 저장하지 않는다.)</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc5</span> <span class="op">&lt;-</span> <span class="va">nc</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="va">nc7</span> <span class="op">&lt;-</span> <span class="va">nc</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="op">]</span></span>
<span><span class="op">(</span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span><span class="va">nc5</span>, <span class="va">nc7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Sparse geometry binary predicate list of length 5, where the</span></span>
<span><span class="co"># predicate was `intersects'</span></span>
<span><span class="co">#  1: 1, 2</span></span>
<span><span class="co">#  2: 1, 2, 3</span></span>
<span><span class="co">#  3: 2, 3</span></span>
<span><span class="co">#  4: 4, 7</span></span>
<span><span class="co">#  5: 5, 6</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-fig57-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-2" data-gallery="quarto-lightbox-gallery-2"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-fig57-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.2: 노스케롤라이나의 처음 일곱개 카운티
</figcaption></figure>
</div>
<p>그림 7.2는 처음 다섯 개 카운티와 처음 일곱 개 카운티 간의 교차을 이해하는 방법을 보여준다. 다음과 같은 방법으로 희소 논리 행렬을 조밀한 행렬(dense matrix)로 변환할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="co">#       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]</span></span>
<span><span class="co"># [1,]  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE</span></span>
<span><span class="co"># [2,]  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</span></span>
<span><span class="co"># [3,] FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE</span></span>
<span><span class="co"># [4,] FALSE FALSE FALSE  TRUE FALSE FALSE  TRUE</span></span>
<span><span class="co"># [5,] FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>nc5</code>의 각 카운티와 교차하는 <code>nc7</code> 카운티의 개수는 다음과 같이 계산할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="co"># [1] 2 3 2 2 2</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>역으로 <code>nc7</code>의 개별 카운티와 교차하는 <code>nc5</code>의 카운티의 개수는 다음과 같이 계산할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] 2 3 2 1 1 1 1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>객체 <code>i</code> 가 <code>sgbp</code>(sparse geometrical binary predicate) 클래스의 한 객체라고 할 때, 객체 <code>i</code>는 정수 벡터의 리스트로 표현되며, 이 리스트의 각 요소는 논리 프레디케이트 행렬의 한 행을 나타낸다. 논리 프레디케이트 행렬은 해당 행에 대해 <code>TRUE</code> 값을 갖는 열의 인덱스를 저장한다. 이 객체에는 사용된 프레디케이트와 총 열 수 등의 메타데이터도 포함된다. <code>sgbp</code> 객체에 적용할 수 있는 메서드에는 다음과 같은 것들이 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"sgbp"</span><span class="op">)</span></span>
<span><span class="co">#  [1] as.data.frame as.matrix     coerce        dim          </span></span>
<span><span class="co">#  [5] initialize    Ops           print         show         </span></span>
<span><span class="co">#  [9] slotsFromS3   t            </span></span>
<span><span class="co"># see '?methods' for accessing help and source code</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>sgbp</code> 클래스 객체에서 사용 가능한 유일한 <code>Ops</code> 메서드는 <code>!</code>(부정 연산자)이다.</p>
</section><section id="타이디버스-패키지" class="level3" data-number="7.1.5"><h3 data-number="7.1.5" class="anchored" data-anchor-id="타이디버스-패키지">
<span class="header-section-number">7.1.5</span> 타이디버스 패키지</h3>
<p><strong>tidyverse</strong> 패키지는 다양한 데이터사이언스 패키지를 함께 로드한다(Wickham and Grolemund 2017; Wickham et al.&nbsp;2019). <strong>sf</strong> 패키지는 <strong>tidyverse</strong> 스타일의 읽기 및 쓰기 함수인 <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code>와 <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf()</a></code>를 제공하며, 이 함수들은 다음과 같은 특징을 가진다.</p>
<ul>
<li><p><code>data.frame</code> 대신 <code>tibble</code>을 반환한다.</p></li>
<li><p>출력 내용을 콘솔에 인쇄하지 않는다.</p></li>
<li><p>기본적으로 기본 데이터를 덮어쓴다.</p></li>
</ul>
<p><code>sf</code> 객체에는 <strong>tidyverse</strong> 패키지의 <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/spread.html">spread()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/nest.html">nest()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/separate_rows.html">separate_rows()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_frac()</a></code>등의 함수를 적용할 수 있다. 대부분의 함수는 <code>sf</code> 객체의 메타데이터만 처리하며, 지오메트리 정보는 변경하지 않는다. 사용자가 지오메트리를 제거하려면, <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry()</a></code> 함수를 사용하거나, 선택 작업 전에 간단히 <code>tibble</code> 또는 <code>data.frame</code>으로 강제 변환(coerce)하면 된다.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nc</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">BIR74</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 3 × 1</span></span>
<span><span class="co">#   BIR74</span></span>
<span><span class="co">#   &lt;dbl&gt;</span></span>
<span><span class="co"># 1  1091</span></span>
<span><span class="co"># 2   487</span></span>
<span><span class="co"># 3  3188</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>sf</code> 객체에 대한 <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> 함수에는 두 가지 특별한 인수가 있다</p>
<ul>
<li><p><code>do_union</code>(기본값: <code>TRUE</code>): 그룹화된 지오메트리가 반환될 때 유니언(합집합)할지 여부를 결정하여, 이를 통해 밸리드한 지오메트리가 형성되도록 한다.</p></li>
<li><p><code>is_coverage</code>(기본값: <code>FALSE</code>): 그룹화된 지오메트리가 커버리지(겹침이 없는 경우)를 형성할 때, 이를 <code>TRUE</code>로 설정하면 유니언 과정이 더 빨라진다.</p></li>
</ul>
<p><code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> 함수는 고유한 레코드를 선택하며, <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_equals()</a></code> 함수는 지오메트리의 고유성을 평가한다.</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> 함수는 일반적인 프레디케이트와 함께 사용할 수 있으며, 공간적 프레디케이트를 사용하고자 할 경우 예를 들어 오렌지 카운티에서 50 km 이내에 있는 모든 카운티를 선택하려면 다음과 같이 사용할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">orange</span> <span class="op">&lt;-</span> <span class="va">nc</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Orange"</span><span class="op">)</span></span>
<span><span class="va">wd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_is_within_distance</a></span><span class="op">(</span><span class="va">nc</span>, <span class="va">orange</span>, </span>
<span>                            <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fl">50</span>, <span class="va">km</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">o50</span> <span class="op">&lt;-</span> <span class="va">nc</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">wd</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">o50</span><span class="op">)</span></span>
<span><span class="co"># [1] 17</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(여기서 <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code>를 사용하는 것은 베이스 R의 <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> 함수와의 혼동을 피하기 위함이다.)(역자주: 베이스 R과 패키지, 또는 서로 다른 패키지에서 동일한 이름의 함수를 제공하는 경우, 충돌을 방지하기 위해 <code>패키지명::함수명</code> 형식으로 함수를 명시한다.)</p>
<p>그림 7.3은 이 분석의 결과를 보여주며, 카운티 경계 주위에 버퍼도 추가되어 있다. 이 버퍼는 설명을 위한 것이며, 카운티를 선택하는 데에는 사용되지는 않았음을 유의하라.</p>
<div id="fig-7-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-orangebuffer-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-3" data-gallery="quarto-lightbox-gallery-3"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-orangebuffer-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.3: 오렌지 카운티(오렌지색), 반경 50 km 내의 카운티(검은색), 오랜지 카운티 주변의 버퍼(갈색), 나머지 카운티(회색)
</figcaption></figure>
</div>
</section></section><section id="공간적-조인" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="공간적-조인">
<span class="header-section-number">7.2</span> 공간적 조인</h2>
<p>일반적인 조인(왼쪽 조인, 오른쪽 조인, 내부 조인)에서는 두 테이블에서 하나 이상의 속성이 매치할 때 <em>조인</em>이 이루어진다. 공간적 조인도 이와 유사하지만, 레코드를 조인하는 기준이 속성의 매치가 아니라 공간적 프레디케이트라는 점이 다르다. 이로 인해 <em>공간적으로</em> 매치하는 레코드를 정의하는 데에는 여러 선택지가 있으며, 이는 3.2.2절에 나열된 이항 프레디케이트를 사용해 결정할 수 있다. ‘왼쪽’, ‘오른쪽’, ‘내부’, ‘전체’ 조인의 개념은 비공간 조인과 동일하게 유지되는데, 이는 공간적 매치를 고려하지 않고 레코드의 조인을 처리할 때 적용된다.(역자주: 왼쪽 조인(left join)은 왼쪽 데이터의 모든 레코드를 유지하고, 오른쪽 데이터와 매치되는 경우 해당 값을 결합한다. 오른쪽 조인(right join)은 오른쪽 데이터의 모든 레코드를 유지하고, 왼쪽 데이터와 매치되는 경우 해당 값을 결합한다. 내부 조인(Inner join)은 양쪽 데이터 모두에서 매치되는 레코드만 결합한다. 전체 조인(full join)은 양쪽 데이터의 모든 레코드를 유지하며, 매치되지 않는 값은 결측값(NA)으로 채운다.)</p>
<p>공간적 조인을 실행할 때, 각 레코드에 여러 일치하는 레코드가 존재할 수 있으므로 결과 테이블이 매우 커질 수 있다. 이러한 복잡성을 줄이는 방법 중 하나는, 일치하는 레코드 가운데 타깃 지오메트리와 가장 넓은 면적이 겹치는 레코드 하나만 선택하는 것이다. 이 방법의 시각적 예시는 그림 7.4에 나와 있으며, <code><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join()</a></code> 함수에서 <code>largest = TRUE</code> 인수를 설정해 이를 수행할 수 있다.</p>
<div id="fig-7-4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-largest-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-4" data-gallery="quarto-lightbox-gallery-4"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-largest-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.4: <code>largest = TRUE</code> 인수를 적용한 <code><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join()</a></code> 함수의 예시. 아래쪽 그림의 폴리곤과 가장 넓은 면적이 겹치는 위쪽 그림의 폴리곤 라벨이 아래쪽 폴리곤에 할당되어 있다.
</figcaption></figure>
</div>
<p>결과의 복잡성을 줄이는 또 다른 방법은 조인 후에 <code>aggregate</code> 함수를 사용하여 모든 일치하는 레코드를 결합함과 동시에 지오메트리도 병합하는 것이다. 이에 대한 자세한 내용은 5.4절을 참고하라.</p>
<section id="표본추출-그리드-생성-내삽" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="표본추출-그리드-생성-내삽">
<span class="header-section-number">7.2.1</span> 표본추출, 그리드 생성, 내삽</h3>
<p><strong>sf</strong> 패키지가 제공하는 몇 가지 유용한 함수를 소개한다. <code><a href="https://r-spatial.github.io/sf/reference/st_sample.html">st_sample()</a></code> 함수는 대상 지오메트리로부터 임의의 표본 포인트를 생성하며, 여기서 대상 지오메트리는 포인트, 라인, 폴리곤 등 다양할 수 있다. 표본추출 방식은 완전 무작위 방식, 규칙적 방식, 또는 폴리곤의 경우 삼각형 방식 중 선택할 수 있다. 11장에서 <strong>spatstat</strong> 패키지가 제공하는 공간적 표본추출(또는 포인트패턴 시뮬레이션) 방법이 <code><a href="https://r-spatial.github.io/sf/reference/st_sample.html">st_sample()</a></code> 함수를 통해 어떻게 구현되는지 설명한다.</p>
<p><code><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid()</a></code> 함수는 특정 영역 위에 정사각형, 직사각형, 또는 육각형의 그리드를 생성한다. 옵션 설정에 따라 그리드 자체가 아닌 그리드의 중심점이나 모서리점을 생성할 수도 있다. 이 함수는 그림 7.4에서 직사각형 그리드를 생성하는 데 사용되었다.</p>
<p>함수 <code><a href="https://r-spatial.github.io/sf/reference/interpolate_aw.html">st_interpolate_aw()</a></code> 함수는 5.3절에서 설명한 바와 같이, 공간 내포 변수와 공간 외연 변수를 새로운 구역으로 ’내삽’하는 기능을 제공한다.</p>
</section></section><section id="타원체-좌표" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="타원체-좌표">
<span class="header-section-number">7.3</span> 타원체 좌표</h2>
<p>비투영 데이터는 경위도로 표현된 타원체 좌표를 가진다. 4.1절에서 설명한 바와 같이, 포인트 간의 ’직선’은 최단 곡선 경로인 ’측지선(geodesic line)’이다. 기본적으로 <strong>sf</strong> 패키지는 s2geometry 라이브러리를 사용해 기하학적 연산을 수행하며, 이는 <strong>s2</strong> 패키지를 통해 구현된다(Dunnington, Pebesma, and Rubak 2023).</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">"POINT(50 50.1)"</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"OGC:CRS84"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pt</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>예를 들어, 아래의 지점은 특정 폴리곤 <em>내부</em>에 위치한다(그림 7.5의 왼쪽: 정사 도법).</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">"POLYGON((40 40, 60 40, 60 50, 40 50, 40 40))"</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"OGC:CRS84"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span><span class="va">pt</span>, <span class="va">pol</span><span class="op">)</span></span>
<span><span class="co"># Sparse geometry binary predicate list of length 1, where the</span></span>
<span><span class="co"># predicate was `intersects'</span></span>
<span><span class="co">#  1: 1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-5" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-figs2-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-5" data-gallery="quarto-lightbox-gallery-5"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-figs2-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.5: 교차의 결과는 측지선 혹은 대권호를 사용하느냐(왼쪽) 데카르트 좌표계를 사용하느냐에 따라 달라진다.
</figcaption></figure>
</div>
<p><strong>sf</strong> 패키지가 타원체 좌표를 마치 데카르트 좌표처럼 처리하도록 하려면, <strong>s2</strong> 사용을 비활성화하면 된다.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Spherical geometry (s2) switched off</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span><span class="va">pol</span>, <span class="va">pt</span><span class="op">)</span></span>
<span><span class="co"># although coordinates are longitude/latitude, st_intersects assumes</span></span>
<span><span class="co"># that they are planar</span></span>
<span><span class="co"># Sparse geometry binary predicate list of length 1, where the</span></span>
<span><span class="co"># predicate was `intersects'</span></span>
<span><span class="co">#  1: (empty)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span> <span class="co"># restore</span></span>
<span><span class="co"># Spherical geometry (s2) switched on</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이렇게 하면 그림 7.5의 오른쪽(정거원통 도법)처럼, 엠프티 교차가 반환된다. 경고 메시지에는 타원체 좌표를 평면좌표으로 취급하고 있다는 내용이 명시된다.</p>
<p><strong>s2</strong> 사용은 성능상의 이유나 레거시 구현과의 호환성을 위해 비활성화할 수 있다. 데카르트 기하를 위한 <code>GEOS</code> 라이브러리와 구체 기하를 위한 s2geometry 라이브러리(그림 1.7)는 서로 다른 동기로 개발되었으며, <strong>sf</strong> 패키지를 통해 사용될 때 몇 가지 차이가 있다.</p>
<ul>
<li><p>특정 연산에서 속도 차이가 크게 발생할 수 있다.</p></li>
<li><p>일부 함수는 특정 라이브러리에만 존재한다(예를 들어 <code><a href="https://r-spatial.github.io/sf/reference/st_relate.html">st_relate()</a></code> 함수는 GEOS 라이브러리에만 존재)</p></li>
<li><p>변환자를 사용할 때, GEOS는 외부 폴리곤 링을 시계 방향으로 노드로 반환하며, 이를 반시계 방향으로 되돌리기 위해 <code>st_sfc(..., check_ring_dir = TRUE)</code>를 사용한다. 반면, s2geometry는 외부 폴리곤 링을 반시계 방향으로 반환한다.</p></li>
</ul></section><section id="stars-패키지" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="stars-패키지">
<span class="header-section-number">7.4</span> stars 패키지</h2>
<p><strong>sp</strong> 패키지가 래스터 데이터 지원 측면에서 정체되어 있는 동안, <strong>raster</strong> 패키지(Hijmans 2023a)는 지난 10여년간 래스터 분석을 위한 강력하고 유연하며 확장 가능한 패키지로서 지배적인 위치를 공고히 해왔다. <strong>raster</strong> 패키지(및 그 후속인 <strong>terra</strong> 패키지(Hijmans 2023b))는 2차원 규칙 래스터 또는 래스터 레이어 집합(‘래스터 스택’)이라는 래스터 데이터 모형에 기반한다. 이러한 모형은 세상이 수많은 레이어로 구성되어 있고, 각 레이어가 특정 주제를 반영한다는 고전적인 정적 ’GIS 뷰’와 일치한다. 그러나 오늘날의 많은 데이터는 동적이며, 시계열 래스터 또는 시계열 래스터 스택의 형태로 제공된다. 기존의 래스터 스택은 이러한 동적 특성을 제대로 반영하지 못하며, 사용자가 각 레이어가 무엇을 나타내는지 별도로 기록해야 한다.</p>
<p>또한, <strong>raster</strong> 패키지와 그 후속인 <strong>terra</strong> 패키지는 데이터 크기가 로컬 저장소(컴퓨터의 하드 드라이브)보다 크지 않을 때에만 우수한 연산 성능을 발휘한다. 그러나 최근의 데이터셋—예를 들어 위성 이미지, 기후 모형, 기상 예보 데이터—은 로컬 저장소의 용량으로는 더 이상 감당하기 어려운 수준에 도달했다(9장 참조). <strong>spacetime</strong> 패키지(Pebesma 2012, 2022)는 벡터 지오메트리 또는 래스터 그리드 셀의 시계열 분석을 어느 정도 지원하지만, 더 높은 차원의 어레이나 메모리가 한계를 넘어서는 대규모 데이터셋은 여전히 처리하기 어렵다.</p>
<p>여기서는 래스터 및 벡터 데이터 큐브 분석을 위한 패키지로 <strong>stars</strong>를 소개한다. 이 패키지는 다음과 같은 기능을 제공한다.</p>
<ul>
<li><p>동적(시간 변화) 래스터 스택을 재현할 수 있다.</p></li>
<li><p>로컬 디스크 용량에 제한받지 않는 확장성을 목표로 한다.</p></li>
<li><p>GDAL 라이브러리의 래스터 기능과 강력하게 통합된다.</p></li>
<li><p>규칙 그리드 뿐만 아니라 회전형, 전단형, 직선형, 곡선형 래스터도 처리할 수 있다(그림 1.6 참조).</p></li>
<li><p><strong>sf</strong> 패키지와 긴밀하게 통합된다.</p></li>
<li><p>비래스터 공간 디맨션을 가진 어레이 데이터(벡터 데이터 큐브)를 처리할 수 있다.</p></li>
<li><p>타이디버스 디자인 원리를 따른다.</p></li>
</ul>
<p>벡터 데이터 큐브에는 심플 피처의 시계열이나 출발지-목적지 매트릭스(및 그 시계열)를 포함한 공간 그래프 데이터가 포함된다. 공간적 벡터 및 래스터 데이터 큐브의 개념은 6장에서 설명되었다. 불규칙 시공간 관측치는 <strong>sftime</strong> 패키지(Teickner, Pebesma, and Graeler 2022)에서 제공하는 <code>sftime</code> 객체로 재현할 수 있으며, 이는 시간 열을 추가하는 방식으로 <code>sf</code> 객체를 확장한 것이다(13.3절 참조).</p>
<section id="래스터-데이터의-읽기와-쓰기" class="level3" data-number="7.4.1"><h3 data-number="7.4.1" class="anchored" data-anchor-id="래스터-데이터의-읽기와-쓰기">
<span class="header-section-number">7.4.1</span> 래스터 데이터의 읽기와 쓰기</h3>
<p>래스터 데이터는 일반적으로 파일에서 불러온다. 여기서는 브라질의 올린다 시에 대한 30 m 해상도의 Landsat 7 데이터셋(밴드 1~5 및 7번)을 사용한다. <strong>stars</strong> 패키지에서 규칙 비회전 그리드에 대한 예제 GeoTIFF 파일을 읽어올 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"tif/L7_ETMs.tif"</span>, package <span class="op">=</span> <span class="st">"stars"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span></span>
<span><span class="co"># Loading required package: abind</span></span>
<span><span class="op">(</span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="va">tif</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     1      54     69 68.9      86  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x       1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>여기서 우리는 오프셋, 셀 크기, 좌표참조계, 그리고 디멘션을 확인할 수 있다. 디멘션 테이블은 각 디멘션에 대해 다음과 같은 필드를 포함한다.</p>
<ul>
<li><p><code>from</code>: 시작 인덱스 값</p></li>
<li><p><code>to</code>: 종료 인덱스 값</p></li>
<li><p><code>offset</code>: 첫 번째 픽셀의 시작(모서리)에서의 디멘션 값</p></li>
<li><p><code>delta</code>: 셀 크기로 음의 값은 디멘션 값이 감소할수록 픽셀 인덱스 값이 증가함을 의미</p></li>
<li><p><code>refsys</code>: 참조계</p></li>
<li><p><code>point</code>: 셀 값이 포인트 서포트인지, 셀 서포트인지를 나타내는 논리 값</p></li>
<li><p><code>x/y</code>: 디멘션이 래스터의 x축과 관련되는지, y축과 관련되는지를 나타내는 값</p></li>
</ul>
<p>여기에는 사용되지 않기 때문에 숨겨진 또 다른 필드인 <code>values</code>가 있다. 규칙, 회전형, 또는 전단형 그리드와 같이 일정하게 이산화된 디멘션(예: 시간)의 경우, <code>offset</code>과 <code>delta</code>는 <code>NA</code>가 아니다. 반면 불규칙하게 이산화된 디멘션의 경우에는 <code>offset</code>과 <code>delta</code>가 <code>NA</code>이며, <code>values</code> 속성에는 다음 중 하나가 포함된다.</p>
<ul>
<li><p>값 또는 구간의 시퀀스: 직선형 공간 래스터 또는 불규칙 시간 디멘션의 경우</p></li>
<li><p>공간 디멘션과 연결된 지오메트리: 벡터 데이트 큐브의 경우</p></li>
<li><p>각 래스터 셀에 대한 좌표값이 포함된 매트릭스: 곡선형 래스터의 경우</p></li>
<li><p>디멘션 값과 연결된 밴드 이름 또는 레이블: 이산형 디멘션의 경우</p></li>
</ul>
<p><code>stars</code> 클래스 객체 <code>r</code>은 길이 1의 단순 리스트로 구성되어 있으며, 3차원 어레이를 포함한다.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co"># [1] 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">r</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># [1] "array"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">r</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#    x    y band </span></span>
<span><span class="co">#  349  352    6</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>또한 이 객체는 어레이 디멘션이 무엇을 나타내는지 파악하는 데 필요한 모든 메타데이터를 포함한 디멘션 테이블을 속성으로 가진다. 이는 다음을 통해 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다음과 같은 방법으로 어레이의 공간적 범위를 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#    xmin    ymin    xmax    ymax </span></span>
<span><span class="co">#  288776 9110729  298723 9120761</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://r-spatial.github.io/stars/reference/write_stars.html">write_stars()</a></code> 함수를 사용하여 래스터 데이터를 로컬 디스크에 저장할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/write_stars.html">write_stars</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">tf</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>파일 확장자를 통해 데이터 형식(이 경우 GeoTIFF)이 지정된다. 심플 피처와 마찬가지로 읽기 및 쓰기 작업은 GDAL 라이브러리를 사용하며, 래스터 데이터에 사용할 수 있는 드라이버 목록은 다음과 같이 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_drivers.html">st_drivers</a></span><span class="op">(</span><span class="st">"raster"</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="stars-데이터-큐브의-서브세팅" class="level3" data-number="7.4.2"><h3 data-number="7.4.2" class="anchored" data-anchor-id="stars-데이터-큐브의-서브세팅">
<span class="header-section-number">7.4.2</span> <code>stars</code> 데이터 큐브의 서브세팅</h3>
<p>데이터 큐브는 <code>[]</code> 연산자를 사용하거나 타이디버스 동사를 사용하여 서브세팅할 수 있다. 첫 번째 방식인 <code>[]</code> 연산자를 사용할 때는 다음 인수를 쉼표로 구분하여 순서대로 지정한다.</p>
<ul>
<li><p>속성: 이름, 인덱스, 또는 논리 벡터</p></li>
<li><p>디멘션</p></li>
</ul>
<p>예를 들어, <code>r[1:2, 101:200, , 5:10]</code>는 <code>r</code>에서 속성 1~2를 선택하고, 디멘션 1에 대해 인덱스 101~200, 차원 3에 대해 인덱스 5~10을 선택함을 의미한다. 이 경우 디멘션 2를 통한 선택은 이루어지지 않는다. 속성 선택 시에는 속성 이름, 인덱스, 또는 논리 벡터를 사용할 수 있다. 디멘션 선택 시에는 논리 벡터가 지원되지 않는다. 불연속 범위 선택은 규칙 시퀀스일 때만 가능하다. <code>drop</code>는 기본값이 <code>FALSE</code>이며, <code>TRUE</code>로 설정하면 단일 값을 가진 디멘션은 모두 제거된다.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">r</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">250</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#    x    y band </span></span>
<span><span class="co">#  100   50    1</span></span>
<span><span class="va">r</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">250</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fl">4</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#   x   y </span></span>
<span><span class="co"># 100  50</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>특정 범위의 디멘션 <em>값</em>을 선택하려면 <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> 함수를 사용할 수 있으며, 이를 위해서는 <strong>dplyr</strong> 패키지를 먼저 로드해야 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">289000</span>, <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">290000</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     5      51     63 64.3      75  242</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x       1  35  289004  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1   6       1     1                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이는 차원의 오프셋을 변경한다. 특정 큐브 슬라이스는 <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> 함수를 사용하여 얻을 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">band</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif    21      49     63 64.4      77  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#   from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x    1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y    1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이는 단일 디멘션인 <code>band</code>를 제거한다. <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> 함수는 <code>stars</code> 객체에서 기존 어레이를 기반으로 새로운 어레이를 추가하는 데 사용되며, <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute()</a></code> 함수는 여기에 더해 기존 어레이를 제거한다.</p>
</section><section id="크로핑" class="level3" data-number="7.4.3"><h3 data-number="7.4.3" class="anchored" data-anchor-id="크로핑">
<span class="header-section-number">7.4.3</span> 크로핑</h3>
<p>일부를 추출하는 또 다른 방법으로, <code>sf</code>, <code>sfc</code> 또는 <code>bbox</code> 클래스의 공간 객체를 사용하는 방법이 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fl">500</span>, <span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">r</span><span class="op">[</span><span class="va">b</span><span class="op">]</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max. NA's</span></span>
<span><span class="co"># L7_ETMs.tif    22      54     66 67.7    78.2  174 2184</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x     157 193  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y     159 194 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>예를 들어, 해당 지역에 대한 직경 500 m의 원형 중심부를 추출할 수 있으며, 그림 7.6은 이를 첫 번째 밴드에 적용한 결과를 보여준다.</p>
<div id="fig-7-6" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-circr-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-6" data-gallery="quarto-lightbox-gallery-6"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-circr-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.6: Landsat 7의 1번 밴드 이미지의 원형 중심부
</figcaption></figure>
</div>
<p>원형 공간 객체의 외부에 위치한 픽셀에는 <code>NA</code> 값이 할당되는 것을 확인할 수 있다. 이 원형 객체는 여전히 <code>r</code>의 <code>offset</code>과 <code>delta</code> 값에 대한 디멘션 인덱스를 가지고 있다. 다음과 같은 방법으로 <code>offset</code> 값을 재설정할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">r</span><span class="op">[</span><span class="va">b</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_normalize.html">st_normalize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#      from to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x       1 37  293222  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 36 9116258 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1  6      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>기본적으로 결과 래스터는 선택 객체의 범위로 크로핑(cropping, 자르기)된다. 입력 객체와 동일한 디멘션을 가진 객체는 다음과 같은 방식으로 얻을 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">r</span><span class="op">[</span><span class="va">b</span>, crop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.   NA's</span></span>
<span><span class="co"># L7_ETMs.tif    22      54     66 67.7    78.2  174 731280</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x       1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>stars</code> 객체의 크로핑은 <code><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop()</a></code> 함수를 사용해 직접 수행할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">b</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="stars-객체의-디멘션-재설정-및-결합" class="level3" data-number="7.4.4"><h3 data-number="7.4.4" class="anchored" data-anchor-id="stars-객체의-디멘션-재설정-및-결합">
<span class="header-section-number">7.4.4</span> <code>stars</code> 객체의 디멘션 재설정 및 결합</h3>
<p><strong>stars</strong> 패키지는 다양한 어레이 조작을 수행하기 위해 <strong>abind</strong> 패키지(Plate and Heiberger 2016)를 사용한다. 예를 들어, 어레이를 순열하여 전치하는 <code><a href="https://rdrr.io/r/base/aperm.html">aperm()</a></code> 함수가 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     1      54     69 68.9      86  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA    </span></span>
<span><span class="co"># x       1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>stars</code> 객체에 대한 메서드가 제공되며, 이를 통해 결과 객체의 디멘션 순서를 재배열할 수 있다.</p>
<p>속성과 디멘션을 교환할 수도 있으며, 이는 <code><a href="https://rdrr.io/r/base/split.html">split()</a></code>과 <code><a href="https://rdrr.io/r/base/merge.html">merge()</a></code> 함수를 사용해 수행된다.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 6 attributes</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#     Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># X1    47      67     78 79.1      89  255</span></span>
<span><span class="co"># X2    32      55     66 67.6      79  255</span></span>
<span><span class="co"># X3    21      49     63 64.4      77  255</span></span>
<span><span class="co"># X4     9      52     63 59.2      75  255</span></span>
<span><span class="co"># X5     1      63     89 83.2     112  255</span></span>
<span><span class="co"># X6     1      32     60 60.0      88  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#   from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x    1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y    1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">rs</span>, name <span class="op">=</span> <span class="st">"band"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="st">"L7_ETMs"</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#          Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs     1      54     69 68.9      86  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point    values x/y</span></span>
<span><span class="co"># x       1 349  288776  28.5 SIRGAS 2000 / ... FALSE      NULL [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE      NULL [y]</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA X1,...,X6</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/r/base/split.html">split()</a></code> 함수는 밴드 디멘션을 2차원 어레이의 여섯 개 속성으로 분리하며, <code><a href="https://rdrr.io/r/base/merge.html">merge()</a></code> 함수는 그 반대 작업을 수행한다. <code><a href="https://r-spatial.github.io/stars/reference/redimension.html">st_redimension()</a></code> 함수는 단일 어레이 디멘션을 두 개의 새로운 디멘션으로 분할하는 것과 같은 보다 일반적인 작업에 사용된다.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/redimension.html">st_redimension</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">349</span>, y <span class="op">=</span> <span class="fl">352</span>, b1 <span class="op">=</span> <span class="fl">3</span>, b2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 4 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     1      54     69 68.9      86  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#    from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x     1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y     1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># b1    1   3      NA    NA                NA    NA    </span></span>
<span><span class="co"># b2    1   2      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>동일한 디멘션을 가진 여러 개의 <code>stars</code> 객체는 <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> 함수를 사용해 결합할 수 있다. 결합된 어레이는 기본적으로 추가 속성으로 취급되지만, <code>along</code> 인수를 지정하면 새로운 디멘션을 따라 병합할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">r</span>, along <span class="op">=</span> <span class="st">"new_dim"</span><span class="op">)</span></span>
<span><span class="co"># stars object with 4 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s), summary of first 1e+05 cells:</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif    47      65     76 77.3      87  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#         from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x          1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y          1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band       1   6      NA    NA                NA    NA    </span></span>
<span><span class="co"># new_dim    1   2      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 사용 예시는 7.5.2절에서 설명한다.</p>
</section><section id="포인트-샘플추출과-애그리게이션" class="level3" data-number="7.4.5"><h3 data-number="7.4.5" class="anchored" data-anchor-id="포인트-샘플추출과-애그리게이션">
<span class="header-section-number">7.4.5</span> 포인트 샘플추출과 애그리게이션</h3>
<p>래스터 데이터 큐브 분석에서 매우 흔한 작업 중 하나는 특정 위치에서 값을 추출하거나 지정된 지오메트리에 대해 집계값을 계산하는 것이다. <code><a href="https://r-spatial.github.io/stars/reference/st_extract.html">st_extract()</a></code> 함수는 포인트 위치의 값을 추출한다. 여기서는 <code>r</code> 객체의 바운딩 박스 범위 안에서 임의로 선택한 몇 개의 샘플링 포인트에 대해 이 연산을 수행한다.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">115517</span><span class="op">)</span></span>
<span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html">st_sample</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_extract.html">st_extract</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">pts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif    12    41.8     63   61    80.5  145</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#          from to            refsys point</span></span>
<span><span class="co"># geometry    1 20 SIRGAS 2000 / ...  TRUE</span></span>
<span><span class="co"># band        1  6                NA    NA</span></span>
<span><span class="co">#                                           values</span></span>
<span><span class="co"># geometry POINT (293002 ...,...,POINT (290941 ...</span></span>
<span><span class="co"># band                                        NULL</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이는 20개의 포인트와 6개의 밴드를 가진 벡터 데이터 큐브를 생성한다. 시드를 설정하면 반복 실행 시 동일한 샘플을 사용할 수 있다. 따라서 포인트를 무작위로 다시 생성하고자 하는 경우는 시드를 설정하지 않아야 한다.</p>
<p>데이터 큐브에서 정보를 추출하는 또 다른 방법은 집계값을 계산하는 것이다. 이를 수행하는 한 가지 방법은 공간 폴리곤이나 라인에 따라 값을 공간적으로 집계하는 것이다(6.4절 참조). 예를 들어, 그림 1.4(d)에 나타난 세 개의 원 각각에 대해, 여섯 개 밴드에서의 최대 픽셀 값을 계산할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">circles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html">st_sample</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">circles</span>, <span class="va">max</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif    73    94.2    117  121     142  205</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#          from to            refsys point</span></span>
<span><span class="co"># geometry    1  3 SIRGAS 2000 / ... FALSE</span></span>
<span><span class="co"># band        1  6                NA    NA</span></span>
<span><span class="co">#                                           values</span></span>
<span><span class="co"># geometry POLYGON ((2913...,...,POLYGON ((2921...</span></span>
<span><span class="co"># band                                        NULL</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이는 세 개의 지오메트리와 여섯 개의 밴드를 가진 (벡터) 데이터 큐브를 생성한다. 시간 디멘션에 대한 집계는 <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code> 함수의 두 번째 인수로 시간 변수를 지정하여 수행한다. 시간 변수로는 다음과 같은 값들을 사용할 수 있다.</p>
<ul>
<li><p>시간 간격의 시작을 나타내는 타임스탬프 집합</p></li>
<li><p><code><a href="https://r-spatial.github.io/stars/reference/make_intervals.html">make_intervals()</a></code> 함수로 정의된 시간 간격 집합</p></li>
<li><p>‘주’, ‘5일’, ’년’과 같이 기간을 나타내는 문자열</p></li>
</ul></section><section id="예측모형" class="level3" data-number="7.4.6"><h3 data-number="7.4.6" class="anchored" data-anchor-id="예측모형">
<span class="header-section-number">7.4.6</span> 예측모형</h3>
<p><code>R</code>에서의 일반적인 모형 예측 워크플로우는 다음과 같다.</p>
<ul>
<li><p>응답변수와 예측변수(공변량)가 포함된 <code>data.frame</code>을 준비한다.</p></li>
<li><p><code>data.frame</code>을 기반으로 모형 객체를 생성한다.</p></li>
<li><p>모형 객체와 대상 예측변수 값이 포함된 <code>data.frame</code>을 사용하여 <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>함수를 호출한다.</p></li>
</ul>
<p><strong>stars</strong> 패키지는 <code>stars</code> 객체에 대한 <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> 메서드를 제공하며, 이는 위 과정의 마지막 단계를 수행한다. 즉, <code>stars</code> 객체에서 <code>data.frame</code>을 생성한 뒤, <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>를 호출하고, 예측 값으로 다시 <code>stars</code> 객체를 재구성한다.</p>
<p>이 과정을 설명하기 위해, Landsat 데이터셋과 앞에서 추출한 표본 포인트를 이용해, 육지를 바다에서 분리하는 간단한 이진 클래스 예제를 살펴본다. 결과는 그림 7.7에 제시되어 있다.</p>
<div id="fig-7-7" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-rsample-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-7" data-gallery="quarto-lightbox-gallery-7"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-rsample-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.7: 훈련 데이터로 사용된 무작위 표본 포인트: 빨간색은 해양부이고 노란색을 육지부를 나타낸다.
</figcaption></figure>
</div>
<p>이 그림에서 포인트 8, 14, 15, 18, 19는 수부에, 나머지 포인트는 육지부에 위치함을 ‘육안’으로 확인할 수 있다. 선형판별(’최대우도’) 분류기를 적용한 결과, 그림 7.8과 같은 모형 예측 결과를 얻을 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="va">trn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_extract.html">st_extract</a></span><span class="op">(</span><span class="va">rs</span>, <span class="va">pts</span><span class="op">)</span></span>
<span><span class="va">trn</span><span class="op">$</span><span class="va">cls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"land"</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">trn</span><span class="op">$</span><span class="va">cls</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">19</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"water"</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html">lda</a></span><span class="op">(</span><span class="va">cls</span> <span class="op">~</span> <span class="va">.</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">trn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">rs</span>, <span class="va">model</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>여기서는 <code>MASS::</code> 접두사를 사용하여 <strong>MASS</strong> 패키지를 로드하지 않았는데, 이는 <strong>dplyr</strong> 패키지의 <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> 함수를 덮어쓰는 것을 방지하기 위함이다. <code>split</code> 단계는 밴드 디멘션을 속성으로 변환해 예측 변수로 사용하기 위해 필요한 과정이다.</p>
<div id="fig-7-8" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-lda-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-8" data-gallery="quarto-lightbox-gallery-8"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-lda-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.8: 그림 7.7의 훈련 데이터를 기반으로 한 육지부/수부 구분 선형 판별 분류 결과
</figcaption></figure>
</div>
<p>또한, 그림 7.8에 표시된 레이어가 클래스 레이블을 가진 범주형 변수임을 확인할 수 있다.</p>
</section><section id="래스터-데이터-플로팅" class="level3" data-number="7.4.7"><h3 data-number="7.4.7" class="anchored" data-anchor-id="래스터-데이터-플로팅">
<span class="header-section-number">7.4.7</span> 래스터 데이터 플로팅</h3>
<div id="fig-7-9" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-firststars-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-9" data-gallery="quarto-lightbox-gallery-9"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-firststars-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.9: 30 m 해상도의 Landsat 6개 밴드를 90 m로 다운샘플한 결과로 브라질의 올린다의 예시이다.
</figcaption></figure>
</div>
<p>베이스 플롯 함수를 <code>stars</code> 객체에 적용할 수 있으며, <code>plot(r)</code>로 생성된 결과는 그림 7.9에 나타나 있다. 기본 색상 스케일은 회색 톤을 사용하고, 모든 밴드의 데이터 분위수에 맞춰 명암 대비를 조정하는 ’히스토그램 평활화’가 적용된다.(역자주: 히스토그램 평활화는 데이터의 분포를 재조정하여 시각적으로 더 유용하게 하고 세부 사항을 더 잘 드르나게 하는 기법이다. 예를 들어, 어두운 영상에서는 어두운 영역의 픽셀 값이 한쪽에 몰려 있는데, 히스토그램 평활화를 적용하면 이 픽셀 값의 범위를 더 넓게 확장(stretch)시켜 이미지를 더 밝고 선명하게 만들 수 있다.) <code>breaks = "equal"</code>로 설정하면 급폭이 동일한 등간격 분류법이 적용되며, 계급 단절값을 임의로 지정하는 것도 가능하다. 그런데 더 익숙한 시각화 방식은 그림 7.10에 나타난 RGB 또는 폴스(false) 컬러 합성일 것이다.</p>
<div id="fig-7-10" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-starsrgb-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-10" data-gallery="quarto-lightbox-gallery-10"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-starsrgb-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.10: 컬러 합성의 두 가지 예시
</figcaption></figure>
</div>
<p>보다 자세한 사항은 8장에서 다룬다.</p>
</section><section id="래스터-데이터-분석" class="level3" data-number="7.4.8"><h3 data-number="7.4.8" class="anchored" data-anchor-id="래스터-데이터-분석">
<span class="header-section-number">7.4.8</span> 래스터 데이터 분석</h3>
<p><code>stars</code> 객체의 개별 원소에는 수리 함수가 어레이에 직접 적용된다. 이는 사용자가 함수를 호출하여 표현식을 생성할 수 있음을 의미한다.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     0    3.99   4.23 4.12    4.45 5.54</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x       1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA</span></span>
<span><span class="va">r</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     1      62   77.5 77.1    94.9  266</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x       1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>또는 특정 값을 마스킹할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="va">r</span></span>
<span><span class="va">r2</span><span class="op">[</span><span class="va">r</span> <span class="op">&lt;</span> <span class="fl">50</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">r2</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.   NA's</span></span>
<span><span class="co"># L7_ETMs.tif    50      64     75   79      90  255 149170</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x       1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>또는 마스킹을 해제할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">r2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">r2</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     0      54     69   63      86  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x       1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y       1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span>
<span><span class="co"># band    1   6      NA    NA                NA    NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>stars</code> 객체에서는 기본 R의 <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> 함수가 어레이에 동작하는 것처럼, 선택된 어레이 디멘션 단위로 함수를 적용할 수 있다(6.3.3절). 예를 들어, 각 픽셀에 대해 6개 밴드 값의 평균을 계산할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#       Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># mean  25.5    53.3   68.3 68.9      82  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#   from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x    1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y    1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>더 유의미한 함수의 예로는 NDVI(Normalized Difference Vegetation Index, 정규화 식생 지수) 계산이 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ndvi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">b1</span>, <span class="va">b2</span>, <span class="va">b3</span>, <span class="va">b4</span>, <span class="va">b5</span>, <span class="va">b6</span><span class="op">)</span> <span class="op">(</span><span class="va">b4</span> <span class="op">-</span> <span class="va">b3</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">b4</span> <span class="op">+</span> <span class="va">b3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, <span class="va">ndvi</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#         Min. 1st Qu.  Median    Mean 3rd Qu.  Max.</span></span>
<span><span class="co"># ndvi  -0.753  -0.203 -0.0687 -0.0643   0.187 0.587</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#   from  to  offset delta            refsys point x/y</span></span>
<span><span class="co"># x    1 349  288776  28.5 SIRGAS 2000 / ... FALSE [x]</span></span>
<span><span class="co"># y    1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE [y]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>또는 함수를 다음과 같이 정의할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ndvi2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>밴드 수가 많을 경우 이러한 방식은 더 편리하지만, 각 픽셀마다 호출해야 하므로 위에서 정의한 <code>ndvi()</code> 함수보다 훨씬 느리다. 반면 <code>ndvi()</code> 함수는 모든 픽셀이나 큰 픽셀 덩어리에 대해 한 번만 호출하면 된다. 전체 영상에 대해 각 밴드의 평균은 다음과 같이 계산된다.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"band"</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#   band mean</span></span>
<span><span class="co"># 1    1 79.1</span></span>
<span><span class="co"># 2    2 67.6</span></span>
<span><span class="co"># 3    3 64.4</span></span>
<span><span class="co"># 4    4 59.2</span></span>
<span><span class="co"># 5    5 83.2</span></span>
<span><span class="co"># 6    6 60.0</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>결과는 <code>data.frame</code>의 형태로 바로 출력해 볼 수 있을 만큼 작다. 위의 두 예제에서는 전체 디멘션이 모두 사라지지만, 항상 그런 것은 아니다(6.3.2절). 예를 들어, 각 밴드에 대해 세 개의 사분위수를 계산할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"band"</span><span class="op">)</span>, <span class="va">quantile</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif    32    60.8   66.5 69.8    78.8  112</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#          from to        values</span></span>
<span><span class="co"># quantile    1  3 25%, 50%, 75%</span></span>
<span><span class="co"># band        1  6          NULL</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이렇게 하면 세 개의 값으로 이루어진 새로운 디멘션인 <code>quantile</code>이 <em>생성</em>된다. 또는, 각 픽셀에 대해 여섯 개 밴드 값의 세 사분위수를 다음과 같이 계산할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, <span class="va">quantile</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     4      55   69.2 67.2    81.2  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#          from  to  offset delta            refsys point</span></span>
<span><span class="co"># quantile    1   3      NA    NA                NA    NA</span></span>
<span><span class="co"># x           1 349  288776  28.5 SIRGAS 2000 / ... FALSE</span></span>
<span><span class="co"># y           1 352 9120761 -28.5 SIRGAS 2000 / ... FALSE</span></span>
<span><span class="co">#                 values x/y</span></span>
<span><span class="co"># quantile 25%, 50%, 75%    </span></span>
<span><span class="co"># x                 NULL [x]</span></span>
<span><span class="co"># y                 NULL [y]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="곡선형-래스터" class="level3" data-number="7.4.9"><h3 data-number="7.4.9" class="anchored" data-anchor-id="곡선형-래스터">
<span class="header-section-number">7.4.9</span> 곡선형 래스터</h3>
<p>불규칙 래스터가 발생하는 이유는 다양하다(그림 1.6). 우선, 데이터가 지구의 곡면 형태를 그대로 반영하는 경우, 규칙 래스터는 곡면인 지구의 표면에 정확히 맞지 않는다. 다른 이유로는 다음과 같은 것들이 있다.</p>
<ul>
<li><p>규칙 래스터 데이터를 다른 좌표참조계로 변환하거나 재투영할 때, 워핑(7.8절)을 수행하지 않으면 곡선 형태로 나타난다. 그러나 워핑은 항상 데이터 손실을 수반하며, 이는 가역적이지 않다.</p></li>
<li><p>관측 방식 자체가 불규칙 래스터를 만들어 낼 수 있다. 예를 들어 품질이 낮은 위성 영상의 경우, 위성의 진행 방향에서는 규칙 래스터 형태를 유지 하지만(<span class="math inline">\(x\)</span> 또는 <span class="math inline">\(y\)</span> 축과 정렬되지 않음), 진행 방향과 직각인 방향에서는 직교형 래스터가 된다(예: 센서가 시야<em>각</em>을 일정 간격으로 분할하여 관측하는 경우).</p></li>
</ul></section><section id="gdal-유틸리티" class="level3" data-number="7.4.10"><h3 data-number="7.4.10" class="anchored" data-anchor-id="gdal-유틸리티">
<span class="header-section-number">7.4.10</span> GDAL 유틸리티</h3>
<p>GDAL 라이브러리는 일반적으로 데이터 변환과 처리를 위한 여러 실행 파일, 즉 GDAL 명령줄 유틸리티와 함께 제공된다. 이들 유틸리티 가운데 상당수(Python으로 작성된 것을 제외한 모든 유틸리티)는 ’GDAL Algorithms C API’를 통해 GDAL 라이브러리의 C 함수로도 제공된다. GDAL 라이브러리와 연동된 R 패키지(예: <strong>sf</strong> 패키지)가 이러한 C API 알고리즘을 사용한다면, 사용자는 별도로 GDAL 명령줄 유틸리티를 설치하지 않아도 된다.</p>
<p><strong>sf</strong> 패키지는 <code><a href="https://r-spatial.github.io/sf/reference/gdal_utils.html">gdal_utils()</a></code> 함수를 통해 이러한 C API 알고리즘을 호출할 수 있다. 이때 첫 번째 인수에는 <code>gdal</code> 접두사를 제외한 이름을 지정한다. 주요 명령과 기능은 다음과 같다.</p>
<ul>
<li><p><code>info</code>: GDAL 래스터 데이터셋에 대한 정보를 출력한다.</p></li>
<li><p><code>warp</code>: 래스터를 새로운 래스터로 변환한다(CRS의 전환 포함).</p></li>
<li><p><code>rasterize</code>: 벡터 데이터셋을 래스터화한다.</p></li>
<li><p><code>translate</code>: 래스터 파일을 다른 형식으로 변환한다.</p></li>
<li><p><code>vectortranslate</code>: 벡터 파일을 다른 형식으로 변환한다(<code>ogr2ogr</code>에 해당).</p></li>
<li><p><code>buildvrt</code>: 가상 래스터 타일(여러 파일의 결합하여 생성된 단일 래스터)을 생성한다.</p></li>
<li><p><code>demprocessing</code>: DEM(digital data model)에 대한 다양한 처리를 수행한다.</p></li>
<li><p><code>nearblack</code>: 거의 검정색 또는 흰색인 경계 부분을 검정색으로 변환한다.</p></li>
<li><p><code>grid</code>: 흩어진 데이터로부터 규칙 그리드를 생성한다.</p></li>
<li><p><code>mdiminfo</code>: 다차원 어레이에 대한 정보를 출력한다.</p></li>
<li><p><code>mdimtranslate</code>: 다차원 어레이를 다른 형식으로 변환한다.</p></li>
</ul>
<p>이러한 유틸리티는 기본적으로 파일 단위로 작동하며, <code>sf</code> 또는 <code>stars</code> 객체에 직접 작용되지는 않는다. 그러나 <code>stars_proxy</code> 객체는 본질적으로 파일에 대한 포인터 역할을 하므로, 다른 객체들도 파일로 저장하여 사용할 수 있다. 이러한 유틸리티 중 일부는(항상 혹은 선택적으로) <code><a href="https://r-spatial.github.io/stars/reference/st_mosaic.html">st_mosaic()</a></code>, <code><a href="https://r-spatial.github.io/stars/reference/st_warp.html">st_warp()</a></code>, 또는 <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write()</a></code> 등의 함수를 통해 호출된다. R의 <strong>gdalUtilities</strong>(O’Brien 2022) 패키지는 <code><a href="https://r-spatial.github.io/sf/reference/gdal_utils.html">sf::gdal_utils()</a></code> 함수에 기반하여, 명령줄 유틸리티 인수 이름과 동일한 인수 이름을 사용하는 편의성 래퍼 함수를 제공한다.</p>
</section></section><section id="벡터-데이터-큐브-예제" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="벡터-데이터-큐브-예제">
<span class="header-section-number">7.5</span> 벡터 데이터 큐브 예제</h2>
<section id="예제-대기질-시계열-데이터-애그리게이션-실행" class="level3" data-number="7.5.1"><h3 data-number="7.5.1" class="anchored" data-anchor-id="예제-대기질-시계열-데이터-애그리게이션-실행">
<span class="header-section-number">7.5.1</span> 예제: 대기질 시계열 데이터 애그리게이션 실행</h3>
<p>유럽 대기질 데이터를 사례로, 벡터 데이터 큐브의 애그리게이션 작업을 설명한다. 이 데이터는 Gräler, Pebesma와 Heuvelink(2016)에서 사용된 것과 동일하며, 12장과 13장에서도 다시 사용될 예정이다. 독일 농촌 지역 관측소에서 1998~2009년 동안 수집한 데이터를 바탕으로 일평균 <span class="math inline">\(\text{PM}_{10}\)</span> 값을 계산하였다.</p>
<p><code>air</code> 데이터 매트릭스, 날짜 벡터 <code>date</code>s, 그리고 <code>SpatialPoints</code> 객체 <code>stations</code>을 결합하여 <code>stars</code> 객체를 생성할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/air.rda"</span><span class="op">)</span> <span class="co"># this loads several datasets in .GlobalEnv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">air</span><span class="op">)</span></span>
<span><span class="co"># space  time </span></span>
<span><span class="co">#    70  4383</span></span>
<span><span class="va">stations</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">st</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span>station <span class="op">=</span> <span class="va">st</span>, time <span class="op">=</span> <span class="va">dates</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">aq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PM10 <span class="op">=</span> <span class="va">air</span><span class="op">)</span>, dimensions <span class="op">=</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#       Min. 1st Qu. Median Mean 3rd Qu. Max.   NA's</span></span>
<span><span class="co"># PM10     0    9.92   14.8 17.7      22  274 157659</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#         from   to     offset  delta refsys point</span></span>
<span><span class="co"># station    1   70         NA     NA WGS 84  TRUE</span></span>
<span><span class="co"># time       1 4383 1998-01-01 1 days   Date FALSE</span></span>
<span><span class="co">#                                          values</span></span>
<span><span class="co"># station POINT (9.59 53.7),...,POINT (9.45 49.2)</span></span>
<span><span class="co"># time                                       NULL</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그림 7.11에서는 시간 시계열이 상당히 길지만, 큰 결측 구간도 존재함을 확인할 수 있다. 그림 7.12는 평균 <span class="math inline">\(\text{PM}_{10}\)</span> 값과 함께 측정소의 공간 분포를 보여준다.</p>
<div id="fig-7-11" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-airst-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-11" data-gallery="quarto-lightbox-gallery-11"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-airst-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.11: 시간과 관측소별로 계산된 PM10 값에 대한 시공간 다이어그램
</figcaption></figure>
</div>
<div id="fig-7-12" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-airmap-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-12" data-gallery="quarto-lightbox-gallery-12"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-airmap-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.12: 관측소별 PM10 평균값
</figcaption></figure>
</div>
<p>간단한 실습 차원에서, 관측소별 시간 시계열 데이터를 지역 평균으로 애그리게이션할 수 있다. 이를 위해 <code>stars</code> 객체에 대한 <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code> 메서드를 사용한다.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">aq</span>, <span class="va">de_nuts1</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#       Min. 1st Qu. Median Mean 3rd Qu. Max.  NA's</span></span>
<span><span class="co"># PM10  1.08    10.9   15.3 17.9    21.8  172 25679</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from   to     offset  delta refsys point</span></span>
<span><span class="co"># geom    1   16         NA     NA WGS 84 FALSE</span></span>
<span><span class="co"># time    1 4383 1998-01-01 1 days   Date FALSE</span></span>
<span><span class="co">#                                       values</span></span>
<span><span class="co"># geom MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span>
<span><span class="co"># time                                    NULL</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>또한, 아래 코드를 통해 임의로 선택한 여섯 날짜의 지도를 표시할 수 있다(그림 7.13).</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op">&gt;=</span> <span class="st">"2008-01-01"</span>, <span class="va">time</span> <span class="op">&lt;</span> <span class="st">"2008-01-07"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>key.pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-13" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-airagg-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-13" data-gallery="quarto-lightbox-gallery-13"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-airagg-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.13: 임의의 여섯 날짜에 대한 지역 평균 PM10
</figcaption></figure>
</div>
<p>또한, 아래 코드를 이용해 단일 주(state)의 평균값 시계열 플롯을 생성할 수 있다(그림 7.14).</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://joshuaulrich.github.io/xts/">xts</a></span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xts/man/as.xts.html">as.xts</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>, main <span class="op">=</span> <span class="va">de_nuts1</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-14" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-airts-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-14" data-gallery="quarto-lightbox-gallery-14"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-airts-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.14: 단일 주에 대한 지역 평균 PM10의 시계열 플롯
</figcaption></figure>
</div>
</section><section id="예제-브리스톨-출발지-도착지-데이터-큐브" class="level3" data-number="7.5.2"><h3 data-number="7.5.2" class="anchored" data-anchor-id="예제-브리스톨-출발지-도착지-데이터-큐브">
<span class="header-section-number">7.5.2</span> 예제: 브리스톨 출발지-도착지 데이터 큐브</h3>
<p>이 예제에 사용된 데이터는 Lovelace, Nowosad와 Muenchow(2019)에서 가져온 출발지-목적지(OD) 매트릭스로, A 지역에서 B 지역으로 이동하는 인구수를 교통수단별로 나타낸 것이다. 102개 지역의 피처 지오메트리는 <code>sf</code> 객체인 <code>bristol_zones</code>에 포함되어 있다.</p>
<div id="fig-7-15" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-bristol1-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-15" data-gallery="quarto-lightbox-gallery-15"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-bristol1-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.15: 영국 브리스톨의 102개 구역 현황(33번 구역(E02003043)이 빨간색으로 표시되어 있음)
</figcaption></figure>
</div>
<p><code>bristol_od</code> 테이블에 OD 쌍(이동량이 0인 경우는 제외)이 레코드로 저장되어 있으며, 서로 다른 교통수단이 변수로 포함되어 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bristol_od</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 6 × 7</span></span>
<span><span class="co">#   o         d           all bicycle  foot car_driver train</span></span>
<span><span class="co">#   &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co"># 1 E02002985 E02002985   209       5   127         59     0</span></span>
<span><span class="co"># 2 E02002985 E02002987   121       7    35         62     0</span></span>
<span><span class="co"># 3 E02002985 E02003036    32       2     1         10     1</span></span>
<span><span class="co"># 4 E02002985 E02003043   141       1     2         56    17</span></span>
<span><span class="co"># 5 E02002985 E02003049    56       2     4         36     0</span></span>
<span><span class="co"># 6 E02002985 E02003054    42       4     0         21     0</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>제외된 무이동 OD 쌍의 개수는 모든 OD 조합 수에서 데이터에 포함된 OD 쌍 수를 빼서 구할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bristol_zones</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bristol_od</span><span class="op">)</span> </span>
<span><span class="co"># [1] 7494</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>우리는 출발지, 목적지, 교통수단을 디멘션으로 하는 3차원 벡터 데이터 큐브를 만들 것이다. 이를 위해 먼저 <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> 함수를 사용하여 <code>bristol_od</code> 테이블을 정리해, 출발지(<code>o</code>), 목적지(<code>d</code>), 교통수단(<code>mode</code>), 빈도(<code>n</code>) 변수를 갖도록 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create O-D-mode array:</span></span>
<span><span class="va">bristol_tidy</span> <span class="op">&lt;-</span> <span class="va">bristol_od</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">all</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, names_to <span class="op">=</span> <span class="st">"mode"</span>, values_to <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bristol_tidy</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 6 × 4</span></span>
<span><span class="co">#   o         d         mode           n</span></span>
<span><span class="co">#   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span><span class="co"># 1 E02002985 E02002985 bicycle        5</span></span>
<span><span class="co"># 2 E02002985 E02002985 foot         127</span></span>
<span><span class="co"># 3 E02002985 E02002985 car_driver    59</span></span>
<span><span class="co"># 4 E02002985 E02002985 train          0</span></span>
<span><span class="co"># 5 E02002985 E02002987 bicycle        7</span></span>
<span><span class="co"># 6 E02002985 E02002987 foot          35</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그리고 나서 0으로 채워진 3차원 어레이 <code>a</code>를 생성한다.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">od</span> <span class="op">&lt;-</span> <span class="va">bristol_tidy</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="st">"o"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span></span>
<span><span class="va">mode</span> <span class="op">&lt;-</span> <span class="va">bristol_tidy</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="st">"mode"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nmode</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mode</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fl">0L</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">nod</span>, <span class="va">nod</span>, <span class="va">nmode</span><span class="op">)</span>, </span>
<span>    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>o <span class="op">=</span> <span class="va">od</span>, d <span class="op">=</span> <span class="va">od</span>, mode <span class="op">=</span> <span class="va">mode</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="co"># [1] 102 102   4</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>해당 어레이의 세 차원에 구역 이름(<code>o</code>, <code>d</code>)과 교통수단 이름(<code>mode</code>)이 부여되어 있음을 확인할 수 있다. 이렇게 함으로써 <code>bristol_tidy</code>의 각 행은 해당 어레이의 한 단위(엔트리)에 해당하게 된다. <code>bristol_tidy</code> 테이블에 있는 인덱스(<code>o</code>, <code>d</code> 및 <code>mode</code>)와 값(<code>n</code>)을 이용해 해당 어레이(<code>a</code>)의 0이 아닌 부분을 채울 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">bristol_tidy</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"o"</span>, <span class="st">"d"</span>, <span class="st">"mode"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>        <span class="va">bristol_tidy</span><span class="op">$</span><span class="va">n</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>bristol_zones</code>의 구역과 <code>bristol_tidy</code>의 구역명이 서로 다른 순서를 가질 수 있으므로, 아래와 같이 인덱스를 일치 시키는 정렬 절차를 수행한다.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">od</span>, <span class="va">bristol_zones</span><span class="op">$</span><span class="va">geo_code</span><span class="op">)</span></span>
<span><span class="va">zones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">bristol_zones</span><span class="op">)</span><span class="op">[</span><span class="va">order</span><span class="op">]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>순서가 이미 올바를 수도 있지만, 그런 가정은 배제하고 위 코드를 그대로 실행하는 편이 안전하다. 다음으로, 구역과 교통수단을 이용해 <code>stars</code> 디멘션 객체를 생성한다.</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span>o <span class="op">=</span> <span class="va">zones</span>, d <span class="op">=</span> <span class="va">zones</span>, mode <span class="op">=</span> <span class="va">mode</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#      from  to refsys point                                  values</span></span>
<span><span class="co"># o       1 102 WGS 84 FALSE MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span>
<span><span class="co"># d       1 102 WGS 84 FALSE MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span>
<span><span class="co"># mode    1   4     NA FALSE                       bicycle,...,train</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>마지막으로, 어레이 <code>a</code>와 디멘션 <code>d</code>를 이용해 최종 <code>stars</code> 객체를 생성한다.</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">odm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">a</span><span class="op">)</span>, dimensions <span class="op">=</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#    Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># N     0       0      0  4.8       0 1296</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to refsys point                                  values</span></span>
<span><span class="co"># o       1 102 WGS 84 FALSE MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span>
<span><span class="co"># d       1 102 WGS 84 FALSE MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span>
<span><span class="co"># mode    1   4     NA FALSE                       bicycle,...,train</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 3차원 어레이에서 단일 슬라이스를 추출할 수 있다. 예를 들어, 구역 33에 대한 데이터를 <code>odm[ , , 33]</code>으로 추출한 뒤 플롯을 그릴 수 있다(그림 7.16).</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/adrop.html">adrop</a></span><span class="op">(</span><span class="va">odm</span><span class="op">[</span>,,<span class="fl">33</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, logz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-16" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-odm33-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-16" data-gallery="quarto-lightbox-gallery-16"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-odm33-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.16: 33번 존에 대한 OD 데이터를 추출한 후 교통수단별로 지도화하였다.
</figcaption></figure>
</div>
<p>이렇게 서브세팅을 수행하면, 첫 번째 인수가 비어 있으므로 모든 속성(여기서는 하나만 존재: <code>N</code>)을 선택하고, 두 번째 인수가 비어 있어 모든 출발지를 선택하며, 세 번째 인수로 목적지 구역 33을 선택하고, 네 번째 인수가 비어 있어 모든 교통 수단을 선택하게 된다.</p>
<p>이 특정 구역을 목적지로 선택한 이유는 해당 구역이 가장 많은 여행자를 보유하고 있기 때문이다. 이는 목적지별로 모든 출발지와 여행 수단을 합산해 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">odm</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">d</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># [1] 33</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다른 애그리게이션도 수행할 수 있다. 예를 들어, OD(102 × 102)의 총통행량은 다음과 같이 구할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">odm</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#      Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># sum     0       0      0 19.2      19 1434</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#   from  to refsys point                                  values</span></span>
<span><span class="co"># o    1 102 WGS 84 FALSE MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span>
<span><span class="co"># d    1 102 WGS 84 FALSE MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>교통수단별로 출발지 총계를 구할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">odm</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#      Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># sum     1    57.5    214  490     771 2903</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to refsys point                                  values</span></span>
<span><span class="co"># o       1 102 WGS 84 FALSE MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span>
<span><span class="co"># mode    1   4     NA FALSE                       bicycle,...,train</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>교통수단별로 도착지 총계를 구할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">odm</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#      Min. 1st Qu. Median Mean 3rd Qu.  Max.</span></span>
<span><span class="co"># sum     0      13    104  490     408 12948</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to refsys point                                  values</span></span>
<span><span class="co"># d       1 102 WGS 84 FALSE MULTIPOLYGON (...,...,MULTIPOLYGON (...</span></span>
<span><span class="co"># mode    1   4     NA FALSE                       bicycle,...,train</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>모드별 합산 출발지 총계를 구할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">odm</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>모드별 합산 도착지 총계를 구할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">odm</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>o</code>와 <code>d</code>를 결합한 뒤 함께 플롯할 수 있다(그림 7.17).</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">o</span>, <span class="va">d</span>, along <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>od <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"origin"</span>, <span class="st">"destination"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, logz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-17" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-odjoined-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-17" data-gallery="quarto-lightbox-gallery-17"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-odjoined-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.17: 출발지별 총통근(왼쪽)과 목적지별 총통근(오른쪽)
</figcaption></figure>
</div>
<p>이 지도는 현상의 본질을 왜곡할 수 있다는 우려가 있다. 그 이유는 실질적인 값의 크기(컬러) 뿐만 아니라 구역의 면적 역시 시각적으로 인지되는 양의 크기에 영향을 미치기 때문이다. 이를 감안해 밀도값(카운트/<span class="math inline">\(\text{km}^2\)</span>)을 계산해 나타낼 수 있다(그림 7.18).(역자주: 지도학적 원칙에 따르면, 총통근과 같은 카운트 변수를 코로플레스 맵으로 표현하는 것은 적절하지 않다. 보다 바람직한 방법은 도형표현도로 나타내는 것이다.)</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-quantities.github.io/units/">units</a></span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span>, <span class="va">km</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">o</span><span class="op">$</span><span class="va">sum_km</span> <span class="op">&lt;-</span> <span class="va">o</span><span class="op">$</span><span class="va">sum</span> <span class="op">/</span> <span class="va">a</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">sum_km</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">$</span><span class="va">sum</span> <span class="op">/</span> <span class="va">a</span></span>
<span><span class="va">od</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">o</span><span class="op">[</span><span class="st">"sum_km"</span><span class="op">]</span>, <span class="va">d</span><span class="op">[</span><span class="st">"sum_km"</span><span class="op">]</span>, along <span class="op">=</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>od <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"origin"</span>, <span class="st">"destination"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">od</span>, logz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-18" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-odbykm-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-18" data-gallery="quarto-lightbox-gallery-18"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-odbykm-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.18: 출발지별 총통근 밀도(왼쪽)와 목적지별 총통근 밀도(오른쪽)
</figcaption></figure>
</div>
<p>카운트 속성을 정규화하는 또 다른 방법은 값을 면적이 아닌 인구수로 나누는 것이다.</p>
</section><section id="타이디-어레이-데이터" class="level3" data-number="7.5.3"><h3 data-number="7.5.3" class="anchored" data-anchor-id="타이디-어레이-데이터">
<span class="header-section-number">7.5.3</span> 타이디 어레이 데이터</h3>
<p>Wickham(2014)의 <em>타이디</em> 데이터 논문은 3차원 데이터를 어레이 데이터 형식보다는 각 행이 (지역, 클래스, 연도, 값)으로 구성된 긴(비정규화된) 테이블 형식으로 처리되는 것이 더 바람직하다고 제안한다. 이는 가능하다면 항상 좋은 접근이다. 그러나 기본 처리나 저장 목적에서는 이 방법을 적용할 수 없는 경우가 있으며, 그 이유는 다음과 같다.</p>
<ul>
<li><p>많은 어레이 데이터는 처음부터 어레이 형식으로 수집되거나 생성된다. 예를 들어, 원격탐사를 통해 수집된 데이터나 기후 모형을 통해 생성된 데이터가 이에 해당한다.</p></li>
<li><p>어레이 형식을 긴 테이블 형태로 변환하는 것이 그 반대보다 훨씬 쉽다.</p></li>
<li><p>긴 테이블 형식의 데이터는 훨씬 더 많은 메모리를 요구한다. 디멘션 <span class="math inline">\(i\)</span>의 기수(크기)를 <span class="math inline">\(n_i\)</span>라고 할 때, 디멘션 값이 차지하는 메모리 공간은 <span class="math inline">\(O(\sum{n_i})\)</span>가 아니라 <span class="math inline">\(O(\prod{n_i})\)</span>로 주어진다.</p></li>
<li><p>결측값이 있는 셀을 삭제하면, 긴 테이블 형식은 어레이 형식이 내재하고 있는 인덱싱을 상실하게 된다.</p></li>
</ul>
<p>이 주장을 극단적으로 표현하자면, 모든 이미지, 비디오, 음성 데이터가 어레이 형식으로 저장된다고 가정해 보자. 실제로 이를 긴 테이블 형식으로 저장해야 한다고 주장하는 사람은 거의 없을 것이다. 그럼에도 불구하고 <strong>tsibble</strong>(Wang et al.&nbsp;2022)과 같은 R 패키지는 긴 테이블 형식을 취하고 있으며, 동일한 시간 스텝을 가진 다수의 공간적 피처에 순서를 매기는 작업이 매우 모호함에도 불구하고 어쨋든 인덱싱을 해야 한다는 문제점이 있다. 이러한 문제는 <strong>stars</strong> 패키지에서 제공하는 어레이 형식을 사용함으로써 <em>자동</em>으로 해결된다. 물론 이는 조밀한 어레이를 사용해야한다는 대가를 치루는 것이기도 하다.</p>
<p><strong>stars</strong> 패키지는 어레이 집합을 처리하는 문제에 있어 타이디 데이터 원칙(tidy manifesto)을 따르려 하며, 특히 하나 이상의 디멘션이 공간 및/또는 시간을 참조하는 경우에 그러하다.</p>
</section><section id="벡터-데이터-큐브를-위한-파일-포맷" class="level3" data-number="7.5.4"><h3 data-number="7.5.4" class="anchored" data-anchor-id="벡터-데이터-큐브를-위한-파일-포맷">
<span class="header-section-number">7.5.4</span> 벡터 데이터 큐브를 위한 파일 포맷</h3>
<p>규칙 테이블 형식(긴 테이블 형식을 포함)은 하나의 대안이지만 사용하기에는 불편하다. 위의 출발지-목적지 데이터 예제와 13장에서 다룰 내용은 테이블 형식에서 벡터 데이터 큐브를 재구성하는 작업이 매우 복잡하다는 점을 잘 보여준다. NetCDF나 Zarr와 같은 어레이 형식은 어레이 데이터를 저장하기 위해 설계되었으나, 사실상 <em>모든</em> 데이터 구조를 저장할 수 있다. 다만, 한 번 작성된 파일은 재사용하기 어렵다는 위험이 있다. 포인트, (멀티)라인스트링, (멀티)폴리곤으로 구성된 <em>단일</em> 지오메트리 디멘션을 가진 벡터 데이터 큐브의 경우, CF 규칙(Eaton et al.&nbsp;2022)은 이러한 지오메트리를 인코딩하는 방법을 설명한다. <code><a href="https://r-spatial.github.io/stars/reference/mdim.html">stars::read_mdim()</a></code> 함수와 <code><a href="https://r-spatial.github.io/stars/reference/mdim.html">stars::write_mdim()</a></code> 함수는 이 규칙을 따르는 벡터 데이터 큐브를 읽고 쓸 수 있다.</p>
</section></section><section id="래스터-벡터-전환과-벡터-래스터-전환" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="래스터-벡터-전환과-벡터-래스터-전환">
<span class="header-section-number">7.6</span> 래스터-벡터 전환과 벡터-래스터 전환</h2>
<p>1.3절에서 래스터-벡터 전환과 벡터-래스터 전환의 몇 가지 예제를 이미 다루었다. 이 절에서는 이에 대한 코드와 예제를 추가로 제시한다.</p>
<section id="벡터-래스터-전환" class="level3" data-number="7.6.1"><h3 data-number="7.6.1" class="anchored" data-anchor-id="벡터-래스터-전환">
<span class="header-section-number">7.6.1</span> 벡터-래스터 전환</h3>
<p><code><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars()</a></code> 함수는 객체를 <code>stars</code> 객체로 변환하도록 설계된 메서드이다. 그러나 모든 <code>stars</code> 객체가 래스터 객체인 것은 아니며, <code>sf</code> 객체에 이 메서드들 적용하면 지오메트리를 공간적(벡터) 디멘션으로, 속성을 속성 디멘션으로 가지는 벡터 데이터 큐브가 생성된다. 피처 <em>지오메트리</em>(<code>sfc</code>) 객체가 주어지면, <code><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars()</a></code> 함수는 이를 래스터화한다(7.8절과 그림 7.19).</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"gpkg/nc.gpkg"</span>, package<span class="op">=</span><span class="st">"sf"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>key.pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-19" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-asstars-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-19" data-gallery="quarto-lightbox-gallery-19"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-asstars-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.19: <code><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars()</a></code> 함수를 활용한 백터 지오메트리의 래스터화
</figcaption></figure>
</div>
<p><code><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars()</a></code> 함수는 셀 크기, 셀 수 그리고/또는 범위를 제어하는 파라미터를 설정할 수 있다. 반환되는 셀 값은 중심점이 지오메트리 외부에 있는 경우 <code>0</code>이고, 지오메트리 내부 또는 경계에 있는 경우 <code>1</code>이다. 기존 피처를 래스터화하는 작업은 <code><a href="https://r-spatial.github.io/stars/reference/st_rasterize.html">st_rasterize()</a></code> 함수를 사용해 수행하며, 이는 그림 1.5에서도 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SID74</span>, <span class="va">SID79</span>, <span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_rasterize.html">st_rasterize</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># stars object with 2 dimensions and 3 attributes</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#      SID74           SID79            name       </span></span>
<span><span class="co">#  Min.   : 0      Min.   : 0      Sampson :  655  </span></span>
<span><span class="co">#  1st Qu.: 3      1st Qu.: 3      Columbus:  648  </span></span>
<span><span class="co">#  Median : 5      Median : 6      Robeson :  648  </span></span>
<span><span class="co">#  Mean   : 8      Mean   :10      Bladen  :  604  </span></span>
<span><span class="co">#  3rd Qu.:10      3rd Qu.:13      Wake    :  590  </span></span>
<span><span class="co">#  Max.   :44      Max.   :57      (Other) :30952  </span></span>
<span><span class="co">#  NA's   :30904   NA's   :30904   NA's    :30904  </span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#   from  to offset   delta refsys point x/y</span></span>
<span><span class="co"># x    1 461  -84.3  0.0192  NAD27 FALSE [x]</span></span>
<span><span class="co"># y    1 141   36.6 -0.0192  NAD27 FALSE [y]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>라인과 포인트 지오메트리도 이와 유사하게 래스터화할 수 있다(그림 7.20).</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="st">"MULTILINESTRING"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">CNTY_ID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_rasterize.html">st_rasterize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>key.pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-7-20" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-7-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-lineras-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-20" data-gallery="quarto-lightbox-gallery-20"><img src="https://r-spatial.org/book/07-Introsf_files/figure-html/fig-lineras-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;7.20: 노스캐롤라이나 카운티 경계를 래스터로 전환하기
</figcaption></figure>
</div>
</section></section><section id="좌표변환-및-좌표전환" class="level2" data-number="7.7"><h2 data-number="7.7" class="anchored" data-anchor-id="좌표변환-및-좌표전환">
<span class="header-section-number">7.7</span> 좌표변환 및 좌표전환</h2>
<section id="st_crs-함수" class="level3" data-number="7.7.1"><h3 data-number="7.7.1" class="anchored" data-anchor-id="st_crs-함수">
<span class="header-section-number">7.7.1</span> <code>st_crs()</code> 함수</h3>
<p><code>sf</code> 또는 <code>stars</code> 클래스의 공간 객체는 CRS(좌표참조계)를 포함하고 있다. <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs()</a></code> 함수를 사용하여 해당 객체의 CRS를 확인하거나 다른 CRS로 교체할 수 있다. 또한, <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_set_crs()</a></code>함수를 사용하여 CRS를 설정하거나 교체할 수 있다. CRS는 EPSG 코드로 설정할 수 있으며, 예를 들어 <code>st_crs(4326)</code>는 <code>st_crs('EPSG:4326')</code>로 변환된다. 또는 <code>"+proj=utm +zone=25 +south"</code>와 같은 PROJ.4 문자열, <code>"WGS84"</code>와 같은 이름, <code>"OGC:CRS84"</code>처럼 기관명이 앞에 붙은 이름으로도 설정할 수 있다. 대안으로 WKT, WKT-2(2.5절), 또는 PROJJSON 형식의 CRS 정의를 사용할 수 있다. <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs()</a></code> 함수가 반환하는 객체는 다음 두 개의 필드를 포함한다.</p>
<ul>
<li><p><code>wkt</code>: WKT-2 형식으로 표현된 CRS</p></li>
<li><p><code>input</code>: 사용자 입력(있는 경우), 또는 CRS에 대한 인간 가독 설명(가능한 경우)</p></li>
</ul>
<p>PROJ.4 문자열은 일부 CRS을 <em>정의</em>하는 데는 사용할 수 있지만, CRS 전체를 <em>대표</em>하는 용도로는 적합하지 않다. 예를 들어, <code>crs</code> 객체의 WKT-2를 <code>$proj4string</code> 메서드를 사용해 proj4string으로 전환하려면 다음과 같이 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">"OGC:CRS84"</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">proj4string</span></span>
<span><span class="co"># [1] "+proj=longlat +datum=WGS84 +no_defs"</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그러나, 이 과정이 성공적으로 이루어졌다 하더라도, 일반적으로 정보 손실이 수반되며 가역적으로 전환되지 않는다. PROJ.4 문자열을 사용해 CRS를 <em>정의</em>하는 경우(예: 파라미터가 지정된 투영 CRS), 해당 투영 CRS가 WGS84 데이텀과 관련되는 한에는 문제가 없다.</p>
</section><section id="st_transform함수와-st_project-함수" class="level3" data-number="7.7.2"><h3 data-number="7.7.2" class="anchored" data-anchor-id="st_transform함수와-st_project-함수">
<span class="header-section-number">7.7.2</span> <code>st_transform()</code>함수와 <code>st_project()</code> 함수</h3>
<p><code>sf</code> 또는 <code>stars</code> 객체의 좌표변환이나 좌표전환은 <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code>함수를 사용해 수행한다. 이 함수의 첫 번째 인수는 CRS가 설정된 <code>sf</code> 또는 <code>stars</code> 클래스의 공간 객체이고, 두 번째 인수는 <code>crs</code> 객체(또는 <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs()</a></code> 함수로 변환 가능한 값이다. 소스 <code>crs</code>에서 타깃 <code>crs</code>로 변환 또는 전환하는 방법이 여러 가지인 경우, PROJ는 가장 높은 명시(declared) 정확도를 가진 방법을 선택한다. 더 세밀한 옵션은 7.7.5절에서 설명된다. 규칙 래스터 디멘션을 가진 <code>stars</code> 객체의 경우, <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code> 함수는 좌표<em>만</em> 변환하며 항상 곡선형 그리드를 생성한다. 새로운 CRS에서 규칙 래스터를 생성하려면, 재그리딩(regridding)을 수행하는 <code><a href="https://r-spatial.github.io/stars/reference/st_warp.html">st_warp()</a></code> 함수를 사용하면 된다(7.8절).</p>
<p><code>sf</code>나 <code>stars</code> 객체가 아닌 경우의 좌표변환이나 좌표전환은 저수준(lower-level) 함수인 <code><a href="https://r-spatial.github.io/sf/reference/sf_project.html">sf_project()</a></code>를 통해 수행된다. 이 함수는 좌표가 담긴 행렬과 소스 및 타깃 CRS(<code>crs</code>)를 입력받아, 변환 또는 전환된 좌표를 반환한다.</p>
</section><section id="sf_proj_info-함수" class="level3" data-number="7.7.3"><h3 data-number="7.7.3" class="anchored" data-anchor-id="sf_proj_info-함수">
<span class="header-section-number">7.7.3</span> <code>sf_proj_info()</code> 함수</h3>
<p><code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">sf_proj_info()</a></code> 함수는 PROJ 소프트웨어에서 사용 가능한 투영, 타원체, 단위 및 본초 자오선에 대한 정보를 조회하는 데 사용된다. 이 함수는 단일 매개변수 <code>type</code>을 받으며, <code>type</code>에는 다음과 같은 값을 지정할 수 있다.</p>
<ul>
<li><p><code>type = "proj"</code>: 사용 가능한 투영법의 짧은 이름과 긴 이름을 나열한다. 짧은 이름은 <code>“+proj=name”</code> 문자열에서 사용할 수 있다.</p></li>
<li><p><code>type = "ellps"</code>: 사용 가능한 타원체를 나열하며, 이름, 긴 이름 및 타원체의 파라미터 정보를 포함한다.</p></li>
<li><p><code>type = "units"</code>: 사용 가능한 길이 단위를 나열하며, 미터로의 변환 상수 정보를 포함한다.</p></li>
<li><p><code>type = "prime_meridians"</code>: 본초 자오선을 나열하고, 그리니치 자오선과의 상대적 위치 정보를 포함한다.</p></li>
</ul></section><section id="데이텀-그리드-proj.db-cdn.proj.org.-로컬-캐쉬" class="level3" data-number="7.7.4"><h3 data-number="7.7.4" class="anchored" data-anchor-id="데이텀-그리드-proj.db-cdn.proj.org.-로컬-캐쉬">
<span class="header-section-number">7.7.4</span> 데이텀 그리드, proj.db, cdn.proj.org. 로컬 캐쉬</h3>
<p>데이텀 그리드(2.4절 참조)는 로컬에 설치하거나 PROJ 측량 그리드 CDN(https://cdn.proj.org/)에서 불러 올 수 있다. 로컬에 설치된 경우, 데이텀 그리드는 PROJ 검색 경로를 통해 불러오며, 이 경로는 다음과 같이 표시된다.</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_search_paths</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] "/home/edzer/.local/share/proj" "/usr/share/proj"</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>핵심 PROJ 데이터베이스는 <code>proj.db</code>이며, 일반적으로 다음 위치에서 불러올 수 있는 <code>sqlite3</code> 데이터베이스이다.</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_search_paths</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">.Platform</span><span class="op">$</span><span class="va">file.sep</span>, </span>
<span>       <span class="st">"proj.db"</span><span class="op">)</span></span>
<span><span class="co"># [1] "/usr/share/proj/proj.db"</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>각 PROJ 릴리스에 포함된 EPSG 데이터베이스 스냅샷의 버전은 <code>proj.db</code>의 <code>"metadata"</code> 테이블에 명시되어 있으며, <strong>sf</strong> 패키지에서 사용되는 PROJ 런타임 버전은 다음과 같이 표시된다.</p>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf_extSoftVersion.html">sf_extSoftVersion</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">"PROJ"</span><span class="op">]</span></span>
<span><span class="co">#    PROJ </span></span>
<span><span class="co"># "9.1.1"</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>특정 좌표변환에 필요한 데이텀 그리드가 로컬에 없을 경우, PROJ는 PROJ CDN에서 온라인 데이텀 그리드를 검색한다. 단, 아래의 결과가 <code>TRUE</code>인 경우에 한한다.</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_network</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] FALSE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>기본값은 <code>FALSE</code>로 설정되어 있지만, 이를 <code>TRUE</code>로 변경하면 해당 네트워크 리소스의 URL을 반환한다. 이 리소스는 더 빠르거나 제한이 덜한 다른 리소스로 변경할 수도 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_network</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># [1] "https://cdn.proj.org"</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>CDN에서 데이텀 그리드를 조회한 후, PROJ는 조회된 그리드의 <em>일부만</em>(기본값은 전체 그리드가 아님) 로컬 캐시에 기록한다. 이 캐시는 사용자 디렉터리에 저장된 또 다른 <code>sqlite3</code> 데이터베이스이며, 다음과 같이 표시된다.</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_search_paths</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># [1] "/home/edzer/.local/share/proj/cache.db"</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>차후의 데이텀 그리드 조회는 이 데이터베이스를 우선적으로 참조한다.</p>
</section><section id="변환-파이프라인" class="level3" data-number="7.7.5"><h3 data-number="7.7.5" class="anchored" data-anchor-id="변환-파이프라인">
<span class="header-section-number">7.7.5</span> 변환 파이프라인</h3>
<p>내부적으로 PROJ는 소스 CRS에서 타겟 CRS로 변환하는 연산 시퀀스를 나타내기 위해, 이른바 <em>좌표 연산 파이프라인</em>(coordinate operation pipeline)을 사용한다. 소스에서 타겟으로 가는 여러 옵션이 있을 경우, <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code> 함수는 가장 높은 정확도의 옵션을 선택한다. 사용 가능한 옵션을 조회하려면 <code><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_pipelines()</a></code> 함수를 사용하면 된다.</p>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_pipelines</a></span><span class="op">(</span><span class="st">"OGC:CRS84"</span>, <span class="st">"EPSG:22525"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Candidate coordinate operations found:  5 </span></span>
<span><span class="co"># Strict containment:     FALSE </span></span>
<span><span class="co"># Axis order auth compl:  FALSE </span></span>
<span><span class="co"># Source:  OGC:CRS84 </span></span>
<span><span class="co"># Target:  EPSG:22525 </span></span>
<span><span class="co"># Best instantiable operation has accuracy: 2 m</span></span>
<span><span class="co"># Description: axis order change (2D) + Inverse of Corrego Alegre</span></span>
<span><span class="co">#              1970-72 to WGS 84 (2) + UTM zone 25S</span></span>
<span><span class="co"># Definition:  +proj=pipeline +step +proj=unitconvert +xy_in=deg</span></span>
<span><span class="co">#              +xy_out=rad +step +inv +proj=hgridshift</span></span>
<span><span class="co">#              +grids=br_ibge_CA7072_003.tif +step</span></span>
<span><span class="co">#              +proj=utm +zone=25 +south +ellps=intl</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>해당 변환에서 가장 높은 정확도를 보이는 연산 파이프라인이 요약되어 있으며, 특정 데이텀 그리드의 사용이 지정되어 있음을 확인할 수 있다. 네트워크 검색을 활성화하지 않았다면 다른 결과가 나왔을 것이다.</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_network</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># character(0)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_pipelines</a></span><span class="op">(</span><span class="st">"OGC:CRS84"</span>, <span class="st">"EPSG:22525"</span><span class="op">)</span></span>
<span><span class="co"># Candidate coordinate operations found:  5 </span></span>
<span><span class="co"># Strict containment:     FALSE </span></span>
<span><span class="co"># Axis order auth compl:  FALSE </span></span>
<span><span class="co"># Source:  OGC:CRS84 </span></span>
<span><span class="co"># Target:  EPSG:22525 </span></span>
<span><span class="co"># Best instantiable operation has accuracy: 2 m</span></span>
<span><span class="co"># Description: axis order change (2D) + Inverse of Corrego Alegre</span></span>
<span><span class="co">#              1970-72 to WGS 84 (2) + UTM zone 25S</span></span>
<span><span class="co"># Definition:  +</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 경우에는 데이텀 그리드 관련 정보가 누락되어 있음을 확인할 수 있다. <code><a href="https://r-spatial.github.io/sf/reference/proj_tools.html">sf_proj_pipelines()</a></code> 함수가 반환하는 객체는 서브클래스화된 <code>data.frame</code>으로, 다음과 같은 열을 포함한다.</p>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co"># [1] "id"           "description"  "definition"   "has_inverse" </span></span>
<span><span class="co"># [5] "accuracy"     "axis_order"   "grid_count"   "instantiable"</span></span>
<span><span class="co"># [9] "containment"</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>예를 들어 다음과 같이 정확도를 나열할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="co"># [1]  2  5  5  8 NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>여기서 <code>NA</code>는 ’대략적인 정확도’를 의미하며, 이는 30~120 m 범위 내의 값을 가진다.</p>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Candidate coordinate operations found:  1 </span></span>
<span><span class="co"># Strict containment:     FALSE </span></span>
<span><span class="co"># Axis order auth compl:  FALSE </span></span>
<span><span class="co"># Source:  OGC:CRS84 </span></span>
<span><span class="co"># Target:  EPSG:22525 </span></span>
<span><span class="co"># Best instantiable operation has only ballpark accuracy </span></span>
<span><span class="co"># Description: Ballpark geographic offset from WGS 84 (CRS84) to</span></span>
<span><span class="co">#              Corrego Alegre 1970-72 + UTM zone 25S</span></span>
<span><span class="co"># Definition:  +proj=pipeline +step +proj=unitconvert +xy_in=deg</span></span>
<span><span class="co">#              +xy_out=rad +step +proj=utm +zone=25</span></span>
<span><span class="co">#              +south +ellps=intl</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code> 함수가 선택한 가장 정확한 오프레이션 파이프라인이 기본값이지만, <code>pipeline</code> 인수를 지정하면 결과를 변경할 수도 있다. 이 경우 <code>p$definition</code>에 있는 옵션 중 하나를 선택하면 된다.</p>
</section><section id="축-순서와-방향" class="level3" data-number="7.7.6"><h3 data-number="7.7.6" class="anchored" data-anchor-id="축-순서와-방향">
<span class="header-section-number">7.7.6</span> 축 순서와 방향</h3>
<p>2.5절에서 언급했듯이, <code>EPSG:4326</code>은 첫 번째 축을 위도에, 두 번째 축을 경도에 대응하도록 정의한다. 이는 많은 다른 타원체 CRS에서도 동일하다. 이러한 방식은 해당 기관(EPSG)이 규정한 것이지만, 현재 대부분의 데이터셋은 이러한 방식을 따르지 않는다. 대부분의 다른 소프트웨어와 마찬가지로, <strong>sf</strong> 패키지는 이를 무시하고 기본값으로 타원체 좌표 쌍을 (경도, 위도)로 해석한다. 그러나 해당 기관의 규정을 준수하는 데이터 원천(예: WFS 서비스)에서 생성된 데이터를 읽어야 하는 경우, 다음과 같이 지정할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_axis_order</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이렇게 하면 <strong>sf</strong> 패키지가 GDAL과 PROJ 루틴을 호출할 때, 규정 준수(위도, 경도 순서)가 항상 전제되도록 할 수 있다. 그러나 이러한 규정 준수 과정에서 많은 문제가 발생할 수 있으며, 예를 들어 데이터를 플로팅할 때 그 문제가 드러난다. <code>sf</code> 객체를 위한 플롯 메서드는 축 순서 규정을 준수하며, 플로팅 전에 변환 파이프라인 <code>"+proj=pipeline +step +proj=axisswap +order=2,1"</code>을 사용해 위도, 경도 순서를 바꾸지만, <strong>ggplot2</strong> 패키지의 <code>geom_sf</code>는 이러한 수정 과정을 거치지 않는다. 앞서 언급했듯이, <code>EPSG:4326</code>에서 발견되는 축 순서의 모호성은 <code>OGC:CRS84</code>를 사용하면 모두 해결된다.</p>
<p>축 순서와는 별개의 문제로, 모든 CRS가 북쪽과 동쪽 방향을 양의 값으로 지정하는 것은 아니라는 점도 매우 중요하다. R의 대부분의 플로팅 함수는 이와 반대로 정의된 축을 가진 데이터에서는 제대로 작동하지 않는다. 축의 방향과 단위에 대한 정보는 다음과 같이 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">$</span><span class="va">axes</span></span>
<span><span class="co">#                 name orientation</span></span>
<span><span class="co"># 1  Geodetic latitude           1</span></span>
<span><span class="co"># 2 Geodetic longitude           3</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">$</span><span class="va">ud_unit</span></span>
<span><span class="co"># 1 [°]</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:2053"</span><span class="op">)</span><span class="op">$</span><span class="va">axes</span></span>
<span><span class="co">#       name orientation</span></span>
<span><span class="co"># 1  Westing           4</span></span>
<span><span class="co"># 2 Southing           2</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:2053"</span><span class="op">)</span><span class="op">$</span><span class="va">ud_unit</span></span>
<span><span class="co"># 1 [m]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="래스터-변환-및-워프" class="level2" data-number="7.8"><h2 data-number="7.8" class="anchored" data-anchor-id="래스터-변환-및-워프">
<span class="header-section-number">7.8</span> 래스터 변환 및 워프</h2>
<p>래스터 데이터셋에 대해 <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code> 함수를 사용할 때는 다음과 같이 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"tif/L7_ETMs.tif"</span>, package <span class="op">=</span> <span class="st">"stars"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="va">tif</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="st">'OGC:CRS84'</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># L7_ETMs.tif     1      54     69 68.9      86  255</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to refsys point                    values x/y</span></span>
<span><span class="co"># x       1 349 WGS 84 FALSE [349x352] -34.9,...,-34.8 [x]</span></span>
<span><span class="co"># y       1 352 WGS 84 FALSE [349x352] -8.04,...,-7.95 [y]</span></span>
<span><span class="co"># band    1   6     NA    NA                      NULL    </span></span>
<span><span class="co"># curvilinear grid</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이제 <em>곡선형</em> 그리드가 생성된 것을 확인할 수 있다 이는 새로운 CRS에 따라 모든 그리드 셀의 좌표가 재계산되므로 더 이상 <em>규칙</em> 그리드로 존재할 수 없음을 의미한다. 이러한 데이터를 플로팅하면 속도가 극도로 느려지는데, 그 이유는 각 그리드 셀에 대해 작은 폴리곤을 먼저 계산한 뒤 플로팅하기 때문이다. 장점은 정보가 손실되지 않는다는 점으로, 투영 이후에도 그리드 셀의 값은 그대로 유지된다.</p>
<p>규칙 그리드를 입력하여 새로운 CRS에서도 <em>규칙</em> 그리드를 산출하려면 <em>워프</em> 연산을 적용해야 한다. 즉, 새로운 위치에 그리드를 재생성하고 새로운 그리드 셀에 값을 할당하는 특정 규칙을 사용해야 한다. 이 과정에는 가장 가까운 값을 사용하거나 방법이나, 어떤 형태의 보간법을 적용하는 방법도 포함될 수 있다.(역자주: 이러한 작업은 GIS 래스터 분석인 원격탐사 분야에서는 재샘플링(resampling)이라고 하는데, 최근린(nearest neighbor), 양선형(bilibear), 3차 회선(cubic convolution) 등의 내삽 기법이 사용된다.) 다만, 이 연산은 정보 손실이 발생하며, 한 번 수행되면 원래 데이터로 되돌릴 수 없다.</p>
<p>워핑을 할 때 가장 좋은 방법은 타깃 그리드를 <code>stars</code> 객체로 명시하는 것이다. 타깃 CRS만 지정하면, 타깃 그리드의 기본 옵션이 자동으로 선택되는데, 이는 실제 작업 상황에 전혀 맞지 않을 수도 있다. 아래 예시는 목표 CRS만 지정했을 때의 워크플로를 보여준다.</p>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="va">tif</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_warp.html">st_warp</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">'OGC:CRS84'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#      from  to offset     delta refsys x/y</span></span>
<span><span class="co"># x       1 350  -34.9  0.000259 WGS 84 [x]</span></span>
<span><span class="co"># y       1 352  -7.95 -0.000259 WGS 84 [y]</span></span>
<span><span class="co"># band    1   6     NA        NA     NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 방법은 원본과 상당히 비슷한 래스터를 생성하지만, 변환 정도도 비교적 작다. 소스 래스터와 정확히 동일한 행과 열을 갖는 타깃 래스터를 먼저 생성하려는 워크플로우의 경우, 다음과 같이 하면 된다.</p>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="va">tif</span><span class="op">)</span></span>
<span><span class="va">grd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="st">'OGC:CRS84'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span>nx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span>, ny <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">[</span><span class="st">"y"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_warp.html">st_warp</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">grd</span><span class="op">)</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#              Min. 1st Qu. Median Mean 3rd Qu. Max. NA's</span></span>
<span><span class="co"># L7_ETMs.tif     1      54     69 68.9      86  255 6180</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#      from  to offset     delta refsys x/y</span></span>
<span><span class="co"># x       1 349  -34.9   0.00026 WGS 84 [x]</span></span>
<span><span class="co"># y       1 352  -7.95 -0.000259 WGS 84 [y]</span></span>
<span><span class="co"># band    1   6     NA        NA     NA</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>여기서 <span class="math inline">\(x\)</span>와 <span class="math inline">\(y\)</span>의 방향의 그리드 해상도가 조금 달라졌음을 확인할 수 있다.</p>
</section><section id="연습문제" class="level2" data-number="7.9"><h2 data-number="7.9" class="anchored" data-anchor-id="연습문제">
<span class="header-section-number">7.9</span> 연습문제</h2>
<p>R을 사용하여 다음 연습문제를 해결하시오.</p>
<ol type="1">
<li><p><code>nc</code> 카운티 중 <code>LINESTRING(-84 35,-78 35)</code>와 인턱센션하는 카운티의 이름을 찾으시오. 이를 위해 <code>[]</code>를 사용하고, 대안으로 <code><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join()</a></code> 함수를 사용하시오.</p></li>
<li><p><code>sf_use_s2(FALSE)</code>를 설정한 후 위 작업을 반복하고, 차이를 <em>계산</em>하시오(힌트: <code><a href="https://generics.r-lib.org/reference/setops.html">setdiff()</a></code>사용). 차이가 나타나는 카운티는 색상 <code>‘#88000088’</code>로 채색하시오.</p></li>
<li><p>두 지점 사이의 직선과 대권을 하나의 플롯에 그리시오. 현재 사용 중인 투영법에서는 R이 직선을 항상 직선으로 그린다는 점을 명심하시오. <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_segmentize()</a></code> 함수를 사용하여 직선 또는 타원 좌표의 대권 상에 포인트를 추가하시오.</p></li>
<li><p>NDVI는 <code>(NIR-R)/(NIR+R)</code>로 계산되며, 여기서 NIR은 근적외선 밴드, R은 적색 밴드이다. <code>L7_ETMs.tif</code> 파일을 객체 <code>x</code>로 읽고, <code>split(x, "band")</code>를 사용하여 밴드 디멘션을 속성으로 분리하시오. 그런 다음 NIR(밴드 4)과 R(밴드 3) 속성을 직접 사용하는 표현식을 이용해 이 객체에 NDVI 속성을 추가하시오.</p></li>
<li><p><code>L7_ETMs.tif</code> 이미지의 밴드 디맨션을 축소하여 NDVI를 계산하시오. 이를 위해 <code><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply()</a></code> 함수와 <code>ndvi = function(x) { (x[4]-x[3])/(x[4]+x[3]) }</code> 함수를 사용하시오. 결과를 플로팅하고, GeoTIFF 형식으로 저장하시오.</p></li>
<li><p><code>L7_ETMs.tif</code>에서 읽은 <code>stars</code> 객체를 <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code> 함수를 사용하여 <code>OGC:CRS84</code>로 변환하시오. 객체를 출력하시오. 이것이 규칙 그리드인지 확인하시오. 첫 번째 밴드를 <code>axes=TRUE</code>, <code>border=NA</code> 인수와 함께 플로팅하고, 왜 이렇게 시간이 오래 걸리는지 설명하시오.</p></li>
<li><p><code>L7_ETMs.tif</code> 객체를 <code><a href="https://r-spatial.github.io/stars/reference/st_warp.html">st_warp()</a></code> 함수를 사용하여 <code>OGC:CRS84</code>로 변환하시오. 결과 객체를 <code>axes=TRUE</code>로 플로팅하시오. 왜 <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code> 함수에 비해 플롯이 훨씬 더 빨리 생성되는지 설명하시오.</p></li>
<li><p>래스터 <code>L7_ETMs</code>의 벡터 표현을 사용하여 <code>POINT(293716 9113692)</code>를 중심으로 반지름 75 m인 원형 영역과의 교차를 플로팅하고, 이 원의 면적 가중 평균 픽셀 값을 계산하시오. 벡터 데이터에 <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code> 함수를 적용하여 얻은 결과와 래스터 데이터에 <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code> 함수를 적용하여 얻은 결과(<code>exact=FALSE</code> 및 <code>exact=TRUE</code> 각각)를 비교하고, 차이점을 설명하시오.</p></li>
</ol>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">그림&nbsp;7.1: <code>sf</code> 객체의 구조</span>
<span class="glightbox-desc lightbox-desc-2">그림&nbsp;7.2: 노스케롤라이나의 처음 일곱개 카운티</span>
<span class="glightbox-desc lightbox-desc-3">그림&nbsp;7.3: 오렌지 카운티(오렌지색), 반경 50 km 내의 카운티(검은색), 오랜지 카운티 주변의 버퍼(갈색), 나머지 카운티(회색)</span>
<span class="glightbox-desc lightbox-desc-4">그림&nbsp;7.4: <code>largest = TRUE</code> 인수를 적용한 <code><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join()</a></code> 함수의 예시. 아래쪽 그림의 폴리곤과 가장 넓은 면적이 겹치는 위쪽 그림의 폴리곤 라벨이 아래쪽 폴리곤에 할당되어 있다.</span>
<span class="glightbox-desc lightbox-desc-5">그림&nbsp;7.5: 교차의 결과는 측지선 혹은 대권호를 사용하느냐(왼쪽) 데카르트 좌표계를 사용하느냐에 따라 달라진다.</span>
<span class="glightbox-desc lightbox-desc-6">그림&nbsp;7.6: Landsat 7의 1번 밴드 이미지의 원형 중심부</span>
<span class="glightbox-desc lightbox-desc-7">그림&nbsp;7.7: 훈련 데이터로 사용된 무작위 표본 포인트: 빨간색은 해양부이고 노란색을 육지부를 나타낸다.</span>
<span class="glightbox-desc lightbox-desc-8">그림&nbsp;7.8: 그림 7.7의 훈련 데이터를 기반으로 한 육지부/수부 구분 선형 판별 분류 결과</span>
<span class="glightbox-desc lightbox-desc-9">그림&nbsp;7.9: 30 m 해상도의 Landsat 6개 밴드를 90 m로 다운샘플한 결과로 브라질의 올린다의 예시이다.</span>
<span class="glightbox-desc lightbox-desc-10">그림&nbsp;7.10: 컬러 합성의 두 가지 예시</span>
<span class="glightbox-desc lightbox-desc-11">그림&nbsp;7.11: 시간과 관측소별로 계산된 PM10 값에 대한 시공간 다이어그램</span>
<span class="glightbox-desc lightbox-desc-12">그림&nbsp;7.12: 관측소별 PM10 평균값</span>
<span class="glightbox-desc lightbox-desc-13">그림&nbsp;7.13: 임의의 여섯 날짜에 대한 지역 평균 PM10</span>
<span class="glightbox-desc lightbox-desc-14">그림&nbsp;7.14: 단일 주에 대한 지역 평균 PM10의 시계열 플롯</span>
<span class="glightbox-desc lightbox-desc-15">그림&nbsp;7.15: 영국 브리스톨의 102개 구역 현황(33번 구역(E02003043)이 빨간색으로 표시되어 있음)</span>
<span class="glightbox-desc lightbox-desc-16">그림&nbsp;7.16: 33번 존에 대한 OD 데이터를 추출한 후 교통수단별로 지도화하였다.</span>
<span class="glightbox-desc lightbox-desc-17">그림&nbsp;7.17: 출발지별 총통근(왼쪽)과 목적지별 총통근(오른쪽)</span>
<span class="glightbox-desc lightbox-desc-18">그림&nbsp;7.18: 출발지별 총통근 밀도(왼쪽)와 목적지별 총통근 밀도(오른쪽)</span>
<span class="glightbox-desc lightbox-desc-19">그림&nbsp;7.19: <code><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars()</a></code> 함수를 활용한 백터 지오메트리의 래스터화</span>
<span class="glightbox-desc lightbox-desc-20">그림&nbsp;7.20: 노스캐롤라이나 카운티 경계를 래스터로 전환하기</span>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "복사완료!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "복사완료!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./part_2.html" class="pagination-link  aria-label=" r="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">공간데이터사이언스와 R</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08.html" class="pagination-link" aria-label="<span class='chapter-number'>8</span>&nbsp; <span class='chapter-title'>공간데이터의 플로팅</span>">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">공간데이터의 플로팅</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","selector":".lightbox","openEffect":"zoom","descPosition":"bottom","loop":false});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>