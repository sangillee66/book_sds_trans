<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>공간데이터사이언스 개론 - 14&nbsp; 근접성과 에어리어 데이터</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./15.html" rel="next">
<link href="./13.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-area" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">근접성과 에어리어 데이터</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">공간데이터사이언스 개론</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/sangillee66/book_sds_trans" title="소스 코드" class="quarto-navigation-tool px-1" aria-label="소스 코드"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">서장</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">시작하기</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">좌표계</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">구체 지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">속성과 서포트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">데이터 큐브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터사이언스와 R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">sf와 stars</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">공간데이터의 플로팅</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">대용량 데이터와 클라우드 네이티브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간통계분석과 공간모델링</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">공간데이터의 통계적 모델링</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">포인트 패턴 분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">공간적 인터폴레이션</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">다변량 및 시공간 지구통계학</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">근접성과 에어리어 데이터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">공간적 자기상관 측도</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">공간적 회귀분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">공간계량경제학적 모델</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">부록</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">R 스페셜 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R 기초</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">목차</h2>
   
  <ul>
<li><a href="#%EA%B7%BC%EC%A0%91%EC%84%B1%EC%9D%98-%EC%9E%AC%ED%98%84-spdep-%ED%8C%A8%ED%82%A4%EC%A7%80%EC%9D%98-%EA%B2%BD%EC%9A%B0" id="toc-근접성의-재현-spdep-패키지의-경우" class="nav-link active" data-scroll-target="#%EA%B7%BC%EC%A0%91%EC%84%B1%EC%9D%98-%EC%9E%AC%ED%98%84-spdep-%ED%8C%A8%ED%82%A4%EC%A7%80%EC%9D%98-%EA%B2%BD%EC%9A%B0"><span class="header-section-number">14.1</span> 근접성의 재현: spdep 패키지의 경우</a></li>
  <li><a href="#%EC%9D%B4%EC%9B%83%EC%9D%98-%EA%B7%9C%EC%A0%95-%EC%97%B0%EC%A0%91%EC%84%B1-%EA%B8%B0%EB%B0%98" id="toc-이웃의-규정-연접성-기반" class="nav-link" data-scroll-target="#%EC%9D%B4%EC%9B%83%EC%9D%98-%EA%B7%9C%EC%A0%95-%EC%97%B0%EC%A0%91%EC%84%B1-%EA%B8%B0%EB%B0%98"><span class="header-section-number">14.2</span> 이웃의 규정: 연접성 기반</a></li>
  <li><a href="#%EC%9D%B4%EC%9B%83%EC%9D%98-%EA%B7%9C%EC%A0%95-%EA%B7%B8%EB%A6%AC%ED%94%84-%EA%B8%B0%EB%B0%98" id="toc-이웃의-규정-그리프-기반" class="nav-link" data-scroll-target="#%EC%9D%B4%EC%9B%83%EC%9D%98-%EA%B7%9C%EC%A0%95-%EA%B7%B8%EB%A6%AC%ED%94%84-%EA%B8%B0%EB%B0%98"><span class="header-section-number">14.3</span> 이웃의 규정: 그리프 기반</a></li>
  <li><a href="#%EC%9D%B4%EC%9B%83%EC%9D%98-%EA%B7%9C%EC%A0%95-%EA%B1%B0%EB%A6%AC-%EA%B8%B0%EB%B0%98" id="toc-이웃의-규정-거리-기반" class="nav-link" data-scroll-target="#%EC%9D%B4%EC%9B%83%EC%9D%98-%EA%B7%9C%EC%A0%95-%EA%B1%B0%EB%A6%AC-%EA%B8%B0%EB%B0%98"><span class="header-section-number">14.4</span> 이웃의 규정: 거리 기반</a></li>
  <li><a href="#%EA%B0%80%EC%A4%91%EC%B9%98-%EB%B6%80%EC%97%AC" id="toc-가중치-부여" class="nav-link" data-scroll-target="#%EA%B0%80%EC%A4%91%EC%B9%98-%EB%B6%80%EC%97%AC"><span class="header-section-number">14.5</span> 가중치 부여</a></li>
  <li><a href="#%EA%B3%A0%EC%B0%A8-%EC%9D%B4%EC%9B%83%EC%9D%98-%EA%B7%9C%EC%A0%95" id="toc-고차-이웃의-규정" class="nav-link" data-scroll-target="#%EA%B3%A0%EC%B0%A8-%EC%9D%B4%EC%9B%83%EC%9D%98-%EA%B7%9C%EC%A0%95"><span class="header-section-number">14.6</span> 고차 이웃의 규정</a></li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C" id="toc-연습문제" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C"><span class="header-section-number">14.7</span> 연습문제</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-area" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">근접성과 에어리어 데이터</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">2024년 11월 21일</p>
    </div>
  </div>
    
  </div>
  


</header><p>관측개체가 에어리어 객체인 경우는 매우 흔하다. 연구대상 전체에서 관측이 동시적으로 이루어지고 그러한 관측값이 비중첩 구역단위로 합산되는 경우가 여기에 해당한다. 이러한 구역단위는 행정구역인 경우가 많다. 물론 통근 플로와 같이 기저 공간 프로세스를 직접적으로 반영한 경우도 있지만, 보통은 프로세스와 관계없이 임의적으로 주어진다. 이러한 구역단위와 기저 공간 프로세스 간의 불일치는 동일한 공간적 프로세스가 인접한 구역단위 사이에서 부분적으로 공유된다는 것을 의미하며, 이러한 불일치가 해당 데이터셋 내의 단 하나의 변수에서라도 발생한다면, 전체적으로 공간적 자기상관의 문제가 야기된다고 할 수 있다. 여기서 근접성(proximity)이란 데이터 생성 프로세스라는 의미에서의 <em>가까움</em>(closeness)을 의미한다. 포인트 스포트를 사용하는 횡단 지구통계학 분석에서는 포인트 간 거리가 전형적인 데이터 생성 프로세스에 적합하다. 그런데, 에어리어 데이터의 경우는 거리보다는 공유 경계가 더 적합할 수 있다. 공유 경계는 우리가 확실히 측정할 수 있는 것이지만, 동일한 확실성 하에서 에어리어간 거리를 측정할 수 있는 방법은 없기 때문이다.</p>
<p>데이터의 스포트란 개별 관찰단위(관측개체)의 물리적 크기(길이, 면적, 부피)를 의미한다(5장 참조). 에어리어 데이터는 기본적으로 폴리곤 스포트를 가지지만 포인트 서포트를 가지는 것으로 재현할 수도 있다. 개별 폴리곤의 센트로이드 혹은 멀티폴리곤의 경우는 최대 폴리곤의 센트로이드를 대표 지점으로 삼을 수 있다. 반대로, 포인트 스포트를 가지는 데이터를 에어리어 데이터로 취급할 수도 있다. 이 경우 포인트를 비중첩 테셀레이션으로 전환해야 하는데, 들로네 삼각망을 통해 보로노이 다이어그램(디리클레 테셀레이션 혹은 티센 폴리곤)을 생성한다. 다른 메트릭이 선택될 수 있으며, 평면이 아닌 네트워크 상의 거리를 측정할 수도 있다. 국지적 공간 분석에서는 가중 보로노이 다이어그램이 사용되기도 한다(Boots and Okabe 2007; Okabe et al.&nbsp;2008; She et al.&nbsp;2015 참조).</p>
<p>데이터의 원 스포트가 포인트이지만, 기저의 공간 프로세스가 관측개체간의 거리가 아니라 오로지 인접성에 의거해 발생하는 경우라면, 데이터는 총빈도 혹은 총계(투표소의 개수, 총매출액)이거나 관측개체의 직접적 속성(예: 투표소의 개방 시간)일 수 있다. 이러한 모든 경우에서 기저의 공간 프로세스를 잘못 재현할 위험성이 상존함은 분명한 사실이다. 특히, 연구지역 전체를 하나의 테셀레이션 체계로 재현하는 경우, 관측값이 기저의 공간적 프로세스를 모두 포착해 낸 것으로 상정되기 때문에 더욱 그러하다. 이러한 측면에서 에어리어 데이터는 지구통계학적 데이터와는 다르다. 후자는 전체 지역에 대해 특정한 방식의 샘플링이 적용되었다는 것을 전제하지만 전자는 그렇지 않다. 또한 생태 및 환경 분석에서 사용되는 에어리어 샘플링과도 다른데, 그러한 샘플링은 지역 전체가 아니라 일부 영역에 대해 선택적으로 이루어진다.</p>
<p>15~17장에 걸쳐 에어리어 데이터를 탐색 및 분석하기 위한 기법들이 다루어진다. 이를 위해서는 관측개체 간의 근접성을 나타내는 특정한 방식이 요구된다. 이 장에서는 근접성을 연접성(contiguity)에 의거해 규정하는 방식에 집중한다. 여기서 연접성은 이웃으로 정의된 관측개체들을 서로 연결한 그래프를 통해 규정된다. 이 그래프는 보통 방향성과 가중치가 없지만, 특정 설정에서는 방향과 가중치가 부여될 수도 있으며, 이 경우 대칭성에 대한 추가적인 이슈가 야기될 수 있다. 원칙적으로, 근접성은 공간 상에서 대칭적으로 작동하는 것으로 간주한다. 즉, <span class="math inline">\(i\)</span>가 <span class="math inline">\(j\)</span>에 미치는 영향과 <span class="math inline">\(j\)</span>가 <span class="math inline">\(i\)</span>에 미치는 영향은 동일한 것으로 간주한다. 일반적으로 에지 효과(edge effect)는 고려하지 않는다.</p>
<section id="근접성의-재현-spdep-패키지의-경우" class="level2" data-number="14.1"><h2 data-number="14.1" class="anchored" data-anchor-id="근접성의-재현-spdep-패키지의-경우">
<span class="header-section-number">14.1</span> 근접성의 재현: spdep 패키지의 경우</h2>
<p>공간적 자기상관을 그래프 상의 이웃들의 관계를 통해 다루는 접근의 경우, 해당 그래프는 주어진 것이고, 그 그래프를 연구자가 선택한 것으로 간주한다. 이것은 지구통계학적 접근과는 다른 것인데, 연구자는 경험적 베리오그램의 거리를 어떻게 나눌 것인지, 어떤 함수를 적용할 것인지, 베리오그램 적합을 어떻게 수행할 것인지를 모두 선택한다. 두 접근법 모두 사전 선택을 포함하지만, 기저의 상관성을 재현하는 방식에서는 서로 다른 것이다(Wall 2004). 그래프에 기반한 이웃 규정 방식을 보다 넓은 맥락에서 설명하는 시도도 존재한다(Bavaud, 1998).</p>
<p>이웃 관계를 나타내는 객체를 생성할 때 이웃이 없는 구역단위의 존재는 문제를 야기한다(Bivand and Portnov 2004). 섬이나 강으로 분리된 구역단위가 이러한 비이웃 구역단위일 수 있는데, 구역단위에 에어리어 스포터가 적용되어 있고 공유 경계와 같은 위상 관계가 사용되는 경우이다. 예를 들어, <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html">mgcv::gam</a></code>과 같은 모델 적합 함수에서 <code>mrf</code>(마르코프 랜덤 필드) 항을 사용할 때, 방향이 없는 필요하지만, 그래프가 분리된 하위 그래프들로 구성되는 경우 에러가 발생한다.</p>
<p>이러한 무이웃 문제는 포인트 간의 거리로 이웃을 규정하는 경우에도 발생할 수 있는데, 거리 임계값이 최근린 이웃 거리보다 작은 경우가 여기에 해당된다. 공유 경계에 기반한 연접성 규정은 비투영 경위도 좌표를 사용하더라도 영향을 받지 않지만, 모든 포인트 기반 접근법은 어쨌든 거리를 사용하며, 적절한 방식으로 거리를 계산할 필요가 있다.</p>
<p><strong>spdep</strong> 패키지는 이웃을 규정하는 <code>nb</code> 클래스를 제공한다. <code>nb</code> 클래스는 관측개체의 수를 길이로 갖는 리스트로 정수 벡터를 구성 요소로 갖는다. 이웃이 없는 경우는 <code>0L</code>이 단일 요소로 포함된 정수 벡터로 인코딩된다. 이웃이 있는 경우는 <code>1L:n</code> 범위 내의 값이 포함된 정수 벡터로 인코딩되는데, 그 값들은 이웃으로 규정된 관측개체의 인덱스값이다. 이것은 소위 행-기반 희소 재현(row-oriented sparse representation) 방식이다. <strong>spdep</strong> 패키지는 <code>nb</code> 객체를 생성하는 다양한 방법을 제공하며, 이 표현과 생성 함수는 다른 패키지에서도 널리 사용된다.</p>
<p><strong>spdep</strong> 패키지는 <code>nb</code> 클래스(무방향 혹은 유방향 그래프)를 통해 <code>listw</code> 객체를 구성한다. <code>listw</code> 객체는 세 가지 구성 요소를 갖는 리스트로, <code>nb</code> 객체, 가중치 리스트, 그리고 가중치 계산 방식을 나타내는 단일 요소 문자 벡터가 포함된다. 사회과학에서 가장 흔히 사용되는 방법은 행 표준화를 통해 가중치를 계산하는 것인데, 개별 관측개체의 한 이웃의 가중치는 해당 관측개체의 이웃의 수(즉 카드널리티)의 역수(즉, <code>1/card(nb)[i]</code>)로 변환된다.</p>
<p>이 장에서는 2015년 폴란드 대통령 선거 데이터를 사용하는데, 지역 전체가 2,495개의 지방자치단체와 바르샤바 구역으로 구성되어 있다(그림 14.1 참조). 이 지도는 <strong>tmap</strong> 패키지(8.5절)를 활용해 그려진 것으로 지방자치단체 유형이 표시되어 있다. 구역단위는 <code>sf</code> 객체이며, 투표소 단위의 결과를 구역단위로 집계한 데이터이다.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co"># Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">pol_pres15</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span><span class="op">)</span></span>
<span><span class="va">pol_pres15</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">TERYT</span>, <span class="va">name</span>, <span class="va">types</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Simple feature collection with 6 features and 3 fields</span></span>
<span><span class="co"># Geometry type: MULTIPOLYGON</span></span>
<span><span class="co"># Dimension:     XY</span></span>
<span><span class="co"># Bounding box:  xmin: 235000 ymin: 367000 xmax: 281000 ymax: 413000</span></span>
<span><span class="co"># Projected CRS: ETRS89 / Poland CS92</span></span>
<span><span class="co">#    TERYT                name       types</span></span>
<span><span class="co"># 1 020101         BOLESŁAWIEC       Urban</span></span>
<span><span class="co"># 2 020102         BOLESŁAWIEC       Rural</span></span>
<span><span class="co"># 3 020103            GROMADKA       Rural</span></span>
<span><span class="co"># 4 020104        NOWOGRODZIEC Urban/rural</span></span>
<span><span class="co"># 5 020105          OSIECZNICA       Rural</span></span>
<span><span class="co"># 6 020106 WARTA BOLESŁAWIECKA       Rural</span></span>
<span><span class="co">#                         geometry</span></span>
<span><span class="co"># 1 MULTIPOLYGON (((261089 3855...</span></span>
<span><span class="co"># 2 MULTIPOLYGON (((254150 3837...</span></span>
<span><span class="co"># 3 MULTIPOLYGON (((275346 3846...</span></span>
<span><span class="co"># 4 MULTIPOLYGON (((251770 3770...</span></span>
<span><span class="co"># 5 MULTIPOLYGON (((263424 4060...</span></span>
<span><span class="co"># 6 MULTIPOLYGON (((267031 3870...</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/">tmap</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Breaking News: tmap 3.x is retiring. Please test v4, e.g. with</span></span>
<span><span class="co"># remotes::install_github('r-tmap/tmap')</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">"types"</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-14-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-14-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/14-Areal_files/figure-html/fig-plotpolpres15-1.png" class="lightbox" data-glightbox="description: .lightbox-desc-1" data-gallery="quarto-lightbox-gallery-1"><img src="https://r-spatial.org/book/14-Areal_files/figure-html/fig-plotpolpres15-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-14-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;14.1: 폴란드 구역단위 유형(2015년)
</figcaption></figure>
</div>
<p><code>sf</code> 객체의 위상 구조의 유효성을 검토한다.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_is_valid</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">pol_pres15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>2002년 초부터 2019년 4월까지, <code>spdep</code>는 이웃 및 공간 가중치 객체를 생성하고 처리하는 함수, 공간적 자기상관을 검정하는 함수, 모델 적합과 관련된 함수 등을 포함하고 있었다. 모델 적합과 관련된 함수는 <code>spatialreg</code>로 분리되었으며, 이후 장에서 다룰 예정이다. 현재 <code>spdep</code>(Bivand 2022)는 <code>sf</code> 클래스와 <code>sp</code> 클래스 객체 모두를 지원한다.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="이웃의-규정-연접성-기반" class="level2" data-number="14.2"><h2 data-number="14.2" class="anchored" data-anchor-id="이웃의-규정-연접성-기반">
<span class="header-section-number">14.2</span> 이웃의 규정: 연접성 기반</h2>
<p><strong>spdep</strong> 패키지의 <code>poly2nb</code> 함수는 <code>pl</code> 아규먼트를 통해 투입된 객체에서 폴리곤 경계를 구성하고 있는 경계 포인트들을 이용한다. 투입 객체는 일반적으로 <code>"POLYGON"</code> 또는 <code>"MULTIPOLYGON"</code> 지오메트리를 가진 <code>"sf"</code> 또는 <code>"sfc"</code> 객체이다. 각 관측개체에 대해, 최소한 하나의 포인트(디폴트 퀸 방식, <code>queen=TRUE</code>) 또는 최소 두 개의 포인트(루크 방식, <code>queen=FALSE</code>)가 <code>snap</code> 거리 내에 또 다른 포인트(역자주: 연접 폴리곤의 경계 포인트)를 가지는지를 확인한다. 거리 계산은 투영법에 관계없이 원 길이 단위에 기반한 평면 거리로 이루어진다. 필요한 수의 충분히 가까운 점을 찾으면, 검색이 중단된다.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html">args</a></span><span class="op">(</span><span class="va">poly2nb</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#  function (pl, row.names = NULL, snap = sqrt(.Machine$double.eps),</span></span>
<span><span class="co">#    queen = TRUE, useC = TRUE, foundInBox = NULL)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>spdep</strong> 패키지 1.1-7부터, <code>poly2nb</code> 함수는 후보 이웃을 찾고 <code>foundInBox</code>를 내부적으로 채우기 위해 <strong>sf</strong> 패키지의 GEOS 인터페이스를 사용한다. 이 경우, <strong>sf</strong> 패키지를 통한 GEOS의 공간 인덱싱(STRtree 쿼리 사용)이 기본값으로 설정된다.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pol_pres15</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span>queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">nb_q</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>print</code> 메서드는 이웃 객체의 요약 구조를 표시한다.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nb_q</span></span>
<span><span class="co"># Neighbour list object:</span></span>
<span><span class="co"># Number of regions: 2495 </span></span>
<span><span class="co"># Number of nonzero links: 14242 </span></span>
<span><span class="co"># Percentage nonzero weights: 0.229 </span></span>
<span><span class="co"># Average number of links: 5.71</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>sf</strong> 패키지 버전 1.0-0부터는 구체 지오메트리를 위해 기본적으로 <strong>s2</strong> 패키지(Dunnington, Pebesma, and Rubak 2023)가 사용된다. 이는 <code>poly2nb</code> 함수에서 사용되는 <code>st_intersects</code> 함수가 계산을 <code><a href="https://r-spatial.github.io/s2/reference/s2_closest_feature.html">s2::s2_intersects_matrix</a></code>로 전달하기 때문이다(4장 참조). <strong>spdep</strong> 패키지 버전 1.1-9부터는 <code><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2()</a></code>가 <code>TRUE</code>일 경우 구체 인터섹션을 사용하여 후보 이웃을 찾는다. GEOS와 마찬가지로, <code>s2</code> 라이브러리는 빠른 공간 인덱싱을 사용한다.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">old_use_s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">pol_pres15</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="st">"OGC:CRS84"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pol_pres15_ll</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span>queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">nb_q_s2</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>예시의 경우, 구면 교차와 평면 교차가 동일한 인접 이웃을 생성한다. 두 경우 모두 투입 지오메트리의 유효성이 담보되어야 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="va">nb_q</span>, <span class="va">nb_q_s2</span>, check.attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>nb</code> 객체는 대칭적인 이웃 관계인 <span class="math inline">\(i\)</span>에서 <span class="math inline">\(j\)</span>, <span class="math inline">\(j\)</span>에서<span class="math inline">\(i\)</span>를 모두 기록하는데, 이는 <code>nb</code> 객체가 비대칭적인 관계도 허용하기 때문이다. 그러나 객체 생성에는 이러한 중복이 큰 의미는 없다.</p>
<p>대부분의 <strong>spdep</strong> 패키지 함수는 이웃 객체를 생성할 때 <code>row.names</code> 아규먼트를 사용하며, 이 값은 <code>region.id</code> 속성으로 저장된다. 만약 <code>row.names</code> 아규먼트가 지정되지 않으면, 첫 번째 아규먼트의 <code><a href="https://rdrr.io/r/base/row.names.html">row.names()</a></code>에서 가져온다. <code>region.id</code> 속성은 <code>nb</code> 객체가 원 데이터와 동일한 순서로 정리되어 있는지를 확인하는 데 사용된다. <code>nb</code> 객체의 일부만 추출할 경우 인덱스는 <code>1:length(subsetted_nb)</code> 범위 내의 값으로 재설정되지만, <code>region.id</code> 속성 값을 통해 원본 객체와 정확한 연결 정보를 확인할 수 있다. 이는 17.4절에서 간략하게 논의될 공간적 회귀 모델의 샘플 외 예측에서 사용된다.</p>
<p><code>n.comp.nb</code> 함수를 사용하여 이 비방향 그래프의 연결성을 확인할 수도 있다. 일부 모델 추정 기법은 비연결 그래프를 지원하지 않지만, 비연결 그래프가 야기할 가능한 문제를 인지하고 있는 것은 중요하다(Freni-Sterrantino, Ventrucci, and Rue 2018).</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">nb_q</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/compon.html">n.comp.nb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">nc</span></span>
<span><span class="co"># [1] 1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 접근법은 이웃 객체를 그래프처럼 취급하고 해당 그래프에 대해 그래프 분석을 수행하는 것과 동일하다(Csardi and Nepusz 2006; Nepusz 2022). 먼저 이웃 객체를 이진 희소 행렬로 변환한 후 그래프 분석을 수행한다(Bates, Maechler, and Jagan 2022).</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org">Matrix</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spatialreg/">spatialreg</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">nb_q</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span>style <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/methods/as.html">as</a></span><span class="op">(</span><span class="st">"CsparseMatrix"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">smat</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/">igraph</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">smat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r.igraph.org/reference/graph.adjacency.html">graph.adjacency</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">g1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r.igraph.org/reference/components.html">count_components</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] 1</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다른 소프트웨어와의 호환성을 위해 이웃 객체를 GAL 형식으로 내보내고 가져올 수 있다. 이를 위해 <code>write.nb.gal</code>함수와 <code>read.gal</code> 함수가 사용된다.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".gal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/write.nb.gal.html">write.nb.gal</a></span><span class="op">(</span><span class="va">nb_q</span>, <span class="va">tf</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="이웃의-규정-그리프-기반" class="level2" data-number="14.3"><h2 data-number="14.3" class="anchored" data-anchor-id="이웃의-규정-그리프-기반">
<span class="header-section-number">14.3</span> 이웃의 규정: 그리프 기반</h2>
</section><section id="이웃의-규정-거리-기반" class="level2" data-number="14.4"><h2 data-number="14.4" class="anchored" data-anchor-id="이웃의-규정-거리-기반">
<span class="header-section-number">14.4</span> 이웃의 규정: 거리 기반</h2>
</section><section id="가중치-부여" class="level2" data-number="14.5"><h2 data-number="14.5" class="anchored" data-anchor-id="가중치-부여">
<span class="header-section-number">14.5</span> 가중치 부여</h2>
</section><section id="고차-이웃의-규정" class="level2" data-number="14.6"><h2 data-number="14.6" class="anchored" data-anchor-id="고차-이웃의-규정">
<span class="header-section-number">14.6</span> 고차 이웃의 규정</h2>
</section><section id="연습문제" class="level2" data-number="14.7"><h2 data-number="14.7" class="anchored" data-anchor-id="연습문제">
<span class="header-section-number">14.7</span> 연습문제</h2>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">그림&nbsp;14.1: 폴란드 구역단위 유형(2015년)</span>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "복사완료!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "복사완료!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./13.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">다변량 및 시공간 지구통계학</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./15.html" class="pagination-link" aria-label="<span class='chapter-number'>15</span>&nbsp; <span class='chapter-title'>공간적 자기상관 측도</span>">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">공간적 자기상관 측도</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"selector":".lightbox","closeEffect":"zoom","loop":false,"descPosition":"bottom","openEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>