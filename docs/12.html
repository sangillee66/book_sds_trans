<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>공간데이터사이언스 개론 - 12&nbsp; 공간적 인터폴레이션</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13.html" rel="next">
<link href="./11.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-interpolation" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">공간적 인터폴레이션</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">공간데이터사이언스 개론</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/sangillee66/book_sds_trans" title="소스 코드" class="quarto-navigation-tool px-1" aria-label="소스 코드"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">서장</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">시작하기</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">좌표계</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">구체 지오메트리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">속성과 서포트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">데이터 큐브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간데이터사이언스와 R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">sf와 stars 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">공간데이터의 플로팅</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">대규모 데이터와 클라우드 네이티브</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공간통계분석과 공간모델링</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">공간데이터의 통계적 모형화</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">포인트 패턴 분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">공간적 인터폴레이션</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">다변량 및 시공간 지구통계학</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">근접성과 에어리어 데이터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">공간적 자기상관 측도</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">공간적 회귀분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">공간계량경제학적 모형</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">부록</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">예전 R 공간 패키지</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R 기초</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">목차</h2>
   
  <ul>
<li><a href="#%EC%B2%AB-%EB%B2%88%EC%A7%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B" id="toc-첫-번째-데이터셋" class="nav-link active" data-scroll-target="#%EC%B2%AB-%EB%B2%88%EC%A7%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B"><span class="header-section-number">12.1</span> 첫 번째 데이터셋</a></li>
  <li><a href="#%EC%83%98%ED%94%8C-%EB%B2%A0%EB%A6%AC%EC%98%A4%EA%B7%B8%EB%9E%A8" id="toc-샘플-베리오그램" class="nav-link" data-scroll-target="#%EC%83%98%ED%94%8C-%EB%B2%A0%EB%A6%AC%EC%98%A4%EA%B7%B8%EB%9E%A8"><span class="header-section-number">12.2</span> 샘플 베리오그램</a></li>
  <li><a href="#%EB%B2%A0%EB%A6%AC%EC%98%A4%EA%B7%B8%EB%9E%A8-%EB%AA%A8%ED%98%95-%EC%A0%81%ED%95%A9" id="toc-베리오그램-모형-적합" class="nav-link" data-scroll-target="#%EB%B2%A0%EB%A6%AC%EC%98%A4%EA%B7%B8%EB%9E%A8-%EB%AA%A8%ED%98%95-%EC%A0%81%ED%95%A9"><span class="header-section-number">12.3</span> 베리오그램 모형 적합</a></li>
  <li><a href="#%ED%81%AC%EB%A6%AC%EA%B9%85-%EC%9D%B8%ED%84%B0%ED%8F%B4%EB%A0%88%EC%9D%B4%EC%85%98" id="toc-크리깅-인터폴레이션" class="nav-link" data-scroll-target="#%ED%81%AC%EB%A6%AC%EA%B9%85-%EC%9D%B8%ED%84%B0%ED%8F%B4%EB%A0%88%EC%9D%B4%EC%85%98"><span class="header-section-number">12.4</span> 크리깅 인터폴레이션</a></li>
  <li><a href="#%EC%97%90%EC%96%B4%EB%A6%AC%EC%96%B4-%ED%8F%89%EA%B7%A0-%EB%B8%94%EB%A1%9D-%ED%81%AC%EB%A6%AC%EA%B9%85" id="toc-에어리어-평균-블록-크리깅" class="nav-link" data-scroll-target="#%EC%97%90%EC%96%B4%EB%A6%AC%EC%96%B4-%ED%8F%89%EA%B7%A0-%EB%B8%94%EB%A1%9D-%ED%81%AC%EB%A6%AC%EA%B9%85"><span class="header-section-number">12.5</span> 에어리어 평균: 블록 크리깅</a></li>
  <li><a href="#%EC%A1%B0%EA%B1%B4%EB%B6%80-%EC%8B%9C%EB%AE%AC%EB%A0%88%EC%9D%B4%EC%85%98" id="toc-조건부-시뮬레이션" class="nav-link" data-scroll-target="#%EC%A1%B0%EA%B1%B4%EB%B6%80-%EC%8B%9C%EB%AE%AC%EB%A0%88%EC%9D%B4%EC%85%98"><span class="header-section-number">12.6</span> 조건부 시뮬레이션</a></li>
  <li>
<a href="#%EA%B2%BD%ED%96%A5-%EB%AA%A8%ED%98%95" id="toc-경향-모형" class="nav-link" data-scroll-target="#%EA%B2%BD%ED%96%A5-%EB%AA%A8%ED%98%95"><span class="header-section-number">12.7</span> 경향 모형</a>
  <ul class="collapse">
<li><a href="#%EC%9D%B8%EA%B5%AC-%EB%B0%80%EB%8F%84-%EA%B7%B8%EB%A6%AC%EB%93%9C" id="toc-인구-밀도-그리드" class="nav-link" data-scroll-target="#%EC%9D%B8%EA%B5%AC-%EB%B0%80%EB%8F%84-%EA%B7%B8%EB%A6%AC%EB%93%9C"><span class="header-section-number">12.7.1</span> 인구 밀도 그리드</a></li>
  </ul>
</li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C" id="toc-연습문제" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C"><span class="header-section-number">12.8</span> 연습문제</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-interpolation" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">공간적 인터폴레이션</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">2025년 8월 13일</p>
    </div>
  </div>
    
  </div>
  


</header><p>공간적 인터폴레이션은 관측된 위치 정보를 바탕으로, 관측되지 않은 공간 위치에서 공간적으로 연속적인 변수(필드)의 값을 추정하는 과정이다. 이를 위한 통계적 방법론을 지구통계학(geostatistics)이라 하며, 공간적으로 연속적인 현상의 모형화, 예측, 그리고 시뮬레이션에 중점을 둔다. 공간적 인터폴레이션의 전형적인 적용 사례는 결측값 문제이다. 즉, 연구 대상 지역에서 한정된 샘플 위치 <span class="math inline">\(s_i,i=1,...,n\)</span> 에서만 특정 현상의 속성 <span class="math inline">\(Z(s)\)</span>가 관측되었을 때, 이를 바탕으로 해당 연구 내 모든 위치 <span class="math inline">\(s_0\)</span>에서의 속성값을 추정하는 것이다. 관측되지 않은 위치에 대해 속성값을 예측하는 이러한 과정을 크리깅(kriging) 또는 가우시안 프로세스 예측(Gaussian Process prediction)이라고도 부른다. 만일 <span class="math inline">\(Z(s)\)</span>에 화이트 노이즈 성분인 <span class="math inline">\(\epsilon\)</span>이 포함되어 있다면, 이를 <span class="math inline">\(Z(s)=S(s)+\epsilon\)</span> (측정 오차 포함) 형태로 나타낼 수 있다. 이 경우, <span class="math inline">\(Z(s)\)</span> 자체가 아니라 오차가 제거된 <span class="math inline">\(S(s)\)</span>를 예측하거나 시뮬레이션하는 것이 대안적인 목표가 될 수 있다. 이러한 과정을 보통 <em>공간 필터링</em>(spatial filtering) 또는 <em>평활화</em>(smoothing)라고 부른다.</p>
<p>이 장에서는 지구통계학적 데이터를 다루는 간단한 접근법, 기초적인 인터폴레이션 기법, 그리고 공간적 자기상관, 공간 예측 및 시뮬레이션 모형화를 다룬다. 13장에서는 다변량 및 시공간 지구통계학적 모형과 같이 보다 복잡한 모형에 중점을 둔다. 주요 도구로는 <strong>gstat</strong> 패키지(Pebesma and Graeler 2022; Pebesma 2004)를 사용하며, 이 패키지는 다양한 비베이지안 지구통계 분석 모형과 옵션을 제공한다. R로 구현된 베이지안 방법은 Diggle, Tawn, and Moyeed (1998), Diggle and Ribeiro Jr.&nbsp;(2007), Blangiardo and Cameletti (2015), Wikle, Zammit-Mangion, and Cressie (2019)에서 확인할 수 있다. 대용량 데이터셋 분석에 활용되는 기법의 개요와 비교는 Heaton et al.&nbsp;(2018)에 제시되어 있다.</p>
<section id="첫-번째-데이터셋" class="level2" data-number="12.1"><h2 data-number="12.1" class="anchored" data-anchor-id="첫-번째-데이터셋">
<span class="header-section-number">12.1</span> 첫 번째 데이터셋</h2>
<p><strong>gstat</strong> 패키지에 포함된 평균 NO₂ 데이터셋을 불러온다. 이 데이터셋은 13장에서 준비된 것이다.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">no2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"external/no2.csv"</span>, </span>
<span>    package <span class="op">=</span> <span class="st">"gstat"</span><span class="op">)</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 데이터셋에 UTM 투영을 적용한 뒤, 이를 <code>sf</code> 객체로 변환한다.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co"># Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE</span></span>
<span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:32632"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">no2</span>, crs <span class="op">=</span> <span class="st">"OGC:CRS84"</span>, coords <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"station_longitude_deg"</span>, <span class="st">"station_latitude_deg"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">crs</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">no2.sf</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그다음, 국가 행정 경계를 불러오고, <strong>ggplot2</strong> 패키지를 사용해 지도를 작성한다(그림 12.1).</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"data/de_nuts1.gpkg"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">crs</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">de</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-12-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-plotDE-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-plotDE-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.1: 독일의 농촌 지역 관측소들에 높은 평균 NO<span class="math inline">\(_2\)</span> 값이 집중해 있다.
</figcaption></figure>
</div>
<p>이 데이터를 바탕으로 공간적 인터폴레이션을 수행하려면, 먼저 예측을 수행할 위치를 결정해야 한다. 일반적으로는 연구 대상 지역 전체를 덮는 규칙 그리드를 사용한다. 객체 <code>de</code>의 국가 윤곽에 맞추어, 독일 전역을 커버하는 10 km × 10 km의 규칙적 그리드를 생성한다. 그리드 셀의 크기를 지난치게 세밀하게 설정하지 않은 것은, 플롯에서 결과를 눈으로 확인하기 위함이다.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">de</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span>dx <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">de</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">grd</span></span>
<span><span class="va">grd</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#         Min. 1st Qu. Median Mean 3rd Qu. Max. NA's</span></span>
<span><span class="co"># values     0       0      0    0       0    0 2076</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#   from to  offset  delta            refsys x/y</span></span>
<span><span class="co"># x    1 65  280741  10000 WGS 84 / UTM z... [x]</span></span>
<span><span class="co"># y    1 87 6101239 -10000 WGS 84 / UTM z... [y]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>가장 단순한 공간적 인터폴레이션 기법 중 하나는 역거리 가중법(inverse distance weighted)이다. 이 방법은 예측 지점으로부터의 거리의 역비례하는 가중치를 부여하여 가중 평균을 계산한다.</p>
<p><span class="math display">\[
\hat{z}(s_0)=\frac{\sum^n_{i=1} w_iz(s_i)}{\sum^n_{i=1}w_i}
\]</span></p>
<p>여기서 가중치는 <span class="math inline">\(w_i=|s_0-s_i|^{-p}\)</span>로 주어지며, 지수(<span class="math inline">\(p\)</span>)는 일반적으로 2를 사용하지만 교차검증을 통해 최적값을 찾을 수도 있다. <strong>gstat</strong> 패키지의 <code><a href="https://r-spatial.github.io/gstat/reference/krige.html">idw()</a></code> 함수를 사용하면 역거리 가중 인터폴레이션을 쉽게 수행할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/">gstat</a></span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/krige.html">idw</a></span><span class="op">(</span><span class="va">NO2</span><span class="op">~</span><span class="fl">1</span>, <span class="va">no2.sf</span>, <span class="va">grd</span><span class="op">)</span></span>
<span><span class="co"># [inverse distance weighted interpolation]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그 결과는 그림 12.2에 나타나 있다.</p>
<div id="fig-12-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-idw-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-idw-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.2: 독일 NO<span class="math inline">\(_2\)</span> 집중도에 대한 역거리 가중 인터폴레이션의 결과
</figcaption></figure>
</div>
</section><section id="샘플-베리오그램" class="level2" data-number="12.2"><h2 data-number="12.2" class="anchored" data-anchor-id="샘플-베리오그램">
<span class="header-section-number">12.2</span> 샘플 베리오그램</h2>
<p>지구통계학적 방법으로 공간 예측을 수행하려면 먼저 평균과 공간적 자기상관을 설명할 수 있는 모형을 설정해야 한다. 가장 단순한 모형은 <span class="math inline">\(Z(s)=m+e(s)\)</span>로, 여기서 <span class="math inline">\(m\)</span>은 알려지지 않은 상수 평균값이며, 공간적 자기상관은 <span class="math inline">\(\gamma (h)=0.5E(Z(s)-Z(s+h))^2\)</span> 형태의 베리오그램(variogram)으로 표현된다. 유한한 분산 <span class="math inline">\(C(0)\)</span>를 가지는 경우에는 <span class="math inline">\(\gamma (h)=C(0)-C(h)\)</span>가 성립하며, 이를 통해 베리오그램이 코베리오그램(covariogram) 또는 공분산 함수와 밀접하게 연결되어 있음을 알 수 있다.</p>
<p>샘플 베리오그램은 거리 구간 <span class="math inline">\(h_i=[h_{i,0},h_{i,1}]\)</span>별 <span class="math inline">\(\gamma(h)\)</span>으의 추정값을 계산하여 얻는다.</p>
<p><span id="eq-12-1"><span class="math display">\[
\hat{\gamma}(h_i)=\frac{1}{2N(h_i)}\sum^{N(h_i)}_{j=1}(z(s_i)-z(s_i+h'))^2,\quad h_{i,0}\le h' \lt h_{i,1}
\tag{12.1}\]</span></span></p>
<p>여기에서 <span class="math inline">\(N(h_i)\)</span>는 거리 구간 <span class="math inline">\(h_i\)</span>에 속하는 모든 샘플 쌍의 개수를 의미한다(역자주: 즉, 샘플 쌍 간의 거리가 해당 구간 내에 포함되는 경우의 개수를 의미한다). <strong>gstat</strong> 패키지의 <code><a href="https://r-spatial.github.io/gstat/reference/variogram.html">variogram()</a></code> 함수를 사용하면 이러한 샘플 베리오그램을 계산할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/variogram.html">variogram</a></span><span class="op">(</span><span class="va">NO2</span><span class="op">~</span><span class="fl">1</span>, <span class="va">no2.sf</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그림 12.3은 계산된 베리오그램 결과를 플롯으로 나타낸 것이다.</p>
<div id="fig-12-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-vgm-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-vgm-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.3: 샘플 베리오그램 플롯
</figcaption></figure>
</div>
<p><code><a href="https://r-spatial.github.io/gstat/reference/variogram.html">variogram()</a></code> 함수는 기본적으로 최대 거리(<code>cutoff</code>)를 바운딩 박스의 대각선 길이의 1/3로, 구간 너비(<code>width</code>)를 <code>cutoff</code>를 15로 나눈 값으로 설정한다. 이러한 기본값은 다음과 같이 변경할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">v0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/variogram.html">variogram</a></span><span class="op">(</span><span class="va">NO2</span><span class="op">~</span><span class="fl">1</span>, <span class="va">no2.sf</span>, cutoff <span class="op">=</span> <span class="fl">100000</span>, width <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>변경된 설정값을 적용한 결과는 그림 12.4에 나타나 있다.</p>
<div id="fig-12-4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-vgm2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" data-glightbox="description: .lightbox-desc-4"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-vgm2-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.4: 변경된 설정값을 적용하여 생성한 샘플 베리오그램
</figcaption></figure>
</div>
<p>공식 <code>NO₂~1</code>은 데이터 파일(NO₂)에서 관심 변수를 선택하고 평균 모형을 지정하는 데 사용된다. 여기서 <code>~1</code>은 절편만 포함된(알려지지 않은 상수 평균을 가정하는) 모형을 의미한다.</p>
</section><section id="베리오그램-모형-적합" class="level2" data-number="12.3"><h2 data-number="12.3" class="anchored" data-anchor-id="베리오그램-모형-적합">
<span class="header-section-number">12.3</span> 베리오그램 모형 적합</h2>
<p>공간 예측을 수행하려면, 앞에서 도출한 거리 구간별 추정값이 아니라 이론적으로 모든 거리 <span class="math inline">\(h\)</span>에 적용할 수 있는 베리오그램 <em>모형</em> <span class="math inline">\(\gamma(h)\)</span>가 필요하다. 구간별 추정값을 단순히 직선으로 연결하거나 각 구간에서 일정한 값이라고 가정하면 문제가 발생한다. 이는 비양수 정의 공분산 행렬(non-positive definite covariance matrices)을 전제하게 되며, 이러한 행렬을 기반으로 한 통계 모형은 예측에 사용할 수 없다(역자주: 샘플 베리오그램의 구간별 평균값(위의 그림 12.3과 12.4의 포인트들)을 단순히 직선으로 연결하거나 각 구간에서 일정한 값으로 고정하면, 이를 바탕으로 계산된 공분산 행렬이 양의 정부호(positive definite) 조건이라는 수학적 제약을 만족하지 못할 수 있다. 따라서 다음에 나오는 내용처럼, 관측값만 반영한 비모수적 연결 대신 반드시 이론적으로 타당한 형태를 가진 파라메트릭 베리오그램 모형을 적합해야 한다.)</p>
<p>이 문제를 피하기 위해, 파라메트릭 형태의 <span class="math inline">\(\gamma (h)\)</span>를 적합하여 추정값 <span class="math inline">\(\hat{\gamma} (h)\)</span>를 구한다. 여기서 <span class="math inline">\(\hat{\gamma} (h)\)</span>는 <span class="math inline">\(\gamma (h)\)</span>를 추정하는 데 사용된 모든 <span class="math inline">\(h'\)</span> 값의 평균값으로 설정된다. 예를 들어, 다음과 같은 지수형 베리오그램 모형을 적합할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">v.m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/fit.variogram.html">fit.variogram</a></span><span class="op">(</span><span class="va">v</span>, <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/vgm.html">vgm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"Exp"</span>, <span class="fl">50000</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>결과는 그림 12.5에 제시되어 있다.</p>
<div id="fig-12-5" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-fitvariogrammodel-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" data-glightbox="description: .lightbox-desc-5"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-fitvariogrammodel-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.5: 샘플 베리오그램(가운데가 비어 있는 점) 위에, 가중 최소제곱법(실선) 및 최대우도추정법(점선)으로 적합한 모형이 함께 표시되어 있다.
</figcaption></figure>
</div>
<p>선의 적합에는 다음 식을 최소화하는 가중 최소제곱법이 적용되었다.</p>
<p><span id="eq-12-2"><span class="math display">\[
\sum^n_{i=1}w_i(\gamma (h_i)-\hat{\gamma}(h_i))^2,
\tag{12.2}\]</span></span></p>
<p>여기에서 가중치의 기본값은 <span class="math inline">\(N(h_i)/h^2\)</span>로 주어지며, <code>fit.method</code> 인수를 통해 다른 가중치 옵션을 선택할 수 있다.</p>
<p>가중 최소제곱법 적합의 대안으로 최대우도(ML) 또는 제한 최대우도(parameter estimation) 모수 추정법(Kitanidis and Lane 1985)을 사용할 수 있다. 이 사례에서는 그림 12.5에서 점선으로 나타난 것처럼, 비교적 유사한 적합 모형이 도출되었다. ML 접근법의 장점은 식 12.1에서 거리 구간 <span class="math inline">\(h_i\)</span>나 식 12.2에서 가중치 <span class="math inline">\(w_i\)</span>를 선택할 필요가 없다는 것이다. 반면, 단점은 데이터가 다변량 정규분포를 따른다는 강한 가정을 전제로 하며, 대규모 데이터셋의 경우 관측 수에 해당하는 크기의 선형 시스템을 반복적으로 풀어야 한다는 점이다. Heaton et al.&nbsp;(2018)은 대규모 데이터셋에 모형을 적합하는 데 특화된 접근법을 비교한다.</p>
</section><section id="크리깅-인터폴레이션" class="level2" data-number="12.4"><h2 data-number="12.4" class="anchored" data-anchor-id="크리깅-인터폴레이션">
<span class="header-section-number">12.4</span> 크리깅 인터폴레이션</h2>
<p>일반적으로 인터폴레이션은 연구 대상 지역을 덮는 규칙 그리드 지점들을 대상으로 수행된다. 먼저, 해당 지역을 포함하되 외부 영역은 <code>NA</code>로 채워진 래스터(<code>stars</code> 객체)를 생성한다.</p>
<p>크리깅은 연구 대상 지역 내 임의 지점 <span class="math inline">\(Z(s_0)\)</span>의 속성값을 예측하는 방법이다. <strong>gstat</strong> 패키지의 <code><a href="https://r-spatial.github.io/gstat/reference/krige.html">krige()</a></code> 함수를 사용하면 NO₂ 값을 크리깅할 수 있으며, 이때 경향면 모형, 데이터, 예측 그리드, 베리오그램 모형을 인수로 함께 전달한다(그림 12.6).</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/krige.html">krige</a></span><span class="op">(</span><span class="va">NO2</span><span class="op">~</span><span class="fl">1</span>, <span class="va">no2.sf</span>, <span class="va">grd</span>, <span class="va">v.m</span><span class="op">)</span></span>
<span><span class="co"># [using ordinary kriging]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/geom_stars.html">geom_stars</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">k</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">var1.pred</span>, x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="va">de</span>, <span class="st">"MULTILINESTRING"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">no2.sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>lims_method <span class="op">=</span> <span class="st">"geometry_bbox"</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-12-6" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-krigeovergermany-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" data-glightbox="description: .lightbox-desc-6"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-krigeovergermany-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.6: 독일의 NO<span class="math inline">\(_2\)</span> 농도 크리깅의 결과
</figcaption></figure>
</div>
</section><section id="에어리어-평균-블록-크리깅" class="level2" data-number="12.5"><h2 data-number="12.5" class="anchored" data-anchor-id="에어리어-평균-블록-크리깅">
<span class="header-section-number">12.5</span> 에어리어 평균: 블록 크리깅</h2>
<p>에어리어 평균을 계산하는 방법에는 여러 가지가 있다. 그중 가장 간단한 방법은 대상 폴리곤 내부에 포함된 포인트 샘플들의 값을 평균하는것이다.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">no2.sf</span><span class="op">[</span><span class="st">"NO2"</span><span class="op">]</span>, by <span class="op">=</span> <span class="va">de</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>더 복잡한 방법으로는 블록 크리깅(block kriging, Journel and Huijbregts 1978)이 있으며, 이는 타깃 에어리어의 평균값을 추정하기 위해 모든 데이터를 활용한다. <code><a href="https://r-spatial.github.io/gstat/reference/krige.html">krige()</a></code> 함수의 <code>newdata</code> 인수에 타깃 에어리어(폴리곤)을 전달하면 된다.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/krige.html">krige</a></span><span class="op">(</span><span class="va">NO2</span><span class="op">~</span><span class="fl">1</span>, <span class="va">no2.sf</span>, <span class="va">de</span>, <span class="va">v.m</span><span class="op">)</span></span>
<span><span class="co"># [using ordinary kriging]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>두 지도를 하나의 객체로 병합해 단일 플롯으로 표현한다(그림 12.7).</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="va">NO2</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">kriging</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">var1.pred</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">kriging</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, names_to <span class="op">=</span> <span class="st">"var"</span>, values_to <span class="op">=</span> <span class="st">"NO2"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">b2</span></span>
<span><span class="va">b2</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">b2</span><span class="op">$</span><span class="va">var</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="st">"kriging"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">b2</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">NO2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">var</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-12-7" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-aggregations-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" data-glightbox="description: .lightbox-desc-7"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-aggregations-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.7: 단순 평균 계산법(왼쪽)과 블록 크리깅(오른쪽)을 통해 계산한 NO<span class="math inline">\(_2\)</span> 농도 집계값
</figcaption></figure>
</div>
<p>패턴은 유사하지만, 단순 평균을 통한 샘플 평균이 블록 크리깅 결과보다 변동성이 더 크다. 이는 크리깅에서 집계 영역 외부의 데이터 포인트에도 가중치를 부여되기 때문에 발생하는 평활화 효과 때문일 수 있다.</p>
<p>표준 오차의 대략적인 추정치는 <span class="math inline">\(\sqrt{(\sigma^2 /n)}\)</span>으로 계산할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">no2.sf</span><span class="op">[</span><span class="st">"NO2"</span><span class="op">]</span>, <span class="va">de</span>, <span class="va">SE</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>샘플이 공간적으로 무작위 표본 추출을 통해 얻어진 경우, 디자인 기반 추론(10.4절)에서 실제 추정치는 위와 같았을 것이다. 블록 크리깅 분산은 모형 기반 추정치이며, 크리깅의 부산물로 계산된다. 그림 12.8에서 두 값을 비교하면, 단순 평균 접근법이 블록 크리깅에 비해 구역 평균의 예측 오차에서 변동성이 더 클 뿐 아니라, 그 값 자체도 더 크다는 것을 확인할 수 있다.</p>
<div id="fig-12-8" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-aggrSE-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" data-glightbox="description: .lightbox-desc-8"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-aggrSE-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.8: 단순 평균 계산법(왼쪽)과 블록 크리깅(오른쪽)을 통해 산출한 평균 NO<span class="math inline">\(_2\)</span> 농도의 표준 오차
</figcaption></figure>
</div>
</section><section id="조건부-시뮬레이션" class="level2" data-number="12.6"><h2 data-number="12.6" class="anchored" data-anchor-id="조건부-시뮬레이션">
<span class="header-section-number">12.6</span> 조건부 시뮬레이션</h2>
<p>필드 <span class="math inline">\(Z(s)\)</span>의 조건부 평균이 아니라, 하나 또는 여러 개의 조건부 실현이 필요한 경우, 조건부 시뮬레이션을 활용한다.(역자주: ’조건부 실현’이란, 이미 관측된 자료를 조건으로 하여 공간 필드 <span class="math inline">\(Z(s)\)</span>의 가능한 한 가지 구체적인 분포 패턴을 생성한 결과를 의미한다. 반면 ’조건부 시뮬레이션’은 이러한 조건부 실현을 여러 번 생성하는 과정을 말한다. 조건부 평균이 하나의 “가장 그럴듯한” 값만 제공하는 데 비해, 조건부 시뮬레이션은 불확실성을 반영한 다양한 가능성을 탐색할 수 있다는 장점이 있다. 이를 통해 단순 평균값 예측만으로는 얻기 어려운 확률적 특성이나 극단값 발생 가능성 등을 평가할 수 있다.) 이러한 조건부 실현이 필요한 상황은, 비선형 함수 <span class="math inline">\(g(\cdot)\)</span>을 통해 <span class="math inline">\(Z(s)\)</span>의 구역 평균 값 <span class="math inline">\(g(Z(s))\)</span>를 추정해야 하는 경우에 해당된다. 간단한 예로는 <span class="math inline">\(Z(s)\)</span>가 특정 임계값을 초과하는 지역이 존재하는지를 평가하는 경우를 들 수 있다.</p>
<p><strong>gstat</strong> 패키지의 기본 접근법은 이를 위해 순차(sequential) 시뮬레이션 알고리즘을 사용한다. 이 알고리즘은 예측 대상 위치들을 무작위로 순회하며, 각 위치에서 다음 단계를 수행한다.</p>
<ul>
<li><p>해당 위치에서 크리깅 예측을 수행한다.</p></li>
<li><p>크리깅 분산과 동일한 평균과 분산을 갖는 정규분포로부터 난수를 생성한다.</p></li>
<li><p>이 값을 조건부 데이터셋에 추가한다.</p></li>
<li><p>새로운 무작위 시뮬레이션 위치를 찾는다.</p></li>
</ul>
<p>위 과정을 모든 위치에 대해 반복한다.</p>
<p><strong>gstat</strong> 패키지의 <code><a href="https://r-spatial.github.io/gstat/reference/krige.html">krige()</a></code> 함수가 이를 수행하며, <code>nsim</code> 인수를 양수로 설정하면 조건부 시뮬레이션이 실행된다. <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code>를 설정한 것은 시뮬레이션 결과가 실행될 때마다 달라지지 않도록, 즉 재현 가능성을 확보하기 위함이다.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">13341</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/krige.html">krige</a></span><span class="op">(</span><span class="va">NO2</span><span class="op">~</span><span class="fl">1</span>, <span class="va">no2.sf</span>, <span class="va">grd</span>, <span class="va">v.m</span>, nmax <span class="op">=</span> <span class="fl">30</span>, nsim <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># drawing 6 GLS realisations of beta...</span></span>
<span><span class="co"># [using conditional Gaussian simulation]</span></span>
<span><span class="co"># stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#       Min. 1st Qu. Median Mean 3rd Qu. Max.  NA's</span></span>
<span><span class="co"># var1  -5.7    6.12   8.68 8.88    11.5 23.9 12456</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#        from to  offset  delta            refsys        values x/y</span></span>
<span><span class="co"># x         1 65  280741  10000 WGS 84 / UTM z...          NULL [x]</span></span>
<span><span class="co"># y         1 87 6101239 -10000 WGS 84 / UTM z...          NULL [y]</span></span>
<span><span class="co"># sample    1  6      NA     NA                NA sim1,...,sim6</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>크리깅 추정 시 포함할 최근접 이웃의 최대 개수는 <code>nmax</code> 인수를 통해 제한할 수 있다. 이는 단계가 진행됨에 따라 조건부 데이터셋이 계속 증가하면서 계산 시간이 길어지고 메모리 사용량이 커지기 문제를 방지하기 위함이다. 조건부 시뮬레이션 결과가 그림 12.9에 나타나 있다.</p>
<div id="fig-12-9" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-plotkrigingvalues-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" data-glightbox="description: .lightbox-desc-9"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-plotkrigingvalues-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.9: NO<span class="math inline">\(_2\)</span> 농도에 대한 여섯 가지 조건부 시뮬레이션 결과
</figcaption></figure>
</div>
<p><strong>gstat</strong> 패키지에는 최근 조건부 시뮬레이션의 대안 기법이 추가되었으며, 원형 임베딩(circular embedding) 기법을 구현한 함수 <code><a href="https://r-spatial.github.io/gstat/reference/krigeSimCE.html">krigeSimCE()</a></code>(Davies와 Bryant, 2013)와 터닝 밴드(turning band) 기법을 구현한 함수 <code><a href="https://r-spatial.github.io/gstat/reference/krigeSTSimTB.html">krigeSTSimTB()</a></code>(Schlather, 2011)가 있다. 이러한 기법들은 대규모 데이터셋이나 시공간 데이터셋의 조건부 시뮬레이션에 특히 유용하다.</p>
</section><section id="경향-모형" class="level2" data-number="12.7"><h2 data-number="12.7" class="anchored" data-anchor-id="경향-모형">
<span class="header-section-number">12.7</span> 경향 모형</h2>
<p>이 장에서 사용된 크리깅과 조건부 시뮬레이션은 모든 공간 변동성이 공간 공분산 모형으로 특징지어지는 무작위 과정이라고 가정한다. 그러나 타깃 변수와 의미 있게 상관된 다른 변수가 있는 경우, 이러한 변수를 경향 모형(trend model)을 위한 선형 회귀 모형에 포함될 수 있다.(여기서 ’경향 모형’은 공간데이터의 평균 구조를 설명하는 회귀 기반 모형을 의미한다. 즉, 타깃 변수와 상관된 하나 이상의 보조 변수를 설명변수로 포함하여 기대값을 추정하고, 잔차에 대해 공간적 자기상관 구조를 모형화한다. 이는 공간적 인터폴레이션 기법인 경향면 분석(trend surface analysis)과는 다른 개념이다.)</p>
<p><span class="math display">\[
Z(s)=\sum^p_{j=0} \beta_jX_j(s)+e(s)
\]</span></p>
<p>여기서 <span class="math inline">\(X_0(s)=1\)</span>, <span class="math inline">\(\beta_0\)</span>는 절편, <span class="math inline">\(\beta_j\)</span>는 각 변수에 대한 회귀계수이다. 변수를 추가하면 일반적으로 잔차 <span class="math inline">\(e(s)\)</span>의 공간적 자기상관과 분산이 모두 감소하여, 더 정확한 예측과 유사한 조건부 시뮬레이션 결과를 얻을 수 있다. NO<span class="math inline">\(_2\)</span>의 변동에 대한 설명 변수로 인구 밀도 변수를 사용하는 예를 살펴본다.</p>
<section id="인구-밀도-그리드" class="level3" data-number="12.7.1"><h3 data-number="12.7.1" class="anchored" data-anchor-id="인구-밀도-그리드">
<span class="header-section-number">12.7.1</span> 인구 밀도 그리드</h3>
<p>대기 중 NO<span class="math inline">\(_2\)</span>의 예측 변수로 인구 밀도를 사용한다. NO<span class="math inline">\(_2\)</span>는 주로 교통에서 발생하며, 교통량은 인구 밀도가 높은 지역에서 더 집중된다. 인구 밀도 데이터는 2011년 인구 조사에서 얻어진 것으로, 100m × 100m 그리드 셀당 거주자 수가 CSV 파일에 포함되어 있다. 이 데이터를 타깃 그리드 셀에 맞춰 합산하여 새로운 집계 데이터를 생성할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="fu">::</span><span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"aq/pop/Zensus_Bevoelkerung_100m-Gitter.csv"</span><span class="op">)</span></span>
<span><span class="va">v</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Einwohner</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Gitter_ID_100m</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x_mp_100m"</span>, <span class="st">"y_mp_100m"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">3035</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">grd</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">b</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">b</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">grd</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>위의 코드를 통해 집계된 타깃 그리드 셀의 인구 수가 <code>a</code>에 저장된다. 인구 밀도를 계산하려면 각 셀의 면적이 필요한데, 국경과 겹치는 셀의 경우 면적이 10km × 10km보다 작을 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grd</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">grd</span><span class="op">)</span><span class="op">)</span> <span class="co"># to identify grid cells</span></span>
<span><span class="va">ii</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span><span class="va">grd</span><span class="op">[</span><span class="st">"ID"</span><span class="op">]</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">de</span><span class="op">)</span>, <span class="st">"MULTILINESTRING"</span><span class="op">)</span>, as_points <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">grd_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">grd</span><span class="op">[</span><span class="st">"ID"</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">ii</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_agr.html">st_agr</a></span><span class="op">(</span><span class="va">grd_sf</span><span class="op">)</span> <span class="op">=</span> <span class="st">"identity"</span></span>
<span><span class="va">iii</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_intersection</a></span><span class="op">(</span><span class="va">grd_sf</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">de</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grd</span><span class="op">$</span><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">grd</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> </span>
<span>    <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="va">grd</span><span class="op">$</span><span class="va">values</span>, <span class="va">m</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">grd</span><span class="op">$</span><span class="va">area</span><span class="op">[</span><span class="va">iii</span><span class="op">$</span><span class="va">ID</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">iii</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>위의 두 단계 과정(먼저 국경에 걸친 셀을 찾은 뒤 면적을 계산하는 과정)을 거치지 않고, 모든 셀에 바로 <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_intersection()</a></code> 함수를 적용하는 방법도 있다. 그러나 이 방법은 오퍼레이션 시간이 오래 걸린다는 단점이 있다. 인구 수와 면적을 이용해 인구 밀도를 계산하고(그림 12.10), 총계가 맞는지 확인해 본다.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grd</span><span class="op">$</span><span class="va">pop_dens</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="va">Einwohner</span> <span class="op">/</span> <span class="va">grd</span><span class="op">$</span><span class="va">area</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">grd</span><span class="op">$</span><span class="va">pop_dens</span> <span class="op">*</span> <span class="va">grd</span><span class="op">$</span><span class="va">area</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># verify</span></span>
<span><span class="co"># 80323301 [1]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">Einwohner</span><span class="op">)</span></span>
<span><span class="co"># [1] 80324282</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>두 값이 상당히 잘 일치하는 것을 확인할 수 있다. <code><a href="https://r-spatial.github.io/sf/reference/interpolate_aw.html">st_interpolate_aw()</a></code> 함수를 사용했다면, 완전히 동일한 결과를 얻었을 것이다. 인구 수를 인구 밀도로 변환하려면 해당 인구 수를 100m × 100m 그리드 셀의 면적으로 나누어야 한다.</p>
<div id="fig-12-10" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-popdens-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" data-glightbox="description: .lightbox-desc-10"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-popdens-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.10: 100m x 100m 그리드 셀별 인구 밀도
</figcaption></figure>
</div>
<p>대기질 관측소가 위치한 지점의 인구 밀도 값을 추출하기 위해 <code><a href="https://r-spatial.github.io/stars/reference/st_extract.html">st_extract()</a></code> 함수를 사용한다.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="st">"pop_dens"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_extract.html">st_extract</a></span><span class="op">(</span><span class="va">no2.sf</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="st">"pop_dens"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">no2.sf</span>, pop_dens <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">no2.sf</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>그런 다음, 관측소 위치에서 NO<span class="math inline">\(_2\)</span>와 인구 밀도 사이의 선형 관계를 살펴볼 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">NO2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">pop_dens</span><span class="op">)</span>, <span class="va">no2.sf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># lm(formula = NO2 ~ sqrt(pop_dens), data = no2.sf)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Residuals:</span></span>
<span><span class="co">#    Min     1Q Median     3Q    Max </span></span>
<span><span class="co"># -7.990 -2.052 -0.505  1.610  8.095 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Coefficients:</span></span>
<span><span class="co">#                Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co"># (Intercept)       4.537      0.685    6.62  5.5e-09 ***</span></span>
<span><span class="co"># sqrt(pop_dens)  326.154     49.366    6.61  5.8e-09 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Residual standard error: 3.13 on 72 degrees of freedom</span></span>
<span><span class="co"># Multiple R-squared:  0.377,   Adjusted R-squared:  0.369 </span></span>
<span><span class="co"># F-statistic: 43.7 on 1 and 72 DF,  p-value: 5.82e-09</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>두 변수 간의 선형 관계는 그림 12.11의 산점도에서 확인할 수 있다.</p>
<div id="fig-12-11" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-no2scat-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" data-glightbox="description: .lightbox-desc-11"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-no2scat-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.11: 2017년 농촌 지역 대기질 관측소의 연평균 NO<span class="math inline">\(_2\)</span> 농도와 인구 밀도의 산점도
</figcaption></figure>
</div>
<p>이 새로운 모형을 사용해 예측을 수행하려면, 먼저 잔차 베리오그램을 모형화해야 한다(그림 12.12).</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">no2.sf</span> <span class="op">&lt;-</span> <span class="va">no2.sf</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">no2.sf</span><span class="op">$</span><span class="va">pop_dens</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">vr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/variogram.html">variogram</a></span><span class="op">(</span><span class="va">NO2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">pop_dens</span><span class="op">)</span>, <span class="va">no2.sf</span><span class="op">)</span></span>
<span><span class="va">vr.m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/fit.variogram.html">fit.variogram</a></span><span class="op">(</span><span class="va">vr</span>, <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/vgm.html">vgm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"Exp"</span>, <span class="fl">50000</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-12.12" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12.12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-predictusingpopulationdensity-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" data-glightbox="description: .lightbox-desc-12"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-predictusingpopulationdensity-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12.12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.12: 인구 밀도 경향을 제거한 후 잔차에 대해 계산한 베리오그램
</figcaption></figure>
</div>
<p>그리고 나서 아래의 코드를 사용해 크리깅 예측을 수행한다. 이 때 중요한 점은, 예측 대상 위치에 대해서도 <code>pop_dens</code> 값이 계산되어 새로 생성되는 객체 <code>grd</code>에 포함된다는 것이다. 예측 결과는 그림 12.13에 나타나 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/krige.html">krige</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">pop_dens</span><span class="op">)</span>, <span class="va">no2.sf</span>, </span>
<span>            <span class="va">grd</span><span class="op">[</span><span class="st">"pop_dens"</span><span class="op">]</span>, <span class="va">vr.m</span><span class="op">)</span></span>
<span><span class="co"># [using universal kriging]</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-12-13" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-12-13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-residualkriging-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" data-glightbox="description: .lightbox-desc-13"><img src="https://r-spatial.org/book/12-Interpolation_files/figure-html/fig-residualkriging-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-12-13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;12.13: 인구 밀도를 경향 변수로 활용한 크리깅 기반 NO<span class="math inline">\(_2\)</span> 농도 예측값
</figcaption></figure>
</div>
<p>(오디너리) 크리깅과 비교하면 몇 가지 뚜렷한 차이가 나타난다. 인구 밀도를 경향 변수로 사용한 크리깅 결과 지도는 측정소의 극단적인 값보다는 인구 밀도의 극단적인 값을 따르는 경향을 보이며, 값의 범위도 오디너리 크리깅보다 넓다. 그러나 사용된 측정소가 모두 “농촌 배경” 범주에 속해 전반적으로 인구 밀도가 낮다는 점에서, 결과 해석에는 주의가 필요하다. 그림 12.11의 산점도에서 x축을 보면, 측정소의 인구 밀도 값이 인구 밀도 지도에 나타난 값의 범위보다 훨씬 좁다는 사실을 알 수 있다. 따라서 오른쪽 지도는 그림 12.11의 관계를 강하게 반영하여 인터폴레이션한 결과라 할 수 있다.</p>
</section></section><section id="연습문제" class="level2" data-number="12.8"><h2 data-number="12.8" class="anchored" data-anchor-id="연습문제">
<span class="header-section-number">12.8</span> 연습문제</h2>
<ol type="1">
<li><p>그림 12.13과 동일한 플롯을 생성하되, 왼쪽 패널에 그림 12.2의 역거리 가중 인터폴레이션 지도를 추가하시오.</p></li>
<li><p>역거리 가중 인터폴레이션 결과와 크리깅 결과 간 산점도를 작성하고, 역거리 가중 인터폴레이션 결과와 잔차 크리깅 결과 간 산점도를 작성하시오.</p></li>
<li><p>그리드 셀을 중심으로 하는 블록 평균을 예측하기 위해 <code><a href="https://r-spatial.github.io/gstat/reference/krige.html">krige()</a></code> 함수의 <code>block</code> 인수를 사용하여 블록 크기 10km(그리드 셀 크기), 50km, 200km로 설정한 <em>블록 크리깅</em>을 수행하시오. 세 가지 블록 크기에 대한 추정치 결과 지도를 포인트 크리깅 결과 지도와 비교하고, 각 경우에 해당하는 크리깅 표준 오차 지도도 동일하게 비교하시오.</p></li>
<li><p>위에서 얻은 잔차 크리깅 결과를 기반으로, 크리깅 오차가 정규분포를 따른다고 가정하여 95% 신뢰구간의 하한선과 상한선에 해당하는 지도를 산출하고, 이를 단일(공통) 범례를 사용하여 플로팅하시오.</p></li>
<li><p>크리깅 오차가 정규분포를 따른다고 가정할 때, NO<span class="math inline">\(_2\)</span>의 포인트 값이 15 ppm을 초과할 확률을 계산하여 이를 지도로 표현하시오.</p></li>
</ol>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">그림&nbsp;12.1: 독일의 농촌 지역 관측소들에 높은 평균 NO<span class="math inline">\(_2\)</span> 값이 집중해 있다.</span>
<span class="glightbox-desc lightbox-desc-2">그림&nbsp;12.2: 독일 NO<span class="math inline">\(_2\)</span> 집중도에 대한 역거리 가중 인터폴레이션의 결과</span>
<span class="glightbox-desc lightbox-desc-3">그림&nbsp;12.3: 샘플 베리오그램 플롯</span>
<span class="glightbox-desc lightbox-desc-4">그림&nbsp;12.4: 변경된 설정값을 적용하여 생성한 샘플 베리오그램</span>
<span class="glightbox-desc lightbox-desc-5">그림&nbsp;12.5: 샘플 베리오그램(가운데가 비어 있는 점) 위에, 가중 최소제곱법(실선) 및 최대우도추정법(점선)으로 적합한 모형이 함께 표시되어 있다.</span>
<span class="glightbox-desc lightbox-desc-6">그림&nbsp;12.6: 독일의 NO<span class="math inline">\(_2\)</span> 농도 크리깅의 결과</span>
<span class="glightbox-desc lightbox-desc-7">그림&nbsp;12.7: 단순 평균 계산법(왼쪽)과 블록 크리깅(오른쪽)을 통해 계산한 NO<span class="math inline">\(_2\)</span> 농도 집계값</span>
<span class="glightbox-desc lightbox-desc-8">그림&nbsp;12.8: 단순 평균 계산법(왼쪽)과 블록 크리깅(오른쪽)을 통해 산출한 평균 NO<span class="math inline">\(_2\)</span> 농도의 표준 오차</span>
<span class="glightbox-desc lightbox-desc-9">그림&nbsp;12.9: NO<span class="math inline">\(_2\)</span> 농도에 대한 여섯 가지 조건부 시뮬레이션 결과</span>
<span class="glightbox-desc lightbox-desc-10">그림&nbsp;12.10: 100m x 100m 그리드 셀별 인구 밀도</span>
<span class="glightbox-desc lightbox-desc-11">그림&nbsp;12.11: 2017년 농촌 지역 대기질 관측소의 연평균 NO<span class="math inline">\(_2\)</span> 농도와 인구 밀도의 산점도</span>
<span class="glightbox-desc lightbox-desc-12">그림&nbsp;12.12: 인구 밀도 경향을 제거한 후 잔차에 대해 계산한 베리오그램</span>
<span class="glightbox-desc lightbox-desc-13">그림&nbsp;12.13: 인구 밀도를 경향 변수로 활용한 크리깅 기반 NO<span class="math inline">\(_2\)</span> 농도 예측값</span>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "복사완료!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "복사완료!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./11.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">포인트 패턴 분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13.html" class="pagination-link" aria-label="<span class='chapter-number'>13</span>&nbsp; <span class='chapter-title'>다변량 및 시공간 지구통계학</span>">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">다변량 및 시공간 지구통계학</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sangillee66/book_sds_trans/issues/new" class="toc-action"><i class="bi bi-github"></i>이슈 보고</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"loop":false,"descPosition":"bottom","closeEffect":"zoom","openEffect":"zoom","selector":".lightbox"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>